//>>built
define("dojox/lang/aspect",["dojo","dijit","dojox"],function(e,t,i){e.provide("dojox.lang.aspect"),function(){var t,a=e,r=i.lang.aspect,o=Array.prototype,n=[],s=function(){this.next_before=this.prev_before=this.next_around=this.prev_around=this.next_afterReturning=this.prev_afterReturning=this.next_afterThrowing=this.prev_afterThrowing=this,this.counter=0};a.extend(s,{add:function(e){var t=a.isFunction(e),i={advice:e,dynamic:t};return this._add(i,"before","",t,e),this._add(i,"around","",t,e),this._add(i,"after","Returning",t,e),this._add(i,"after","Throwing",t,e),++this.counter,i},_add:function(e,t,i,a,r){var o=t+i;if(a||r[t]||i&&r[o]){var n="next_"+o,s="prev_"+o;(e[s]=this[s])[n]=e,(e[n]=this)[s]=e}},remove:function(e){this._remove(e,"before"),this._remove(e,"around"),this._remove(e,"afterReturning"),this._remove(e,"afterThrowing"),--this.counter},_remove:function(e,t){var i="next_"+t,a="prev_"+t;e[i]&&(e[i][a]=e[a],e[a][i]=e[i])},isEmpty:function(){return!this.counter}});var l=function(){return function(){var e,i,a,s,l,d=arguments.callee,u=d.advices;t&&n.push(t),t={instance:this,joinPoint:d,depth:n.length,around:u.prev_around,dynAdvices:[],dynIndex:0};try{for(i=u.prev_before;i!=u;i=i.prev_before)i.dynamic?(t.dynAdvices.push(a=new i.advice(t)),(l=a.before)&&l.apply(a,arguments)):(l=i.advice,l.before.apply(l,arguments));try{e=(u.prev_around==u?d.target:r.proceed).apply(this,arguments)}catch(s){for(t.dynIndex=t.dynAdvices.length,i=u.next_afterThrowing;i!=u;i=i.next_afterThrowing)a=i.dynamic?t.dynAdvices[--t.dynIndex]:i.advice,(l=a.afterThrowing)&&l.call(a,s),(l=a.after)&&l.call(a);throw s}for(t.dynIndex=t.dynAdvices.length,i=u.next_afterReturning;i!=u;i=i.next_afterReturning)a=i.dynamic?t.dynAdvices[--t.dynIndex]:i.advice,(l=a.afterReturning)&&l.call(a,e),(l=a.after)&&l.call(a);var c=d._listeners;for(i in c)i in o||c[i].apply(this,arguments)}finally{for(i=0;i<t.dynAdvices.length;++i)a=t.dynAdvices[i],a.destroy&&a.destroy();t=n.length?n.pop():null}return e}};r.advise=function(e,t,i){"object"!=typeof e&&(e=e.prototype);var o=[];t instanceof Array||(t=[t]);for(var n=0;n<t.length;++n){var s=t[n];if(s instanceof RegExp)for(var l in e)a.isFunction(e[l])&&s.test(l)&&o.push(l);else a.isFunction(e[s])&&o.push(s)}return a.isArray(i)||(i=[i]),r.adviseRaw(e,o,i)},r.adviseRaw=function(e,t,i){if(!t.length||!i.length)return null;for(var a={},r=i.length,o=t.length-1;o>=0;--o){var n=t[o],d=e[n],u=new Array(r),c=d.advices;if(!c){var h=e[n]=l();h.target=d.target||d,h.targetName=n,h._listeners=d._listeners||[],h.advices=new s,c=h.advices}for(var m=0;r>m;++m)u[m]=c.add(i[m]);a[n]=u}return[e,a]},r.unadvise=function(e){if(e){var t=e[0],i=e[1];for(var r in i){for(var n=t[r],s=n.advices,l=i[r],d=l.length-1;d>=0;--d)s.remove(l[d]);if(s.isEmpty()){var u=!0,c=n._listeners;if(c.length)for(d in c)if(!(d in o)){u=!1;break}if(u)t[r]=n.target;else{var h=t[r]=a._listener.getDispatcher();h.target=n.target,h._listeners=c}}}}},r.getContext=function(){return t},r.getContextStack=function(){return n},r.proceed=function(){for(var e=t.joinPoint,i=e.advices,a=t.around;a!=i;a=t.around){if(t.around=a.prev_around,!a.dynamic)return a.advice.around.apply(a.advice,arguments);var r=t.dynAdvices[t.dynIndex++],o=r.around;if(o)return o.apply(r,arguments)}return e.target.apply(t.instance,arguments)}}()});//# sourceMappingURL=aspect.js.map