//>>built
define("dojox/lang/aspect",["dojo","dijit","dojox"],function(e,t,i){e.provide("dojox.lang.aspect"),function(){var t,a=e,o=i.lang.aspect,n=Array.prototype,r=[],s=function(){this.next_before=this.prev_before=this.next_around=this.prev_around=this.next_afterReturning=this.prev_afterReturning=this.next_afterThrowing=this.prev_afterThrowing=this,this.counter=0};a.extend(s,{add:function(e){var t=a.isFunction(e),i={advice:e,dynamic:t};return this._add(i,"before","",t,e),this._add(i,"around","",t,e),this._add(i,"after","Returning",t,e),this._add(i,"after","Throwing",t,e),++this.counter,i},_add:function(e,t,i,a,o){var n=t+i;if(a||o[t]||i&&o[n]){var r="next_"+n,s="prev_"+n;(e[s]=this[s])[r]=e,(e[r]=this)[s]=e}},remove:function(e){this._remove(e,"before"),this._remove(e,"around"),this._remove(e,"afterReturning"),this._remove(e,"afterThrowing"),--this.counter},_remove:function(e,t){var i="next_"+t,a="prev_"+t;e[i]&&(e[i][a]=e[a],e[a][i]=e[i])},isEmpty:function(){return!this.counter}});var l=function(){return function(){var e,i,a,s,l=arguments.callee,d=l.advices;t&&r.push(t),t={instance:this,joinPoint:l,depth:r.length,around:d.prev_around,dynAdvices:[],dynIndex:0};try{for(i=d.prev_before;i!=d;i=i.prev_before)i.dynamic?(t.dynAdvices.push(a=new i.advice(t)),(s=a.before)&&s.apply(a,arguments)):(s=i.advice,s.before.apply(s,arguments));try{e=(d.prev_around==d?l.target:o.proceed).apply(this,arguments)}catch(e){for(t.dynIndex=t.dynAdvices.length,i=d.next_afterThrowing;i!=d;i=i.next_afterThrowing)a=i.dynamic?t.dynAdvices[--t.dynIndex]:i.advice,(s=a.afterThrowing)&&s.call(a,e),(s=a.after)&&s.call(a);throw e}for(t.dynIndex=t.dynAdvices.length,i=d.next_afterReturning;i!=d;i=i.next_afterReturning)a=i.dynamic?t.dynAdvices[--t.dynIndex]:i.advice,(s=a.afterReturning)&&s.call(a,e),(s=a.after)&&s.call(a);var h=l._listeners;for(i in h)i in n||h[i].apply(this,arguments)}finally{for(i=0;i<t.dynAdvices.length;++i)a=t.dynAdvices[i],a.destroy&&a.destroy();t=r.length?r.pop():null}return e}};o.advise=function(e,t,i){"object"!=typeof e&&(e=e.prototype);var n=[];t instanceof Array||(t=[t]);for(var r=0;r<t.length;++r){var s=t[r];if(s instanceof RegExp)for(var l in e)a.isFunction(e[l])&&s.test(l)&&n.push(l);else a.isFunction(e[s])&&n.push(s)}return a.isArray(i)||(i=[i]),o.adviseRaw(e,n,i)},o.adviseRaw=function(e,t,i){if(!t.length||!i.length)return null;for(var a={},o=i.length,n=t.length-1;n>=0;--n){var r=t[n],d=e[r],h=new Array(o),u=d.advices;if(!u){var c=e[r]=l();c.target=d.target||d,c.targetName=r,c._listeners=d._listeners||[],c.advices=new s,u=c.advices}for(var m=0;m<o;++m)h[m]=u.add(i[m]);a[r]=h}return[e,a]},o.unadvise=function(e){if(e){var t=e[0],i=e[1];for(var o in i){for(var r=t[o],s=r.advices,l=i[o],d=l.length-1;d>=0;--d)s.remove(l[d]);if(s.isEmpty()){var h=!0,u=r._listeners;if(u.length)for(d in u)if(!(d in n)){h=!1;break}if(h)t[o]=r.target;else{var c=t[o]=a._listener.getDispatcher();c.target=r.target,c._listeners=u}}}}},o.getContext=function(){return t},o.getContextStack=function(){return r},o.proceed=function(){for(var e=t.joinPoint,i=e.advices,a=t.around;a!=i;a=t.around){if(t.around=a.prev_around,!a.dynamic)return a.advice.around.apply(a.advice,arguments);var o=t.dynAdvices[t.dynIndex++],n=o.around;if(n)return n.apply(o,arguments)}return e.target.apply(t.instance,arguments)}}()});//# sourceMappingURL=aspect.js.map