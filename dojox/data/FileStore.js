//>>built
define("dojox/data/FileStore",["dojo/_base/declare","dojo/_base/lang","dojo/_base/kernel","dojo/_base/json","dojo/_base/xhr"],function(e,t,i,a,r){return e("dojox.data.FileStore",null,{constructor:function(e){e&&e.label&&(this.label=e.label),e&&e.url&&(this.url=e.url),e&&e.options&&(t.isArray(e.options)?this.options=e.options:t.isString(e.options)&&(this.options=e.options.split(","))),e&&e.pathAsQueryParam&&(this.pathAsQueryParam=!0),e&&"urlPreventCache"in e&&(this.urlPreventCache=!!e.urlPreventCache)},url:"",_storeRef:"_S",label:"name",_identifier:"path",_attributes:["children","directory","name","path","modified","size","parentDir"],pathSeparator:"/",options:[],failOk:!1,urlPreventCache:!0,_assertIsItem:function(e){if(!this.isItem(e))throw new Error("dojox.data.FileStore: a function was passed an item argument that was not an item")},_assertIsAttribute:function(e){if("string"!=typeof e)throw new Error("dojox.data.FileStore: a function was passed an attribute argument that was not an attribute name string")},pathAsQueryParam:!1,getFeatures:function(){return{"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0}},getValue:function(e,t,i){var a=this.getValues(e,t);return a&&a.length>0?a[0]:i},getAttributes:function(e){return this._attributes},hasAttribute:function(e,t){return this._assertIsItem(e),this._assertIsAttribute(t),t in e},getIdentity:function(e){return this.getValue(e,this._identifier)},getIdentityAttributes:function(e){return[this._identifier]},isItemLoaded:function(e){var t=this.isItem(e);return t&&"boolean"==typeof e._loaded&&!e._loaded&&(t=!1),t},loadItem:function(e){var o=e.item,n=this,s=e.scope||i.global,d={};this.options.length>0&&(d.options=a.toJson(this.options)),this.pathAsQueryParam&&(d.path=o.parentPath+this.pathSeparator+o.name);var l={url:this.pathAsQueryParam?this.url:this.url+"/"+o.parentPath+"/"+o.name,handleAs:"json-comment-optional",content:d,preventCache:this.urlPreventCache,failOk:this.failOk},m=r.get(l);m.addErrback(function(t){e.onError&&e.onError.call(s,t)}),m.addCallback(function(i){delete o.parentPath,delete o._loaded,t.mixin(o,i),n._processItem(o),e.onItem&&e.onItem.call(s,o)})},getLabel:function(e){return this.getValue(e,this.label)},getLabelAttributes:function(e){return[this.label]},containsValue:function(e,t,i){for(var a=this.getValues(e,t),r=0;r<a.length;r++)if(a[r]==i)return!0;return!1},getValues:function(e,i){this._assertIsItem(e),this._assertIsAttribute(i);var a=e[i];return"undefined"==typeof a||t.isArray(a)?"undefined"==typeof a&&(a=[]):a=[a],a},isItem:function(e){return!(!e||e[this._storeRef]!==this)},close:function(e){},fetch:function(e){e=e||{},e.store||(e.store=this);var t=this,o=e.scope||i.global,n={};e.query&&(n.query=a.toJson(e.query)),e.sort&&(n.sort=a.toJson(e.sort)),e.queryOptions&&(n.queryOptions=a.toJson(e.queryOptions)),"number"==typeof e.start&&(n.start=""+e.start),"number"==typeof e.count&&(n.count=""+e.count),this.options.length>0&&(n.options=a.toJson(this.options));var s={url:this.url,preventCache:this.urlPreventCache,failOk:this.failOk,handleAs:"json-comment-optional",content:n},d=r.get(s);d.addCallback(function(i){t._processResult(i,e)}),d.addErrback(function(t){e.onError&&e.onError.call(o,t,e)})},fetchItemByIdentity:function(e){var t=e.identity,o=this,n=e.scope||i.global,s={};this.options.length>0&&(s.options=a.toJson(this.options)),this.pathAsQueryParam&&(s.path=t);var d={url:this.pathAsQueryParam?this.url:this.url+"/"+t,handleAs:"json-comment-optional",content:s,preventCache:this.urlPreventCache,failOk:this.failOk},l=r.get(d);l.addErrback(function(t){e.onError&&e.onError.call(n,t)}),l.addCallback(function(t){var i=o._processItem(t);e.onItem&&e.onItem.call(n,i)})},_processResult:function(e,t){var a=t.scope||i.global;try{e.pathSeparator&&(this.pathSeparator=e.pathSeparator),t.onBegin&&t.onBegin.call(a,e.total,t);var r=this._processItemArray(e.items);if(t.onItem){var o;for(o=0;o<r.length;o++)t.onItem.call(a,r[o],t);r=null}t.onComplete&&t.onComplete.call(a,r,t)}catch(n){t.onError&&t.onError.call(a,n,t)}},_processItemArray:function(e){var t;for(t=0;t<e.length;t++)this._processItem(e[t]);return e},_processItem:function(e){if(!e)return null;if(e[this._storeRef]=this,e.children&&e.directory)if(t.isArray(e.children)){var i,a=e.children;for(i=0;i<a.length;i++){var r=a[i];t.isObject(r)?a[i]=this._processItem(r):(a[i]={name:r,_loaded:!1,parentPath:e.path},a[i][this._storeRef]=this)}}else delete e.children;return e}})});//# sourceMappingURL=FileStore.js.map