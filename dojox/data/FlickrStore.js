//>>built
define("dojox/data/FlickrStore",["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/data/util/simpleFetch","dojo/io/script","dojo/_base/connect","dojo/date/stamp","dojo/AdapterRegistry"],function(e,t,i,a,r,o,n,d){var s=t("dojox.data.FlickrStore",null,{constructor:function(e){e&&e.label&&(this.label=e.label),e&&"urlPreventCache"in e&&(this.urlPreventCache=!!e.urlPreventCache)},_storeRef:"_S",label:"title",urlPreventCache:!0,_assertIsItem:function(e){if(!this.isItem(e))throw new Error("dojox.data.FlickrStore: a function was passed an item argument that was not an item")},_assertIsAttribute:function(e){if("string"!=typeof e)throw new Error("dojox.data.FlickrStore: a function was passed an attribute argument that was not an attribute name string")},getFeatures:function(){return{"dojo.data.api.Read":!0}},getValue:function(e,t,i){var a=this.getValues(e,t);return a&&a.length>0?a[0]:i},getAttributes:function(e){return["title","description","author","datePublished","dateTaken","imageUrl","imageUrlSmall","imageUrlMedium","tags","link"]},hasAttribute:function(e,t){var i=this.getValue(e,t);return!(!i&&""!==i&&i!==!1)},isItemLoaded:function(e){return this.isItem(e)},loadItem:function(e){},getLabel:function(e){return this.getValue(e,this.label)},getLabelAttributes:function(e){return[this.label]},containsValue:function(e,t,i){for(var a=this.getValues(e,t),r=0;r<a.length;r++)if(a[r]===i)return!0;return!1},getValues:function(t,i){this._assertIsItem(t),this._assertIsAttribute(i);var a=e.hitch(this,"_unescapeHtml"),r=e.hitch(n,"fromISOString");switch(i){case"title":return[a(t.title)];case"author":return[a(t.author)];case"datePublished":return[r(t.published)];case"dateTaken":return[r(t.date_taken)];case"imageUrlSmall":return[t.media.m.replace(/_m\./,"_s.")];case"imageUrl":return[t.media.m.replace(/_m\./,".")];case"imageUrlMedium":return[t.media.m];case"link":return[t.link];case"tags":return t.tags.split(" ");case"description":return[a(t.description)];default:return[]}},isItem:function(e){return!(!e||e[this._storeRef]!==this)},close:function(e){},_fetchItems:function(t,a,n){var d=t.query=t.query||{},s={format:"json",tagmode:"any"};i.forEach(["tags","tagmode","lang","id","ids"],function(e){d[e]&&(s[e]=d[e])}),s.id=d.id||d.userid||d.groupid,d.userids&&(s.ids=d.userids);var l=null,h={url:dojox.data.FlickrStore.urlRegistry.match(t),preventCache:this.urlPreventCache,content:s},u=e.hitch(this,function(e){l&&o.disconnect(l),a(this._processFlickrData(e),t)});l=o.connect("jsonFlickrFeed",u);var m=r.get(h);m.addErrback(function(e){o.disconnect(l),n(e,t)})},_processFlickrData:function(e){var t=[];if(e.items){t=e.items;for(var i=0;i<e.items.length;i++){var a=e.items[i];a[this._storeRef]=this}}return t},_unescapeHtml:function(e){return e.replace(/&amp;/gm,"&").replace(/&lt;/gm,"<").replace(/&gt;/gm,">").replace(/&quot;/gm,'"').replace(/&#39;/gm,"'")}});e.extend(s,a);var l="https://api.flickr.com/services/feeds/",h=s.urlRegistry=new d(!0);if(h.register("group pool",function(e){return!!e.query.groupid},l+"groups_pool.gne"),h.register("default",function(e){return!0},l+"photos_public.gne"),!u)var u=function(e){};return s});//# sourceMappingURL=FlickrStore.js.map