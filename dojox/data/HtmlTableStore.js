//>>built
define("dojox/data/HtmlTableStore",["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/dom","dojo/_base/array","dojo/_base/xhr","dojo/_base/sniff","dojo/data/util/simpleFetch","dojo/data/util/filter","dojox/xml/parser"],function(e,t,i,r,a,n,o,d,s,l){var u=t("dojox.data.HtmlTableStore",null,{constructor:function(t){if(e.deprecated("dojox.data.HtmlTableStore","Please use dojox.data.HtmlStore"),t.url){if(!t.tableId)throw new Error("dojo.data.HtmlTableStore: Cannot instantiate using url without an id!");this.url=t.url,this.tableId=t.tableId}else{t.tableId?(this._rootNode=r.byId(t.tableId),this.tableId=this._rootNode.id):this._rootNode=r.byId(this.tableId),this._getHeadings();for(var i=0;i<this._rootNode.rows.length;i++)this._rootNode.rows[i].store=this}},url:"",tableId:"",_getHeadings:function(){this._headings=[],a.forEach(this._rootNode.tHead.rows[0].cells,i.hitch(this,function(e){this._headings.push(l.textContent(e))}))},_getAllItems:function(){for(var e=[],t=1;t<this._rootNode.rows.length;t++)e.push(this._rootNode.rows[t]);return e},_assertIsItem:function(e){if(!this.isItem(e))throw new Error("dojo.data.HtmlTableStore: a function was passed an item argument that was not an item")},_assertIsAttribute:function(e){if("string"!=typeof e)throw new Error("dojo.data.HtmlTableStore: a function was passed an attribute argument that was not an attribute name string");return a.indexOf(this._headings,e)},getValue:function(e,t,i){var r=this.getValues(e,t);return r.length>0?r[0]:i},getValues:function(e,t){this._assertIsItem(e);var i=this._assertIsAttribute(t);return i>-1?[l.textContent(e.cells[i])]:[]},getAttributes:function(e){this._assertIsItem(e);for(var t=[],i=0;i<this._headings.length;i++)this.hasAttribute(e,this._headings[i])&&t.push(this._headings[i]);return t},hasAttribute:function(e,t){return this.getValues(e,t).length>0},containsValue:function(e,t,i){var r=void 0;return"string"==typeof i&&(r=s.patternToRegExp(i,!1)),this._containsValue(e,t,i,r)},_containsValue:function(e,t,i,r){for(var a=this.getValues(e,t),n=0;n<a.length;++n){var o=a[n];if("string"==typeof o&&r)return null!==o.match(r);if(i===o)return!0}return!1},isItem:function(e){return!(!e||!e.store||e.store!==this)},isItemLoaded:function(e){return this.isItem(e)},loadItem:function(e){this._assertIsItem(e.item)},_fetchItems:function(e,t,i){if(this._rootNode)this._finishFetchItems(e,t,i);else if(this.url){var a={url:this.url,handleAs:"text"},o=this,d=n.get(a);d.addCallback(function(r){var a=function(e,t){if(e.id==t)return e;if(e.childNodes)for(var i=0;i<e.childNodes.length;i++){var r=a(e.childNodes[i],t);if(r)return r}return null},n=document.createElement("div");n.innerHTML=r,o._rootNode=a(n,o.tableId),o._getHeadings.call(o);for(var d=0;d<o._rootNode.rows.length;d++)o._rootNode.rows[d].store=o;o._finishFetchItems(e,t,i)}),d.addErrback(function(t){i(t,e)})}else{this._rootNode=r.byId(this.tableId),this._getHeadings();for(var s=0;s<this._rootNode.rows.length;s++)this._rootNode.rows[s].store=this}},_finishFetchItems:function(e,t,i){var r=null,a=this._getAllItems();if(e.query){var n=e.queryOptions?e.queryOptions.ignoreCase:!1;r=[];var o,d,l={};for(d in e.query)o=e.query[d]+"","string"==typeof o&&(l[d]=s.patternToRegExp(o,n));for(var u=0;u<a.length;++u){var c=!0,f=a[u];for(d in e.query)o=e.query[d]+"",this._containsValue(f,d,o,l[d])||(c=!1);c&&r.push(f)}t(r,e)}else a.length>0&&(r=a.slice(0,a.length)),t(r,e)},getFeatures:function(){return{"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0}},close:function(e){},getLabel:function(e){return this.isItem(e)?"Table Row #"+this.getIdentity(e):void 0},getLabelAttributes:function(e){return null},getIdentity:function(e){return this._assertIsItem(e),o("opera")?a.indexOf(this._rootNode.rows,e)-1:e.sectionRowIndex},getIdentityAttributes:function(e){return null},fetchItemByIdentity:function(t){var i=t.identity,a=this,o=null,d=null;if(this._rootNode)this._rootNode.rows[i+1]&&(o=this._rootNode.rows[i+1],t.onItem&&(d=t.scope?t.scope:e.global,t.onItem.call(d,o)));else if(this.url){var s={url:this.url,handleAs:"text"},l=n.get(s);l.addCallback(function(r){var n=function(e,t){if(e.id==t)return e;if(e.childNodes)for(var i=0;i<e.childNodes.length;i++){var r=n(e.childNodes[i],t);if(r)return r}return null},s=document.createElement("div");s.innerHTML=r,a._rootNode=n(s,a.tableId),a._getHeadings.call(a);for(var l=0;l<a._rootNode.rows.length;l++)a._rootNode.rows[l].store=a;o=a._rootNode.rows[i+1],t.onItem&&(d=t.scope?t.scope:e.global,t.onItem.call(d,o))}),l.addErrback(function(i){t.onError&&(d=t.scope?t.scope:e.global,t.onError.call(d,i))})}else{this._rootNode=r.byId(this.tableId),this._getHeadings();for(var u=0;u<this._rootNode.rows.length;u++)this._rootNode.rows[u].store=this;o=this._rootNode.rows[i+1],t.onItem&&(d=t.scope?t.scope:e.global,t.onItem.call(d,o))}}});return i.extend(u,d),u});//# sourceMappingURL=HtmlTableStore.js.map