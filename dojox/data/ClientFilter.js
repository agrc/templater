//>>built
define("dojox/data/ClientFilter",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/data/util/filter"],function(e,t,a,i,r){var o=function(e,t,a){return function(i){e._updates.push({create:t&&i,remove:a&&i}),n.onUpdate()}},n=e("dojox.data.ClientFilter",null,{cacheByDefault:!1,constructor:function(){this.onSet=o(this,!0,!0),this.onNew=o(this,!0,!1),this.onDelete=o(this,!1,!0),this._updates=[],this._fetchCache=[]},clearCache:function(){this._fetchCache=[]},updateResultSet:function(e,t){if(this.isUpdateable(t)){for(var i=t._version||0;i<this._updates.length;i++){var r=this._updates[i].create,o=this._updates[i].remove;if(o)for(var n=0;n<e.length;n++)if(this.getIdentity(e[n])==this.getIdentity(o)){e.splice(n--,1);var d=!0}r&&this.matchesQuery(r,t)&&-1==a.indexOf(e,r)&&(e.push(r),d=!0)}return t.sort&&d&&e.sort(this.makeComparator(t.sort.concat())),e._fullLength=e.length,t.count&&d&&t.count!==1/0&&e.splice(t.count,e.length),t._version=this._updates.length,d?2:1}return 0},querySuperSet:function(e,a){if(e.query==a.query)return{};if(!(a.query instanceof Object)||e.query&&"object"!=typeof e.query)return!1;var i=t.mixin({},a.query);for(var o in e.query)if(i[o]==e.query[o])delete i[o];else if("string"!=typeof e.query[o]||!r.patternToRegExp(e.query[o]).test(i[o]))return!1;return i},serverVersion:0,cachingFetch:function(e){for(var r=this,o=0;o<this._fetchCache.length;o++){var n=this._fetchCache[o],d=this.querySuperSet(n,e);if(d!==!1){var s=n._loading;s||(s=new i,s.callback(n.cacheResults)),s.addCallback(function(a){return a=r.clientSideFetch(t.mixin(t.mixin({},e),{query:d}),a),s.fullLength=a._fullLength,a}),e._version=n._version;break}}if(!s){var l=t.mixin({},e),m=(e.queryOptions||0).cache,u=this._fetchCache;(void 0===m?this.cacheByDefault:m)&&((e.start||e.count)&&(delete l.start,delete l.count,e.clientQuery=t.mixin(e.clientQuery||{},{start:e.start,count:e.count})),e=l,u.push(e)),s=e._loading=this._doQuery(e),s.addErrback(function(){u.splice(a.indexOf(u,e),1)})}var c=this.serverVersion;return s.addCallback(function(t){return delete e._loading,t&&(e._version="number"==typeof e._version?e._version:c,r.updateResultSet(t,e),e.cacheResults=t,(!e.count||t.length<e.count)&&(s.fullLength=(e.start?e.start:0)+t.length)),t}),s},isUpdateable:function(e){return!e.query||"object"==typeof e.query},clientSideFetch:function(e,t){if(e.queryOptions&&e.queryOptions.results&&(t=e.queryOptions.results),e.query)for(var a=[],i=0;i<t.length;i++){var r=t[i];r&&this.matchesQuery(r,e)&&a.push(t[i])}else a=e.sort?t.concat():t;return e.sort&&a.sort(this.makeComparator(e.sort.concat())),this.clientSidePaging(e,a)},clientSidePaging:function(e,t){var a=e.start||0,i=a||e.count?t.slice(a,a+(e.count||t.length)):t;return i._fullLength=t.length,i},matchesQuery:function(e,t){var a=t.query,i=t.queryOptions&&t.queryOptions.ignoreCase;for(var o in a){var n=a[o],d=this.getValue(e,o);if("string"==typeof n&&(n.match(/[\*\.]/)||i)?!r.patternToRegExp(n,i).test(d):d!=n)return!1}return!0},makeComparator:function(e){var t=e.shift();if(!t)return function(){return 0};var a=t.attribute,i=!!t.descending,r=this.makeComparator(e),o=this;return function(e,t){var n=o.getValue(e,a),d=o.getValue(t,a);return n!=d?d>n==i?1:-1:r(e,t)}}});return n.onUpdate=function(){},n});//# sourceMappingURL=ClientFilter.js.map