//>>built
define("dojox/data/AppStore",["dojo","dojox","dojo/data/util/simpleFetch","dojo/data/util/filter","dojox/atom/io/Connection"],function(e,t){e.experimental("dojox.data.AppStore");var i=e.declare("dojox.data.AppStore",null,{url:"",urlPreventCache:!1,xmethod:!1,_atomIO:null,_feed:null,_requests:null,_processing:null,_updates:null,_adds:null,_deletes:null,constructor:function(e){if(e&&e.url&&(this.url=e.url),e&&e.urlPreventCache&&(this.urlPreventCache=e.urlPreventCache),!this.url)throw new Error("A URL is required to instantiate an APP Store object")},_setFeed:function(e,t){this._feed=e;var i;for(i=0;i<this._feed.entries.length;i++)this._feed.entries[i].store=this;if(this._requests)for(i=0;i<this._requests.length;i++){var a=this._requests[i];a.request&&a.fh&&a.eh?this._finishFetchItems(a.request,a.fh,a.eh):a.clear?this._feed=null:a.add?this._feed.addEntry(a.add):a.remove&&this._feed.removeEntry(a.remove)}this._requests=null},_getAllItems:function(){for(var e=[],t=0;t<this._feed.entries.length;t++)e.push(this._feed.entries[t]);return e},_assertIsItem:function(e){if(!this.isItem(e))throw new Error("This error message is provided when a function is called in the following form: getAttribute(argument, attributeName).  The argument variable represents the member or owner of the object. The error is created when an item that does not belong to this store is specified as an argument.")},_assertIsAttribute:function(e){if("string"!=typeof e)throw new Error("The attribute argument must be a string. The error is created when a different type of variable is specified such as an array or object.");for(var i in t.atom.io.model._actions)if(i==e)return!0;return!1},_addUpdate:function(e){this._updates?this._updates.push(e):this._updates=[e]},getValue:function(e,t,i){var a=this.getValues(e,t);return a.length>0?a[0]:i},getValues:function(e,t){this._assertIsItem(e);var i=this._assertIsAttribute(t);if(i){if(("author"===t||"contributor"===t||"link"===t)&&e[t+"s"])return e[t+"s"];if("category"===t&&e.categories)return e.categories;if(e[t])return e=e[t],"Content"==e.nodeType?[e.value]:[e]}return[]},getAttributes:function(e){this._assertIsItem(e);var i=[];for(var a in t.atom.io.model._actions)this.hasAttribute(e,a)&&i.push(a);return i},hasAttribute:function(e,t){return this.getValues(e,t).length>0},containsValue:function(t,i,a){var r=void 0;return"string"==typeof a&&(r=e.data.util.filter.patternToRegExp(a,!1)),this._containsValue(t,i,a,r)},_containsValue:function(e,t,i,a,r){for(var o=this.getValues(e,t),n=0;n<o.length;++n){var d=o[n];if("string"==typeof d&&a)return r&&(d=d.replace(new RegExp(/^\s+/),""),d=d.replace(new RegExp(/\s+$/),"")),d=d.replace(/\r|\n|\r\n/g,""),null!==d.match(a);if(i===d)return!0}return!1},isItem:function(e){return e&&e.store&&e.store===this},isItemLoaded:function(e){return this.isItem(e)},loadItem:function(e){this._assertIsItem(e.item)},_fetchItems:function(e,i,a){if(this._feed)this._finishFetchItems(e,i,a);else{var r=!1;this._requests||(this._requests=[],r=!0),this._requests.push({request:e,fh:i,eh:a}),r&&(this._atomIO=new t.atom.io.Connection(!1,this.urlPreventCache),this._atomIO.getFeed(this.url,this._setFeed,null,this))}},_finishFetchItems:function(t,i,a){var r=null,o=this._getAllItems();if(t.query){var n=t.queryOptions?t.queryOptions.ignoreCase:!1;r=[];var d,s,l={};for(d in t.query)s=t.query[d]+"","string"==typeof s&&(l[d]=e.data.util.filter.patternToRegExp(s,n));for(var m=0;m<o.length;++m){var h=!0,u=o[m];for(d in t.query)s=t.query[d]+"",this._containsValue(u,d,s,l[d],t.trim)||(h=!1);h&&r.push(u)}}else o.length>0&&(r=o.slice(0,o.length));try{i(r,t)}catch(f){a(f,t)}},getFeatures:function(){return{"dojo.data.api.Read":!0,"dojo.data.api.Write":!0,"dojo.data.api.Identity":!0}},close:function(e){this._feed=null},getLabel:function(e){return this.isItem(e)?this.getValue(e,"title","No Title"):void 0},getLabelAttributes:function(e){return["title"]},getIdentity:function(e){return this._assertIsItem(e),this.getValue(e,"id")},getIdentityAttributes:function(e){return["id"]},fetchItemByIdentity:function(t){this._fetchItems({query:{id:t.identity},onItem:t.onItem,scope:t.scope},function(t,i){var a=i.scope;a||(a=e.global),t.length<1?i.onItem.call(a,null):i.onItem.call(a,t[0])},t.onError)},newItem:function(i){var a,r=new t.atom.io.model.Entry,o=null,n=null;for(var d in i)if(this._assertIsAttribute(d))switch(o=i[d],d){case"link":for(a in o)n=o[a],r.addLink(n.href,n.rel,n.hrefLang,n.title,n.type);break;case"author":for(a in o)n=o[a],r.addAuthor(n.name,n.email,n.uri);break;case"contributor":for(a in o)n=o[a],r.addContributor(n.name,n.email,n.uri);break;case"category":for(a in o)n=o[a],r.addCategory(n.scheme,n.term,n.label);break;case"icon":case"id":case"logo":case"xmlBase":case"rights":r[d]=o;break;case"updated":case"published":case"issued":case"modified":r[d]=t.atom.io.model.util.createDate(o);break;case"content":case"summary":case"title":case"subtitle":r[d]=new t.atom.io.model.Content(d),r[d].value=o;break;default:r[d]=o}return r.store=this,r.isDirty=!0,this._adds?this._adds.push(r):this._adds=[r],this._feed?this._feed.addEntry(r):this._requests?this._requests.push({add:r}):(this._requests=[{add:r}],this._atomIO=new t.atom.io.Connection(!1,this.urlPreventCache),this._atomIO.getFeed(this.url,e.hitch(this,this._setFeed))),!0},deleteItem:function(i){return this._assertIsItem(i),this._deletes?this._deletes.push(i):this._deletes=[i],this._feed?this._feed.removeEntry(i):this._requests?this._requests.push({remove:i}):(this._requests=[{remove:i}],this._atomIO=new t.atom.io.Connection(!1,this.urlPreventCache),this._atomIO.getFeed(this.url,e.hitch(this,this._setFeed))),i=null,!0},setValue:function(e,i,a){this._assertIsItem(e);var r={item:e};if(this._assertIsAttribute(i))switch(i){case"link":return r.links=e.links,this._addUpdate(r),e.links=null,e.addLink(a.href,a.rel,a.hrefLang,a.title,a.type),e.isDirty=!0,!0;case"author":return r.authors=e.authors,this._addUpdate(r),e.authors=null,e.addAuthor(a.name,a.email,a.uri),e.isDirty=!0,!0;case"contributor":return r.contributors=e.contributors,this._addUpdate(r),e.contributors=null,e.addContributor(a.name,a.email,a.uri),e.isDirty=!0,!0;case"category":return r.categories=e.categories,this._addUpdate(r),e.categories=null,e.addCategory(a.scheme,a.term,a.label),e.isDirty=!0,!0;case"icon":case"id":case"logo":case"xmlBase":case"rights":return r[i]=e[i],this._addUpdate(r),e[i]=a,e.isDirty=!0,!0;case"updated":case"published":case"issued":case"modified":return r[i]=e[i],this._addUpdate(r),e[i]=t.atom.io.model.util.createDate(a),e.isDirty=!0,!0;case"content":case"summary":case"title":case"subtitle":return r[i]=e[i],this._addUpdate(r),e[i]=new t.atom.io.model.Content(i),e[i].value=a,e.isDirty=!0,!0;default:return r[i]=e[i],this._addUpdate(r),e[i]=a,e.isDirty=!0,!0}return!1},setValues:function(e,i,a){if(0===a.length)return this.unsetAttribute(e,i);this._assertIsItem(e);var r,o,n={item:e};if(this._assertIsAttribute(i))switch(i){case"link":n.links=e.links,e.links=null;for(o in a)r=a[o],e.addLink(r.href,r.rel,r.hrefLang,r.title,r.type);return e.isDirty=!0,!0;case"author":n.authors=e.authors,e.authors=null;for(o in a)r=a[o],e.addAuthor(r.name,r.email,r.uri);return e.isDirty=!0,!0;case"contributor":n.contributors=e.contributors,e.contributors=null;for(o in a)r=a[o],e.addContributor(r.name,r.email,r.uri);return e.isDirty=!0,!0;case"categories":n.categories=e.categories,e.categories=null;for(o in a)r=a[o],e.addCategory(r.scheme,r.term,r.label);return e.isDirty=!0,!0;case"icon":case"id":case"logo":case"xmlBase":case"rights":return n[i]=e[i],e[i]=a[0],e.isDirty=!0,!0;case"updated":case"published":case"issued":case"modified":return n[i]=e[i],e[i]=t.atom.io.model.util.createDate(a[0]),e.isDirty=!0,!0;case"content":case"summary":case"title":case"subtitle":return n[i]=e[i],e[i]=new t.atom.io.model.Content(i),e[i].values[0]=a[0],e.isDirty=!0,!0;default:return n[i]=e[i],e[i]=a[0],e.isDirty=!0,!0}return this._addUpdate(n),!1},unsetAttribute:function(e,t){if(this._assertIsItem(e),this._assertIsAttribute(t)&&null!==e[t]){var i={item:e};switch(t){case"author":case"contributor":case"link":i[t+"s"]=e[t+"s"];break;case"category":i.categories=e.categories;break;default:i[t]=e[t]}return e.isDirty=!0,e[t]=null,this._addUpdate(i),!0}return!1},save:function(t){var i;for(i in this._adds)this._atomIO.addEntry(this._adds[i],null,function(){},t.onError,!1,t.scope);this._adds=null;for(i in this._updates)this._atomIO.updateEntry(this._updates[i].item,function(){},t.onError,!1,this.xmethod,t.scope);this._updates=null;for(i in this._deletes)this._atomIO.removeEntry(this._deletes[i],function(){},t.onError,this.xmethod,t.scope);if(this._deletes=null,this._atomIO.getFeed(this.url,e.hitch(this,this._setFeed)),t.onComplete){var a=t.scope||e.global;t.onComplete.call(a)}},revert:function(){var e;for(e in this._adds)this._feed.removeEntry(this._adds[e]);this._adds=null;var t,i,a;for(e in this._updates){t=this._updates[e],i=t.item;for(a in t)"item"!==a&&(i[a]=t[a])}this._updates=null;for(e in this._deletes)this._feed.addEntry(this._deletes[e]);return this._deletes=null,!0},isDirty:function(e){return e?(this._assertIsItem(e),!!e.isDirty):null!==this._adds||null!==this._updates}});return e.extend(i,e.data.util.simpleFetch),i});//# sourceMappingURL=AppStore.js.map