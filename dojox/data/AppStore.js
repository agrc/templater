//>>built
define("dojox/data/AppStore",["dojo","dojox","dojo/data/util/simpleFetch","dojo/data/util/filter","dojox/atom/io/Connection"],function(e,t){e.experimental("dojox.data.AppStore");var i=e.declare("dojox.data.AppStore",null,{url:"",urlPreventCache:!1,xmethod:!1,_atomIO:null,_feed:null,_requests:null,_processing:null,_updates:null,_adds:null,_deletes:null,constructor:function(e){if(e&&e.url&&(this.url=e.url),e&&e.urlPreventCache&&(this.urlPreventCache=e.urlPreventCache),!this.url)throw new Error("A URL is required to instantiate an APP Store object")},_setFeed:function(e,t){this._feed=e;var i;for(i=0;i<this._feed.entries.length;i++)this._feed.entries[i].store=this;if(this._requests)for(i=0;i<this._requests.length;i++){var a=this._requests[i];a.request&&a.fh&&a.eh?this._finishFetchItems(a.request,a.fh,a.eh):a.clear?this._feed=null:a.add?this._feed.addEntry(a.add):a.remove&&this._feed.removeEntry(a.remove)}this._requests=null},_getAllItems:function(){for(var e=[],t=0;t<this._feed.entries.length;t++)e.push(this._feed.entries[t]);return e},_assertIsItem:function(e){if(!this.isItem(e))throw new Error("This error message is provided when a function is called in the following form: getAttribute(argument, attributeName).  The argument variable represents the member or owner of the object. The error is created when an item that does not belong to this store is specified as an argument.")},_assertIsAttribute:function(e){if("string"!=typeof e)throw new Error("The attribute argument must be a string. The error is created when a different type of variable is specified such as an array or object.");for(var i in t.atom.io.model._actions)if(i==e)return!0;return!1},_addUpdate:function(e){this._updates?this._updates.push(e):this._updates=[e]},getValue:function(e,t,i){var a=this.getValues(e,t);return a.length>0?a[0]:i},getValues:function(e,t){this._assertIsItem(e);var i=this._assertIsAttribute(t);if(i){if(("author"===t||"contributor"===t||"link"===t)&&e[t+"s"])return e[t+"s"];if("category"===t&&e.categories)return e.categories;if(e[t])return e=e[t],"Content"==e.nodeType?[e.value]:[e]}return[]},getAttributes:function(e){this._assertIsItem(e);var i=[];for(var a in t.atom.io.model._actions)this.hasAttribute(e,a)&&i.push(a);return i},hasAttribute:function(e,t){return this.getValues(e,t).length>0},containsValue:function(t,i,a){var r=void 0;return"string"==typeof a&&(r=e.data.util.filter.patternToRegExp(a,!1)),this._containsValue(t,i,a,r)},_containsValue:function(e,t,i,a,r){for(var n=this.getValues(e,t),o=0;o<n.length;++o){var s=n[o];if("string"==typeof s&&a)return r&&(s=s.replace(new RegExp(/^\s+/),""),s=s.replace(new RegExp(/\s+$/),"")),s=s.replace(/\r|\n|\r\n/g,""),null!==s.match(a);if(i===s)return!0}return!1},isItem:function(e){return e&&e.store&&e.store===this},isItemLoaded:function(e){return this.isItem(e)},loadItem:function(e){this._assertIsItem(e.item)},_fetchItems:function(e,i,a){if(this._feed)this._finishFetchItems(e,i,a);else{var r=!1;this._requests||(this._requests=[],r=!0),this._requests.push({request:e,fh:i,eh:a}),r&&(this._atomIO=new t.atom.io.Connection(!1,this.urlPreventCache),this._atomIO.getFeed(this.url,this._setFeed,null,this))}},_finishFetchItems:function(t,i,a){var r=null,n=this._getAllItems();if(t.query){var o=t.queryOptions?t.queryOptions.ignoreCase:!1;r=[];var s,d,l={};for(s in t.query)d=t.query[s]+"","string"==typeof d&&(l[s]=e.data.util.filter.patternToRegExp(d,o));for(var m=0;m<n.length;++m){var h=!0,u=n[m];for(s in t.query)d=t.query[s]+"",this._containsValue(u,s,d,l[s],t.trim)||(h=!1);h&&r.push(u)}}else n.length>0&&(r=n.slice(0,n.length));try{i(r,t)}catch(f){a(f,t)}},getFeatures:function(){return{"dojo.data.api.Read":!0,"dojo.data.api.Write":!0,"dojo.data.api.Identity":!0}},close:function(e){this._feed=null},getLabel:function(e){return this.isItem(e)?this.getValue(e,"title","No Title"):void 0},getLabelAttributes:function(e){return["title"]},getIdentity:function(e){return this._assertIsItem(e),this.getValue(e,"id")},getIdentityAttributes:function(e){return["id"]},fetchItemByIdentity:function(t){this._fetchItems({query:{id:t.identity},onItem:t.onItem,scope:t.scope},function(t,i){var a=i.scope;a||(a=e.global),t.length<1?i.onItem.call(a,null):i.onItem.call(a,t[0])},t.onError)},newItem:function(i){var a,r=new t.atom.io.model.Entry,n=null,o=null;for(var s in i)if(this._assertIsAttribute(s))switch(n=i[s],s){case"link":for(a in n)o=n[a],r.addLink(o.href,o.rel,o.hrefLang,o.title,o.type);break;case"author":for(a in n)o=n[a],r.addAuthor(o.name,o.email,o.uri);break;case"contributor":for(a in n)o=n[a],r.addContributor(o.name,o.email,o.uri);break;case"category":for(a in n)o=n[a],r.addCategory(o.scheme,o.term,o.label);break;case"icon":case"id":case"logo":case"xmlBase":case"rights":r[s]=n;break;case"updated":case"published":case"issued":case"modified":r[s]=t.atom.io.model.util.createDate(n);break;case"content":case"summary":case"title":case"subtitle":r[s]=new t.atom.io.model.Content(s),r[s].value=n;break;default:r[s]=n}return r.store=this,r.isDirty=!0,this._adds?this._adds.push(r):this._adds=[r],this._feed?this._feed.addEntry(r):this._requests?this._requests.push({add:r}):(this._requests=[{add:r}],this._atomIO=new t.atom.io.Connection(!1,this.urlPreventCache),this._atomIO.getFeed(this.url,e.hitch(this,this._setFeed))),!0},deleteItem:function(i){return this._assertIsItem(i),this._deletes?this._deletes.push(i):this._deletes=[i],this._feed?this._feed.removeEntry(i):this._requests?this._requests.push({remove:i}):(this._requests=[{remove:i}],this._atomIO=new t.atom.io.Connection(!1,this.urlPreventCache),this._atomIO.getFeed(this.url,e.hitch(this,this._setFeed))),i=null,!0},setValue:function(e,i,a){this._assertIsItem(e);var r={item:e};if(this._assertIsAttribute(i))switch(i){case"link":return r.links=e.links,this._addUpdate(r),e.links=null,e.addLink(a.href,a.rel,a.hrefLang,a.title,a.type),e.isDirty=!0,!0;case"author":return r.authors=e.authors,this._addUpdate(r),e.authors=null,e.addAuthor(a.name,a.email,a.uri),e.isDirty=!0,!0;case"contributor":return r.contributors=e.contributors,this._addUpdate(r),e.contributors=null,e.addContributor(a.name,a.email,a.uri),e.isDirty=!0,!0;case"category":return r.categories=e.categories,this._addUpdate(r),e.categories=null,e.addCategory(a.scheme,a.term,a.label),e.isDirty=!0,!0;case"icon":case"id":case"logo":case"xmlBase":case"rights":return r[i]=e[i],this._addUpdate(r),e[i]=a,e.isDirty=!0,!0;case"updated":case"published":case"issued":case"modified":return r[i]=e[i],this._addUpdate(r),e[i]=t.atom.io.model.util.createDate(a),e.isDirty=!0,!0;case"content":case"summary":case"title":case"subtitle":return r[i]=e[i],this._addUpdate(r),e[i]=new t.atom.io.model.Content(i),e[i].value=a,e.isDirty=!0,!0;default:return r[i]=e[i],this._addUpdate(r),e[i]=a,e.isDirty=!0,!0}return!1},setValues:function(e,i,a){if(0===a.length)return this.unsetAttribute(e,i);this._assertIsItem(e);var r,n,o={item:e};if(this._assertIsAttribute(i))switch(i){case"link":o.links=e.links,e.links=null;for(n in a)r=a[n],e.addLink(r.href,r.rel,r.hrefLang,r.title,r.type);return e.isDirty=!0,!0;case"author":o.authors=e.authors,e.authors=null;for(n in a)r=a[n],e.addAuthor(r.name,r.email,r.uri);return e.isDirty=!0,!0;case"contributor":o.contributors=e.contributors,e.contributors=null;for(n in a)r=a[n],e.addContributor(r.name,r.email,r.uri);return e.isDirty=!0,!0;case"categories":o.categories=e.categories,e.categories=null;for(n in a)r=a[n],e.addCategory(r.scheme,r.term,r.label);return e.isDirty=!0,!0;case"icon":case"id":case"logo":case"xmlBase":case"rights":return o[i]=e[i],e[i]=a[0],e.isDirty=!0,!0;case"updated":case"published":case"issued":case"modified":return o[i]=e[i],e[i]=t.atom.io.model.util.createDate(a[0]),e.isDirty=!0,!0;case"content":case"summary":case"title":case"subtitle":return o[i]=e[i],e[i]=new t.atom.io.model.Content(i),e[i].values[0]=a[0],e.isDirty=!0,!0;default:return o[i]=e[i],e[i]=a[0],e.isDirty=!0,!0}return this._addUpdate(o),!1},unsetAttribute:function(e,t){if(this._assertIsItem(e),this._assertIsAttribute(t)&&null!==e[t]){var i={item:e};switch(t){case"author":case"contributor":case"link":i[t+"s"]=e[t+"s"];break;case"category":i.categories=e.categories;break;default:i[t]=e[t]}return e.isDirty=!0,e[t]=null,this._addUpdate(i),!0}return!1},save:function(t){var i;for(i in this._adds)this._atomIO.addEntry(this._adds[i],null,function(){},t.onError,!1,t.scope);this._adds=null;for(i in this._updates)this._atomIO.updateEntry(this._updates[i].item,function(){},t.onError,!1,this.xmethod,t.scope);this._updates=null;for(i in this._deletes)this._atomIO.removeEntry(this._deletes[i],function(){},t.onError,this.xmethod,t.scope);if(this._deletes=null,this._atomIO.getFeed(this.url,e.hitch(this,this._setFeed)),t.onComplete){var a=t.scope||e.global;t.onComplete.call(a)}},revert:function(){var e;for(e in this._adds)this._feed.removeEntry(this._adds[e]);this._adds=null;var t,i,a;for(e in this._updates){t=this._updates[e],i=t.item;for(a in t)"item"!==a&&(i[a]=t[a])}this._updates=null;for(e in this._deletes)this._feed.addEntry(this._deletes[e]);return this._deletes=null,!0},isDirty:function(e){return e?(this._assertIsItem(e),!!e.isDirty):null!==this._adds||null!==this._updates}});return e.extend(i,e.data.util.simpleFetch),i});//# sourceMappingURL=AppStore.js.map