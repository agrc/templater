//>>built
define("dojox/data/GoogleSearchStore",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/declare","dojo/_base/query","dojo/dom-construct","dojo/io/script"],function(e,t,a,i,r,o){e.experimental("dojox.data.GoogleSearchStore");var n=a("dojox.data.GoogleSearchStore",null,{constructor:function(e){e&&(e.label&&(this.label=e.label),e.key&&(this._key=e.key),e.lang&&(this._lang=e.lang),"urlPreventCache"in e&&(this.urlPreventCache=!!e.urlPreventCache)),this._id=dojox.data.GoogleSearchStore.prototype._id++},_id:0,_requestCount:0,_googleUrl:"http://ajax.googleapis.com/ajax/services/search/",_storeRef:"_S",_attributes:["unescapedUrl","url","visibleUrl","cacheUrl","title","titleNoFormatting","content","estimatedResultCount"],_aggregatedAttributes:{estimatedResultCount:"cursor.estimatedResultCount"},label:"titleNoFormatting",_type:"web",urlPreventCache:!0,_queryAttrs:{text:"q"},_assertIsItem:function(e){if(!this.isItem(e))throw new Error("dojox.data.GoogleSearchStore: a function was passed an item argument that was not an item")},_assertIsAttribute:function(e){if("string"!=typeof e)throw new Error("dojox.data.GoogleSearchStore: a function was passed an attribute argument that was not an attribute name string")},getFeatures:function(){return{"dojo.data.api.Read":!0}},getValue:function(e,t,a){var i=this.getValues(e,t);return i&&i.length>0?i[0]:a},getAttributes:function(e){return this._attributes},hasAttribute:function(e,t){return!!this.getValue(e,t)},isItemLoaded:function(e){return this.isItem(e)},loadItem:function(e){},getLabel:function(e){return this.getValue(e,this.label)},getLabelAttributes:function(e){return[this.label]},containsValue:function(e,t,a){for(var i=this.getValues(e,t),r=0;r<i.length;r++)if(i[r]===a)return!0;return!1},getValues:function(e,a){this._assertIsItem(e),this._assertIsAttribute(a);var i=e[a];return t.isArray(i)?i:void 0!==i?[i]:[]},isItem:function(e){return!(!e||e[this._storeRef]!==this)},close:function(e){},_format:function(e,t){return e},fetch:function(t){function a(e){b++,y.content.context=y.content.start=e.start;var a=o.get(y);k.push(a.ioArgs.id),a.addErrback(function(e){t.onError&&t.onError.call(n,e,t)})}t=t||{};var n=t.scope||e.global;if(!t.query&&t.onError)return void t.onError.call(n,new Error(this.declaredClass+": A query must be specified."));var d={};for(var l in this._queryAttrs)d[l]=t.query[l];t={query:d,onComplete:t.onComplete,onError:t.onError,onItem:t.onItem,onBegin:t.onBegin,start:t.start,count:t.count};var s,m=8,u="GoogleSearchStoreCallback_"+this._id+"_"+ ++this._requestCount,f=this._createContent(d,u,t);void 0!==t.start&&null!==t.start||(t.start=0),t.count||(t.count=m),s={start:t.start-t.start%m};var h=this,c=this._googleUrl+this._type,y={url:c,preventCache:this.urlPreventCache,content:f},v=[],p=0,g=!1,M=t.start-1,b=0,k=[],w=function(o,d){if(k.length>0&&i("#"+k.splice(0,1)).forEach(r.destroy),!g){var l=h._getItems(d),s=d?d.cursor:null;if(l){for(var f=0;f<l.length&&f+o<t.count+t.start;f++)h._processItem(l[f],d),v[f+o]=l[f];if(1==++p){var c=s?s.pages:null,y=c?Number(c[c.length-1].start):0;if(t.onBegin){var w=s?s.estimatedResultCount:l.length,_=w?Math.min(w,y+l.length):y+l.length;t.onBegin.call(n,_,t)}for(var F=t.start-t.start%m+m,I=1;c&&c[I]&&!(Number(c[I].start)>=t.start+t.count);)Number(c[I].start)>=F&&a({start:c[I].start}),I++}if(t.onItem&&v[M+1])do{M++,t.onItem.call(n,v[M],t)}while(v[M+1]&&M<t.start+t.count);p==b&&(g=!0,e.global[u]=null,t.onItem?t.onComplete.call(n,null,t):(v=v.slice(t.start,t.start+t.count),t.onComplete.call(n,v,t)))}}},_=[],F=s.start-1;e.global[u]=function(a,i,r,o){try{if(200!=r)return t.onError&&t.onError.call(n,new Error("Response from Google was: "+r),t),void(e.global[u]=function(){});if(a==F+1){if(w(Number(a),i),F+=m,_.length>0)for(_.sort(h._getSort());_.length>0&&_[0].start==F+1;)w(Number(_[0].start),_[0].data),_.splice(0,1),F+=m}else _.push({start:a,data:i})}catch(e){t.onError.call(n,e,t)}},a(s)},_getSort:function(){return function(e,t){return e.start<t.start?-1:t.start<e.start?1:0}},_processItem:function(e,a){e[this._storeRef]=this;for(var i in this._aggregatedAttributes)e[i]=t.getObject(this._aggregatedAttributes[i],!1,a)},_getItems:function(e){return e.results||e},_createContent:function(e,t,a){var i={v:"1.0",rsz:"large",callback:t,key:this._key,hl:this._lang};for(var r in this._queryAttrs)i[this._queryAttrs[r]]=e[r];return i}}),d=a("dojox.data.GoogleWebSearchStore",n,{}),l=a("dojox.data.GoogleBlogSearchStore",n,{_type:"blogs",_attributes:["blogUrl","postUrl","title","titleNoFormatting","content","author","publishedDate"],_aggregatedAttributes:{}}),s=a("dojox.data.GoogleLocalSearchStore",n,{_type:"local",_attributes:["title","titleNoFormatting","url","lat","lng","streetAddress","city","region","country","phoneNumbers","ddUrl","ddUrlToHere","ddUrlFromHere","staticMapUrl","viewport"],_aggregatedAttributes:{viewport:"viewport"},_queryAttrs:{text:"q",centerLatLong:"sll",searchSpan:"sspn"}}),m=a("dojox.data.GoogleVideoSearchStore",n,{_type:"video",_attributes:["title","titleNoFormatting","content","url","published","publisher","duration","tbWidth","tbHeight","tbUrl","playUrl"],_aggregatedAttributes:{}}),u=a("dojox.data.GoogleNewsSearchStore",n,{_type:"news",_attributes:["title","titleNoFormatting","content","url","unescapedUrl","publisher","clusterUrl","location","publishedDate","relatedStories"],_aggregatedAttributes:{}}),f=a("dojox.data.GoogleBookSearchStore",n,{_type:"books",_attributes:["title","titleNoFormatting","authors","url","unescapedUrl","bookId","pageCount","publishedYear"],_aggregatedAttributes:{}});return{Search:n,ImageSearch:a("dojox.data.GoogleImageSearchStore",n,{_type:"images",_attributes:["title","titleNoFormatting","visibleUrl","url","unescapedUrl","originalContextUrl","width","height","tbWidth","tbHeight","tbUrl","content","contentNoFormatting"],_aggregatedAttributes:{}}),BookSearch:f,NewsSearch:u,VideoSearch:m,LocalSearch:s,BlogSearch:l,WebSearch:d}});//# sourceMappingURL=GoogleSearchStore.js.map