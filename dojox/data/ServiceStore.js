//>>built
define("dojox/data/ServiceStore",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array"],function(e,t,a){return e("dojox.data.ServiceStore",t.getObject("dojox.data.ClientFilter",0)||null,{service:null,constructor:function(e){this.byId=this.fetchItemByIdentity,this._index={},e&&t.mixin(this,e),this.idAttribute=e&&e.idAttribute||this.schema&&this.schema._idAttr},schema:null,idAttribute:"id",labelAttribute:"label",syncMode:!1,estimateCountFactor:1,getSchema:function(){return this.schema},loadLazyValues:!0,getValue:function(e,t,a){var i=e[t];return i||(t in e?i:e._loadObject?(dojox.rpc._sync=!0)&&arguments.callee.call(this,dojox.data.ServiceStore.prototype.loadItem({item:e})||{},t,a):a)},getValues:function(e,t){var a=this.getValue(e,t);return a instanceof Array?a:void 0===a?[]:[a]},getAttributes:function(e){var t=[];for(var a in e)!e.hasOwnProperty(a)||"_"==a.charAt(0)&&"_"==a.charAt(1)||t.push(a);return t},hasAttribute:function(e,t){return t in e},containsValue:function(e,t,i){return a.indexOf(this.getValues(e,t),i)>-1},isItem:function(e){return"object"==typeof e&&e&&!(e instanceof Date)},isItemLoaded:function(e){return e&&!e._loadObject},loadItem:function(e){var t;return e.item._loadObject?e.item._loadObject(function(a){t=a,delete t._loadObject;var i=a instanceof Error?e.onError:e.onItem;i&&i.call(e.scope,a)}):e.onItem&&e.onItem.call(e.scope,e.item),t},_currentId:0,_processResults:function(e,a){if(e&&"object"==typeof e){var i=e.__id;if(!i&&(i=this.idAttribute?e[this.idAttribute]:this._currentId++,void 0!==i)){var r=this._index[i];if(r){for(var n in r)delete r[n];e=t.mixin(r,e)}e.__id=i,this._index[i]=e}for(var o in e)e[o]=this._processResults(e[o],a).items;var d=e.length}return{totalCount:a.request.count==d?(a.request.start||0)+d*this.estimateCountFactor:d,items:e}},close:function(e){return e&&e.abort&&e.abort()},fetch:function(e){e=e||{},("syncMode"in e?e.syncMode:this.syncMode)&&(dojox.rpc._sync=!0);var t=this,a=e.scope||t,i=this.cachingFetch?this.cachingFetch(e):this._doQuery(e);return i.request=e,i.addCallback(function(r){e.clientFetch&&(r=t.clientSideFetch({query:e.clientFetch,sort:e.sort,start:e.start,count:e.count},r));var n=t._processResults(r,i);if(r=e.results=n.items,e.onBegin&&e.onBegin.call(a,n.totalCount,e),e.onItem)for(var o=0;o<r.length;o++)e.onItem.call(a,r[o],e);return e.onComplete&&e.onComplete.call(a,e.onItem?null:r,e),r}),i.addErrback(e.onError&&function(t){return e.onError.call(a,t,e)}),e.abort=function(){i.cancel()},e.store=this,e},_doQuery:function(e){var t="string"==typeof e.queryStr?e.queryStr:e.query;return this.service(t)},getFeatures:function(){return{"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0,"dojo.data.api.Schema":this.schema}},getLabel:function(e){return this.getValue(e,this.labelAttribute)},getLabelAttributes:function(e){return[this.labelAttribute]},getIdentity:function(e){return e.__id},getIdentityAttributes:function(e){return[this.idAttribute]},fetchItemByIdentity:function(e){var t=this._index[(e._prefix||"")+e.identity];return t?t._loadObject?(e.item=t,this.loadItem(e)):(e.onItem&&e.onItem.call(e.scope,t),t):this.fetch({query:e.identity,onComplete:e.onItem,onError:e.onError,scope:e.scope}).results}})});//# sourceMappingURL=ServiceStore.js.map