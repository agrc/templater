//>>built
define("dojox/data/SnapLogicStore",["dojo","dojox","dojo/io/script","dojo/data/util/sorter"],function(e,t){return e.declare("dojox.data.SnapLogicStore",null,{Parts:{DATA:"data",COUNT:"count"},url:"",constructor:function(e){e.url&&(this.url=e.url),this._parameters=e.parameters},_assertIsItem:function(e){if(!this.isItem(e))throw new Error("dojox.data.SnapLogicStore: a function was passed an item argument that was not an item")},_assertIsAttribute:function(e){if("string"!=typeof e)throw new Error("dojox.data.SnapLogicStore: a function was passed an attribute argument that was not an attribute name string")},getFeatures:function(){return{"dojo.data.api.Read":!0}},getValue:function(t,a,i){this._assertIsItem(t),this._assertIsAttribute(a);var r=e.indexOf(t.attributes,a);return-1!==r?t.values[r]:i},getAttributes:function(e){return this._assertIsItem(e),e.attributes},hasAttribute:function(e,t){this._assertIsItem(e),this._assertIsAttribute(t);for(var a=0;a<e.attributes.length;++a)if(t==e.attributes[a])return!0;return!1},isItemLoaded:function(e){return this.isItem(e)},loadItem:function(e){},getLabel:function(e){},getLabelAttributes:function(e){return null},containsValue:function(e,t,a){return this.getValue(e,t)===a},getValues:function(t,a){this._assertIsItem(t),this._assertIsAttribute(a);var i=e.indexOf(t.attributes,a);return-1!==i?[t.values[i]]:[]},isItem:function(e){return!(!e||e._store!==this)},close:function(e){},_fetchHandler:function(t){var a=t.scope||e.global;if(t.onBegin&&t.onBegin.call(a,t._countResponse[0],t),t.onItem||t.onComplete){var i=t._dataResponse;if(!i.length)return void t.onError.call(a,new Error("dojox.data.SnapLogicStore: invalid response of length 0"),t);if("record count"!=t.query){for(var r=i.shift(),o=[],n=0;n<i.length&&!t._aborted;++n)o.push({attributes:r,values:i[n],_store:this});t.sort&&!t._aborted&&o.sort(e.data.util.sorter.createSortFunction(t.sort,self))}else o=[{attributes:["count"],values:i,_store:this}];if(t.onItem){for(var n=0;n<o.length&&!t._aborted;++n)t.onItem.call(a,o[n],t);o=null}t.onComplete&&!t._aborted&&t.onComplete.call(a,o,t)}},_partHandler:function(e,t,a){if(a instanceof Error)t==this.Parts.DATA?e._dataHandle=null:e._countHandle=null,e._aborted=!0,e.onError&&e.onError.call(e.scope,a,e);else{if(e._aborted)return;t==this.Parts.DATA?e._dataResponse=a:e._countResponse=a,e._dataHandle&&null===e._dataResponse||e._countHandle&&null===e._countResponse||this._fetchHandler(e)}},fetch:function(t){if(t._countResponse=null,t._dataResponse=null,t._aborted=!1,t.abort=function(){t._aborted||(t._aborted=!0,t._dataHandle&&t._dataHandle.cancel&&t._dataHandle.cancel(),t._countHandle&&t._countHandle.cancel&&t._countHandle.cancel())},t.onItem||t.onComplete){var a=this._parameters||{};if(t.start){if(t.start<0)throw new Error("dojox.data.SnapLogicStore: request start value must be 0 or greater");a["sn.start"]=t.start+1}if(t.count){if(t.count<0)throw new Error("dojox.data.SnapLogicStore: request count value 0 or greater");a["sn.limit"]=t.count}a["sn.content_type"]="application/javascript";var i={url:this.url,content:a,timeout:6e4,callbackParamName:"sn.stream_header",handle:e.hitch(this,"_partHandler",t,this.Parts.DATA)};t._dataHandle=e.io.script.get(i)}if(t.onBegin){var a={};a["sn.count"]="records",a["sn.content_type"]="application/javascript";var i={url:this.url,content:a,timeout:6e4,callbackParamName:"sn.stream_header",handle:e.hitch(this,"_partHandler",t,this.Parts.COUNT)};t._countHandle=e.io.script.get(i)}return t}})});//# sourceMappingURL=SnapLogicStore.js.map