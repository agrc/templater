//>>built
define("dojox/store/transaction",["dojo/store/Memory","dojo/store/Cache","dojo/when","dojo/aspect","dojo/_base/lang"],function(e,t,i,a,o){var n,r={},s=1;return function(l){function d(e){return function t(a,o){var n=this;if(f){var r=c[e](a,o);return i(r,null,function(e){n.errorHandler(e)&&(f=!1,o.error=e,t.call(n,a,o),f=!0)}),r}var s="remove"===e?a:n.getIdentity(a);if(void 0!==s)var l=h.get(s);return i(l,function(t){return i(m.add({objectId:s,method:e,target:a,previous:t,options:o,storeId:u}),function(){return a})})}}l=l||{};var c=l.masterStore,h=l.cachingStore,u=c.id||c.storeName||c.name||(c.id=s++);u&&(r[u]=c);var m=l.transactionLogStore||n||(n=new e),f=!0;return a.before(c,"notify",function(e,t){e?h.put(e):h.remove(t)}),new t(o.delegate(c,{put:d("put"),add:d("add"),remove:d("remove"),errorHandler:function(e){return!0},commit:function(){f=!0;var e=this;return m.query({}).map(function(t){var i,a=t.method,o=r[t.storeId],n=t.target;try{i=o[a](n,t.options)}catch(r){if(!0===(i=e.errorHandler(r)))return r;!1===i&&("add"===a?h.remove(t.objectId):h.put(n),o.notify&&o.notify("add"===a?null:t.previous,"remove"===a?void 0:t.objectId)),i=r}return m.remove(t.id),i})},transaction:function(){f=!1;var e=this;return{commit:function(){return e.commit()}}}}),h,l)}});//# sourceMappingURL=transaction.js.map