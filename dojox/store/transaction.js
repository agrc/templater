//>>built
define("dojox/store/transaction",["dojo/store/Memory","dojo/store/Cache","dojo/when","dojo/aspect","dojo/_base/lang"],function(e,t,i,a,o){var r,n={},s=1;return function(l){function d(e){return function t(a,o){var r=this;if(f){var n=h[e](a,o);return i(n,null,function(e){r.errorHandler(e)&&(f=!1,o.error=e,t.call(r,a,o),f=!0)}),n}var s="remove"===e?a:r.getIdentity(a);if(void 0!==s)var l=c.get(s);return i(l,function(t){return i(m.add({objectId:s,method:e,target:a,previous:t,options:o,storeId:u}),function(){return a})})}}l=l||{};var h=l.masterStore,c=l.cachingStore,u=h.id||h.storeName||h.name||(h.id=s++);u&&(n[u]=h);var m=l.transactionLogStore||r||(r=new e),f=!0;return a.before(h,"notify",function(e,t){e?c.put(e):c.remove(t)}),new t(o.delegate(h,{put:d("put"),add:d("add"),remove:d("remove"),errorHandler:function(e){return!0},commit:function(){f=!0;var e=this;return m.query({}).map(function(t){var i,a=t.method,o=n[t.storeId],r=t.target;try{i=o[a](r,t.options)}catch(s){if(i=e.errorHandler(s),i===!0)return s;i===!1&&("add"===a?c.remove(t.objectId):c.put(r),o.notify&&o.notify("add"===a?null:t.previous,"remove"===a?void 0:t.objectId)),i=s}return m.remove(t.id),i})},transaction:function(){f=!1;var e=this;return{commit:function(){return e.commit()}}}}),c,l)}});//# sourceMappingURL=transaction.js.map