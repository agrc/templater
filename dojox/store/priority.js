//>>built
define("dojox/store/priority",["dojo/_base/lang","dojo/Deferred","dojo/when"],function(e,t,i){function r(){for(var e=o.length-1;e>=a;e--){var t=o[e],i=t&&t[t.length-1];if(i){t.pop(),a++;try{i.executor(function(){a--,r()})}catch(e){i.def.reject(e),r()}}}}function n(){var e=new t;return{promise:{total:{then:function(t,i){return e.then(function(e){return e.results.total}).then(t,i)}},forEach:function(t,i){return e.then(function(e){return e.results.forEach(t,i)})},map:function(t,i){return e.then(function(e){return e.results.map(t,i)})},filter:function(t,i){return e.then(function(e){return e.results.filter(t,i)})},then:function(t,r){return e.then(function(e){return i(e.results,t,r)})}},resolve:e.resolve,reject:e.reject}}var o=[],a=0;return function(a,s){s=s||{};var l=e.delegate(a);return["add","put","query","remove","get"].forEach(function(e){var d=a[e];d&&(l[e]=function(l,c){c=c||{};var h,u;if(c.immediate)return d.call(a,l,c);c.immediate=!0,"query"===e?(u=function(e){var t=d.call(a,l,c);h.resolve({results:t}),i(t,e,e)},h=n()):(u=function(e){i(d.call(a,l,c),function(t){h.resolve(t),e()},function(t){h.reject(t),e()})},h=new t);var f=c.priority>-1?c.priority:s.priority>-1?s.priority:4;return(o[f]||(o[f]=[])).push({executor:u,def:h}),r(),h.promise})}),l}});//# sourceMappingURL=priority.js.map