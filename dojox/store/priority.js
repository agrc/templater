//>>built
define("dojox/store/priority",["dojo/_base/lang","dojo/Deferred","dojo/when"],function(e,t,i){function r(){for(var e=n.length-1;e>=a;e--){var t=n[e],i=t&&t[t.length-1];if(i){t.pop(),a++;try{i.executor(function(){a--,r()})}catch(e){i.def.reject(e),r()}}}}function o(){var e=new t;return{promise:{total:{then:function(t,i){return e.then(function(e){return e.results.total}).then(t,i)}},forEach:function(t,i){return e.then(function(e){return e.results.forEach(t,i)})},map:function(t,i){return e.then(function(e){return e.results.map(t,i)})},filter:function(t,i){return e.then(function(e){return e.results.filter(t,i)})},then:function(t,r){return e.then(function(e){return i(e.results,t,r)})}},resolve:e.resolve,reject:e.reject}}var n=[],a=0;return function(a,s){s=s||{};var d=e.delegate(a);return["add","put","query","remove","get"].forEach(function(e){var l=a[e];l&&(d[e]=function(d,u){u=u||{};var c,h;if(u.immediate)return l.call(a,d,u);u.immediate=!0,"query"===e?(h=function(e){var t=l.call(a,d,u);c.resolve({results:t}),i(t,e,e)},c=o()):(h=function(e){i(l.call(a,d,u),function(t){c.resolve(t),e()},function(t){c.reject(t),e()})},c=new t);var f=u.priority>-1?u.priority:s.priority>-1?s.priority:4;return(n[f]||(n[f]=[])).push({executor:h,def:c}),r(),c.promise})}),d}});//# sourceMappingURL=priority.js.map