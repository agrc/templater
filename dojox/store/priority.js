//>>built
define("dojox/store/priority",["dojo/_base/lang","dojo/Deferred","dojo/when"],function(e,t,i){function a(){for(var e=o.length-1;e>=r;e--){var t=o[e],i=t&&t[t.length-1];if(i){t.pop(),r++;try{i.executor(function(){r--,a()})}catch(n){i.def.reject(n),a()}}}}function n(){var e=new t;return{promise:{total:{then:function(t,i){return e.then(function(e){return e.results.total}).then(t,i)}},forEach:function(t,i){return e.then(function(e){return e.results.forEach(t,i)})},map:function(t,i){return e.then(function(e){return e.results.map(t,i)})},filter:function(t,i){return e.then(function(e){return e.results.filter(t,i)})},then:function(t,a){return e.then(function(e){return i(e.results,t,a)})}},resolve:e.resolve,reject:e.reject}}var o=[],r=0;return function(r,s){s=s||{};var l=e.delegate(r);return["add","put","query","remove","get"].forEach(function(e){var d=r[e];d&&(l[e]=function(l,c){c=c||{};var u,h;if(c.immediate)return d.call(r,l,c);c.immediate=!0,"query"===e?(h=function(e){var t=d.call(r,l,c);u.resolve({results:t}),i(t,e,e)},u=n()):(h=function(e){i(d.call(r,l,c),function(t){u.resolve(t),e()},function(t){u.reject(t),e()})},u=new t);var m=c.priority>-1?c.priority:s.priority>-1?s.priority:4;return(o[m]||(o[m]=[])).push({executor:h,def:u}),a(),u.promise})}),l}});//# sourceMappingURL=priority.js.map