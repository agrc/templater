//>>built
define("dojox/mvc/_atBindingMixin",["dojo/_base/array","dojo/_base/lang","dojo/_base/declare","dojo/has","dojo/Stateful","./resolve","./sync"],function(array,lang,declare,has,Stateful,resolve,sync){function getLogContent(e,t){return[e._setIdAttr||!e.declaredClass?e:e.declaredClass,t].join(":")}function logResolveFailure(e,t){}function getParent(e){var t;try{t=require("dijit/registry")}catch(i){return}for(var a,r=e.domNode&&e.domNode.parentNode;r;){if(a=t.getEnclosingWidget(r)){var n=a._relTargetProp||"target",o=lang.isFunction(a.get)?a.get(n):a[n];if(o||n in a.constructor.prototype)return a}r=a&&a.domNode.parentNode}}function bind(e,t,i,a,r){function n(){o.Two&&o.Two.unwatch(),delete o.Two;var n=s&&(lang.isFunction(s.get)?s.get(l):s[l]),d=resolve(e,n),u=resolve(i,n);return has("mvc-bindings-log-api")&&(!d||/^rel:/.test(e)&&!s)&&logResolveFailure(e,t),has("mvc-bindings-log-api")&&(!u||/^rel:/.test(i)&&!s)&&logResolveFailure(i,a),d&&u&&(!/^rel:/.test(e)&&!/^rel:/.test(i)||s)?d.set&&d.watch||"*"!=t?void(null==t?(lang.isFunction(u.set)?u.set(a,d):u[a]=d,has("mvc-bindings-log-api")):o.Two=sync(d,t,u,a,r)):void(has("mvc-bindings-log-api")&&logResolveFailure(e,t)):void 0}var o={},s=getParent(i),l=s&&s._relTargetProp||"target";n(),(s&&/^rel:/.test(e)||/^rel:/.test(i)&&lang.isFunction(s.set)&&lang.isFunction(s.watch))&&(o.rel=s.watch(l,function(e,t,i){t!==i&&(has("mvc-bindings-log-api"),n())}));var d={};return d.unwatch=d.remove=function(){for(var e in o)o[e]&&o[e].unwatch(),delete o[e]},d}has("mvc-bindings-log-api");var mixin={dataBindAttr:"data-mvc-bindings",_dbpostscript:function(e,t){var i=this._refs=(e||{}).refs||{};for(var a in e)if("dojox.mvc.at"==(e[a]||{}).atsignature){var r=e[a];delete e[a],i[a]=r}var n=new Stateful,o=this;n.toString=function(){return"[Mixin value of widget "+o.declaredClass+", "+(o.id||"NO ID")+"]"},n.canConvertToLoggable=!0,this._startAtWatchHandles(n);for(var a in i)void 0!==n[a]&&((e=e||{})[a]=n[a]);this._stopAtWatchHandles()},_startAtWatchHandles:function(e){this.canConvertToLoggable=!0;var t=this._refs;if(t){var i=this._atWatchHandles=this._atWatchHandles||{};this._excludes=null;for(var a in t)t[a]&&"*"!=a&&(i[a]=bind(t[a].target,t[a].targetProp,e||this,a,{bindDirection:t[a].bindDirection,converter:t[a].converter,equals:t[a].equalsCallback}));"dojox.mvc.at"==(t["*"]||{}).atsignature&&(i["*"]=bind(t["*"].target,t["*"].targetProp,e||this,"*",{bindDirection:t["*"].bindDirection,converter:t["*"].converter,equals:t["*"].equalsCallback}))}},_stopAtWatchHandles:function(){for(var e in this._atWatchHandles)this._atWatchHandles[e].unwatch(),delete this._atWatchHandles[e]},_setAtWatchHandle:function(e,t){if("ref"==e)throw new Error(this+": 1.7 ref syntax used in conjunction with 1.8 dojox/mvc/at syntax, which is not supported.");var i=this._atWatchHandles=this._atWatchHandles||{};i[e]&&(i[e].unwatch(),delete i[e]),this[e]=null,this._excludes=null,this._started?i[e]=bind(t.target,t.targetProp,this,e,{bindDirection:t.bindDirection,converter:t.converter,equals:t.equalsCallback}):this._refs[e]=t},_setBind:function(value){var list=eval("({"+value+"})");for(var prop in list){var h=list[prop];"dojox.mvc.at"!=(h||{}).atsignature||this._setAtWatchHandle(prop,h)}},_getExcludesAttr:function(){if(this._excludes)return this._excludes;var e=[];for(var t in this._atWatchHandles)"*"!=t&&e.push(t);return e},_getPropertiesAttr:function(){if(this.constructor._attribs)return this.constructor._attribs;var e=["onClick"].concat(this.constructor._setterAttrs);return array.forEach(["id","excludes","properties","ref","binding"],function(t){var i=array.indexOf(e,t);i>=0&&e.splice(i,1)}),this.constructor._attribs=e}};mixin[mixin.dataBindAttr]="";var _atBindingMixin=declare("dojox/mvc/_atBindingMixin",null,mixin);return _atBindingMixin.mixin=mixin,_atBindingMixin});//# sourceMappingURL=_atBindingMixin.js.map