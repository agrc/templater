//>>built
define("dojox/mvc/StatefulModel",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/Stateful","./getStateful","./getPlainValue","./StatefulArray"],function(e,t,i,a,o,r,s,l){e.deprecated("dojox/mvc/StatefulModel","Use dojox/mvc/getStateful, dojox/mvc/getPlainValue, dojox/mvc/StatefulArray or one of the dojox/mvc/*RefControllers instead");var d=a("dojox.mvc.StatefulModel",[o],{data:null,store:null,valid:!0,value:"",reset:function(){if(!t.isObject(this.data)||this.data instanceof Date||this.data instanceof RegExp)this.set("value",this.data);else for(var e in this)this[e]&&t.isFunction(this[e].reset)&&this[e].reset()},commit:function(e){this._commit();var t=e||this.store;t&&this._saveToStore(t)},toPlainObject:function(){return s(this,d.getPlainValueOptions)},splice:function(e,i){for(var a=new l([]).splice.apply(this,t._toArray(arguments)),o=0;o<a.length;o++)(this._removals=this._removals||[]).push(a[o].toPlainObject());return a},add:function(e,t){if("number"==typeof this.get("length")&&/^[0-9]+$/.test(e.toString())){if(this.get("length")<e-0)throw new Error("Out of bounds insert attempted, must be contiguous.");this.splice(e-0,0,t)}else this.set(e,t)},remove:function(e){if("number"==typeof this.get("length")&&/^[0-9]+$/.test(e.toString())){if(!this.get(e))throw new Error("Out of bounds delete attempted - no such index: "+n);this.splice(e-0,1)}else{var t=this.get(e);if(!t)throw new Error("Illegal delete attempted - no such property: "+e);this._removals=this._removals||[],this._removals.push(t.toPlainObject()),this.set(e,void 0),delete this[e]}},valueOf:function(){return this.toPlainObject()},toString:function(){return""===this.value&&this.data?this.data.toString():this.value.toString()},constructor:function(e){var t=e&&"data"in e?e.data:this.data;this._createModel(t)},_createModel:function(e){if(null!=e)if(e=r(e,d.getStatefulOptions),t.isArray(e))this.length=0,[].splice.apply(this,e);else if(t.isObject(e))for(var i in e)e.hasOwnProperty(i)&&(this[i]=e[i]);else this.set("value",e)},_commit:function(){for(var e in this)this[e]&&t.isFunction(this[e]._commit)&&this[e]._commit();this.data=this.toPlainObject()},_saveToStore:function(e){this._removals&&(i.forEach(this._removals,function(t){e.remove(e.getIdentity(t))},this),delete this._removals);var a=this.toPlainObject();t.isArray(a)?i.forEach(a,function(t){e.put(t)},this):e.put(a)}});return t.mixin(d,{getStatefulOptions:{getType:function(e){return t.isArray(e)?"array":null!=e&&"[object Object]"=={}.toString.call(e)?"object":"value"},getStatefulArray:function(e){var a=this,o=t.mixin(new l(i.map(e,function(e){return r(e,a)})));for(var n in d.prototype)"set"!=n&&(o[n]=d.prototype[n]);return o.data=e,o},getStatefulObject:function(e){var t=new d;t.data=e;for(var i in e)t.set(i,r(e[i],this));return t},getStatefulValue:function(e){var t=new d;return t.data=e,t.set("value",e),t}},getPlainValueOptions:{getType:function(e){if(t.isArray(e))return"array";if(t.isObject(e))for(var i in e)if(e.hasOwnProperty(i)&&"value"!=i&&(e[i]||{}).get&&(e[i]||{}).watch)return"object";return"value"},getPlainArray:function(e){return i.map(e,function(e){return s(e,this)},this)},getPlainObject:function(e){var t={};for(var i in e)"_watchCallbacks"==i||i in d.prototype||(t[i]=s(e[i],this));return t},getPlainValue:function(e){return(e||{}).set&&(e||{}).watch?s(e.value,this):e}}}),d});//# sourceMappingURL=StatefulModel.js.map