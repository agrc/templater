//>>built
define("dojox/mvc/_DataBindingMixin",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/Stateful","dijit/registry"],function(e,t,i,a,o,r){return e.deprecated("dojox.mvc._DataBindingMixin","Use dojox/mvc/at for data binding."),a("dojox.mvc._DataBindingMixin",null,{ref:null,isValid:function(){var e=this.get("valid");return"undefined"!=typeof e?e:this.get("binding")?this.get("binding").get("valid"):!0},_dbstartup:function(){this._databound||(this._unwatchArray(this._viewWatchHandles),this._viewWatchHandles=[this.watch("ref",function(e,t,i){this._databound&&t!==i&&this._setupBinding()}),this.watch("value",function(e,t,i){if(this._databound){var a=this.get("binding");a&&(i&&t&&t.valueOf()===i.valueOf()||a.set("value",i))}})],this._beingBound=!0,this._setupBinding(),delete this._beingBound,this._databound=!0)},_setupBinding:function(e){if(this.ref){var i,a,o=this.ref;if(o&&t.isFunction(o.toPlainObject))a=o;else if(/^\s*expr\s*:\s*/.test(o))o=o.replace(/^\s*expr\s*:\s*/,""),a=t.getObject(o);else if(/^\s*rel\s*:\s*/.test(o))o=o.replace(/^\s*rel\s*:\s*/,""),e=e||this._getParentBindingFromDOM(),e&&(a=t.getObject(""+o,!1,e));else if(/^\s*widget\s*:\s*/.test(o)){o=o.replace(/^\s*widget\s*:\s*/,"");var n=o.split(".");1==n.length?a=r.byId(o).get("binding"):(i=r.byId(n.shift()).get("binding"),a=t.getObject(n.join("."),!1,i))}else if(e=e||this._getParentBindingFromDOM())a=t.getObject(""+o,!1,e);else try{var s=t.getObject(""+o)||{};t.isFunction(s.set)&&t.isFunction(s.watch)&&(a=s)}catch(l){-1==o.indexOf("${")}a&&t.isFunction(a.toPlainObject)&&(this.binding=a,this[this._relTargetProp||"target"]!==a&&this.set(this._relTargetProp||"target",a),this._updateBinding("binding",null,a))}},_isEqual:function(e,t){return e===t||isNaN(e)&&"number"==typeof e&&isNaN(t)&&"number"==typeof t},_updateBinding:function(e,i,a){this._unwatchArray(this._modelWatchHandles);var o=this.get("binding");if(o&&t.isFunction(o.watch)){var r=this;this._modelWatchHandles=[o.watch("value",function(e,t,i){r._isEqual(t,i)||r._isEqual(r.get("value"),i)||r.set("value",i)}),o.watch("valid",function(e,i,a){r._updateProperty(e,i,a,!0),a!==r.get(e)&&r.validate&&t.isFunction(r.validate)&&r.validate()}),o.watch("required",function(e,t,i){r._updateProperty(e,t,i,!1,e,i)}),o.watch("readOnly",function(e,t,i){r._updateProperty(e,t,i,!1,e,i)}),o.watch("relevant",function(e,t,i){r._updateProperty(e,t,i,!1,"disabled",!i)})];var n=o.get("value");null!=n&&this.set("value",n)}this._updateChildBindings()},_updateProperty:function(e,t,i,a,o,r){t!==i&&(null===i&&void 0!==a&&(i=a),i!==this.get("binding").get(e)&&this.get("binding").set(e,i),o&&this.set(o,r))},_updateChildBindings:function(e){var t=this.get("binding")||e;t&&!this._beingBound&&i.forEach(r.findWidgets(this.domNode),function(e){e.ref&&e._setupBinding?e._setupBinding(t):e._updateChildBindings(t)})},_getParentBindingFromDOM:function(){for(var e,i,a=this.domNode.parentNode;a&&(e=r.getEnclosingWidget(a),!(e&&(i=e.get("binding"),i&&t.isFunction(i.toPlainObject))));)a=e?e.domNode.parentNode:null;return i},_unwatchArray:function(e){i.forEach(e,function(e){e.unwatch()})}})});//# sourceMappingURL=_DataBindingMixin.js.map