//>>built
define("dojox/mvc/_DataBindingMixin",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/Stateful","dijit/registry"],function(e,t,i,a,r,n){return e.deprecated("dojox.mvc._DataBindingMixin","Use dojox/mvc/at for data binding."),a("dojox.mvc._DataBindingMixin",null,{ref:null,isValid:function(){var e=this.get("valid");return void 0!==e?e:!this.get("binding")||this.get("binding").get("valid")},_dbstartup:function(){this._databound||(this._unwatchArray(this._viewWatchHandles),this._viewWatchHandles=[this.watch("ref",function(e,t,i){this._databound&&t!==i&&this._setupBinding()}),this.watch("value",function(e,t,i){if(this._databound){var a=this.get("binding");a&&(i&&t&&t.valueOf()===i.valueOf()||a.set("value",i))}})],this._beingBound=!0,this._setupBinding(),delete this._beingBound,this._databound=!0)},_setupBinding:function(e){if(this.ref){var i,a,r=this.ref;if(r&&t.isFunction(r.toPlainObject))a=r;else if(/^\s*expr\s*:\s*/.test(r))r=r.replace(/^\s*expr\s*:\s*/,""),a=t.getObject(r);else if(/^\s*rel\s*:\s*/.test(r))r=r.replace(/^\s*rel\s*:\s*/,""),(e=e||this._getParentBindingFromDOM())&&(a=t.getObject(""+r,!1,e));else if(/^\s*widget\s*:\s*/.test(r)){r=r.replace(/^\s*widget\s*:\s*/,"");var o=r.split(".");1==o.length?a=n.byId(r).get("binding"):(i=n.byId(o.shift()).get("binding"),a=t.getObject(o.join("."),!1,i))}else if(e=e||this._getParentBindingFromDOM())a=t.getObject(""+r,!1,e);else try{var s=t.getObject(""+r)||{};t.isFunction(s.set)&&t.isFunction(s.watch)&&(a=s)}catch(e){r.indexOf("${")}a&&t.isFunction(a.toPlainObject)&&(this.binding=a,this[this._relTargetProp||"target"]!==a&&this.set(this._relTargetProp||"target",a),this._updateBinding("binding",null,a))}},_isEqual:function(e,t){return e===t||isNaN(e)&&"number"==typeof e&&isNaN(t)&&"number"==typeof t},_updateBinding:function(e,i,a){this._unwatchArray(this._modelWatchHandles);var r=this.get("binding");if(r&&t.isFunction(r.watch)){var n=this;this._modelWatchHandles=[r.watch("value",function(e,t,i){n._isEqual(t,i)||n._isEqual(n.get("value"),i)||n.set("value",i)}),r.watch("valid",function(e,i,a){n._updateProperty(e,i,a,!0),a!==n.get(e)&&n.validate&&t.isFunction(n.validate)&&n.validate()}),r.watch("required",function(e,t,i){n._updateProperty(e,t,i,!1,e,i)}),r.watch("readOnly",function(e,t,i){n._updateProperty(e,t,i,!1,e,i)}),r.watch("relevant",function(e,t,i){n._updateProperty(e,t,i,!1,"disabled",!i)})];var o=r.get("value");null!=o&&this.set("value",o)}this._updateChildBindings()},_updateProperty:function(e,t,i,a,r,n){t!==i&&(null===i&&void 0!==a&&(i=a),i!==this.get("binding").get(e)&&this.get("binding").set(e,i),r&&this.set(r,n))},_updateChildBindings:function(e){var t=this.get("binding")||e;t&&!this._beingBound&&i.forEach(n.findWidgets(this.domNode),function(e){e.ref&&e._setupBinding?e._setupBinding(t):e._updateChildBindings(t)})},_getParentBindingFromDOM:function(){for(var e,i,a=this.domNode.parentNode;a&&!((e=n.getEnclosingWidget(a))&&(i=e.get("binding"))&&t.isFunction(i.toPlainObject));)a=e?e.domNode.parentNode:null;return i},_unwatchArray:function(e){i.forEach(e,function(e){e.unwatch()})}})});//# sourceMappingURL=_DataBindingMixin.js.map