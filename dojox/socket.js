//>>built
define("dojox/socket",["dojo/_base/array","dojo/_base/lang","dojo/_base/xhr","dojo/aspect","dojo/on","dojo/Evented","dojo/_base/url"],function(e,t,a,i,r,d,n){var o=window.WebSocket,l=function(e){return"string"==typeof e&&(e={url:e}),o?l.WebSocket(e,!0):l.LongPoll(e)};return l.WebSocket=function(e,t){var a=document.baseURI||window.location.href,r=new o(new n(a.replace(/^http/i,"ws"),e.url));r.on=function(e,t){r.addEventListener(e,t,!0)};var d;return i.after(r,"onopen",function(e){d=!0},!0),i.after(r,"onclose",function(a){d||t&&l.replace(r,l.LongPoll(e),!0)},!0),r},l.replace=function(a,i,d){a.send=t.hitch(i,"send"),a.close=t.hitch(i,"close");var n=function(e){(i.addEventListener||i.on).call(i,e,function(e){r.emit(a,e.type,e)},!0)};d&&n("open"),e.forEach(["message","close","error"],n)},l.LongPoll=function(i){var n,o,l,s=!1,m=!0,f=[],u={send:function(a){var r=t.delegate(i);r.rawBody=a,clearTimeout(n);var d=m?(m=!1)||u.firstRequest(r):u.transport(r);return f.push(d),d.then(function(t){u.readyState=1,f.splice(e.indexOf(f,d),1),f.length||(n=setTimeout(l,i.interval)),t&&o("message",{data:t},d)},function(t){f.splice(e.indexOf(f,d),1),s||(o("error",{error:t},d),f.length||(clearTimeout(n),u.readyState=3,o("close",{wasClean:!1},d)))}),d},close:function(){u.readyState=2,s=!0;var e;for(e=0;e<f.length;e++)f[e].cancel();u.readyState=3,o("close",{wasClean:!0})},transport:i.transport||a.post,args:i,url:i.url,readyState:0,CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3,on:d.prototype.on,firstRequest:function(e){var t=e.headers||(e.headers={});t.Pragma="start-long-poll";try{return this.transport(e)}finally{delete t.Pragma}}};return o=function(e,t,a){u["on"+e]&&(t.ioArgs=a&&a.ioArgs,t.type=e,r.emit(u,e,t))},l=function(){0===u.readyState&&o("open",{}),f.length||u.send()},u.connect=u.on,setTimeout(l),u},l});//# sourceMappingURL=socket.js.map