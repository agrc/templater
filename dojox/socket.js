//>>built
define("dojox/socket",["dojo/_base/array","dojo/_base/lang","dojo/_base/xhr","dojo/aspect","dojo/on","dojo/Evented","dojo/_base/url"],function(e,t,a,i,r,o,d){var n=window.WebSocket,l=function(e){return"string"==typeof e&&(e={url:e}),n?l.WebSocket(e,!0):l.LongPoll(e)};return l.WebSocket=function(e,t){var a=document.baseURI||window.location.href,r=new n(new d(a.replace(/^http/i,"ws"),e.url));r.on=function(e,t){r.addEventListener(e,t,!0)};var o;return i.after(r,"onopen",function(e){o=!0},!0),i.after(r,"onclose",function(a){o||t&&l.replace(r,l.LongPoll(e),!0)},!0),r},l.replace=function(a,i,o){a.send=t.hitch(i,"send"),a.close=t.hitch(i,"close");var d=function(e){(i.addEventListener||i.on).call(i,e,function(e){r.emit(a,e.type,e)},!0)};o&&d("open"),e.forEach(["message","close","error"],d)},l.LongPoll=function(i){var d,n,l,s=!1,m=!0,f=[],u={send:function(a){var r=t.delegate(i);r.rawBody=a,clearTimeout(d);var o=m?(m=!1)||u.firstRequest(r):u.transport(r);return f.push(o),o.then(function(t){u.readyState=1,f.splice(e.indexOf(f,o),1),f.length||(d=setTimeout(l,i.interval)),t&&n("message",{data:t},o)},function(t){f.splice(e.indexOf(f,o),1),s||(n("error",{error:t},o),f.length||(clearTimeout(d),u.readyState=3,n("close",{wasClean:!1},o)))}),o},close:function(){u.readyState=2,s=!0;var e;for(e=0;e<f.length;e++)f[e].cancel();u.readyState=3,n("close",{wasClean:!0})},transport:i.transport||a.post,args:i,url:i.url,readyState:0,CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3,on:o.prototype.on,firstRequest:function(e){var t=e.headers||(e.headers={});t.Pragma="start-long-poll";try{return this.transport(e)}finally{delete t.Pragma}}};return n=function(e,t,a){u["on"+e]&&(t.ioArgs=a&&a.ioArgs,t.type=e,r.emit(u,e,t))},l=function(){0===u.readyState&&n("open",{}),f.length||u.send()},u.connect=u.on,setTimeout(l),u},l});//# sourceMappingURL=socket.js.map