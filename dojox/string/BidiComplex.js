//>>built
define("dojox/string/BidiComplex",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/sniff","dojo/keys"],function(e,t,i,o,r,a){e.experimental("dojox.string.BidiComplex");var n=t.getObject("string.BidiComplex",!0,dojox),s=[];n.attachInput=function(e,t){e.alt=t,o.connect(e,"onkeydown",this,"_ceKeyDown"),o.connect(e,"onkeyup",this,"_ceKeyUp"),o.connect(e,"oncut",this,"_ceCutText"),o.connect(e,"oncopy",this,"_ceCopyText"),e.value=n.createDisplayString(e.value,e.alt)},n.createDisplayString=function(e,t){e=n.stripSpecialCharacters(e);var o=n._parse(e,t),r="‪"+e,a=1;return i.forEach(o,function(e){if(null!=e){var t=r.substring(0,e+a),i=r.substring(e+a,r.length);r=t+"‎"+i,a++}}),r},n.stripSpecialCharacters=function(e){return e.replace(/[\u200E\u200F\u202A-\u202E]/g,"")},n._ceKeyDown=function(e){var t=r("ie")?e.srcElement:e.target;s=t.value},n._ceKeyUp=function(e){var t="‎",i=r("ie")?e.srcElement:e.target,o=i.value,l=e.keyCode;if(l!=a.HOME&&l!=a.END&&l!=a.SHIFT){var d,u,c=n._getCaretPos(e,i);if(c&&(d=c[0],u=c[1]),r("ie")){var h=d,f=u;if(l==a.LEFT_ARROW)return void(o.charAt(u-1)==t&&d==u&&n._setSelectedRange(i,d-1,u-1));if(l==a.RIGHT_ARROW)return o.charAt(u-1)==t&&(f=u+1,d==u&&(h=d+1)),void n._setSelectedRange(i,h,f)}else{if(l==a.LEFT_ARROW)return void(o.charAt(u-1)==t&&n._setSelectedRange(i,d-1,u-1));if(l==a.RIGHT_ARROW)return void(o.charAt(u-1)==t&&n._setSelectedRange(i,d+1,u+1))}var m=n.createDisplayString(o,i.alt);o!=m&&(window.status=o+" c="+u,i.value=m,l==a.DELETE&&m.charAt(u)==t&&(i.value=m.substring(0,u)+m.substring(u+2,m.length)),l==a.DELETE?n._setSelectedRange(i,d,u):l==a.BACKSPACE?s.length>=u&&s.charAt(u-1)==t?n._setSelectedRange(i,d-1,u-1):n._setSelectedRange(i,d,u):i.value.charAt(u)!=t&&n._setSelectedRange(i,d+1,u+1))}},n._processCopy=function(e,t,i){if(null==t)if(r("ie")){var o=document.selection.createRange();t=o.text}else t=e.value.substring(e.selectionStart,e.selectionEnd);var a=n.stripSpecialCharacters(t);return r("ie")&&window.clipboardData.setData("Text",a),!0},n._ceCopyText=function(e){return r("ie")&&(e.returnValue=!1),n._processCopy(e,null,!1)},n._ceCutText=function(e){var t=n._processCopy(e,null,!1);if(!t)return!1;if(r("ie"))document.selection.clear();else{var i=e.selectionStart;e.value=e.value.substring(0,i)+e.value.substring(e.selectionEnd),e.setSelectionRange(i,i)}return!0},n._getCaretPos=function(e,t){if(r("ie")){var i=0,o=document.selection.createRange().duplicate(),a=o.duplicate(),n=o.text.length;for("textarea"==t.type?a.moveToElementText(t):a.expand("textedit");o.compareEndPoints("StartToStart",a)>0;)o.moveStart("character",-1),++i;return[i,i+n]}return[e.target.selectionStart,e.target.selectionEnd]},n._setSelectedRange=function(e,t,i){if(r("ie")){var o=e.createTextRange();o&&("textarea"==e.type?o.moveToElementText(e):o.expand("textedit"),o.collapse(),o.moveEnd("character",i),o.moveStart("character",t),o.select())}else e.selectionStart=t,e.selectionEnd=i};var l=function(e){return e>="0"&&"9">=e||e>"ÿ"},d=function(e){return e>="A"&&"Z">=e||e>="a"&&"z">=e},u=function(e,t,i){for(;t>0;){if(t==i)return!1;if(t--,l(e.charAt(t)))return!0;if(d(e.charAt(t)))return!1}return!1};return n._parse=function(e,t){var o=-1,r=[],a={FILE_PATH:"/\\:.",URL:"/:.?=&#",XPATH:"/\\:.<>=[]",EMAIL:"<>@.,;"}[t];switch(t){case"FILE_PATH":case"URL":case"XPATH":i.forEach(e,function(t,i){a.indexOf(t)>=0&&u(e,i,o)&&(o=i,r.push(i))});break;case"EMAIL":;i.forEach(e,function(t,i){if('"'==t){u(e,i,o)&&(o=i,r.push(i)),i++;var n=e.indexOf('"',i);n>=i&&(i=n),u(e,i,o)&&(o=i,r.push(i))}a.indexOf(t)>=0&&u(e,i,o)&&(o=i,r.push(i))})}return r},n});//# sourceMappingURL=BidiComplex.js.map