//>>built
define("dojox/string/BidiComplex",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/sniff","dojo/keys"],function(e,t,i,a,r,n){e.experimental("dojox.string.BidiComplex");var o=t.getObject("string.BidiComplex",!0,dojox),s=[];o.attachInput=function(e,t){e.alt=t,a.connect(e,"onkeydown",this,"_ceKeyDown"),a.connect(e,"onkeyup",this,"_ceKeyUp"),a.connect(e,"oncut",this,"_ceCutText"),a.connect(e,"oncopy",this,"_ceCopyText"),e.value=o.createDisplayString(e.value,e.alt)},o.createDisplayString=function(e,t){e=o.stripSpecialCharacters(e);var a=o._parse(e,t),r="‪"+e,n=1;return i.forEach(a,function(e){if(null!=e){var t=r.substring(0,e+n),i=r.substring(e+n,r.length);r=t+"‎"+i,n++}}),r},o.stripSpecialCharacters=function(e){return e.replace(/[\u200E\u200F\u202A-\u202E]/g,"")},o._ceKeyDown=function(e){var t=r("ie")?e.srcElement:e.target;s=t.value},o._ceKeyUp=function(e){var t="‎",i=r("ie")?e.srcElement:e.target,a=i.value,l=e.keyCode;if(l!=n.HOME&&l!=n.END&&l!=n.SHIFT){var d,u,h=o._getCaretPos(e,i);if(h&&(d=h[0],u=h[1]),r("ie")){var c=d,m=u;if(l==n.LEFT_ARROW)return void(a.charAt(u-1)==t&&d==u&&o._setSelectedRange(i,d-1,u-1));if(l==n.RIGHT_ARROW)return a.charAt(u-1)==t&&(m=u+1,d==u&&(c=d+1)),void o._setSelectedRange(i,c,m)}else{if(l==n.LEFT_ARROW)return void(a.charAt(u-1)==t&&o._setSelectedRange(i,d-1,u-1));if(l==n.RIGHT_ARROW)return void(a.charAt(u-1)==t&&o._setSelectedRange(i,d+1,u+1))}var f=o.createDisplayString(a,i.alt);a!=f&&(window.status=a+" c="+u,i.value=f,l==n.DELETE&&f.charAt(u)==t&&(i.value=f.substring(0,u)+f.substring(u+2,f.length)),l==n.DELETE?o._setSelectedRange(i,d,u):l==n.BACKSPACE?s.length>=u&&s.charAt(u-1)==t?o._setSelectedRange(i,d-1,u-1):o._setSelectedRange(i,d,u):i.value.charAt(u)!=t&&o._setSelectedRange(i,d+1,u+1))}},o._processCopy=function(e,t,i){if(null==t)if(r("ie")){var a=document.selection.createRange();t=a.text}else t=e.value.substring(e.selectionStart,e.selectionEnd);var n=o.stripSpecialCharacters(t);return r("ie")&&window.clipboardData.setData("Text",n),!0},o._ceCopyText=function(e){return r("ie")&&(e.returnValue=!1),o._processCopy(e,null,!1)},o._ceCutText=function(e){if(!o._processCopy(e,null,!1))return!1;if(r("ie"))document.selection.clear();else{var t=e.selectionStart;e.value=e.value.substring(0,t)+e.value.substring(e.selectionEnd),e.setSelectionRange(t,t)}return!0},o._getCaretPos=function(e,t){if(r("ie")){var i=0,a=document.selection.createRange().duplicate(),n=a.duplicate(),o=a.text.length;for("textarea"==t.type?n.moveToElementText(t):n.expand("textedit");a.compareEndPoints("StartToStart",n)>0;)a.moveStart("character",-1),++i;return[i,i+o]}return[e.target.selectionStart,e.target.selectionEnd]},o._setSelectedRange=function(e,t,i){if(r("ie")){var a=e.createTextRange();a&&("textarea"==e.type?a.moveToElementText(e):a.expand("textedit"),a.collapse(),a.moveEnd("character",i),a.moveStart("character",t),a.select())}else e.selectionStart=t,e.selectionEnd=i};var l=function(e){return e>="0"&&e<="9"||e>"ÿ"},d=function(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"},u=function(e,t,i){for(;t>0;){if(t==i)return!1;if(t--,l(e.charAt(t)))return!0;if(d(e.charAt(t)))return!1}return!1};return o._parse=function(e,t){var a=-1,r=[],n={FILE_PATH:"/\\:.",URL:"/:.?=&#",XPATH:"/\\:.<>=[]",EMAIL:"<>@.,;"}[t];switch(t){case"FILE_PATH":case"URL":case"XPATH":i.forEach(e,function(t,i){n.indexOf(t)>=0&&u(e,i,a)&&(a=i,r.push(i))});break;case"EMAIL":;i.forEach(e,function(t,i){if('"'==t){u(e,i,a)&&(a=i,r.push(i)),i++;var o=e.indexOf('"',i);o>=i&&(i=o),u(e,i,a)&&(a=i,r.push(i))}n.indexOf(t)>=0&&u(e,i,a)&&(a=i,r.push(i))})}return r},o});//# sourceMappingURL=BidiComplex.js.map