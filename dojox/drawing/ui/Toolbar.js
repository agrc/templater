//>>built
define("dojox/drawing/ui/Toolbar",["dojo","../library/icons","../util/common","../Drawing","../manager/_registry"],function(e,t,i,r,a){return e.declare("dojox.drawing.ui.Toolbar",[],{constructor:function(t,i){if(t.drawing)this.toolDrawing=t.drawing,this.drawing=this.toolDrawing,this.width=this.toolDrawing.width,this.height=this.toolDrawing.height,this.strSelected=t.selected,this.strTools=t.tools,this.strPlugs=t.plugs,this._mixprops(["padding","margin","size","radius"],t),this.addBack(),this.orient=!!t.orient&&t.orient;else{var n=e.marginBox(i);this.width=n.w,this.height=n.h,this.strSelected=e.attr(i,"selected"),this.strTools=e.attr(i,"tools"),this.strPlugs=e.attr(i,"plugs"),this._mixprops(["padding","margin","size","radius"],i),this.toolDrawing=new r({mode:"ui"},i),this.orient=e.attr(i,"orient")}if(this.horizontal=this.orient?"H"==this.orient:this.width>this.height,this.toolDrawing.ready)this.makeButtons(),!this.strSelected&&this.drawing.defaults.clickMode&&this.drawing.mouse.setCursor("default");else{e.connect(this.toolDrawing,"onSurfaceReady",this,function(){if(e.disconnect(t),this.drawing=a.getRegistered("drawing",e.attr(i,"drawingId")),this.makeButtons(),!this.strSelected&&this.drawing.defaults.clickMode)var t=e.connect(this.drawing,"onSurfaceReady",this,function(){e.disconnect(t),this.drawing.mouse.setCursor("default")})})}},padding:10,margin:5,size:30,radius:3,toolPlugGap:20,strSelected:"",strTools:"",strPlugs:"",makeButtons:function(){this.buttons=[],this.plugins=[];var r=this.padding,n=this.padding,o=this.size,s=this.size,d=this.radius,l=this.margin,u=t,c={place:"BR",size:2,mult:4};if(this.strTools){var h=[],f=a.getRegistered("tool"),m={};for(var p in f){var y=i.abbr(p);if(m[y]=f[p],"all"==this.strTools){h.push(y);var v=a.getRegistered("tool",p);v.secondary&&h.push(v.secondary.name)}}if("all"!=this.strTools){var g=this.strTools.split(",");e.forEach(g,function(t){t=e.trim(t),h.push(t);var i=a.getRegistered("tool",m[t].name);i.secondary&&h.push(i.secondary.name)},this)}e.forEach(h,function(t){t=e.trim(t);var i=!1;if(t.indexOf("Secondary")>-1){var h=t.substring(0,t.indexOf("Secondary")),f=a.getRegistered("tool",m[h].name).secondary,p=f.label;this[t]=f.funct,f.setup&&e.hitch(this,f.setup)();var y=this.toolDrawing.addUI("button",{data:{x:r,y:n,width:o,height:s/2,r:d},toolType:t,secondary:!0,text:p,shadow:c,scope:this,callback:this[t]});f.postSetup&&e.hitch(this,f.postSetup,y)(),i=!0}else var y=this.toolDrawing.addUI("button",{data:{x:r,y:n,width:o,height:s,r:d},toolType:t,icon:u[t],shadow:c,scope:this,callback:"onToolClick"});if(a.register(y,"button"),this.buttons.push(y),this.strSelected==t&&(y.select(),this.selected=y,this.drawing.setTool(y.toolType)),this.horizontal)r+=s+l;else{n+=i?s/2+l:s+l}},this)}if(this.horizontal?r+=this.toolPlugGap:n+=this.toolPlugGap,this.strPlugs){var b=[],M=a.getRegistered("plugin"),w={};for(var p in M){var k=i.abbr(p);w[k]=M[p],"all"==this.strPlugs&&b.push(k)}"all"!=this.strPlugs&&(b=this.strPlugs.split(","),e.map(b,function(t){return e.trim(t)})),e.forEach(b,function(t){var i=e.trim(t);if(0!=w[t].button){var h=this.toolDrawing.addUI("button",{data:{x:r,y:n,width:o,height:s,r:d},toolType:i,icon:u[i],shadow:c,scope:this,callback:"onPlugClick"});a.register(h,"button"),this.plugins.push(h),this.horizontal?r+=s+l:n+=s+l}var f={};f=0==w[t].button?{name:this.drawing.stencilTypeMap[t]}:{name:this.drawing.stencilTypeMap[t],options:{button:h}},this.drawing.addPlugin(f)},this)}e.connect(this.drawing,"onRenderStencil",this,"onRenderStencil")},onRenderStencil:function(e){this.drawing.defaults.clickMode&&(this.drawing.mouse.setCursor("default"),this.selected&&this.selected.deselect(),this.selected=null)},addTool:function(){},addPlugin:function(){},addBack:function(){this.toolDrawing.addUI("rect",{data:{x:0,y:0,width:this.width,height:this.size+2*this.padding,fill:"#ffffff",borderWidth:0}})},onToolClick:function(t){this.drawing.defaults.clickMode&&this.drawing.mouse.setCursor("crosshair"),e.forEach(this.buttons,function(e){e.id==t.id?(e.select(),this.selected=e,this.drawing.setTool(t.toolType)):e.secondary||e.deselect()},this)},onPlugClick:function(e){},_mixprops:function(t,i){e.forEach(t,function(t){this[t]=i.tagName?null===e.attr(i,t)?this[t]:e.attr(i,t):void 0===i[t]?this[t]:i[t]},this)}})});//# sourceMappingURL=Toolbar.js.map