//>>built
define("dojox/drawing/tools/Path",["dojo/_base/lang","../util/oo","../manager/_registry","../stencil/Path"],function(e,t,a,i){var r=t.declare(i,function(){this.pathMode="",this.currentPathMode="",this._started=!1,this.oddEvenClicks=0},{draws:!0,onDown:function(e){this._started||this.onStartPath(e)},makeSubPath:function(e){e&&("Q"==this.currentPathMode&&this.points.push({x:this.points[0].x,y:this.points[0].y}),this.points.push({t:"Z"}),this.render()),this.currentPathMode="",this.pathMode="M"},onStartPath:function(e){this._started=!0,this.revertRenderHit=this.renderHit,this.renderHit=!1,this.closePath=!1,this.mouse.setEventMode("PathEdit"),this.closePoint={x:e.x,y:e.y},this._kc1=this.connect(this.keys,"onEsc",this,function(){this.onCompletePath(!1)}),this._kc2=this.connect(this.keys,"onKeyUp",this,function(e){switch(e.letter){case"c":this.onCompletePath(!0);break;case"l":this.pathMode="L";break;case"m":this.makeSubPath(!1);break;case"q":this.pathMode="Q";break;case"s":this.pathMode="S";break;case"z":this.makeSubPath(!0)}})},onCompletePath:function(e){this.remove(this.closeGuide,this.guide);var t=this.getBounds();return t.w<this.minimumSize&&t.h<this.minimumSize?(this.remove(this.hit,this.shape,this.closeGuide),this._started=!1,this.mouse.setEventMode(""),void this.setPoints([])):(e&&("Q"==this.currentPathMode&&this.points.push({x:this.points[0].x,y:this.points[0].y}),this.closePath=!0),this.renderHit=this.revertRenderHit,this.renderedOnce=!0,this.onRender(this),this.disconnect([this._kc1,this._kc2]),this.mouse.setEventMode(""),void this.render())},onUp:function(e){if(this._started&&e.withinCanvas)if(this.points.length>2&&this.closeRadius>this.util.distance(e.x,e.y,this.closePoint.x,this.closePoint.y))this.onCompletePath(!0);else{var t={x:e.x,y:e.y};this.oddEvenClicks++,this.currentPathMode!=this.pathMode&&("Q"==this.pathMode?(t.t="Q",this.oddEvenClicks=0):"L"==this.pathMode?t.t="L":"M"==this.pathMode&&(t.t="M",this.closePoint={x:e.x,y:e.y}),this.currentPathMode=this.pathMode),this.points.push(t),this.points.length>1&&(this.remove(this.guide),this.render())}},createGuide:function(e){if(this.points.length){var t=[].concat(this.points),a={x:e.x,y:e.y};"Q"==this.currentPathMode&&this.oddEvenClicks%2&&(a.t="L"),this.points.push(a),this.render(),this.points=t;var i=this.util.distance(e.x,e.y,this.closePoint.x,this.closePoint.y);if(this.points.length>1)if(i<this.closeRadius&&!this.closeGuide){var r={cx:this.closePoint.x,cy:this.closePoint.y,rx:this.closeRadius,ry:this.closeRadius};this.closeGuide=this.container.createEllipse(r).setFill(this.closeColor)}else i>this.closeRadius&&this.closeGuide&&(this.remove(this.closeGuide),this.closeGuide=null)}},onMove:function(e){this._started&&this.createGuide(e)},onDrag:function(e){this._started&&this.createGuide(e)}});return e.setObject("dojox.drawing.tools.Path",r),r.setup={name:"dojox.drawing.tools.Path",tooltip:"Path Tool",iconClass:"iconLine"},a.register(r.setup,"tool"),r});//# sourceMappingURL=Path.js.map