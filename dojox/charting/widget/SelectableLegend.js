//>>built
define("dojox/charting/widget/SelectableLegend",["dojo/_base/array","dojo/_base/declare","dojo/query","dojo/_base/connect","dojo/_base/Color","./Legend","dijit/form/CheckBox","../action2d/Highlight","dojox/lang/functional","dojox/gfx/fx","dojo/keys","dojo/dom-construct","dojo/dom-prop","dijit/registry"],function(e,t,a,i,r,o,d,n,l,s,m,f,u,h){function y(e){return"mouseenter"==e?"onmouseover":"mouseleave"==e?"onmouseout":"on"+e}var c=t(null,{constructor:function(t){this.legend=t,this.index=0,this.horizontalLength=this._getHrizontalLength(),e.forEach(t.legends,function(e,t){t>0&&a("input",e).attr("tabindex",-1)}),this.firstLabel=a("input",t.legends[0])[0],i.connect(this.firstLabel,"focus",this,function(){this.legend.active=!0}),i.connect(this.legend.domNode,"keydown",this,"_onKeyEvent")},_getHrizontalLength:function(){var e=this.legend.horizontal;return"number"==typeof e?Math.min(e,this.legend.legends.length):e?this.legend.legends.length:1},_onKeyEvent:function(e){if(this.legend.active){if(e.keyCode==m.TAB)return void(this.legend.active=!1);var t=this.legend.legends.length;switch(e.keyCode){case m.LEFT_ARROW:this.index--,this.index<0&&(this.index+=t);break;case m.RIGHT_ARROW:this.index++,this.index>=t&&(this.index-=t);break;case m.UP_ARROW:this.index-this.horizontalLength>=0&&(this.index-=this.horizontalLength);break;case m.DOWN_ARROW:this.index+this.horizontalLength<t&&(this.index+=this.horizontalLength);break;default:return}this._moveToFocus(),Event.stop(e)}},_moveToFocus:function(){a("input",this.legend.legends[this.index])[0].focus()}}),v=t(n,{connect:function(){}});return t("dojox.charting.widget.SelectableLegend",o,{outline:!1,transitionFill:null,transitionStroke:null,autoScale:!1,postCreate:function(){this.legends=[],this.legendAnim={},this._cbs=[],this.inherited(arguments)},refresh:function(){this.legends=[],this._clearLabels(),this.inherited(arguments),this._applyEvents(),new c(this)},_clearLabels:function(){for(var e=this._cbs;e.length;)e.pop().destroyRecursive()},_addLabel:function(e,t){this.inherited(arguments);var i=a("td",this.legendBody),r=i[i.length-1];this.legends.push(r);var o=new d({checked:!0});this._cbs.push(o),f.place(o.domNode,r,"first");var n=a("label",r)[0];u.set(n,"for",o.id)},_applyEvents:function(){this.chart.dirty||e.forEach(this.legends,function(t,r){var o,d,n;this._isPie()?(o=this.chart.stack[0],d=o.name,n=this.chart.series[0].name):(o=this.chart.series[r],d=o.plot,n=o.name);var l=h.byNode(a(".dijitCheckBox",t)[0]);l.set("checked",!this._isHidden(d,r)),i.connect(l,"onClick",this,function(e){this.toogle(d,r,!l.get("checked")),e.stopPropagation()});var s=a(".dojoxLegendIcon",t)[0],m=this._getFilledShape(this._surfaces[r].children);e.forEach(["onmouseenter","onmouseleave"],function(e){i.connect(s,e,this,function(e){this._highlight(e,m,r,!l.get("checked"),n,d)})},this)},this)},_isHidden:function(t,a){return this._isPie()?-1!=e.indexOf(this.chart.getPlot(t).runFilter,a):this.chart.series[a].hidden},toogle:function(t,a,i){var r=this.chart.getPlot(t);this._isPie()?-1!=e.indexOf(r.runFilter,a)?i||(r.runFilter=e.filter(r.runFilter,function(e){return e!=a})):i&&r.runFilter.push(a):this.chart.series[a].hidden=i,this.autoScale?this.chart.dirty=!0:r.dirty=!0,this.chart.render()},_highlight:function(t,a,i,r,o,d){if(!r){var n=this._getAnim(d),l=this._isPie(),s=y(t.type),m={shape:a,index:l?"legend"+i:"legend",run:{name:o},type:s};n.process(m),e.forEach(this._getShapes(i,d),function(e,t){var a={shape:e,index:l?i:t,run:{name:o},type:s};n.duration=100,n.process(a)})}},_getShapes:function(t,a){var i=[];if(this._isPie()){var r=0;e.forEach(this.chart.getPlot(a).runFilter,function(e){t>e&&r++}),i.push(this.chart.stack[0].group.children[t-r])}else this._isCandleStick(a)?e.forEach(this.chart.series[t].group.children,function(t){e.forEach(t.children,function(t){e.forEach(t.children,function(e){"line"!=e.shape.type&&i.push(e)})})}):i=this.chart.series[t].group.children;return i},_getAnim:function(e){return this.legendAnim[e]||(this.legendAnim[e]=new v(this.chart,e)),this.legendAnim[e]},_getTransitionFill:function(e){return-1!=this.chart.stack[this.chart.plots[e]].declaredClass.indexOf("dojox.charting.plot2d.Stacked")?this.chart.theme.plotarea.fill:null},_getFilledShape:function(e){for(var t=0;e[t];){if(e[t].getFill())return e[t];t++}return null},_isPie:function(){return"dojox.charting.plot2d.Pie"==this.chart.stack[0].declaredClass},_isCandleStick:function(e){return"dojox.charting.plot2d.Candlesticks"==this.chart.stack[this.chart.plots[e]].declaredClass},destroy:function(){this._clearLabels(),this.inherited(arguments)}})});//# sourceMappingURL=SelectableLegend.js.map