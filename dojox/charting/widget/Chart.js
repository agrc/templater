//>>built
define("dojox/charting/widget/Chart",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/dom-attr","dojo/_base/declare","dojo/query","dijit/_WidgetBase","../Chart","dojo/has","dojo/has!dojo-bidi?../bidi/widget/Chart","dojox/lang/utils","dojox/lang/functional","dojox/lang/functional/lambda"],function(kernel,lang,arr,domAttr,declare,query,_WidgetBase,ChartBase,has,BidiChart,du,df,dfl){var collectParams,collectAxisParams,collectPlotParams,collectActionParams,collectDataParams,notNull=function(e){return e},dc=lang.getObject("dojox.charting");collectParams=function(node,type,kw){var dp=eval("("+type+".prototype.defaultParams)"),x,attr;for(x in dp)x in kw||(attr=node.getAttribute(x),kw[x]=du.coerceType(dp[x],null==attr||void 0===attr?dp[x]:attr));var op=eval("("+type+".prototype.optionalParams)");for(x in op)x in kw||null!=(attr=node.getAttribute(x))&&(kw[x]=du.coerceType(op[x],attr))},collectAxisParams=function(node){var name=node.getAttribute("name"),type=node.getAttribute("type");if(!name)return null;var o={name:name,kwArgs:{}},kw=o.kwArgs;if(type){dc.axis2d[type]&&(type=kernel._scopeName+"x.charting.axis2d."+type);var axis=eval("("+type+")");axis&&(kw.type=axis)}else type=kernel._scopeName+"x.charting.axis2d.Default";return collectParams(node,type,kw),(kw.font||kw.fontColor)&&(kw.tick||(kw.tick={}),kw.font&&(kw.tick.font=kw.font),kw.fontColor&&(kw.tick.fontColor=kw.fontColor)),o},collectPlotParams=function(node){var name=node.getAttribute("name"),type=node.getAttribute("type");if(!name)return null;var o={name:name,kwArgs:{}},kw=o.kwArgs;if(type){dc.plot2d&&dc.plot2d[type]&&(type=kernel._scopeName+"x.charting.plot2d."+type);var plot=eval("("+type+")");plot&&(kw.type=plot)}else type=kernel._scopeName+"x.charting.plot2d.Default";collectParams(node,type,kw);var dp=eval("("+type+".prototype.baseParams)"),x,attr;for(x in dp)x in kw||(attr=node.getAttribute(x),kw[x]=du.coerceType(dp[x],null==attr||void 0===attr?dp[x]:attr));return o},collectActionParams=function(node){var plot=node.getAttribute("plot"),type=node.getAttribute("type");plot||(plot="default");var o={plot:plot,kwArgs:{}},kw=o.kwArgs;if(!type)return null;dc.action2d[type]&&(type=kernel._scopeName+"x.charting.action2d."+type);var action=eval("("+type+")");return action?(o.action=action,collectParams(node,type,kw),o):null},collectDataParams=function(node){var ga=lang.partial(domAttr.get,node),name=ga("name");if(!name)return null;var o={name:name,kwArgs:{}},kw=o.kwArgs,t;return t=ga("plot"),null!=t&&(kw.plot=t),t=ga("marker"),null!=t&&(kw.marker=t),t=ga("stroke"),null!=t&&(kw.stroke=eval("("+t+")")),t=ga("outline"),null!=t&&(kw.outline=eval("("+t+")")),t=ga("shadow"),null!=t&&(kw.shadow=eval("("+t+")")),t=ga("fill"),null!=t&&(kw.fill=eval("("+t+")")),t=ga("font"),null!=t&&(kw.font=t),t=ga("fontColor"),null!=t&&(kw.fontColor=eval("("+t+")")),t=ga("legend"),null!=t&&(kw.legend=t),null!=(t=ga("data"))?(o.type="data",o.data=t?arr.map(String(t).split(","),Number):[],o):null!=(t=ga("array"))?(o.type="data",o.data=eval("("+t+")"),o):(t=ga("store"),null!=t?(o.type="store",o.data=eval("("+t+")"),t=ga("field"),o.field=null!=t?t:"value",t=ga("query"),t&&(kw.query=t),t=ga("queryOptions"),t&&(kw.queryOptions=eval("("+t+")")),t=ga("start"),t&&(kw.start=Number(t)),t=ga("count"),t&&(kw.count=Number(t)),t=ga("sort"),t&&(kw.sort=eval("("+t+")")),t=ga("valueFn"),t&&(kw.valueFn=dfl.lambda(t)),o):null)};var Chart=declare(has("dojo-bidi")?"dojox.charting.widget.NonBidiChart":"dojox.charting.widget.Chart",_WidgetBase,{theme:null,margins:null,stroke:void 0,fill:void 0,buildRendering:function(){this.inherited(arguments);var e=this.domNode,t=query("> .axis",e).map(collectAxisParams).filter(notNull),a=query("> .plot",e).map(collectPlotParams).filter(notNull),i=query("> .action",e).map(collectActionParams).filter(notNull),r=query("> .series",e).map(collectDataParams).filter(notNull);e.innerHTML="";var o=this.chart=new ChartBase(e,{margins:this.margins,stroke:this.stroke,fill:this.fill,textDir:this.textDir});this.theme&&o.setTheme(this.theme),t.forEach(function(e){o.addAxis(e.name,e.kwArgs)}),a.forEach(function(e){o.addPlot(e.name,e.kwArgs)}),this.actions=i.map(function(e){return new e.action(o,e.plot,e.kwArgs)}),df.foldl(r,function(e,t){if("data"==t.type)o.addSeries(t.name,t.data,t.kwArgs),e=!0;else{o.addSeries(t.name,[0],t.kwArgs);var a={};du.updateWithPattern(a,t.kwArgs,{query:"",queryOptions:null,start:0,count:1},!0),t.kwArgs.sort&&(a.sort=lang.clone(t.kwArgs.sort)),lang.mixin(a,{onComplete:function(e){var a;if("valueFn"in t.kwArgs){var i=t.kwArgs.valueFn;a=arr.map(e,function(e){return i(t.data.getValue(e,t.field,0))})}else a=arr.map(e,function(e){return t.data.getValue(e,t.field,0)});o.addSeries(t.name,a,t.kwArgs).render()}}),t.data.fetch(a)}return e},!1)&&o.render()},destroy:function(){this.chart.destroy(),this.inherited(arguments)},resize:function(e){this.chart.resize.apply(this.chart,arguments)}});return has("dojo-bidi")?declare("dojox.charting.widget.Chart",[Chart,BidiChart]):Chart});//# sourceMappingURL=Chart.js.map