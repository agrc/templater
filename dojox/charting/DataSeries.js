//>>built
define("dojox/charting/DataSeries",["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/_base/connect","dojox/lang/functional"],function(e,t,a,i,r){return t("dojox.charting.DataSeries",null,{constructor:function(t,a,n){this.store=t,this.kwArgs=a,n?e.isFunction(n)?this.value=n:e.isObject(n)?this.value=e.hitch(this,"_dictValue",r.keys(n),n):this.value=e.hitch(this,"_fieldValue",n):this.value=e.hitch(this,"_defaultValue"),this.data=[],this._events=[],this.store.getFeatures()["dojo.data.api.Notification"]&&this._events.push(i.connect(this.store,"onNew",this,"_onStoreNew"),i.connect(this.store,"onDelete",this,"_onStoreDelete"),i.connect(this.store,"onSet",this,"_onStoreSet")),this._initialRendering=!0,this.fetch()},destroy:function(){a.forEach(this._events,i.disconnect)},setSeriesObject:function(e){this.series=e},_dictValue:function(e,t,i,r){var n={};return a.forEach(e,function(e){n[e]=i.getValue(r,t[e])}),n},_fieldValue:function(e,t,a){return t.getValue(a,e)},_defaultValue:function(e,t){return e.getValue(t,"value")},fetch:function(){if(!this._inFlight){this._inFlight=!0;var t=e.delegate(this.kwArgs);t.onComplete=e.hitch(this,"_onFetchComplete"),t.onError=e.hitch(this,"onFetchError"),this.store.fetch(t)}},_onFetchComplete:function(e,t){this.items=e,this._buildItemMap(),this.data=a.map(this.items,function(e){return this.value(this.store,e)},this),this._pushDataChanges(),this._inFlight=!1},onFetchError:function(e,t){this._inFlight=!1},_buildItemMap:function(){if(this.store.getFeatures()["dojo.data.api.Identity"]){var e={};a.forEach(this.items,function(t,a){e[this.store.getIdentity(t)]=a},this),this.itemMap=e}},_pushDataChanges:function(){this.series&&(this.series.chart.updateSeries(this.series.name,this,this._initialRendering),this._initialRendering=!1,this.series.chart.delayedRender())},_onStoreNew:function(){this.fetch()},_onStoreDelete:function(e){if(this.items){var t=a.some(this.items,function(t,a){return t===e?(this.items.splice(a,1),this._buildItemMap(),this.data.splice(a,1),!0):!1},this);t&&this._pushDataChanges()}},_onStoreSet:function(e){if(this.itemMap){var t=this.store.getIdentity(e),i=this.itemMap[t];"number"==typeof i&&(this.data[i]=this.value(this.store,this.items[i]),this._pushDataChanges())}else if(this.items){var r=a.some(this.items,function(t,a){return t===e?(this.data[a]=this.value(this.store,t),!0):!1},this);r&&this._pushDataChanges()}}})});//# sourceMappingURL=DataSeries.js.map