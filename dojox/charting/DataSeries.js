//>>built
define("dojox/charting/DataSeries",["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/_base/connect","dojox/lang/functional"],function(e,t,i,a,r){return t("dojox.charting.DataSeries",null,{constructor:function(t,i,n){this.store=t,this.kwArgs=i,n?e.isFunction(n)?this.value=n:e.isObject(n)?this.value=e.hitch(this,"_dictValue",r.keys(n),n):this.value=e.hitch(this,"_fieldValue",n):this.value=e.hitch(this,"_defaultValue"),this.data=[],this._events=[],this.store.getFeatures()["dojo.data.api.Notification"]&&this._events.push(a.connect(this.store,"onNew",this,"_onStoreNew"),a.connect(this.store,"onDelete",this,"_onStoreDelete"),a.connect(this.store,"onSet",this,"_onStoreSet")),this._initialRendering=!0,this.fetch()},destroy:function(){i.forEach(this._events,a.disconnect)},setSeriesObject:function(e){this.series=e},_dictValue:function(e,t,a,r){var n={};return i.forEach(e,function(e){n[e]=a.getValue(r,t[e])}),n},_fieldValue:function(e,t,i){return t.getValue(i,e)},_defaultValue:function(e,t){return e.getValue(t,"value")},fetch:function(){if(!this._inFlight){this._inFlight=!0;var t=e.delegate(this.kwArgs);t.onComplete=e.hitch(this,"_onFetchComplete"),t.onError=e.hitch(this,"onFetchError"),this.store.fetch(t)}},_onFetchComplete:function(e,t){this.items=e,this._buildItemMap(),this.data=i.map(this.items,function(e){return this.value(this.store,e)},this),this._pushDataChanges(),this._inFlight=!1},onFetchError:function(e,t){this._inFlight=!1},_buildItemMap:function(){if(this.store.getFeatures()["dojo.data.api.Identity"]){var e={};i.forEach(this.items,function(t,i){e[this.store.getIdentity(t)]=i},this),this.itemMap=e}},_pushDataChanges:function(){this.series&&(this.series.chart.updateSeries(this.series.name,this,this._initialRendering),this._initialRendering=!1,this.series.chart.delayedRender())},_onStoreNew:function(){this.fetch()},_onStoreDelete:function(e){if(this.items){var t=i.some(this.items,function(t,i){return t===e?(this.items.splice(i,1),this._buildItemMap(),this.data.splice(i,1),!0):!1},this);t&&this._pushDataChanges()}},_onStoreSet:function(e){if(this.itemMap){var t=this.store.getIdentity(e),a=this.itemMap[t];"number"==typeof a&&(this.data[a]=this.value(this.store,this.items[a]),this._pushDataChanges())}else if(this.items){var r=i.some(this.items,function(t,i){return t===e?(this.data[i]=this.value(this.store,t),!0):!1},this);r&&this._pushDataChanges()}}})});//# sourceMappingURL=DataSeries.js.map