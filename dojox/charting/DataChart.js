//>>built
define("dojox/charting/DataChart",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/declare","dojo/_base/html","dojo/_base/connect","dojo/_base/array","./Chart2D","./themes/PlotKit/blue","dojo/dom"],function(e,t,a,i,r,d,o,n,l){e.experimental("dojox.charting.DataChart");var s={vertical:!0,min:0,max:10,majorTickStep:5,minorTickStep:1,natural:!1,stroke:"black",majorTick:{stroke:"black",length:8},minorTick:{stroke:"gray",length:2},majorLabels:!0},m={natural:!0,majorLabels:!0,includeZero:!1,majorTickStep:1,majorTick:{stroke:"black",length:8},fixUpper:"major",stroke:"black",htmlLabels:!0,from:1},u={markers:!0,tension:2,gap:2};return a("dojox.charting.DataChart",o,{scroll:!0,comparative:!1,query:"*",queryOptions:"",fieldName:"value",chartTheme:n,displayRange:0,stretchToFit:!0,minWidth:200,minHeight:100,showing:!0,label:"name",constructor:function(e,a){this.domNode=l.byId(e),t.mixin(this,a),this.xaxis=t.mixin(t.mixin({},m),a.xaxis),"seriesLabels"==this.xaxis.labelFunc&&(this.xaxis.labelFunc=t.hitch(this,"seriesLabels")),this.yaxis=t.mixin(t.mixin({},s),a.yaxis),"seriesLabels"==this.yaxis.labelFunc&&(this.yaxis.labelFunc=t.hitch(this,"seriesLabels")),this._events=[],this.convertLabels(this.yaxis),this.convertLabels(this.xaxis),this.onSetItems={},this.onSetInterval=0,this.dataLength=0,this.seriesData={},this.seriesDataBk={},this.firstRun=!0,this.dataOffset=0,this.chartTheme.plotarea.stroke={color:"gray",width:3},this.setTheme(this.chartTheme),this.displayRange&&(this.stretchToFit=!1),this.stretchToFit||(this.xaxis.to=this.displayRange);var i=a.type&&"Pie"!=a.type&&"dojox.charting.plot2d.Pie"!=a.type.prototype.declaredClass;i&&(this.addAxis("x",this.xaxis),this.addAxis("y",this.yaxis)),u.type=a.type||"Markers",this.addPlot("default",t.mixin(u,a.chartPlot)),i&&this.addPlot("grid",t.mixin(a.grid||{},{type:"Grid",hMinorLines:!0})),this.showing&&this.render(),a.store&&this.setStore(a.store,a.query,a.fieldName,a.queryOptions)},destroy:function(){d.forEach(this._events,r.disconnect),this.inherited(arguments)},setStore:function(e,t,a,i){this.firstRun=!0,this.store=e||this.store,this.query=t||this.query,this.fieldName=a||this.fieldName,this.label=this.store.getLabelAttributes(),this.queryOptions=i||i,d.forEach(this._events,r.disconnect),this._events=[r.connect(this.store,"onSet",this,"onSet"),r.connect(this.store,"onError",this,"onError")],this.fetch()},show:function(){this.showing||(i.style(this.domNode,"display",""),this.showing=!0,this.render())},hide:function(){this.showing&&(i.style(this.domNode,"display","none"),this.showing=!1)},onSet:function(e){var a=this.getProperty(e,this.label);(a in this.runs||this.comparative)&&(clearTimeout(this.onSetInterval),this.onSetItems[a]||(this.onSetItems[a]=e),this.onSetInterval=setTimeout(t.hitch(this,function(){clearTimeout(this.onSetInterval);var e=[];for(var t in this.onSetItems)e.push(this.onSetItems[t]);this.onData(e),this.onSetItems={}}),200))},onError:function(e){},onDataReceived:function(e){},getProperty:function(e,t){if(t==this.label)return this.store.getLabel(e);if("id"==t)return this.store.getIdentity(e);var a=this.store.getValues(e,t);return a.length<2&&(a=this.store.getValue(e,t)),a},onData:function(e){if(e&&e.length){if(this.items&&this.items.length!=e.length&&(d.forEach(e,function(e){var t=this.getProperty(e,"id");d.forEach(this.items,function(e,a){this.getProperty(e,"id")==t&&(this.items[a]=e)},this)},this),e=this.items),this.stretchToFit&&(this.displayRange=e.length),this.onDataReceived(e),this.items=e,this.comparative){var a="default";this.seriesData[a]=[],this.seriesDataBk[a]=[],d.forEach(e,function(e){var t=this.getProperty(e,this.fieldName);this.seriesData[a].push(t)},this)}else d.forEach(e,function(e,a){var i=this.store.getLabel(e);this.seriesData[i]||(this.seriesData[i]=[],this.seriesDataBk[i]=[]);var r=this.getProperty(e,this.fieldName);if(t.isArray(r))this.seriesData[i]=r;else{if(this.scroll)this.seriesDataBk[i].length>this.seriesData[i].length&&(this.seriesData[i]=this.seriesDataBk[i]),this.seriesData[i].push(Number(r));else{var o=d.map(new Array(a+1),function(){return 0});o.push(Number(r)),this.seriesData[i]=o}this.seriesDataBk[i].push(Number(r))}},this);var i;if(this.firstRun){this.firstRun=!1;for(a in this.seriesData)this.addSeries(a,this.seriesData[a]),i=this.seriesData[a]}else for(a in this.seriesData)i=this.seriesData[a],this.scroll&&i.length>this.displayRange&&(this.dataOffset=i.length-this.displayRange-1,i=i.slice(i.length-this.displayRange,i.length)),this.updateSeries(a,i);this.dataLength=i.length,this.showing&&this.render()}},fetch:function(){this.store&&this.store.fetch({query:this.query,queryOptions:this.queryOptions,start:this.start,count:this.count,sort:this.sort,onComplete:t.hitch(this,function(e){setTimeout(t.hitch(this,function(){this.onData(e)}),0)}),onError:t.hitch(this,"onError")})},convertLabels:function(e){return!e.labels||t.isObject(e.labels[0])?null:(e.labels=d.map(e.labels,function(e,t){return{value:t,text:e}}),null)},seriesLabels:function(e){if(e--,this.series.length<1||!this.comparative&&e>this.series.length)return"-";if(this.comparative)return this.store.getLabel(this.items[e]);for(var t=0;t<this.series.length;t++)if(this.series[t].data[e]>0)return this.series[t].name;return"-"},resizeChart:function(e){var t=Math.max(e.w,this.minWidth),a=Math.max(e.h,this.minHeight);this.resize(t,a)}})});//# sourceMappingURL=DataChart.js.map