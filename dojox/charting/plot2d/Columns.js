//>>built
define("dojox/charting/plot2d/Columns",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/has","./CartesianBase","./_PlotEvents","./common","dojox/lang/functional","dojox/lang/functional/reversed","dojox/lang/utils","dojox/gfx/fx"],function(e,t,a,i,r,o,d,n,l,s,m){var u=l.lambda("item.purgeGroup()"),f=function(){return!1};return a("dojox.charting.plot2d.Columns",[r,o],{defaultParams:{gap:0,animate:null,enableCache:!1},optionalParams:{minBarSize:1,maxBarSize:1,stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:""},constructor:function(t,a){this.opt=e.clone(e.mixin(this.opt,this.defaultParams)),s.updateWithObject(this.opt,a),s.updateWithPattern(this.opt,a,this.optionalParams),this.animate=this.opt.animate,this.renderingOptions={"shape-rendering":"crispEdges"}},getSeriesStats:function(){var t=d.collectSimpleStats(this.series,e.hitch(this,"isNullValue"));return t.hmin-=.5,t.hmax+=.5,t},createRect:function(e,t,a){var i;return this.opt.enableCache&&e._rectFreePool.length>0?(i=e._rectFreePool.pop(),i.setShape(a),t.add(i)):i=t.createRect(a),this.opt.enableCache&&e._rectUsePool.push(i),i},render:function(a,r){if(this.zoom&&!this.isDataDirty())return this.performZoom(a,r);this.resetEvents(),this.dirty=this.isDirty();var o;this.dirty&&(t.forEach(this.series,u),this._eventSeries={},this.cleanGroup(),o=this.getGroup(),n.forEachRev(this.series,function(e){e.cleanGroup(o)}));var d=this.chart.theme,l=this._hScaler.scaler.getTransformerFromModel(this._hScaler),s=this._vScaler.scaler.getTransformerFromModel(this._vScaler),m=Math.max(this._vScaler.bounds.lower,this._vAxis?this._vAxis.naturalBaseline:0),f=s(m),h=this.events(),y=this.getBarProperties(),c=this.series.length;t.forEach(this.series,function(e){e.hidden&&c--});var v=this.extractValues(this._hScaler);v=this.rearrangeValues(v,s,f);for(var M=0;M<this.series.length;M++){var g=this.series[M];if(this.dirty||g.dirty){g.cleanGroup(),this.opt.enableCache&&(g._rectFreePool=(g._rectFreePool?g._rectFreePool:[]).concat(g._rectUsePool?g._rectUsePool:[]),g._rectUsePool=[]);var p=d.next("column",[this.opt,g]),b=new Array(g.data.length);if(g.hidden)g.dyn.fill=p.series.fill;else{c--,o=g.group;for(var F=t.some(g.data,function(e){return"number"==typeof e||e&&!e.hasOwnProperty("x")}),w=F?Math.max(0,Math.floor(this._hScaler.bounds.from-1)):0,k=F?Math.min(g.data.length,Math.ceil(this._hScaler.bounds.to)):g.data.length,I=w;I<k;++I){var _=g.data[I];if(!this.isNullValue(_)){var E,j,z=this.getValue(_,I,M,F),A=(s(z.y),v[M][I]);if(this.opt.styleFunc||"number"!=typeof _){var G="number"!=typeof _?[_]:[];this.opt.styleFunc&&G.push(this.opt.styleFunc(_)),E=d.addMixin(p,"column",G,!0)}else E=d.post(p,"column");if(y.width>=1){var S={x:r.l+l(z.x+.5)+y.gap+y.thickness*c,y:a.height-r.b-f-Math.max(A,0),width:y.width,height:Math.abs(A)};if(E.series.shadow){var x=e.clone(S);x.x+=E.series.shadow.dx,x.y+=E.series.shadow.dy,j=this.createRect(g,o,x).setFill(E.series.shadow.color).setStroke(E.series.shadow),this.animate&&this._animateColumn(j,a.height-r.b+f,A)}var T=this._plotFill(E.series.fill,a,r);T=this._shapeFill(T,S);var D=this.createRect(g,o,S).setFill(T).setStroke(E.series.stroke);if(this.overrideShape(D,{index:I,value:z}),D.setFilter&&E.series.filter&&D.setFilter(E.series.filter),g.dyn.fill=D.getFill(),g.dyn.stroke=D.getStroke(),h){var C={element:"column",index:I,run:g,shape:D,shadow:j,cx:z.x+.5,cy:z.y,x:F?I:g.data[I].x,y:F?g.data[I]:g.data[I].y};this._connectEvents(C),b[I]=C}!isNaN(z.py)&&z.py>m&&(S.height=A-s(z.py)),this.createLabel(o,_,S,E),this.animate&&this._animateColumn(D,a.height-r.b-f,A)}}}this._eventSeries[g.name]=b,g.dirty=!1}}else d.skip(),this._reconnectEvents(g.name)}return this.dirty=!1,i("dojo-bidi")&&this._checkOrientation(this.group,a,r),this},getValue:function(e,t,a,i){var r,o;return i?(r="number"==typeof e?e:e.y,o=t):(r=e.y,o=e.x-1),{x:o,y:r}},extractValues:function(e){for(var a=[],i=this.series.length-1;i>=0;--i){var r=this.series[i];if(this.dirty||r.dirty){var o=t.some(r.data,function(e){return"number"==typeof e||e&&!e.hasOwnProperty("x")}),d=o?Math.max(0,Math.floor(e.bounds.from-1)):0,n=o?Math.min(r.data.length,Math.ceil(e.bounds.to)):r.data.length,l=a[i]=[];l.min=d,l.max=n;for(var s=d;s<n;++s){var m=r.data[s];l[s]=this.isNullValue(m)?0:"number"==typeof m?m:m.y}}}return a},rearrangeValues:function(e,t,a){for(var i=0,r=e.length;i<r;++i){var o=e[i];if(o)for(var d=o.min,n=o.max;d<n;++d){var l=o[d];o[d]=this.isNullValue(l)?0:t(l)-a}}return e},isNullValue:function(e){if(null===e||void 0===e)return!0;var t=this._hAxis?this._hAxis.isNullValue:f,a=this._vAxis?this._vAxis.isNullValue:f;return"number"==typeof e?a(.5)||t(e):a(isNaN(e.x)?.5:e.x+.5)||null===e.y||t(e.y)},getBarProperties:function(){var e=d.calculateBarSize(this._hScaler.bounds.scale,this.opt);return{gap:e.gap,width:e.size,thickness:0}},_animateColumn:function(t,a,i){0===i&&(i=1),m.animateTransform(e.delegate({shape:t,duration:1200,transform:[{name:"translate",start:[0,a-a/i],end:[0,0]},{name:"scale",start:[1,1/i],end:[1,1]},{name:"original"}]},this.animate)).play()}})});//# sourceMappingURL=Columns.js.map