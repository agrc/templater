//>>built
define("dojox/charting/plot2d/Pie",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","./Base","./_PlotEvents","./common","dojox/gfx","dojox/gfx/matrix","dojox/lang/functional","dojox/lang/utils","dojo/has"],function(e,t,a,i,r,d,o,n,l,s,m){var u=.2;return a("dojox.charting.plot2d.Pie",[i,r],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:20,labelStyle:"default",htmlLabels:!0,radGrad:"native",fanSize:5,startAngle:0},optionalParams:{radius:0,omitLabels:!1,stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:"",labelWiring:{}},constructor:function(t,a){this.opt=e.clone(this.defaultParams),s.updateWithObject(this.opt,a),s.updateWithPattern(this.opt,a,this.optionalParams),this.axes=[],this.run=null,this.dyn=[],this.runFilter=[]},clear:function(){return this.inherited(arguments),this.dyn=[],this.run=null,this},setAxis:function(e){return this},addSeries:function(e){return this.run=e,this},getSeriesStats:function(){return e.delegate(d.defaultStats)},getRequiredColors:function(){return this.run?this.run.data.length:0},render:function(a,i){if(!this.dirty)return this;this.resetEvents(),this.dirty=!1,this._eventSeries={},this.cleanGroup();var r=this.group,d=this.chart.theme;if(!this.run||!this.run.data.length)return this;var s,f,h,y,c,M,v=(a.width-i.l-i.r)/2,g=(a.height-i.t-i.b)/2,p=Math.min(v,g),b="font"in this.opt?this.opt.font:d.series.font,F=n._degToRad(this.opt.startAngle),w=F,k=this.events(),I=t.map(this.run.data,function(e,a){return"number"!=typeof e&&e.hidden&&(this.runFilter.push(a),e.hidden=!1),t.some(this.runFilter,function(e){return e==a})?"number"==typeof e?0:{y:0,text:e.text}:e},this);this.dyn=[],"radius"in this.opt&&(p=this.opt.radius,M=p-this.opt.labelOffset);var E={cx:i.l+v,cy:i.t+g,r:p};if(this.opt.shadow||d.shadow){var j=this.opt.shadow||d.shadow,G=e.clone(E);G.cx+=j.dx,G.cy+=j.dy,r.createCircle(G).setFill(j.color).setStroke(j)}if(r.setFilter&&(this.opt.filter||d.filter)&&r.createCircle(E).setFill(d.series.stroke).setFilter(this.opt.filter||d.filter),"number"==typeof I[0]){if(f=l.map(I,"x ? Math.max(x, 0) : 0"),l.every(f,"<= 0"))return r.createCircle(E).setStroke(d.series.stroke),this.dyn=t.map(f,function(){return{}}),this;h=l.map(f,"/this",l.foldl(f,"+",0)),this.opt.labels&&(y=t.map(h,function(e){return e>0?this._getLabel(100*e)+"%":""},this))}else{if(f=l.map(I,"x ? Math.max(x.y, 0) : 0"),l.every(f,"<= 0"))return r.createCircle(E).setStroke(d.series.stroke),this.dyn=t.map(f,function(){return{}}),this;h=l.map(f,"/this",l.foldl(f,"+",0)),this.opt.labels&&(y=t.map(h,function(e,t){if(e<0)return"";var a=I[t];return"text"in a?a.text:this._getLabel(100*e)+"%"},this))}var _=l.map(I,function(e,t){var a=[this.opt,this.run];return null!==e&&"number"!=typeof e&&a.push(e),this.opt.styleFunc&&a.push(this.opt.styleFunc(e)),d.next("slice",a,!0)},this);this.opt.labels&&(s=b?o.normalizedLength(o.splitFontString(b).size):0,c=l.foldl1(l.map(y,function(e,t){var a=_[t].series.font;return o._base._getTextBox(e,{font:a}).w},this),"Math.max(a, b)")/2,this.opt.labelOffset<0&&(p=Math.min(v-2*c,g-s)+this.opt.labelOffset),M=p-this.opt.labelOffset);var z=new Array(h.length);if(t.some(h,function(e,t){if(e<0)return!1;var d,o,l=I[t],s=_[t];if(0==e)return this.dyn.push({fill:s.series.fill,stroke:s.series.stroke}),!1;if(e>=1){d=this._plotFill(s.series.fill,a,i),d=this._shapeFill(d,{x:E.cx-E.r,y:E.cy-E.r,width:2*E.r,height:2*E.r}),d=this._pseudoRadialFill(d,{x:E.cx,y:E.cy},E.r);var m=r.createCircle(E).setFill(d).setStroke(s.series.stroke);return this.dyn.push({fill:d,stroke:s.series.stroke}),k&&(o={element:"slice",index:t,run:this.run,shape:m,x:t,y:"number"==typeof l?l:l.y,cx:E.cx,cy:E.cy,cr:p},this._connectEvents(o),z[t]=o),!1}var f=w+2*e*Math.PI;t+1==h.length&&(f=F+2*Math.PI);var y=f-w,c=E.cx+p*Math.cos(w),M=E.cy+p*Math.sin(w),v=E.cx+p*Math.cos(f),g=E.cy+p*Math.sin(f),b=n._degToRad(this.opt.fanSize);if(s.series.fill&&"radial"===s.series.fill.type&&"fan"===this.opt.radGrad&&y>b){var j=r.createGroup(),G=Math.ceil(y/b),x=y/G;d=this._shapeFill(s.series.fill,{x:E.cx-E.r,y:E.cy-E.r,width:2*E.r,height:2*E.r});for(var S=0;S<G;++S){var A=0==S?c:E.cx+p*Math.cos(w+(S-u)*x),T=0==S?M:E.cy+p*Math.sin(w+(S-u)*x),D=S==G-1?v:E.cx+p*Math.cos(w+(S+1+u)*x),Q=S==G-1?g:E.cy+p*Math.sin(w+(S+1+u)*x);j.createPath().moveTo(E.cx,E.cy).lineTo(A,T).arcTo(p,p,0,x>Math.PI,!0,D,Q).lineTo(E.cx,E.cy).closePath().setFill(this._pseudoRadialFill(d,{x:E.cx,y:E.cy},p,w+(S+.5)*x,w+(S+.5)*x))}j.createPath().moveTo(E.cx,E.cy).lineTo(c,M).arcTo(p,p,0,y>Math.PI,!0,v,g).lineTo(E.cx,E.cy).closePath().setStroke(s.series.stroke),m=j}else m=r.createPath().moveTo(E.cx,E.cy).lineTo(c,M).arcTo(p,p,0,y>Math.PI,!0,v,g).lineTo(E.cx,E.cy).closePath().setStroke(s.series.stroke),d=s.series.fill,d&&"radial"===d.type?(d=this._shapeFill(d,{x:E.cx-E.r,y:E.cy-E.r,width:2*E.r,height:2*E.r}),"linear"===this.opt.radGrad&&(d=this._pseudoRadialFill(d,{x:E.cx,y:E.cy},p,w,f))):d&&"linear"===d.type&&(d=this._plotFill(d,a,i),d=this._shapeFill(d,m.getBoundingBox())),m.setFill(d);return this.dyn.push({fill:d,stroke:s.series.stroke}),k&&(o={element:"slice",index:t,run:this.run,shape:m,x:t,y:"number"==typeof l?l:l.y,cx:E.cx,cy:E.cy,cr:p},this._connectEvents(o),z[t]=o),w=f,!1},this),this.opt.labels){var x=m("dojo-bidi")&&this.chart.isRightToLeft();if("default"==this.opt.labelStyle)w=F,t.some(h,function(e,t){if(e<=0)return!1;var i=_[t];if(e>=1)return this.renderLabel(r,E.cx,E.cy+s/2,y[t],i,this.opt.labelOffset>0),!0;var d=w+2*e*Math.PI;if(t+1==h.length&&(d=F+2*Math.PI),this.opt.omitLabels&&d-w<.001)return!1;var o=(w+d)/2,n=E.cx+M*Math.cos(o),l=E.cy+M*Math.sin(o)+s/2;return this.renderLabel(r,x?a.width-n:n,l,y[t],i,this.opt.labelOffset>0),w=d,!1},this);else if("columns"==this.opt.labelStyle){w=F;var S=this.opt.omitLabels,A=[];t.forEach(h,function(e,t){var a=w+2*e*Math.PI;t+1==h.length&&(a=F+2*Math.PI);var i=(w+a)/2;A.push({angle:i,left:Math.cos(i)<0,theme:_[t],index:t,omit:!!S&&a-w<.001}),w=a});var T=o._base._getTextBox("a",{font:b}).h;this._getProperLabelRadius(A,T,1.1*E.r),t.forEach(A,function(e,t){if(!e.omit){var i=E.cx-2*E.r,d=E.cx+2*E.r,n=o._base._getTextBox(y[t],{font:e.theme.series.font}).w,l=E.cx+e.labelR*Math.cos(e.angle),s=E.cy+e.labelR*Math.sin(e.angle),m=e.left?i+n:d-n,u=e.left?i:m,f=r.createPath().moveTo(E.cx+E.r*Math.cos(e.angle),E.cy+E.r*Math.sin(e.angle));Math.abs(e.labelR*Math.cos(e.angle))<2*E.r-n&&f.lineTo(l,s),f.lineTo(m,s).setStroke(e.theme.series.labelWiring),this.renderLabel(r,x?a.width-n-u:u,s,y[t],e.theme,!1,"left")}},this)}}var D=0;return this._eventSeries[this.run.name]=l.map(I,function(e){return e<=0?null:z[D++]}),m("dojo-bidi")&&this._checkOrientation(this.group,a,i),this},_getProperLabelRadius:function(e,t,a){var i,r,d=1,o=1;if(1==e.length)return void(e[0].labelR=a);for(var n=0;n<e.length;n++){var l=Math.abs(Math.sin(e[n].angle));e[n].left?d>=l&&(d=l,i=e[n]):o>=l&&(o=l,r=e[n])}i.labelR=r.labelR=a,this._calculateLabelR(i,e,t),this._calculateLabelR(r,e,t)},_calculateLabelR:function(e,t,a){for(var i,r=e.index,d=t.length,o=e.labelR;!(t[r%d].left^t[(r+1)%d].left);)t[(r+1)%d].omit||(i=(Math.sin(t[r%d].angle)*o+(t[r%d].left?-a:a))/Math.sin(t[(r+1)%d].angle),o=i<e.labelR?e.labelR:i,t[(r+1)%d].labelR=o),r++;r=e.index;for(var n=0==r?d-1:r-1;!(t[r].left^t[n].left);)t[n].omit||(i=(Math.sin(t[r].angle)*o+(t[r].left?a:-a))/Math.sin(t[n].angle),o=i<e.labelR?e.labelR:i,t[n].labelR=o),r--,n--,r=r<0?r+t.length:r,n=n<0?n+t.length:n}})});//# sourceMappingURL=Pie.js.map