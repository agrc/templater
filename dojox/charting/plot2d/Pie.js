//>>built
define("dojox/charting/plot2d/Pie",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","./Base","./_PlotEvents","./common","dojox/gfx","dojox/gfx/matrix","dojox/lang/functional","dojox/lang/utils","dojo/has"],function(e,t,a,i,r,o,d,n,s,l,m){var h=.2;return a("dojox.charting.plot2d.Pie",[i,r],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:20,labelStyle:"default",htmlLabels:!0,radGrad:"native",fanSize:5,startAngle:0},optionalParams:{radius:0,omitLabels:!1,stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:"",labelWiring:{}},constructor:function(t,a){this.opt=e.clone(this.defaultParams),l.updateWithObject(this.opt,a),l.updateWithPattern(this.opt,a,this.optionalParams),this.axes=[],this.run=null,this.dyn=[],this.runFilter=[]},clear:function(){return this.inherited(arguments),this.dyn=[],this.run=null,this},setAxis:function(e){return this},addSeries:function(e){return this.run=e,this},getSeriesStats:function(){return e.delegate(o.defaultStats)},getRequiredColors:function(){return this.run?this.run.data.length:0},render:function(a,i){if(!this.dirty)return this;this.resetEvents(),this.dirty=!1,this._eventSeries={},this.cleanGroup();var r=this.group,o=this.chart.theme;if(!this.run||!this.run.data.length)return this;var l,u,f,c,y,v,p=(a.width-i.l-i.r)/2,g=(a.height-i.t-i.b)/2,M=Math.min(p,g),b="font"in this.opt?this.opt.font:o.series.font,w=n._degToRad(this.opt.startAngle),F=w,_=this.events(),k=t.map(this.run.data,function(e,a){return"number"!=typeof e&&e.hidden&&(this.runFilter.push(a),e.hidden=!1),t.some(this.runFilter,function(e){return e==a})?"number"==typeof e?0:{y:0,text:e.text}:e},this);this.dyn=[],"radius"in this.opt&&(M=this.opt.radius,v=M-this.opt.labelOffset);var I={cx:i.l+p,cy:i.t+g,r:M};if(this.opt.shadow||o.shadow){var j=this.opt.shadow||o.shadow,x=e.clone(I);x.cx+=j.dx,x.cy+=j.dy,r.createCircle(x).setFill(j.color).setStroke(j)}if(r.setFilter&&(this.opt.filter||o.filter)&&r.createCircle(I).setFill(o.series.stroke).setFilter(this.opt.filter||o.filter),"number"==typeof k[0]){if(u=s.map(k,"x ? Math.max(x, 0) : 0"),s.every(u,"<= 0"))return r.createCircle(I).setStroke(o.series.stroke),this.dyn=t.map(u,function(){return{}}),this;f=s.map(u,"/this",s.foldl(u,"+",0)),this.opt.labels&&(c=t.map(f,function(e){return e>0?this._getLabel(100*e)+"%":""},this))}else{if(u=s.map(k,"x ? Math.max(x.y, 0) : 0"),s.every(u,"<= 0"))return r.createCircle(I).setStroke(o.series.stroke),this.dyn=t.map(u,function(){return{}}),this;f=s.map(u,"/this",s.foldl(u,"+",0)),this.opt.labels&&(c=t.map(f,function(e,t){if(0>e)return"";var a=k[t];return"text"in a?a.text:this._getLabel(100*e)+"%"},this))}var E=s.map(k,function(e,t){var a=[this.opt,this.run];return null!==e&&"number"!=typeof e&&a.push(e),this.opt.styleFunc&&a.push(this.opt.styleFunc(e)),o.next("slice",a,!0)},this);this.opt.labels&&(l=b?d.normalizedLength(d.splitFontString(b).size):0,y=s.foldl1(s.map(c,function(e,t){var a=E[t].series.font;return d._base._getTextBox(e,{font:a}).w},this),"Math.max(a, b)")/2,this.opt.labelOffset<0&&(M=Math.min(p-2*y,g-l)+this.opt.labelOffset),v=M-this.opt.labelOffset);var A=new Array(f.length);if(t.some(f,function(e,t){if(0>e)return!1;var o,d,s=k[t],l=E[t];if(0==e)return this.dyn.push({fill:l.series.fill,stroke:l.series.stroke}),!1;if(e>=1){o=this._plotFill(l.series.fill,a,i),o=this._shapeFill(o,{x:I.cx-I.r,y:I.cy-I.r,width:2*I.r,height:2*I.r}),o=this._pseudoRadialFill(o,{x:I.cx,y:I.cy},I.r);var m=r.createCircle(I).setFill(o).setStroke(l.series.stroke);return this.dyn.push({fill:o,stroke:l.series.stroke}),_&&(d={element:"slice",index:t,run:this.run,shape:m,x:t,y:"number"==typeof s?s:s.y,cx:I.cx,cy:I.cy,cr:M},this._connectEvents(d),A[t]=d),!1}var u=F+2*e*Math.PI;t+1==f.length&&(u=w+2*Math.PI);var c=u-F,y=I.cx+M*Math.cos(F),v=I.cy+M*Math.sin(F),p=I.cx+M*Math.cos(u),g=I.cy+M*Math.sin(u),b=n._degToRad(this.opt.fanSize);if(l.series.fill&&"radial"===l.series.fill.type&&"fan"===this.opt.radGrad&&c>b){var j=r.createGroup(),x=Math.ceil(c/b),T=c/x;o=this._shapeFill(l.series.fill,{x:I.cx-I.r,y:I.cy-I.r,width:2*I.r,height:2*I.r});for(var C=0;x>C;++C){var S=0==C?y:I.cx+M*Math.cos(F+(C-h)*T),D=0==C?v:I.cy+M*Math.sin(F+(C-h)*T),G=C==x-1?p:I.cx+M*Math.cos(F+(C+1+h)*T),z=C==x-1?g:I.cy+M*Math.sin(F+(C+1+h)*T);j.createPath().moveTo(I.cx,I.cy).lineTo(S,D).arcTo(M,M,0,T>Math.PI,!0,G,z).lineTo(I.cx,I.cy).closePath().setFill(this._pseudoRadialFill(o,{x:I.cx,y:I.cy},M,F+(C+.5)*T,F+(C+.5)*T))}j.createPath().moveTo(I.cx,I.cy).lineTo(y,v).arcTo(M,M,0,c>Math.PI,!0,p,g).lineTo(I.cx,I.cy).closePath().setStroke(l.series.stroke),m=j}else m=r.createPath().moveTo(I.cx,I.cy).lineTo(y,v).arcTo(M,M,0,c>Math.PI,!0,p,g).lineTo(I.cx,I.cy).closePath().setStroke(l.series.stroke),o=l.series.fill,o&&"radial"===o.type?(o=this._shapeFill(o,{x:I.cx-I.r,y:I.cy-I.r,width:2*I.r,height:2*I.r}),"linear"===this.opt.radGrad&&(o=this._pseudoRadialFill(o,{x:I.cx,y:I.cy},M,F,u))):o&&"linear"===o.type&&(o=this._plotFill(o,a,i),o=this._shapeFill(o,m.getBoundingBox())),m.setFill(o);return this.dyn.push({fill:o,stroke:l.series.stroke}),_&&(d={element:"slice",index:t,run:this.run,shape:m,x:t,y:"number"==typeof s?s:s.y,cx:I.cx,cy:I.cy,cr:M},this._connectEvents(d),A[t]=d),F=u,!1},this),this.opt.labels){var T=m("dojo-bidi")&&this.chart.isRightToLeft();if("default"==this.opt.labelStyle)F=w,t.some(f,function(e,t){if(0>=e)return!1;var i=E[t];if(e>=1)return this.renderLabel(r,I.cx,I.cy+l/2,c[t],i,this.opt.labelOffset>0),!0;var o=F+2*e*Math.PI;if(t+1==f.length&&(o=w+2*Math.PI),this.opt.omitLabels&&.001>o-F)return!1;var d=(F+o)/2,n=I.cx+v*Math.cos(d),s=I.cy+v*Math.sin(d)+l/2;return this.renderLabel(r,T?a.width-n:n,s,c[t],i,this.opt.labelOffset>0),F=o,!1},this);else if("columns"==this.opt.labelStyle){F=w;var C=this.opt.omitLabels,S=[];t.forEach(f,function(e,t){var a=F+2*e*Math.PI;t+1==f.length&&(a=w+2*Math.PI);var i=(F+a)/2;S.push({angle:i,left:Math.cos(i)<0,theme:E[t],index:t,omit:C?.001>a-F:!1}),F=a});var D=d._base._getTextBox("a",{font:b}).h;this._getProperLabelRadius(S,D,1.1*I.r),t.forEach(S,function(e,t){if(!e.omit){var i=I.cx-2*I.r,o=I.cx+2*I.r,n=d._base._getTextBox(c[t],{font:e.theme.series.font}).w,s=I.cx+e.labelR*Math.cos(e.angle),l=I.cy+e.labelR*Math.sin(e.angle),m=e.left?i+n:o-n,h=e.left?i:m,u=r.createPath().moveTo(I.cx+I.r*Math.cos(e.angle),I.cy+I.r*Math.sin(e.angle));Math.abs(e.labelR*Math.cos(e.angle))<2*I.r-n&&u.lineTo(s,l),u.lineTo(m,l).setStroke(e.theme.series.labelWiring),this.renderLabel(r,T?a.width-n-h:h,l,c[t],e.theme,!1,"left")}},this)}}var G=0;return this._eventSeries[this.run.name]=s.map(k,function(e){return 0>=e?null:A[G++]}),m("dojo-bidi")&&this._checkOrientation(this.group,a,i),this},_getProperLabelRadius:function(e,t,a){var i,r,o=1,d=1;if(1==e.length)return void(e[0].labelR=a);for(var n=0;n<e.length;n++){var s=Math.abs(Math.sin(e[n].angle));e[n].left?o>=s&&(o=s,i=e[n]):d>=s&&(d=s,r=e[n])}i.labelR=r.labelR=a,this._calculateLabelR(i,e,t),this._calculateLabelR(r,e,t)},_calculateLabelR:function(e,t,a){for(var i,r=e.index,o=t.length,d=e.labelR;!(t[r%o].left^t[(r+1)%o].left);)t[(r+1)%o].omit||(i=(Math.sin(t[r%o].angle)*d+(t[r%o].left?-a:a))/Math.sin(t[(r+1)%o].angle),d=i<e.labelR?e.labelR:i,t[(r+1)%o].labelR=d),r++;r=e.index;for(var n=0==r?o-1:r-1;!(t[r].left^t[n].left);)t[n].omit||(i=(Math.sin(t[r].angle)*d+(t[r].left?a:-a))/Math.sin(t[n].angle),d=i<e.labelR?e.labelR:i,t[n].labelR=d),r--,n--,r=0>r?r+t.length:r,n=0>n?n+t.length:n}})});//# sourceMappingURL=Pie.js.map