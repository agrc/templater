//>>built
define("dojox/charting/plot2d/Bars",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/has","./CartesianBase","./_PlotEvents","./common","dojox/gfx/fx","dojox/lang/utils","dojox/lang/functional","dojox/lang/functional/reversed"],function(e,t,a,i,r,o,d,n,l,s,m){var u=m.lambda("item.purgeGroup()");return a("dojox.charting.plot2d.Bars",[r,o],{defaultParams:{gap:0,animate:null,enableCache:!1},optionalParams:{minBarSize:1,maxBarSize:1,stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:""},constructor:function(t,a){this.opt=e.clone(e.mixin(this.opt,this.defaultParams)),l.updateWithObject(this.opt,a),l.updateWithPattern(this.opt,a,this.optionalParams),this.animate=this.opt.animate,this.renderingOptions={"shape-rendering":"crispEdges"}},getSeriesStats:function(){var e,t=d.collectSimpleStats(this.series);return t.hmin-=.5,t.hmax+=.5,e=t.hmin,t.hmin=t.vmin,t.vmin=e,e=t.hmax,t.hmax=t.vmax,t.vmax=e,t},createRect:function(e,t,a){var i;return this.opt.enableCache&&e._rectFreePool.length>0?(i=e._rectFreePool.pop(),i.setShape(a),t.add(i)):i=t.createRect(a),this.opt.enableCache&&e._rectUsePool.push(i),i},createLabel:function(e,t,a,i){if(this.opt.labels&&"outside"==this.opt.labelStyle){var r=a.y+a.height/2,o=a.x+a.width+this.opt.labelOffset;this.renderLabel(e,o,r,this._getLabel(isNaN(t.y)?t:t.y),i,"start")}else this.inherited(arguments)},render:function(a,r){if(this.zoom&&!this.isDataDirty())return this.performZoom(a,r);this.dirty=this.isDirty(),this.resetEvents();var o;this.dirty&&(t.forEach(this.series,u),this._eventSeries={},this.cleanGroup(),o=this.getGroup(),s.forEachRev(this.series,function(e){e.cleanGroup(o)}));var d=this.chart.theme,n=this._hScaler.scaler.getTransformerFromModel(this._hScaler),l=this._vScaler.scaler.getTransformerFromModel(this._vScaler),m=Math.max(0,this._hScaler.bounds.lower),f=n(m),c=this.events(),h=this.getBarProperties(),y=this.series.length;t.forEach(this.series,function(e){e.hidden&&y--});for(var M=y,v=this.series.length-1;v>=0;--v){var p=this.series[v];if(this.dirty||p.dirty){p.cleanGroup(),this.opt.enableCache&&(p._rectFreePool=(p._rectFreePool?p._rectFreePool:[]).concat(p._rectUsePool?p._rectUsePool:[]),p._rectUsePool=[]);var g=d.next("bar",[this.opt,p]);if(p.hidden)p.dyn.fill=g.series.fill,p.dyn.stroke=g.series.stroke;else{M--;var b=new Array(p.data.length);o=p.group;for(var w=t.some(p.data,function(e){return"number"==typeof e||e&&!e.hasOwnProperty("x")}),k=w?Math.max(0,Math.floor(this._vScaler.bounds.from-1)):0,F=w?Math.min(p.data.length,Math.ceil(this._vScaler.bounds.to)):p.data.length,I=k;F>I;++I){var j=p.data[I];if(null!=j){var E,_,z=this.getValue(j,I,v,w),G=n(z.y),T=Math.abs(G-f);if(this.opt.styleFunc||"number"!=typeof j){var A="number"!=typeof j?[j]:[];this.opt.styleFunc&&A.push(this.opt.styleFunc(j)),E=d.addMixin(g,"bar",A,!0)}else E=d.post(g,"bar");if(T>=0&&h.height>=1){var x={x:r.l+(z.y<m?G:f),y:a.height-r.b-l(z.x+1.5)+h.gap+h.thickness*(y-M-1),width:T,height:h.height};if(E.series.shadow){var S=e.clone(x);S.x+=E.series.shadow.dx,S.y+=E.series.shadow.dy,_=this.createRect(p,o,S).setFill(E.series.shadow.color).setStroke(E.series.shadow),this.animate&&this._animateBar(_,r.l+f,-T)}var N=this._plotFill(E.series.fill,a,r);N=this._shapeFill(N,x);var H=this.createRect(p,o,x).setFill(N).setStroke(E.series.stroke);if(H.setFilter&&E.series.filter&&H.setFilter(E.series.filter),p.dyn.fill=H.getFill(),p.dyn.stroke=H.getStroke(),c){var C={element:"bar",index:I,run:p,shape:H,shadow:_,cx:z.y,cy:z.x+1.5,x:w?I:p.data[I].x,y:w?p.data[I]:p.data[I].y};this._connectEvents(C),b[I]=C}!isNaN(z.py)&&z.py>m&&(x.x+=n(z.py),x.width-=n(z.py)),this.createLabel(o,j,x,E),this.animate&&this._animateBar(H,r.l+f,-T)}}}this._eventSeries[p.name]=b,p.dirty=!1}}else d.skip(),this._reconnectEvents(p.name)}return this.dirty=!1,i("dojo-bidi")&&this._checkOrientation(this.group,a,r),this},getValue:function(e,t,a,i){var r,o;return i?(r="number"==typeof e?e:e.y,o=t):(r=e.y,o=e.x-1),{y:r,x:o}},getBarProperties:function(){var e=d.calculateBarSize(this._vScaler.bounds.scale,this.opt);return{gap:e.gap,height:e.size,thickness:0}},_animateBar:function(t,a,i){0==i&&(i=1),n.animateTransform(e.delegate({shape:t,duration:1200,transform:[{name:"translate",start:[a-a/i,0],end:[0,0]},{name:"scale",start:[1/i,1],end:[1,1]},{name:"original"}]},this.animate)).play()}})});//# sourceMappingURL=Bars.js.map