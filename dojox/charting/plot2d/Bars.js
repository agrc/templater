//>>built
define("dojox/charting/plot2d/Bars",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/has","./CartesianBase","./_PlotEvents","./common","dojox/gfx/fx","dojox/lang/utils","dojox/lang/functional","dojox/lang/functional/reversed"],function(e,t,a,i,r,d,o,n,l,s,m){var u=m.lambda("item.purgeGroup()"),h=function(){return!1};return a("dojox.charting.plot2d.Bars",[r,d],{defaultParams:{gap:0,animate:null,enableCache:!1},optionalParams:{minBarSize:1,maxBarSize:1,stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:""},constructor:function(t,a){this.opt=e.clone(e.mixin(this.opt,this.defaultParams)),l.updateWithObject(this.opt,a),l.updateWithPattern(this.opt,a,this.optionalParams),this.animate=this.opt.animate,this.renderingOptions={"shape-rendering":"crispEdges"}},getSeriesStats:function(){var t,a=o.collectSimpleStats(this.series,e.hitch(this,"isNullValue"));return a.hmin-=.5,a.hmax+=.5,t=a.hmin,a.hmin=a.vmin,a.vmin=t,t=a.hmax,a.hmax=a.vmax,a.vmax=t,a},createRect:function(e,t,a){var i;return this.opt.enableCache&&e._rectFreePool.length>0?(i=e._rectFreePool.pop(),i.setShape(a),t.add(i)):i=t.createRect(a),this.opt.enableCache&&e._rectUsePool.push(i),i},createLabel:function(e,t,a,i){if(this.opt.labels&&"outside"==this.opt.labelStyle){var r=a.y+a.height/2,d=a.x+a.width+this.opt.labelOffset;this.renderLabel(e,d,r,this._getLabel(isNaN(t.y)?t:t.y),i,"start")}else this.inherited(arguments)},render:function(a,r){if(this.zoom&&!this.isDataDirty())return this.performZoom(a,r);this.dirty=this.isDirty(),this.resetEvents();var d;this.dirty&&(t.forEach(this.series,u),this._eventSeries={},this.cleanGroup(),d=this.getGroup(),s.forEachRev(this.series,function(e){e.cleanGroup(d)}));var o=this.chart.theme,n=this._hScaler.scaler.getTransformerFromModel(this._hScaler),l=this._vScaler.scaler.getTransformerFromModel(this._vScaler),m=Math.max(this._hScaler.bounds.lower,this._hAxis?this._hAxis.naturalBaseline:0),h=n(m),f=this.events(),y=this.getBarProperties(),c=this.series.length;t.forEach(this.series,function(e){e.hidden&&c--});var v=c,p=this.extractValues(this._vScaler);p=this.rearrangeValues(p,n,h);for(var M=0;M<this.series.length;M++){var g=this.series[M];if(this.dirty||g.dirty){g.cleanGroup(),this.opt.enableCache&&(g._rectFreePool=(g._rectFreePool?g._rectFreePool:[]).concat(g._rectUsePool?g._rectUsePool:[]),g._rectUsePool=[]);var b=o.next("bar",[this.opt,g]);if(g.hidden)g.dyn.fill=b.series.fill,g.dyn.stroke=b.series.stroke;else{v--;var w=new Array(g.data.length);d=g.group;for(var k=t.some(g.data,function(e){return"number"==typeof e||e&&!e.hasOwnProperty("x")}),_=k?Math.max(0,Math.floor(this._vScaler.bounds.from-1)):0,F=k?Math.min(g.data.length,Math.ceil(this._vScaler.bounds.to)):g.data.length,I=_;I<F;++I){var j=g.data[I];if(!this.isNullValue(j)){var E,A,C=this.getValue(j,I,M,k),D=p[M][I];if(this.opt.styleFunc||"number"!=typeof j){var x="number"!=typeof j?[j]:[];this.opt.styleFunc&&x.push(this.opt.styleFunc(j)),E=o.addMixin(b,"bar",x,!0)}else E=o.post(b,"bar");if(D&&y.height>=1){var G={x:r.l+h+Math.min(D,0),y:a.height-r.b-l(C.x+1.5)+y.gap+y.thickness*(c-v-1),width:Math.abs(D),height:y.height};if(E.series.shadow){var S=e.clone(G);S.x+=E.series.shadow.dx,S.y+=E.series.shadow.dy,A=this.createRect(g,d,S).setFill(E.series.shadow.color).setStroke(E.series.shadow),this.animate&&this._animateBar(A,r.l+h,-D)}var z=this._plotFill(E.series.fill,a,r);z=this._shapeFill(z,G);var N=this.createRect(g,d,G).setFill(z).setStroke(E.series.stroke);if(N.setFilter&&E.series.filter&&N.setFilter(E.series.filter),g.dyn.fill=N.getFill(),g.dyn.stroke=N.getStroke(),f){var T={element:"bar",index:I,run:g,shape:N,shadow:A,cx:C.y,cy:C.x+1.5,x:k?I:g.data[I].x,y:k?g.data[I]:g.data[I].y};this._connectEvents(T),w[I]=T}!isNaN(C.py)&&C.py>m&&(G.x+=n(C.py),G.width-=n(C.py)),this.createLabel(d,j,G,E),this.animate&&this._animateBar(N,r.l+h,-Math.abs(D))}}}this._eventSeries[g.name]=w,g.dirty=!1}}else o.skip(),this._reconnectEvents(g.name)}return this.dirty=!1,i("dojo-bidi")&&this._checkOrientation(this.group,a,r),this},getValue:function(e,t,a,i){var r,d;return i?(r="number"==typeof e?e:e.y,d=t):(r=e.y,d=e.x-1),{y:r,x:d}},extractValues:function(e){for(var a=[],i=this.series.length-1;i>=0;--i){var r=this.series[i];if(this.dirty||r.dirty){var d=t.some(r.data,function(e){return"number"==typeof e||e&&!e.hasOwnProperty("x")}),o=d?Math.max(0,Math.floor(e.bounds.from-1)):0,n=d?Math.min(r.data.length,Math.ceil(e.bounds.to)):r.data.length,l=a[i]=[];l.min=o,l.max=n;for(var s=o;s<n;++s){var m=r.data[s];l[s]=this.isNullValue(m)?0:"number"==typeof m?m:m.y}}}return a},rearrangeValues:function(e,t,a){for(var i=0,r=e.length;i<r;++i){var d=e[i];if(d)for(var o=d.min,n=d.max;o<n;++o){var l=d[o];d[o]=this.isNullValue(l)?0:t(l)-a}}return e},isNullValue:function(e){if(null===e||void 0===e)return!0;var t=this._hAxis?this._hAxis.isNullValue:h,a=this._vAxis?this._vAxis.isNullValue:h;return"number"==typeof e?a(.5)||t(e):a(isNaN(e.x)?.5:e.x+.5)||null===e.y||t(e.y)},getBarProperties:function(){var e=o.calculateBarSize(this._vScaler.bounds.scale,this.opt);return{gap:e.gap,height:e.size,thickness:0}},_animateBar:function(t,a,i){0==i&&(i=1),n.animateTransform(e.delegate({shape:t,duration:1200,transform:[{name:"translate",start:[a-a/i,0],end:[0,0]},{name:"scale",start:[1/i,1],end:[1,1]},{name:"original"}]},this.animate)).play()}})});//# sourceMappingURL=Bars.js.map