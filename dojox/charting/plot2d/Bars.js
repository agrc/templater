//>>built
define("dojox/charting/plot2d/Bars",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/has","./CartesianBase","./_PlotEvents","./common","dojox/gfx/fx","dojox/lang/utils","dojox/lang/functional","dojox/lang/functional/reversed"],function(e,t,i,a,r,n,o,d,s,l,u){var c=u.lambda("item.purgeGroup()");return i("dojox.charting.plot2d.Bars",[r,n],{defaultParams:{gap:0,animate:null,enableCache:!1},optionalParams:{minBarSize:1,maxBarSize:1,stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:""},constructor:function(t,i){this.opt=e.clone(e.mixin(this.opt,this.defaultParams)),s.updateWithObject(this.opt,i),s.updateWithPattern(this.opt,i,this.optionalParams),this.animate=this.opt.animate,this.renderingOptions={"shape-rendering":"crispEdges"}},getSeriesStats:function(){var e,t=o.collectSimpleStats(this.series);return t.hmin-=.5,t.hmax+=.5,e=t.hmin,t.hmin=t.vmin,t.vmin=e,e=t.hmax,t.hmax=t.vmax,t.vmax=e,t},createRect:function(e,t,i){var a;return this.opt.enableCache&&e._rectFreePool.length>0?(a=e._rectFreePool.pop(),a.setShape(i),t.add(a)):a=t.createRect(i),this.opt.enableCache&&e._rectUsePool.push(a),a},createLabel:function(e,t,i,a){if(this.opt.labels&&"outside"==this.opt.labelStyle){var r=i.y+i.height/2,n=i.x+i.width+this.opt.labelOffset;this.renderLabel(e,n,r,this._getLabel(isNaN(t.y)?t:t.y),a,"start")}else this.inherited(arguments)},render:function(i,r){if(this.zoom&&!this.isDataDirty())return this.performZoom(i,r);this.dirty=this.isDirty(),this.resetEvents();var n;this.dirty&&(t.forEach(this.series,c),this._eventSeries={},this.cleanGroup(),n=this.getGroup(),l.forEachRev(this.series,function(e){e.cleanGroup(n)}));var o=this.chart.theme,d=this._hScaler.scaler.getTransformerFromModel(this._hScaler),s=this._vScaler.scaler.getTransformerFromModel(this._vScaler),u=Math.max(0,this._hScaler.bounds.lower),f=d(u),m=this.events(),h=this.getBarProperties(),y=this.series.length;t.forEach(this.series,function(e){e.hidden&&y--});for(var p=y,v=this.series.length-1;v>=0;--v){var g=this.series[v];if(this.dirty||g.dirty){g.cleanGroup(),this.opt.enableCache&&(g._rectFreePool=(g._rectFreePool?g._rectFreePool:[]).concat(g._rectUsePool?g._rectUsePool:[]),g._rectUsePool=[]);var b=o.next("bar",[this.opt,g]);if(g.hidden)g.dyn.fill=b.series.fill,g.dyn.stroke=b.series.stroke;else{p--;var M=new Array(g.data.length);n=g.group;for(var w=t.some(g.data,function(e){return"number"==typeof e||e&&!e.hasOwnProperty("x")}),k=w?Math.max(0,Math.floor(this._vScaler.bounds.from-1)):0,_=w?Math.min(g.data.length,Math.ceil(this._vScaler.bounds.to)):g.data.length,j=k;_>j;++j){var F=g.data[j];if(null!=F){var x,E,I=this.getValue(F,j,v,w),A=d(I.y),C=Math.abs(A-f);if(this.opt.styleFunc||"number"!=typeof F){var T="number"!=typeof F?[F]:[];this.opt.styleFunc&&T.push(this.opt.styleFunc(F)),x=o.addMixin(b,"bar",T,!0)}else x=o.post(b,"bar");if(C>=0&&h.height>=1){var S={x:r.l+(I.y<u?A:f),y:i.height-r.b-s(I.x+1.5)+h.gap+h.thickness*(y-p-1),width:C,height:h.height};if(x.series.shadow){var N=e.clone(S);N.x+=x.series.shadow.dx,N.y+=x.series.shadow.dy,E=this.createRect(g,n,N).setFill(x.series.shadow.color).setStroke(x.series.shadow),this.animate&&this._animateBar(E,r.l+f,-C)}var z=this._plotFill(x.series.fill,i,r);z=this._shapeFill(z,S);var G=this.createRect(g,n,S).setFill(z).setStroke(x.series.stroke);if(G.setFilter&&x.series.filter&&G.setFilter(x.series.filter),g.dyn.fill=G.getFill(),g.dyn.stroke=G.getStroke(),m){var D={element:"bar",index:j,run:g,shape:G,shadow:E,cx:I.y,cy:I.x+1.5,x:w?j:g.data[j].x,y:w?g.data[j]:g.data[j].y};this._connectEvents(D),M[j]=D}!isNaN(I.py)&&I.py>u&&(S.x+=d(I.py),S.width-=d(I.py)),this.createLabel(n,F,S,x),this.animate&&this._animateBar(G,r.l+f,-C)}}}this._eventSeries[g.name]=M,g.dirty=!1}}else o.skip(),this._reconnectEvents(g.name)}return this.dirty=!1,a("dojo-bidi")&&this._checkOrientation(this.group,i,r),this},getValue:function(e,t,i,a){var r,n;return a?(r="number"==typeof e?e:e.y,n=t):(r=e.y,n=e.x-1),{y:r,x:n}},getBarProperties:function(){var e=o.calculateBarSize(this._vScaler.bounds.scale,this.opt);return{gap:e.gap,height:e.size,thickness:0}},_animateBar:function(t,i,a){0==a&&(a=1),d.animateTransform(e.delegate({shape:t,duration:1200,transform:[{name:"translate",start:[i-i/a,0],end:[0,0]},{name:"scale",start:[1/a,1],end:[1,1]},{name:"original"}]},this.animate)).play()}})});//# sourceMappingURL=Bars.js.map