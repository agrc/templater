//>>built
define("dojox/charting/plot2d/Indicator",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","./CartesianBase","./_PlotEvents","./common","../axis2d/common","dojox/gfx","dojox/lang/utils","dojox/gfx/fx","dojo/has"],function(e,t,r,i,a,n,o,s,d,l,u){var c=function(e){return f(e,e.getShape().text)},f=function(t,r){var i,a,n=t.declaredClass;if(-1!=n.indexOf("svg"))try{return e.mixin({},t.rawNode.getBBox())}catch(e){return null}else{if(-1!=n.indexOf("vml")){var o=t.rawNode,d=o.style.display;o.style.display="inline",i=s.pt2px(parseFloat(o.currentStyle.width)),a=s.pt2px(parseFloat(o.currentStyle.height));var l={x:0,y:0,width:i,height:a};return h(t,l),o.style.display=d,l}if(-1!=n.indexOf("silverlight")){var u={width:t.rawNode.actualWidth,height:t.rawNode.actualHeight};return h(t,u,.75)}if(t.getTextWidth){i=t.getTextWidth();var c=t.getFont(),f=c?c.size:s.defaultFont.size;return a=s.normalizedLength(f),l={width:i,height:a},h(t,l,.75),l}}return null},h=function(e,t,r){var i=t.width,a=t.height,n=e.getShape();switch(n.align){case"end":t.x=n.x-i;break;case"middle":t.x=n.x-i/2;break;case"start":default:t.x=n.x}return r=r||1,t.y=n.y-a*r,t},m=r("dojox.charting.plot2d.Indicator",[i,a],{defaultParams:{vertical:!0,fixed:!0,precision:0,lines:!0,labels:"line",markers:!0},optionalParams:{lineStroke:{},outlineStroke:{},shadowStroke:{},lineFill:{},stroke:{},outline:{},shadow:{},fill:{},fillFunc:null,labelFunc:null,font:"",fontColor:"",markerStroke:{},markerOutline:{},markerShadow:{},markerFill:{},markerSymbol:"",values:[],offset:{},start:!1,animate:!1},constructor:function(t,r){this.opt=e.clone(this.defaultParams),d.updateWithObject(this.opt,r),"number"==typeof r.values&&(r.values=[r.values]),d.updateWithPattern(this.opt,r,this.optionalParams),this.animate=this.opt.animate},render:function(e,t){return this.zoom?this.performZoom(e,t):this.isDirty()?(this.cleanGroup(null,!0),this.opt.values?(this._updateIndicator(),this):this):this},_updateIndicator:function(){var e=this.chart.theme,r=this._hAxis.name,i=this._vAxis.name,a=this._hAxis.getScaler().bounds,o=this._vAxis.getScaler().bounds,s={};s[r]=a.from,s[i]=o.from;var d=this.toPage(s);s[r]=a.to,s[i]=o.to;var l=this.toPage(s),u=this.events(),c=t.map(this.opt.values,function(e,t){return this._renderIndicator(e,t,r,i,d,l,u,this.animate)},this),f=c.length;if("trend"==this.opt.labels){var h=this.opt.vertical,m=this._data[0][0],p=this._data[f-1][0],y=p-m,v=this.opt.labelFunc?this.opt.labelFunc(-1,this.values,this._data,this.opt.fixed,this.opt.precision):n.getLabel(y,this.opt.fixed,this.opt.precision)+" ("+n.getLabel(100*y/m,!0,2)+"%)";this._renderText(this.getGroup(),v,this.chart.theme,h?(c[0].x+c[f-1].x)/2:c[1].x,h?c[0].y:(c[1].y+c[f-1].y)/2,-1,this.opt.values,this._data)}var g=void 0!=this.opt.lineFill?this.opt.lineFill:e.indicator.lineFill;if(g&&f>1){var b=Math.min(c[0].x1,c[f-1].x1),M=Math.min(c[0].y1,c[f-1].y1);this.getGroup().createRect({x:b,y:M,width:Math.max(c[0].x2,c[f-1].x2)-b,height:Math.max(c[0].y2,c[f-1].y2)-M}).setFill(g).moveToBack()}},_renderIndicator:function(r,i,a,o,s,d,l,c){var f=this.chart.theme,h=this.chart.getCoords(),m=this.opt.vertical,p=this.getGroup().createGroup(),y={};y[a]=m?r:0,y[o]=m?0:r,u("dojo-bidi")&&(y.x=this._getMarkX(y.x)),y=this.toPage(y);var v=m?y.x>=s.x&&y.x<=d.x:y.y>=d.y&&y.y<=s.y,g=y.x-h.x,b=y.y-h.y,M=m?g:s.x-h.x,w=m?s.y-h.y:b,k=m?M:d.x-h.x,_=m?d.y-h.y:w;if(this.opt.lines&&v){var j=this.opt.hasOwnProperty("lineShadow")?this.opt.lineShadow:f.indicator.lineShadow,x=this.opt.hasOwnProperty("lineStroke")?this.opt.lineStroke:f.indicator.lineStroke,F=this.opt.hasOwnProperty("lineOutline")?this.opt.lineOutline:f.indicator.lineOutline;j&&p.createLine({x1:M+j.dx,y1:w+j.dy,x2:k+j.dx,y2:_+j.dy}).setStroke(j),F&&(F=n.makeStroke(F),F.width=2*F.width+(x?x.width:0),p.createLine({x1:M,y1:w,x2:k,y2:_}).setStroke(F)),p.createLine({x1:M,y1:w,x2:k,y2:_}).setStroke(x)}var E;if(this.opt.markers&&v){var I=this._data[i],S=this;I&&(E=t.map(I,function(e,t){if(y[a]=m?r:e,y[o]=m?e:r,u("dojo-bidi")&&(y.x=S._getMarkX(y.x)),y=this.toPage(y),m?y.y<=s.y&&y.y>=d.y:y.x>=s.x&&y.x<=d.x){g=y.x-h.x,b=y.y-h.y;var i=this.opt.markerSymbol?this.opt.markerSymbol:f.indicator.markerSymbol,l="M"+g+" "+b+" "+i;if(j=void 0!=this.opt.markerShadow?this.opt.markerShadow:f.indicator.markerShadow,x=void 0!=this.opt.markerStroke?this.opt.markerStroke:f.indicator.markerStroke,F=void 0!=this.opt.markerOutline?this.opt.markerOutline:f.indicator.markerOutline,j){var c="M"+(g+j.dx)+" "+(b+j.dy)+" "+i;p.createPath(c).setFill(j.color).setStroke(j)}F&&(F=n.makeStroke(F),F.width=2*F.width+(x?x.width:0),p.createPath(l).setStroke(F));var v=p.createPath(l),M=this._shapeFill(void 0!=this.opt.markerFill?this.opt.markerFill:f.indicator.markerFill,v.getBoundingBox());v.setFill(M).setStroke(x)}return e},this))}var A;if(A=this.opt.start?{x:M,y:m?w:_}:{x:m?M:k,y:m?_:w},this.opt.labels&&"trend"!=this.opt.labels&&v){var T;this.opt.labelFunc?T=this.opt.labelFunc(i,this.opt.values,this._data,this.opt.fixed,this.opt.precision,this.opt.labels):"markers"==this.opt.labels?(T=t.map(E,function(e){return n.getLabel(e,this.opt.fixed,this.opt.precision)},this),T=1!=T.length?"[ "+T.join(", ")+" ]":T[0]):T=n.getLabel(r,this.opt.fixed,this.opt.precision),this._renderText(p,T,f,A.x,A.y,i,this.opt.values,this._data)}return l&&this._connectEvents({element:"indicator",run:this.run?this.run[i]:void 0,shape:p,value:r}),c&&this._animateIndicator(p,m,m?w:M,m?w+_:M+k,c),e.mixin(A,{x1:M,y1:w,x2:k,y2:_})},_animateIndicator:function(t,r,i,a,n){var o=r?[0,i]:[i,0],s=r?[1,1/a]:[1/a,1];l.animateTransform(e.delegate({shape:t,duration:1200,transform:[{name:"translate",start:o,end:[0,0]},{name:"scale",start:s,end:[1,1]},{name:"original"}]},n)).play()},clear:function(){this.inherited(arguments),this._data=[]},addSeries:function(e){this.inherited(arguments),this._data.push(e.data)},_renderText:function(e,t,r,i,a,s,d,l){this.opt.offset&&(i+=this.opt.offset.x,a+=this.opt.offset.y);var u=o.createText.gfx(this.chart,e,i,a,this.opt.vertical?"middle":this.opt.start?"start":"end",t,this.opt.font?this.opt.font:r.indicator.font,this.opt.fontColor?this.opt.fontColor:r.indicator.fontColor),f=c(u);this.opt.vertical&&!this.opt.start&&(f.y+=f.height/2,u.setShape({y:a+f.height/2})),f.x-=2,f.y-=1,f.width+=4,f.height+=2,f.r=this.opt.radius?this.opt.radius:r.indicator.radius;var h=void 0!=this.opt.shadow?this.opt.shadow:r.indicator.shadow,m=void 0!=this.opt.stroke?this.opt.stroke:r.indicator.stroke,p=void 0!=this.opt.outline?this.opt.outline:r.indicator.outline;h&&e.createRect(f).setFill(h.color).setStroke(h),p&&(p=n.makeStroke(p),p.width=2*p.width+(m?m.width:0),e.createRect(f).setStroke(p));var y=this.opt.fillFunc?this.opt.fillFunc(s,d,l):void 0!=this.opt.fill?this.opt.fill:r.indicator.fill;e.createRect(f).setFill(this._shapeFill(y,f)).setStroke(m),u.moveToFront()},getSeriesStats:function(){return e.delegate(n.defaultStats)}});return u("dojo-bidi")&&m.extend({_getMarkX:function(e){return this.chart.isRightToLeft()?this.chart.axes.x.scaler.bounds.to+this.chart.axes.x.scaler.bounds.from-e:e}}),m});//# sourceMappingURL=Indicator.js.map