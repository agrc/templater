//>>built
define("dojox/charting/plot2d/Indicator",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","./CartesianBase","./_PlotEvents","./common","../axis2d/common","dojox/gfx","dojox/lang/utils","dojox/gfx/fx","dojo/has"],function(e,t,a,i,r,o,d,n,l,s,m){var u=function(e){return h(e,e.getShape().text)},h=function(t,a){var i,r,o=t.declaredClass;if(-1!=o.indexOf("svg"))try{return e.mixin({},t.rawNode.getBBox())}catch(d){return null}else{if(-1!=o.indexOf("vml")){var l=t.rawNode,s=l.style.display;l.style.display="inline",i=n.pt2px(parseFloat(l.currentStyle.width)),r=n.pt2px(parseFloat(l.currentStyle.height));var m={x:0,y:0,width:i,height:r};return f(t,m),l.style.display=s,m}if(-1!=o.indexOf("silverlight")){var u={width:t.rawNode.actualWidth,height:t.rawNode.actualHeight};return f(t,u,.75)}if(t.getTextWidth){i=t.getTextWidth();var h=t.getFont(),c=h?h.size:n.defaultFont.size;return r=n.normalizedLength(c),m={width:i,height:r},f(t,m,.75),m}}return null},f=function(e,t,a){var i=t.width,r=t.height,o=e.getShape(),d=o.align;switch(d){case"end":t.x=o.x-i;break;case"middle":t.x=o.x-i/2;break;case"start":default:t.x=o.x}return a=a||1,t.y=o.y-r*a,t},c=a("dojox.charting.plot2d.Indicator",[i,r],{defaultParams:{vertical:!0,fixed:!0,precision:0,lines:!0,labels:"line",markers:!0},optionalParams:{lineStroke:{},outlineStroke:{},shadowStroke:{},lineFill:{},stroke:{},outline:{},shadow:{},fill:{},fillFunc:null,labelFunc:null,font:"",fontColor:"",markerStroke:{},markerOutline:{},markerShadow:{},markerFill:{},markerSymbol:"",values:[],offset:{},start:!1,animate:!1},constructor:function(t,a){this.opt=e.clone(this.defaultParams),l.updateWithObject(this.opt,a),"number"==typeof a.values&&(a.values=[a.values]),l.updateWithPattern(this.opt,a,this.optionalParams),this.animate=this.opt.animate},render:function(e,t){return this.zoom?this.performZoom(e,t):this.isDirty()?(this.cleanGroup(null,!0),this.opt.values?(this._updateIndicator(),this):this):this},_updateIndicator:function(){var e=this.chart.theme,a=this._hAxis.name,i=this._vAxis.name,r=this._hAxis.getScaler().bounds,d=this._vAxis.getScaler().bounds,n={};n[a]=r.from,n[i]=d.from;var l=this.toPage(n);n[a]=r.to,n[i]=d.to;var s=this.toPage(n),m=this.events(),u=t.map(this.opt.values,function(e,t){return this._renderIndicator(e,t,a,i,l,s,m,this.animate)},this),h=u.length;if("trend"==this.opt.labels){var f=this.opt.vertical,c=this._data[0][0],y=this._data[h-1][0],v=y-c,M=this.opt.labelFunc?this.opt.labelFunc(-1,this.values,this._data,this.opt.fixed,this.opt.precision):o.getLabel(v,this.opt.fixed,this.opt.precision)+" ("+o.getLabel(100*v/c,!0,2)+"%)";this._renderText(this.getGroup(),M,this.chart.theme,f?(u[0].x+u[h-1].x)/2:u[1].x,f?u[0].y:(u[1].y+u[h-1].y)/2,-1,this.opt.values,this._data)}var p=void 0!=this.opt.lineFill?this.opt.lineFill:e.indicator.lineFill;if(p&&h>1){var g=Math.min(u[0].x1,u[h-1].x1),b=Math.min(u[0].y1,u[h-1].y1),w=this.getGroup().createRect({x:g,y:b,width:Math.max(u[0].x2,u[h-1].x2)-g,height:Math.max(u[0].y2,u[h-1].y2)-b}).setFill(p);w.moveToBack()}},_renderIndicator:function(a,i,r,d,n,l,s,u){var h=this.chart.theme,f=this.chart.getCoords(),c=this.opt.vertical,y=this.getGroup().createGroup(),v={};v[r]=c?a:0,v[d]=c?0:a,m("dojo-bidi")&&(v.x=this._getMarkX(v.x)),v=this.toPage(v);var M=c?v.x>=n.x&&v.x<=l.x:v.y>=l.y&&v.y<=n.y,p=v.x-f.x,g=v.y-f.y,b=c?p:n.x-f.x,w=c?n.y-f.y:g,k=c?b:l.x-f.x,F=c?l.y-f.y:w;if(this.opt.lines&&M){var I=this.opt.hasOwnProperty("lineShadow")?this.opt.lineShadow:h.indicator.lineShadow,j=this.opt.hasOwnProperty("lineStroke")?this.opt.lineStroke:h.indicator.lineStroke,E=this.opt.hasOwnProperty("lineOutline")?this.opt.lineOutline:h.indicator.lineOutline;I&&y.createLine({x1:b+I.dx,y1:w+I.dy,x2:k+I.dx,y2:F+I.dy}).setStroke(I),E&&(E=o.makeStroke(E),E.width=2*E.width+(j?j.width:0),y.createLine({x1:b,y1:w,x2:k,y2:F}).setStroke(E)),y.createLine({x1:b,y1:w,x2:k,y2:F}).setStroke(j)}var _;if(this.opt.markers&&M){var x=this._data[i],G=this;x&&(_=t.map(x,function(e,t){if(v[r]=c?a:e,v[d]=c?e:a,m("dojo-bidi")&&(v.x=G._getMarkX(v.x)),v=this.toPage(v),c?v.y<=n.y&&v.y>=l.y:v.x>=n.x&&v.x<=l.x){p=v.x-f.x,g=v.y-f.y;var i=this.opt.markerSymbol?this.opt.markerSymbol:h.indicator.markerSymbol,s="M"+p+" "+g+" "+i;if(I=void 0!=this.opt.markerShadow?this.opt.markerShadow:h.indicator.markerShadow,j=void 0!=this.opt.markerStroke?this.opt.markerStroke:h.indicator.markerStroke,E=void 0!=this.opt.markerOutline?this.opt.markerOutline:h.indicator.markerOutline,I){var u="M"+(p+I.dx)+" "+(g+I.dy)+" "+i;y.createPath(u).setFill(I.color).setStroke(I)}E&&(E=o.makeStroke(E),E.width=2*E.width+(j?j.width:0),y.createPath(s).setStroke(E));var M=y.createPath(s),b=this._shapeFill(void 0!=this.opt.markerFill?this.opt.markerFill:h.indicator.markerFill,M.getBoundingBox());M.setFill(b).setStroke(j)}return e},this))}var T;if(T=this.opt.start?{x:c?b:b,y:c?w:F}:{x:c?b:k,y:c?F:w},this.opt.labels&&"trend"!=this.opt.labels&&M){var S;this.opt.labelFunc?S=this.opt.labelFunc(i,this.opt.values,this._data,this.opt.fixed,this.opt.precision,this.opt.labels):"markers"==this.opt.labels?(S=t.map(_,function(e){return o.getLabel(e,this.opt.fixed,this.opt.precision)},this),S=1!=S.length?"[ "+S.join(", ")+" ]":S[0]):S=o.getLabel(a,this.opt.fixed,this.opt.precision),this._renderText(y,S,h,T.x,T.y,i,this.opt.values,this._data)}return s&&this._connectEvents({element:"indicator",run:this.run?this.run[i]:void 0,shape:y,value:a}),u&&this._animateIndicator(y,c,c?w:b,c?w+F:b+k,u),e.mixin(T,{x1:b,y1:w,x2:k,y2:F})},_animateIndicator:function(t,a,i,r,o){var d=a?[0,i]:[i,0],n=a?[1,1/r]:[1/r,1];s.animateTransform(e.delegate({shape:t,duration:1200,transform:[{name:"translate",start:d,end:[0,0]},{name:"scale",start:n,end:[1,1]},{name:"original"}]},o)).play()},clear:function(){this.inherited(arguments),this._data=[]},addSeries:function(e){this.inherited(arguments),this._data.push(e.data)},_renderText:function(e,t,a,i,r,n,l,s){this.opt.offset&&(i+=this.opt.offset.x,r+=this.opt.offset.y);var m=d.createText.gfx(this.chart,e,i,r,"middle",t,this.opt.font?this.opt.font:a.indicator.font,this.opt.fontColor?this.opt.fontColor:a.indicator.fontColor),h=u(m);h.x-=2,h.y-=1,h.width+=4,h.height+=2,h.r=this.opt.radius?this.opt.radius:a.indicator.radius;var f=void 0!=this.opt.shadow?this.opt.shadow:a.indicator.shadow,c=void 0!=this.opt.stroke?this.opt.stroke:a.indicator.stroke,y=void 0!=this.opt.outline?this.opt.outline:a.indicator.outline;f&&e.createRect(h).setFill(f.color).setStroke(f),y&&(y=o.makeStroke(y),y.width=2*y.width+(c?c.width:0),e.createRect(h).setStroke(y));var v=this.opt.fillFunc?this.opt.fillFunc(n,l,s):void 0!=this.opt.fill?this.opt.fill:a.indicator.fill;e.createRect(h).setFill(this._shapeFill(v,h)).setStroke(c),m.moveToFront()},getSeriesStats:function(){return e.delegate(o.defaultStats)}});return m("dojo-bidi")&&c.extend({_getMarkX:function(e){return this.chart.isRightToLeft()?this.chart.axes.x.scaler.bounds.to+this.chart.axes.x.scaler.bounds.from-e:e}}),c});//# sourceMappingURL=Indicator.js.map