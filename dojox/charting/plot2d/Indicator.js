//>>built
define("dojox/charting/plot2d/Indicator",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","./CartesianBase","./_PlotEvents","./common","../axis2d/common","dojox/gfx","dojox/lang/utils","dojox/gfx/fx","dojo/has"],function(e,t,a,i,r,d,o,n,l,s,m){var u=function(e){return f(e,e.getShape().text)},f=function(t,a){var i,r,d=t.declaredClass;if(-1!=d.indexOf("svg"))try{return e.mixin({},t.rawNode.getBBox())}catch(o){return null}else{if(-1!=d.indexOf("vml")){var l=t.rawNode,s=l.style.display;l.style.display="inline",i=n.pt2px(parseFloat(l.currentStyle.width)),r=n.pt2px(parseFloat(l.currentStyle.height));var m={x:0,y:0,width:i,height:r};return h(t,m),l.style.display=s,m}if(-1!=d.indexOf("silverlight")){var u={width:t.rawNode.actualWidth,height:t.rawNode.actualHeight};return h(t,u,.75)}if(t.getTextWidth){i=t.getTextWidth();var f=t.getFont(),y=f?f.size:n.defaultFont.size;return r=n.normalizedLength(y),m={width:i,height:r},h(t,m,.75),m}}return null},h=function(e,t,a){var i=t.width,r=t.height,d=e.getShape(),o=d.align;switch(o){case"end":t.x=d.x-i;break;case"middle":t.x=d.x-i/2;break;case"start":default:t.x=d.x}return a=a||1,t.y=d.y-r*a,t},y=a("dojox.charting.plot2d.Indicator",[i,r],{defaultParams:{vertical:!0,fixed:!0,precision:0,lines:!0,labels:"line",markers:!0},optionalParams:{lineStroke:{},outlineStroke:{},shadowStroke:{},lineFill:{},stroke:{},outline:{},shadow:{},fill:{},fillFunc:null,labelFunc:null,font:"",fontColor:"",markerStroke:{},markerOutline:{},markerShadow:{},markerFill:{},markerSymbol:"",values:[],offset:{},start:!1,animate:!1},constructor:function(t,a){this.opt=e.clone(this.defaultParams),l.updateWithObject(this.opt,a),"number"==typeof a.values&&(a.values=[a.values]),l.updateWithPattern(this.opt,a,this.optionalParams),this.animate=this.opt.animate},render:function(e,t){return this.zoom?this.performZoom(e,t):this.isDirty()?(this.cleanGroup(null,!0),this.opt.values?(this._updateIndicator(),this):this):this},_updateIndicator:function(){var e=this.chart.theme,a=this._hAxis.name,i=this._vAxis.name,r=this._hAxis.getScaler().bounds,o=this._vAxis.getScaler().bounds,n={};n[a]=r.from,n[i]=o.from;var l=this.toPage(n);n[a]=r.to,n[i]=o.to;var s=this.toPage(n),m=this.events(),u=t.map(this.opt.values,function(e,t){return this._renderIndicator(e,t,a,i,l,s,m,this.animate)},this),f=u.length;if("trend"==this.opt.labels){var h=this.opt.vertical,y=this._data[0][0],c=this._data[f-1][0],v=c-y,M=this.opt.labelFunc?this.opt.labelFunc(-1,this.values,this._data,this.opt.fixed,this.opt.precision):d.getLabel(v,this.opt.fixed,this.opt.precision)+" ("+d.getLabel(100*v/y,!0,2)+"%)";this._renderText(this.getGroup(),M,this.chart.theme,h?(u[0].x+u[f-1].x)/2:u[1].x,h?u[0].y:(u[1].y+u[f-1].y)/2,-1,this.opt.values,this._data)}var p=void 0!=this.opt.lineFill?this.opt.lineFill:e.indicator.lineFill;if(p&&f>1){var g=Math.min(u[0].x1,u[f-1].x1),b=Math.min(u[0].y1,u[f-1].y1),w=this.getGroup().createRect({x:g,y:b,width:Math.max(u[0].x2,u[f-1].x2)-g,height:Math.max(u[0].y2,u[f-1].y2)-b}).setFill(p);w.moveToBack()}},_renderIndicator:function(a,i,r,o,n,l,s,u){var f=this.chart.theme,h=this.chart.getCoords(),y=this.opt.vertical,c=this.getGroup().createGroup(),v={};v[r]=y?a:0,v[o]=y?0:a,m("dojo-bidi")&&(v.x=this._getMarkX(v.x)),v=this.toPage(v);var M=y?v.x>=n.x&&v.x<=l.x:v.y>=l.y&&v.y<=n.y,p=v.x-h.x,g=v.y-h.y,b=y?p:n.x-h.x,w=y?n.y-h.y:g,k=y?b:l.x-h.x,F=y?l.y-h.y:w;if(this.opt.lines&&M){var I=this.opt.hasOwnProperty("lineShadow")?this.opt.lineShadow:f.indicator.lineShadow,j=this.opt.hasOwnProperty("lineStroke")?this.opt.lineStroke:f.indicator.lineStroke,_=this.opt.hasOwnProperty("lineOutline")?this.opt.lineOutline:f.indicator.lineOutline;I&&c.createLine({x1:b+I.dx,y1:w+I.dy,x2:k+I.dx,y2:F+I.dy}).setStroke(I),_&&(_=d.makeStroke(_),_.width=2*_.width+(j?j.width:0),c.createLine({x1:b,y1:w,x2:k,y2:F}).setStroke(_)),c.createLine({x1:b,y1:w,x2:k,y2:F}).setStroke(j)}var E;if(this.opt.markers&&M){var x=this._data[i],T=this;x&&(E=t.map(x,function(e,t){if(v[r]=y?a:e,v[o]=y?e:a,m("dojo-bidi")&&(v.x=T._getMarkX(v.x)),v=this.toPage(v),y?v.y<=n.y&&v.y>=l.y:v.x>=n.x&&v.x<=l.x){p=v.x-h.x,g=v.y-h.y;var i=this.opt.markerSymbol?this.opt.markerSymbol:f.indicator.markerSymbol,s="M"+p+" "+g+" "+i;if(I=void 0!=this.opt.markerShadow?this.opt.markerShadow:f.indicator.markerShadow,j=void 0!=this.opt.markerStroke?this.opt.markerStroke:f.indicator.markerStroke,_=void 0!=this.opt.markerOutline?this.opt.markerOutline:f.indicator.markerOutline,I){var u="M"+(p+I.dx)+" "+(g+I.dy)+" "+i;c.createPath(u).setFill(I.color).setStroke(I)}_&&(_=d.makeStroke(_),_.width=2*_.width+(j?j.width:0),c.createPath(s).setStroke(_));var M=c.createPath(s),b=this._shapeFill(void 0!=this.opt.markerFill?this.opt.markerFill:f.indicator.markerFill,M.getBoundingBox());M.setFill(b).setStroke(j)}return e},this))}var G;if(G=this.opt.start?{x:y?b:b,y:y?w:F}:{x:y?b:k,y:y?F:w},this.opt.labels&&"trend"!=this.opt.labels&&M){var S;this.opt.labelFunc?S=this.opt.labelFunc(i,this.opt.values,this._data,this.opt.fixed,this.opt.precision,this.opt.labels):"markers"==this.opt.labels?(S=t.map(E,function(e){return d.getLabel(e,this.opt.fixed,this.opt.precision)},this),S=1!=S.length?"[ "+S.join(", ")+" ]":S[0]):S=d.getLabel(a,this.opt.fixed,this.opt.precision),this._renderText(c,S,f,G.x,G.y,i,this.opt.values,this._data)}return s&&this._connectEvents({element:"indicator",run:this.run?this.run[i]:void 0,shape:c,value:a}),u&&this._animateIndicator(c,y,y?w:b,y?w+F:b+k,u),e.mixin(G,{x1:b,y1:w,x2:k,y2:F})},_animateIndicator:function(t,a,i,r,d){var o=a?[0,i]:[i,0],n=a?[1,1/r]:[1/r,1];s.animateTransform(e.delegate({shape:t,duration:1200,transform:[{name:"translate",start:o,end:[0,0]},{name:"scale",start:n,end:[1,1]},{name:"original"}]},d)).play()},clear:function(){this.inherited(arguments),this._data=[]},addSeries:function(e){this.inherited(arguments),this._data.push(e.data)},_renderText:function(e,t,a,i,r,n,l,s){this.opt.offset&&(i+=this.opt.offset.x,r+=this.opt.offset.y);var m=o.createText.gfx(this.chart,e,i,r,"middle",t,this.opt.font?this.opt.font:a.indicator.font,this.opt.fontColor?this.opt.fontColor:a.indicator.fontColor),f=u(m);f.x-=2,f.y-=1,f.width+=4,f.height+=2,f.r=this.opt.radius?this.opt.radius:a.indicator.radius;var h=void 0!=this.opt.shadow?this.opt.shadow:a.indicator.shadow,y=void 0!=this.opt.stroke?this.opt.stroke:a.indicator.stroke,c=void 0!=this.opt.outline?this.opt.outline:a.indicator.outline;h&&e.createRect(f).setFill(h.color).setStroke(h),c&&(c=d.makeStroke(c),c.width=2*c.width+(y?y.width:0),e.createRect(f).setStroke(c));var v=this.opt.fillFunc?this.opt.fillFunc(n,l,s):void 0!=this.opt.fill?this.opt.fill:a.indicator.fill;e.createRect(f).setFill(this._shapeFill(v,f)).setStroke(y),m.moveToFront()},getSeriesStats:function(){return e.delegate(d.defaultStats)}});return m("dojo-bidi")&&y.extend({_getMarkX:function(e){return this.chart.isRightToLeft()?this.chart.axes.x.scaler.bounds.to+this.chart.axes.x.scaler.bounds.from-e:e}}),y});//# sourceMappingURL=Indicator.js.map