//>>built
define("dojox/charting/plot2d/Indicator",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","./CartesianBase","./_PlotEvents","./common","../axis2d/common","dojox/gfx","dojox/lang/utils","dojox/gfx/fx","dojo/has"],function(e,t,i,a,r,n,o,d,s,l,u){var c=function(e){return f(e,e.getShape().text)},f=function(t,i){var a,r,n=t.declaredClass;if(-1!=n.indexOf("svg"))try{return e.mixin({},t.rawNode.getBBox())}catch(o){return null}else{if(-1!=n.indexOf("vml")){var s=t.rawNode,l=s.style.display;s.style.display="inline",a=d.pt2px(parseFloat(s.currentStyle.width)),r=d.pt2px(parseFloat(s.currentStyle.height));var u={x:0,y:0,width:a,height:r};return m(t,u),s.style.display=l,u}if(-1!=n.indexOf("silverlight")){var c={width:t.rawNode.actualWidth,height:t.rawNode.actualHeight};return m(t,c,.75)}if(t.getTextWidth){a=t.getTextWidth();var f=t.getFont(),h=f?f.size:d.defaultFont.size;return r=d.normalizedLength(h),u={width:a,height:r},m(t,u,.75),u}}return null},m=function(e,t,i){var a=t.width,r=t.height,n=e.getShape(),o=n.align;switch(o){case"end":t.x=n.x-a;break;case"middle":t.x=n.x-a/2;break;case"start":default:t.x=n.x}return i=i||1,t.y=n.y-r*i,t},h=i("dojox.charting.plot2d.Indicator",[a,r],{defaultParams:{vertical:!0,fixed:!0,precision:0,lines:!0,labels:"line",markers:!0},optionalParams:{lineStroke:{},outlineStroke:{},shadowStroke:{},lineFill:{},stroke:{},outline:{},shadow:{},fill:{},fillFunc:null,labelFunc:null,font:"",fontColor:"",markerStroke:{},markerOutline:{},markerShadow:{},markerFill:{},markerSymbol:"",values:[],offset:{},start:!1,animate:!1},constructor:function(t,i){this.opt=e.clone(this.defaultParams),s.updateWithObject(this.opt,i),"number"==typeof i.values&&(i.values=[i.values]),s.updateWithPattern(this.opt,i,this.optionalParams),this.animate=this.opt.animate},render:function(e,t){return this.zoom?this.performZoom(e,t):this.isDirty()?(this.cleanGroup(null,!0),this.opt.values?(this._updateIndicator(),this):this):this},_updateIndicator:function(){var e=this.chart.theme,i=this._hAxis.name,a=this._vAxis.name,r=this._hAxis.getScaler().bounds,o=this._vAxis.getScaler().bounds,d={};d[i]=r.from,d[a]=o.from;var s=this.toPage(d);d[i]=r.to,d[a]=o.to;var l=this.toPage(d),u=this.events(),c=t.map(this.opt.values,function(e,t){return this._renderIndicator(e,t,i,a,s,l,u,this.animate)},this),f=c.length;if("trend"==this.opt.labels){var m=this.opt.vertical,h=this._data[0][0],p=this._data[f-1][0],y=p-h,v=this.opt.labelFunc?this.opt.labelFunc(-1,this.values,this._data,this.opt.fixed,this.opt.precision):n.getLabel(y,this.opt.fixed,this.opt.precision)+" ("+n.getLabel(100*y/h,!0,2)+"%)";this._renderText(this.getGroup(),v,this.chart.theme,m?(c[0].x+c[f-1].x)/2:c[1].x,m?c[0].y:(c[1].y+c[f-1].y)/2,-1,this.opt.values,this._data)}var g=void 0!=this.opt.lineFill?this.opt.lineFill:e.indicator.lineFill;if(g&&f>1){var b=Math.min(c[0].x1,c[f-1].x1),M=Math.min(c[0].y1,c[f-1].y1),w=this.getGroup().createRect({x:b,y:M,width:Math.max(c[0].x2,c[f-1].x2)-b,height:Math.max(c[0].y2,c[f-1].y2)-M}).setFill(g);w.moveToBack()}},_renderIndicator:function(i,a,r,o,d,s,l,c){var f=this.chart.theme,m=this.chart.getCoords(),h=this.opt.vertical,p=this.getGroup().createGroup(),y={};y[r]=h?i:0,y[o]=h?0:i,u("dojo-bidi")&&(y.x=this._getMarkX(y.x)),y=this.toPage(y);var v=h?y.x>=d.x&&y.x<=s.x:y.y>=s.y&&y.y<=d.y,g=y.x-m.x,b=y.y-m.y,M=h?g:d.x-m.x,w=h?d.y-m.y:b,_=h?M:s.x-m.x,k=h?s.y-m.y:w;if(this.opt.lines&&v){var j=this.opt.hasOwnProperty("lineShadow")?this.opt.lineShadow:f.indicator.lineShadow,x=this.opt.hasOwnProperty("lineStroke")?this.opt.lineStroke:f.indicator.lineStroke,I=this.opt.hasOwnProperty("lineOutline")?this.opt.lineOutline:f.indicator.lineOutline;j&&p.createLine({x1:M+j.dx,y1:w+j.dy,x2:_+j.dx,y2:k+j.dy}).setStroke(j),I&&(I=n.makeStroke(I),I.width=2*I.width+(x?x.width:0),p.createLine({x1:M,y1:w,x2:_,y2:k}).setStroke(I)),p.createLine({x1:M,y1:w,x2:_,y2:k}).setStroke(x)}var F;if(this.opt.markers&&v){var E=this._data[a],A=this;E&&(F=t.map(E,function(e,t){if(y[r]=h?i:e,y[o]=h?e:i,u("dojo-bidi")&&(y.x=A._getMarkX(y.x)),y=this.toPage(y),h?y.y<=d.y&&y.y>=s.y:y.x>=d.x&&y.x<=s.x){g=y.x-m.x,b=y.y-m.y;var a=this.opt.markerSymbol?this.opt.markerSymbol:f.indicator.markerSymbol,l="M"+g+" "+b+" "+a;if(j=void 0!=this.opt.markerShadow?this.opt.markerShadow:f.indicator.markerShadow,x=void 0!=this.opt.markerStroke?this.opt.markerStroke:f.indicator.markerStroke,I=void 0!=this.opt.markerOutline?this.opt.markerOutline:f.indicator.markerOutline,j){var c="M"+(g+j.dx)+" "+(b+j.dy)+" "+a;p.createPath(c).setFill(j.color).setStroke(j)}I&&(I=n.makeStroke(I),I.width=2*I.width+(x?x.width:0),p.createPath(l).setStroke(I));var v=p.createPath(l),M=this._shapeFill(void 0!=this.opt.markerFill?this.opt.markerFill:f.indicator.markerFill,v.getBoundingBox());v.setFill(M).setStroke(x)}return e},this))}var C;if(C=this.opt.start?{x:h?M:M,y:h?w:k}:{x:h?M:_,y:h?k:w},this.opt.labels&&"trend"!=this.opt.labels&&v){var T;this.opt.labelFunc?T=this.opt.labelFunc(a,this.opt.values,this._data,this.opt.fixed,this.opt.precision,this.opt.labels):"markers"==this.opt.labels?(T=t.map(F,function(e){return n.getLabel(e,this.opt.fixed,this.opt.precision)},this),T=1!=T.length?"[ "+T.join(", ")+" ]":T[0]):T=n.getLabel(i,this.opt.fixed,this.opt.precision),this._renderText(p,T,f,C.x,C.y,a,this.opt.values,this._data)}return l&&this._connectEvents({element:"indicator",run:this.run?this.run[a]:void 0,shape:p,value:i}),c&&this._animateIndicator(p,h,h?w:M,h?w+k:M+_,c),e.mixin(C,{x1:M,y1:w,x2:_,y2:k})},_animateIndicator:function(t,i,a,r,n){var o=i?[0,a]:[a,0],d=i?[1,1/r]:[1/r,1];l.animateTransform(e.delegate({shape:t,duration:1200,transform:[{name:"translate",start:o,end:[0,0]},{name:"scale",start:d,end:[1,1]},{name:"original"}]},n)).play()},clear:function(){this.inherited(arguments),this._data=[]},addSeries:function(e){this.inherited(arguments),this._data.push(e.data)},_renderText:function(e,t,i,a,r,d,s,l){this.opt.offset&&(a+=this.opt.offset.x,r+=this.opt.offset.y);var u=o.createText.gfx(this.chart,e,a,r,"middle",t,this.opt.font?this.opt.font:i.indicator.font,this.opt.fontColor?this.opt.fontColor:i.indicator.fontColor),f=c(u);f.x-=2,f.y-=1,f.width+=4,f.height+=2,f.r=this.opt.radius?this.opt.radius:i.indicator.radius;var m=void 0!=this.opt.shadow?this.opt.shadow:i.indicator.shadow,h=void 0!=this.opt.stroke?this.opt.stroke:i.indicator.stroke,p=void 0!=this.opt.outline?this.opt.outline:i.indicator.outline;m&&e.createRect(f).setFill(m.color).setStroke(m),p&&(p=n.makeStroke(p),p.width=2*p.width+(h?h.width:0),e.createRect(f).setStroke(p));var y=this.opt.fillFunc?this.opt.fillFunc(d,s,l):void 0!=this.opt.fill?this.opt.fill:i.indicator.fill;e.createRect(f).setFill(this._shapeFill(y,f)).setStroke(h),u.moveToFront()},getSeriesStats:function(){return e.delegate(n.defaultStats)}});return u("dojo-bidi")&&h.extend({_getMarkX:function(e){return this.chart.isRightToLeft()?this.chart.axes.x.scaler.bounds.to+this.chart.axes.x.scaler.bounds.from-e:e}}),h});//# sourceMappingURL=Indicator.js.map