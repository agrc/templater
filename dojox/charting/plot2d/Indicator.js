//>>built
define("dojox/charting/plot2d/Indicator",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","./CartesianBase","./_PlotEvents","./common","../axis2d/common","dojox/gfx","dojox/lang/utils","dojox/gfx/fx","dojo/has"],function(e,t,i,a,r,n,o,s,d,l,u){var c=function(e){return h(e,e.getShape().text)},h=function(t,i){var a,r,n=t.declaredClass;if(-1!=n.indexOf("svg"))try{return e.mixin({},t.rawNode.getBBox())}catch(e){return null}else{if(-1!=n.indexOf("vml")){var o=t.rawNode,d=o.style.display;o.style.display="inline",a=s.pt2px(parseFloat(o.currentStyle.width)),r=s.pt2px(parseFloat(o.currentStyle.height));var l={x:0,y:0,width:a,height:r};return f(t,l),o.style.display=d,l}if(-1!=n.indexOf("silverlight")){var u={width:t.rawNode.actualWidth,height:t.rawNode.actualHeight};return f(t,u,.75)}if(t.getTextWidth){a=t.getTextWidth();var c=t.getFont(),h=c?c.size:s.defaultFont.size;return r=s.normalizedLength(h),l={width:a,height:r},f(t,l,.75),l}}return null},f=function(e,t,i){var a=t.width,r=t.height,n=e.getShape();switch(n.align){case"end":t.x=n.x-a;break;case"middle":t.x=n.x-a/2;break;case"start":default:t.x=n.x}return i=i||1,t.y=n.y-r*i,t},m=i("dojox.charting.plot2d.Indicator",[a,r],{defaultParams:{vertical:!0,fixed:!0,precision:0,lines:!0,labels:"line",markers:!0},optionalParams:{lineStroke:{},outlineStroke:{},shadowStroke:{},lineFill:{},stroke:{},outline:{},shadow:{},fill:{},fillFunc:null,labelFunc:null,font:"",fontColor:"",markerStroke:{},markerOutline:{},markerShadow:{},markerFill:{},markerSymbol:"",values:[],offset:{},start:!1,animate:!1},constructor:function(t,i){this.opt=e.clone(this.defaultParams),d.updateWithObject(this.opt,i),"number"==typeof i.values&&(i.values=[i.values]),d.updateWithPattern(this.opt,i,this.optionalParams),this.animate=this.opt.animate},render:function(e,t){return this.zoom?this.performZoom(e,t):this.isDirty()?(this.cleanGroup(null,!0),this.opt.values?(this._updateIndicator(),this):this):this},_updateIndicator:function(){var e=this.chart.theme,i=this._hAxis.name,a=this._vAxis.name,r=this._hAxis.getScaler().bounds,o=this._vAxis.getScaler().bounds,s={};s[i]=r.from,s[a]=o.from;var d=this.toPage(s);s[i]=r.to,s[a]=o.to;var l=this.toPage(s),u=this.events(),c=t.map(this.opt.values,function(e,t){return this._renderIndicator(e,t,i,a,d,l,u,this.animate)},this),h=c.length;if("trend"==this.opt.labels){var f=this.opt.vertical,m=this._data[0][0],p=this._data[h-1][0],y=p-m,v=this.opt.labelFunc?this.opt.labelFunc(-1,this.values,this._data,this.opt.fixed,this.opt.precision):n.getLabel(y,this.opt.fixed,this.opt.precision)+" ("+n.getLabel(100*y/m,!0,2)+"%)";this._renderText(this.getGroup(),v,this.chart.theme,f?(c[0].x+c[h-1].x)/2:c[1].x,f?c[0].y:(c[1].y+c[h-1].y)/2,-1,this.opt.values,this._data)}var g=void 0!=this.opt.lineFill?this.opt.lineFill:e.indicator.lineFill;if(g&&h>1){var b=Math.min(c[0].x1,c[h-1].x1),M=Math.min(c[0].y1,c[h-1].y1);this.getGroup().createRect({x:b,y:M,width:Math.max(c[0].x2,c[h-1].x2)-b,height:Math.max(c[0].y2,c[h-1].y2)-M}).setFill(g).moveToBack()}},_renderIndicator:function(i,a,r,o,s,d,l,c){var h=this.chart.theme,f=this.chart.getCoords(),m=this.opt.vertical,p=this.getGroup().createGroup(),y={};y[r]=m?i:0,y[o]=m?0:i,u("dojo-bidi")&&(y.x=this._getMarkX(y.x)),y=this.toPage(y);var v=m?y.x>=s.x&&y.x<=d.x:y.y>=d.y&&y.y<=s.y,g=y.x-f.x,b=y.y-f.y,M=m?g:s.x-f.x,w=m?s.y-f.y:b,k=m?M:d.x-f.x,_=m?d.y-f.y:w;if(this.opt.lines&&v){var x=this.opt.hasOwnProperty("lineShadow")?this.opt.lineShadow:h.indicator.lineShadow,j=this.opt.hasOwnProperty("lineStroke")?this.opt.lineStroke:h.indicator.lineStroke,F=this.opt.hasOwnProperty("lineOutline")?this.opt.lineOutline:h.indicator.lineOutline;x&&p.createLine({x1:M+x.dx,y1:w+x.dy,x2:k+x.dx,y2:_+x.dy}).setStroke(x),F&&(F=n.makeStroke(F),F.width=2*F.width+(j?j.width:0),p.createLine({x1:M,y1:w,x2:k,y2:_}).setStroke(F)),p.createLine({x1:M,y1:w,x2:k,y2:_}).setStroke(j)}var E;if(this.opt.markers&&v){var S=this._data[a],I=this;S&&(E=t.map(S,function(e,t){if(y[r]=m?i:e,y[o]=m?e:i,u("dojo-bidi")&&(y.x=I._getMarkX(y.x)),y=this.toPage(y),m?y.y<=s.y&&y.y>=d.y:y.x>=s.x&&y.x<=d.x){g=y.x-f.x,b=y.y-f.y;var a=this.opt.markerSymbol?this.opt.markerSymbol:h.indicator.markerSymbol,l="M"+g+" "+b+" "+a;if(x=void 0!=this.opt.markerShadow?this.opt.markerShadow:h.indicator.markerShadow,j=void 0!=this.opt.markerStroke?this.opt.markerStroke:h.indicator.markerStroke,F=void 0!=this.opt.markerOutline?this.opt.markerOutline:h.indicator.markerOutline,x){var c="M"+(g+x.dx)+" "+(b+x.dy)+" "+a;p.createPath(c).setFill(x.color).setStroke(x)}F&&(F=n.makeStroke(F),F.width=2*F.width+(j?j.width:0),p.createPath(l).setStroke(F));var v=p.createPath(l),M=this._shapeFill(void 0!=this.opt.markerFill?this.opt.markerFill:h.indicator.markerFill,v.getBoundingBox());v.setFill(M).setStroke(j)}return e},this))}var C;if(C=this.opt.start?{x:M,y:m?w:_}:{x:m?M:k,y:m?_:w},this.opt.labels&&"trend"!=this.opt.labels&&v){var A;this.opt.labelFunc?A=this.opt.labelFunc(a,this.opt.values,this._data,this.opt.fixed,this.opt.precision,this.opt.labels):"markers"==this.opt.labels?(A=t.map(E,function(e){return n.getLabel(e,this.opt.fixed,this.opt.precision)},this),A=1!=A.length?"[ "+A.join(", ")+" ]":A[0]):A=n.getLabel(i,this.opt.fixed,this.opt.precision),this._renderText(p,A,h,C.x,C.y,a,this.opt.values,this._data)}return l&&this._connectEvents({element:"indicator",run:this.run?this.run[a]:void 0,shape:p,value:i}),c&&this._animateIndicator(p,m,m?w:M,m?w+_:M+k,c),e.mixin(C,{x1:M,y1:w,x2:k,y2:_})},_animateIndicator:function(t,i,a,r,n){var o=i?[0,a]:[a,0],s=i?[1,1/r]:[1/r,1];l.animateTransform(e.delegate({shape:t,duration:1200,transform:[{name:"translate",start:o,end:[0,0]},{name:"scale",start:s,end:[1,1]},{name:"original"}]},n)).play()},clear:function(){this.inherited(arguments),this._data=[]},addSeries:function(e){this.inherited(arguments),this._data.push(e.data)},_renderText:function(e,t,i,a,r,s,d,l){this.opt.offset&&(a+=this.opt.offset.x,r+=this.opt.offset.y);var u=o.createText.gfx(this.chart,e,a,r,this.opt.vertical?"middle":this.opt.start?"start":"end",t,this.opt.font?this.opt.font:i.indicator.font,this.opt.fontColor?this.opt.fontColor:i.indicator.fontColor),h=c(u);this.opt.vertical&&!this.opt.start&&(h.y+=h.height/2,u.setShape({y:r+h.height/2})),h.x-=2,h.y-=1,h.width+=4,h.height+=2,h.r=this.opt.radius?this.opt.radius:i.indicator.radius;var f=void 0!=this.opt.shadow?this.opt.shadow:i.indicator.shadow,m=void 0!=this.opt.stroke?this.opt.stroke:i.indicator.stroke,p=void 0!=this.opt.outline?this.opt.outline:i.indicator.outline;f&&e.createRect(h).setFill(f.color).setStroke(f),p&&(p=n.makeStroke(p),p.width=2*p.width+(m?m.width:0),e.createRect(h).setStroke(p));var y=this.opt.fillFunc?this.opt.fillFunc(s,d,l):void 0!=this.opt.fill?this.opt.fill:i.indicator.fill;e.createRect(h).setFill(this._shapeFill(y,h)).setStroke(m),u.moveToFront()},getSeriesStats:function(){return e.delegate(n.defaultStats)}});return u("dojo-bidi")&&m.extend({_getMarkX:function(e){return this.chart.isRightToLeft()?this.chart.axes.x.scaler.bounds.to+this.chart.axes.x.scaler.bounds.from-e:e}}),m});//# sourceMappingURL=Indicator.js.map