//>>built
define("dojox/charting/plot2d/Indicator",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","./CartesianBase","./_PlotEvents","./common","../axis2d/common","dojox/gfx","dojox/lang/utils","dojox/gfx/fx","dojo/has"],function(e,t,a,i,r,o,d,n,l,s,m){var u=function(e){return f(e,e.getShape().text)},f=function(t,a){var i,r,o=t.declaredClass;if(-1!=o.indexOf("svg"))try{return e.mixin({},t.rawNode.getBBox())}catch(d){return null}else{if(-1!=o.indexOf("vml")){var l=t.rawNode,s=l.style.display;l.style.display="inline",i=n.pt2px(parseFloat(l.currentStyle.width)),r=n.pt2px(parseFloat(l.currentStyle.height));var m={x:0,y:0,width:i,height:r};return h(t,m),l.style.display=s,m}if(-1!=o.indexOf("silverlight")){var u={width:t.rawNode.actualWidth,height:t.rawNode.actualHeight};return h(t,u,.75)}if(t.getTextWidth){i=t.getTextWidth();var f=t.getFont(),c=f?f.size:n.defaultFont.size;return r=n.normalizedLength(c),m={width:i,height:r},h(t,m,.75),m}}return null},h=function(e,t,a){var i=t.width,r=t.height,o=e.getShape(),d=o.align;switch(d){case"end":t.x=o.x-i;break;case"middle":t.x=o.x-i/2;break;case"start":default:t.x=o.x}return a=a||1,t.y=o.y-r*a,t},c=a("dojox.charting.plot2d.Indicator",[i,r],{defaultParams:{vertical:!0,fixed:!0,precision:0,lines:!0,labels:"line",markers:!0},optionalParams:{lineStroke:{},outlineStroke:{},shadowStroke:{},lineFill:{},stroke:{},outline:{},shadow:{},fill:{},fillFunc:null,labelFunc:null,font:"",fontColor:"",markerStroke:{},markerOutline:{},markerShadow:{},markerFill:{},markerSymbol:"",values:[],offset:{},start:!1,animate:!1},constructor:function(t,a){this.opt=e.clone(this.defaultParams),l.updateWithObject(this.opt,a),"number"==typeof a.values&&(a.values=[a.values]),l.updateWithPattern(this.opt,a,this.optionalParams),this.animate=this.opt.animate},render:function(e,t){return this.zoom?this.performZoom(e,t):this.isDirty()?(this.cleanGroup(null,!0),this.opt.values?(this._updateIndicator(),this):this):this},_updateIndicator:function(){var e=this.chart.theme,a=this._hAxis.name,i=this._vAxis.name,r=this._hAxis.getScaler().bounds,d=this._vAxis.getScaler().bounds,n={};n[a]=r.from,n[i]=d.from;var l=this.toPage(n);n[a]=r.to,n[i]=d.to;var s=this.toPage(n),m=this.events(),u=t.map(this.opt.values,function(e,t){return this._renderIndicator(e,t,a,i,l,s,m,this.animate)},this),f=u.length;if("trend"==this.opt.labels){var h=this.opt.vertical,c=this._data[0][0],y=this._data[f-1][0],v=y-c,p=this.opt.labelFunc?this.opt.labelFunc(-1,this.values,this._data,this.opt.fixed,this.opt.precision):o.getLabel(v,this.opt.fixed,this.opt.precision)+" ("+o.getLabel(100*v/c,!0,2)+"%)";this._renderText(this.getGroup(),p,this.chart.theme,h?(u[0].x+u[f-1].x)/2:u[1].x,h?u[0].y:(u[1].y+u[f-1].y)/2,-1,this.opt.values,this._data)}var g=void 0!=this.opt.lineFill?this.opt.lineFill:e.indicator.lineFill;if(g&&f>1){var M=Math.min(u[0].x1,u[f-1].x1),b=Math.min(u[0].y1,u[f-1].y1),w=this.getGroup().createRect({x:M,y:b,width:Math.max(u[0].x2,u[f-1].x2)-M,height:Math.max(u[0].y2,u[f-1].y2)-b}).setFill(g);w.moveToBack()}},_renderIndicator:function(a,i,r,d,n,l,s,u){var f=this.chart.theme,h=this.chart.getCoords(),c=this.opt.vertical,y=this.getGroup().createGroup(),v={};v[r]=c?a:0,v[d]=c?0:a,m("dojo-bidi")&&(v.x=this._getMarkX(v.x)),v=this.toPage(v);var p=c?v.x>=n.x&&v.x<=l.x:v.y>=l.y&&v.y<=n.y,g=v.x-h.x,M=v.y-h.y,b=c?g:n.x-h.x,w=c?n.y-h.y:M,k=c?b:l.x-h.x,F=c?l.y-h.y:w;if(this.opt.lines&&p){var _=this.opt.hasOwnProperty("lineShadow")?this.opt.lineShadow:f.indicator.lineShadow,I=this.opt.hasOwnProperty("lineStroke")?this.opt.lineStroke:f.indicator.lineStroke,j=this.opt.hasOwnProperty("lineOutline")?this.opt.lineOutline:f.indicator.lineOutline;_&&y.createLine({x1:b+_.dx,y1:w+_.dy,x2:k+_.dx,y2:F+_.dy}).setStroke(_),j&&(j=o.makeStroke(j),j.width=2*j.width+(I?I.width:0),y.createLine({x1:b,y1:w,x2:k,y2:F}).setStroke(j)),y.createLine({x1:b,y1:w,x2:k,y2:F}).setStroke(I)}var x;if(this.opt.markers&&p){var E=this._data[i],S=this;E&&(x=t.map(E,function(e,t){if(v[r]=c?a:e,v[d]=c?e:a,m("dojo-bidi")&&(v.x=S._getMarkX(v.x)),v=this.toPage(v),c?v.y<=n.y&&v.y>=l.y:v.x>=n.x&&v.x<=l.x){g=v.x-h.x,M=v.y-h.y;var i=this.opt.markerSymbol?this.opt.markerSymbol:f.indicator.markerSymbol,s="M"+g+" "+M+" "+i;if(_=void 0!=this.opt.markerShadow?this.opt.markerShadow:f.indicator.markerShadow,I=void 0!=this.opt.markerStroke?this.opt.markerStroke:f.indicator.markerStroke,j=void 0!=this.opt.markerOutline?this.opt.markerOutline:f.indicator.markerOutline,_){var u="M"+(g+_.dx)+" "+(M+_.dy)+" "+i;y.createPath(u).setFill(_.color).setStroke(_)}j&&(j=o.makeStroke(j),j.width=2*j.width+(I?I.width:0),y.createPath(s).setStroke(j));var p=y.createPath(s),b=this._shapeFill(void 0!=this.opt.markerFill?this.opt.markerFill:f.indicator.markerFill,p.getBoundingBox());p.setFill(b).setStroke(I)}return e},this))}var G;if(G=this.opt.start?{x:c?b:b,y:c?w:F}:{x:c?b:k,y:c?F:w},this.opt.labels&&"trend"!=this.opt.labels&&p){var T;this.opt.labelFunc?T=this.opt.labelFunc(i,this.opt.values,this._data,this.opt.fixed,this.opt.precision,this.opt.labels):"markers"==this.opt.labels?(T=t.map(x,function(e){return o.getLabel(e,this.opt.fixed,this.opt.precision)},this),T=1!=T.length?"[ "+T.join(", ")+" ]":T[0]):T=o.getLabel(a,this.opt.fixed,this.opt.precision),this._renderText(y,T,f,G.x,G.y,i,this.opt.values,this._data)}return s&&this._connectEvents({element:"indicator",run:this.run?this.run[i]:void 0,shape:y,value:a}),u&&this._animateIndicator(y,c,c?w:b,c?w+F:b+k,u),e.mixin(G,{x1:b,y1:w,x2:k,y2:F})},_animateIndicator:function(t,a,i,r,o){var d=a?[0,i]:[i,0],n=a?[1,1/r]:[1/r,1];s.animateTransform(e.delegate({shape:t,duration:1200,transform:[{name:"translate",start:d,end:[0,0]},{name:"scale",start:n,end:[1,1]},{name:"original"}]},o)).play()},clear:function(){this.inherited(arguments),this._data=[]},addSeries:function(e){this.inherited(arguments),this._data.push(e.data)},_renderText:function(e,t,a,i,r,n,l,s){this.opt.offset&&(i+=this.opt.offset.x,r+=this.opt.offset.y);var m=d.createText.gfx(this.chart,e,i,r,"middle",t,this.opt.font?this.opt.font:a.indicator.font,this.opt.fontColor?this.opt.fontColor:a.indicator.fontColor),f=u(m);f.x-=2,f.y-=1,f.width+=4,f.height+=2,f.r=this.opt.radius?this.opt.radius:a.indicator.radius;var h=void 0!=this.opt.shadow?this.opt.shadow:a.indicator.shadow,c=void 0!=this.opt.stroke?this.opt.stroke:a.indicator.stroke,y=void 0!=this.opt.outline?this.opt.outline:a.indicator.outline;h&&e.createRect(f).setFill(h.color).setStroke(h),y&&(y=o.makeStroke(y),y.width=2*y.width+(c?c.width:0),e.createRect(f).setStroke(y));var v=this.opt.fillFunc?this.opt.fillFunc(n,l,s):void 0!=this.opt.fill?this.opt.fill:a.indicator.fill;e.createRect(f).setFill(this._shapeFill(v,f)).setStroke(c),m.moveToFront()},getSeriesStats:function(){return e.delegate(o.defaultStats)}});return m("dojo-bidi")&&c.extend({_getMarkX:function(e){return this.chart.isRightToLeft()?this.chart.axes.x.scaler.bounds.to+this.chart.axes.x.scaler.bounds.from-e:e}}),c});//# sourceMappingURL=Indicator.js.map