//>>built
define("dojox/charting/plot2d/Spider",["dojo/_base/lang","dojo/_base/declare","dojo/_base/connect","dojo/_base/array","dojo/dom-geometry","dojo/_base/fx","dojo/fx","dojo/sniff","./Base","./_PlotEvents","./common","../axis2d/common","dojox/gfx","dojox/gfx/matrix","dojox/gfx/fx","dojox/lang/functional","dojox/lang/utils","dojo/fx/easing"],function(e,t,i,a,r,n,o,d,s,l,u,c,f,m,h,y,p,v){var g=t("dojox.charting.plot2d.Spider",[s,l],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:-10,labelStyle:"default",htmlLabels:!0,startAngle:-90,divisions:3,axisColor:"",axisWidth:0,spiderColor:"",spiderWidth:0,seriesWidth:0,seriesFillAlpha:.2,spiderOrigin:.16,markerSize:3,spiderType:"polygon",animationType:v.backOut,animate:null,axisTickFont:"",axisTickFontColor:"",axisFont:"",axisFontColor:""},optionalParams:{radius:0,font:"",fontColor:""},constructor:function(t,i){this.opt=e.clone(this.defaultParams),p.updateWithObject(this.opt,i),p.updateWithPattern(this.opt,i,this.optionalParams),this.dyn=[],this.datas={},this.labelKey=[],this.oldSeriePoints={},this.animate=null===this.opt.animate?{}:this.opt.animate,this.animations={}},clear:function(){return this.inherited(arguments),this.dyn=[],this.axes=[],this.datas={},this.labelKey=[],this.oldSeriePoints={},this.animations={},this},setAxis:function(e){return e&&(void 0!=e.opt.min&&(this.datas[e.name].min=e.opt.min),void 0!=e.opt.max&&(this.datas[e.name].max=e.opt.max)),this},addSeries:function(e){this.series.push(e);var t;for(t in e.data){var i=e.data[t],a=this.datas[t];if(a)a.vlist.push(i),a.min=Math.min(a.min,i),a.max=Math.max(a.max,i);else{var r="__"+t;this.axes.push(r),this[r]=t,this.datas[t]={min:i,max:i,vlist:[i]}}}if(this.labelKey.length<=0)for(t in e.data)this.labelKey.push(t);return this},getSeriesStats:function(){return u.collectSimpleStats(this.series)},render:function(e,t){if(!this.dirty)return this;this.dirty=!1,this.cleanGroup();var i=this.group,n=this.chart.theme;if(this.resetEvents(),!this.series||!this.series.length)return this;var o,d,s,l,u,h,p,v,g,b,M,w,k,_,j,x,F,E,I,C,A=this.opt,T=n.axis,S=(e.width-t.l-t.r)/2,N=(e.height-t.t-t.b)/2,z=Math.min(S,N),D=A.font||T.majorTick&&T.majorTick.font||T.tick&&T.tick.font||"normal normal normal 7pt Tahoma",L=A.axisFont||T.tick&&T.tick.titleFont||"normal normal normal 11pt Tahoma",G=A.axisTickFontColor||T.majorTick&&T.majorTick.fontColor||T.tick&&T.tick.fontColor||"silver",P=A.axisFontColor||T.tick&&T.tick.titleFontColor||"black",R=A.axisColor||T.tick&&T.tick.axisColor||"silver",O=A.spiderColor||T.tick&&T.tick.spiderColor||"silver",H=A.axisWidth||T.stroke&&T.stroke.width||2,q=A.spiderWidth||T.stroke&&T.stroke.width||2,B=A.seriesWidth||T.stroke&&T.stroke.width||2,Q=f.normalizedLength(f.splitFontString(L).size),W=m._degToRad(A.startAngle),U=W,K=A.spiderOrigin,V=A.divisions>=3?A.divisions:3,$=A.markerSize,X=A.spiderType,J=A.animationType,Y=A.labelOffset<-10?A.labelOffset:-10,Z=.2;A.labels&&(o=a.map(this.series,function(e){return e.name},this),d=y.foldl1(y.map(o,function(e){var t=n.series.font;return f._base._getTextBox(e,{font:t}).w},this),"Math.max(a, b)")/2,z=Math.min(S-2*d,N-Q)+Y,s=z-Y),"radius"in A&&(z=A.radius,s=z-Y),z/=1+Z;var ee={cx:t.l+S,cy:t.t+N,r:z};for(g=this.series.length-1;g>=0;g--)if(j=this.series[g],this.dirty||j.dirty){if(j.cleanGroup(),x=j.data,null!==x&&(w=this._getObjectLength(x),(!l||l.length<=0)&&(l=[],u=[],v=[],this._buildPoints(l,w,ee,z,U,!0,e),this._buildPoints(u,w,ee,z*K,U,!0,e),this._buildPoints(v,w,ee,s,U,!1,e),V>2)))for(h=[],p=[],b=0;V-2>b;b++)h[b]=[],this._buildPoints(h[b],w,ee,z*(K+(1-K)*(b+1)/(V-1)),U,!0,e),p[b]=z*(K+(1-K)*(b+1)/(V-1))}else n.skip();var te=i.createGroup(),ie={color:R,width:H},ae={color:O,width:q};for(b=l.length-1;b>=0;--b){M=l[b];var re={x:M.x+(M.x-ee.cx)*Z,y:M.y+(M.y-ee.cy)*Z},ne={x:M.x+(M.x-ee.cx)*Z/2,y:M.y+(M.y-ee.cy)*Z/2};te.createLine({x1:ee.cx,y1:ee.cy,x2:re.x,y2:re.y}).setStroke(ie),this._drawArrow(te,re,ne,ie)}var oe=i.createGroup();for(b=v.length-1;b>=0;--b){M=v[b],k=f._base._getTextBox(this.labelKey[b],{font:L}).w||0,_=this.opt.htmlLabels&&"vml"!=f.renderer?"html":"gfx";var de=c.createText[_](this.chart,oe,r.isBodyLtr()||"html"!=_?M.x:M.x+k-e.width,M.y,"middle",this.labelKey[b],L,P);this.opt.htmlLabels&&this.htmlElements.push(de)}var se=i.createGroup();if("polygon"==X){if(se.createPolyline(l).setStroke(ae),se.createPolyline(u).setStroke(ae),h.length>0)for(b=h.length-1;b>=0;--b)se.createPolyline(h[b]).setStroke(ae)}else if(se.createCircle({cx:ee.cx,cy:ee.cy,r:z}).setStroke(ae),se.createCircle({cx:ee.cx,cy:ee.cy,r:z*K}).setStroke(ae),p.length>0)for(b=p.length-1;b>=0;--b)se.createCircle({cx:ee.cx,cy:ee.cy,r:p[b]}).setStroke(ae);w=this._getObjectLength(this.datas);var le=i.createGroup(),ue=0;for(var ce in this.datas){for(F=this.datas[ce],E=F.min,I=F.max,C=I-E,be=U+2*Math.PI*ue/w,g=0;V>g;g++){var fe=E+C*g/(V-1);M=this._getCoordinate(ee,z*(K+(1-K)*g/(V-1)),be,e),fe=this._getLabel(fe),k=f._base._getTextBox(fe,{font:D}).w||0,_=this.opt.htmlLabels&&"vml"!=f.renderer?"html":"gfx",this.opt.htmlLabels&&this.htmlElements.push(c.createText[_](this.chart,le,r.isBodyLtr()||"html"!=_?M.x:M.x+k-e.width,M.y,"start",fe,D,G))}ue++}for(this.chart.seriesShapes={},g=this.series.length-1;g>=0;g--)if(j=this.series[g],x=j.data,null!==x){var me=n.next("spider",[A,j]),he=f.normalizeColor(me.series.fill),ye={color:me.series.fill,width:B};if(he.a=A.seriesFillAlpha,j.dyn={fill:he,stroke:ye},j.hidden)continue;var pe=[],ve=[];ue=0;for(ce in x){F=this.datas[ce],E=F.min,I=F.max,C=I-E;var ge=x[ce],be=U+2*Math.PI*ue/w;M=this._getCoordinate(ee,z*(K+(1-K)*(ge-E)/C),be,e),pe.push(M),ve.push({sname:j.name,key:ce,data:ge}),ue++}pe[pe.length]=pe[0],ve[ve.length]=ve[0];var Me=this._getBoundary(pe),we=j.group,ke=this.oldSeriePoints[j.name],_e=this._createSeriesEntry(we,ke||u,pe,he,ye,z,K,$,J);this.chart.seriesShapes[j.name]=_e,this.oldSeriePoints[j.name]=pe;var je={element:"spider_poly",index:g,id:"spider_poly_"+j.name,run:j,plot:this,shape:_e.poly,parent:we,brect:Me,cx:ee.cx,cy:ee.cy,cr:z,f:he,s:i};this._connectEvents(je);var xe={element:"spider_plot",index:g,id:"spider_plot_"+j.name,run:j,plot:this,shape:j.group};this._connectEvents(xe),a.forEach(_e.circles,function(e,t){var a={element:"spider_circle",index:t,id:"spider_circle_"+j.name+t,run:j,plot:this,shape:e,parent:we,tdata:ve[t],cx:pe[t].x,cy:pe[t].y,f:he,s:i};this._connectEvents(a)},this)}return this},_createSeriesEntry:function(t,r,d,s,l,u,c,f,m){for(var h=this.animate?r:d,y=t.createPolyline(h).setFill(s).setStroke(l),p=[],v=0;v<h.length;v++){var g=h[v],b=f,M=t.createCircle({cx:g.x,cy:g.y,r:b}).setFill(s).setStroke(l);p.push(M)}if(this.animate){var w=a.map(d,function(t,a){var o=r[a],d=new n.Animation(e.delegate({duration:1e3,easing:m,curve:[o.y,t.y]},this.animate)),s=y,l=p[a];return i.connect(d,"onAnimate",function(e){var t=s.getShape();t.points[a].y=e,s.setShape(t);var i=l.getShape();i.cy=e,l.setShape(i)}),d},this),k=a.map(d,function(t,a){var o=r[a],d=new n.Animation(e.delegate({duration:1e3,easing:m,curve:[o.x,t.x]},this.animate)),s=y,l=p[a];return i.connect(d,"onAnimate",function(e){var t=s.getShape();t.points[a].x=e,s.setShape(t);var i=l.getShape();i.cx=e,l.setShape(i)}),d},this),_=o.combine(w.concat(k));_.play()}return{group:t,poly:y,circles:p}},plotEvent:function(e){"spider_plot"==e.element&&("onmouseover"!=e.type||d("ie")||e.shape.moveToFront())},tooltipFunc:function(e){return"spider_circle"==e.element?e.tdata.sname+"<br/>"+e.tdata.key+"<br/>"+e.tdata.data:null},_getBoundary:function(e){for(var t=e[0].x,i=e[0].x,a=e[0].y,r=e[0].y,n=0;n<e.length;n++){var o=e[n];t=Math.max(o.x,t),a=Math.max(o.y,a),i=Math.min(o.x,i),r=Math.min(o.y,r)}return{x:i,y:r,width:t-i,height:a-r}},_drawArrow:function(e,t,i,a){var r=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)),n=(i.y-t.y)/r,o=(i.x-t.x)/r,d={x:i.x+r/3*-n,y:i.y+r/3*o},s={x:i.x+r/3*n,y:i.y+r/3*-o};e.createPolyline([t,d,s]).setFill(a.color).setStroke(a)},_buildPoints:function(e,t,i,a,r,n,o){for(var d=0;t>d;d++){var s=r+2*Math.PI*d/t;e.push(this._getCoordinate(i,a,s,o))}n&&e.push(this._getCoordinate(i,a,r+2*Math.PI,o))},_getCoordinate:function(e,t,i,a){var r=e.cx+t*Math.cos(i);return d("dojo-bidi")&&this.chart.isRightToLeft()&&a&&(r=a.width-r),{x:r,y:e.cy+t*Math.sin(i)}},_getObjectLength:function(t){var i=0;if(e.isObject(t))for(var a in t)i++;return i},_getLabel:function(e){return u.getLabel(e,this.opt.fixed,this.opt.precision)}});return g});//# sourceMappingURL=Spider.js.map