//>>built
define("dojox/charting/plot2d/Spider",["dojo/_base/lang","dojo/_base/declare","dojo/_base/connect","dojo/_base/array","dojo/dom-geometry","dojo/_base/fx","dojo/fx","dojo/sniff","./Base","./_PlotEvents","./common","../axis2d/common","dojox/gfx","dojox/gfx/matrix","dojox/gfx/fx","dojox/lang/functional","dojox/lang/utils","dojo/fx/easing"],function(e,t,a,i,r,o,n,d,s,l,m,u,c,h,f,y,v,p){var g=t("dojox.charting.plot2d.Spider",[s,l],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:-10,labelStyle:"default",htmlLabels:!0,startAngle:-90,divisions:3,axisColor:"",axisWidth:0,spiderColor:"",spiderWidth:0,seriesWidth:0,seriesFillAlpha:.2,spiderOrigin:.16,markerSize:3,spiderType:"polygon",animationType:p.backOut,animate:null,axisTickFont:"",axisTickFontColor:"",axisFont:"",axisFontColor:""},optionalParams:{radius:0,font:"",fontColor:""},constructor:function(t,a){this.opt=e.clone(this.defaultParams),v.updateWithObject(this.opt,a),v.updateWithPattern(this.opt,a,this.optionalParams),this.dyn=[],this.datas={},this.labelKey=[],this.oldSeriePoints={},this.animate=null===this.opt.animate?{}:this.opt.animate,this.animations={}},clear:function(){return this.inherited(arguments),this.dyn=[],this.axes=[],this.datas={},this.labelKey=[],this.oldSeriePoints={},this.animations={},this},setAxis:function(e){return e&&(void 0!=e.opt.min&&(this.datas[e.name].min=e.opt.min),void 0!=e.opt.max&&(this.datas[e.name].max=e.opt.max)),this},addSeries:function(e){this.series.push(e);var t;for(t in e.data){var a=e.data[t],i=this.datas[t];if(i)i.vlist.push(a),i.min=Math.min(i.min,a),i.max=Math.max(i.max,a);else{var r="__"+t;this.axes.push(r),this[r]=t,this.datas[t]={min:a,max:a,vlist:[a]}}}if(this.labelKey.length<=0)for(t in e.data)this.labelKey.push(t);return this},getSeriesStats:function(){return m.collectSimpleStats(this.series)},render:function(e,t){if(!this.dirty)return this;this.dirty=!1,this.cleanGroup();var a=this.group,o=this.chart.theme;if(this.resetEvents(),!this.series||!this.series.length)return this;var n,d,s,l,m,f,v,p,g,M,b,w,k,F,I,j,_,E,x,T,S=this.opt,C=o.axis,A=(e.width-t.l-t.r)/2,G=(e.height-t.t-t.b)/2,N=Math.min(A,G),z=S.font||C.majorTick&&C.majorTick.font||C.tick&&C.tick.font||"normal normal normal 7pt Tahoma",H=S.axisFont||C.tick&&C.tick.titleFont||"normal normal normal 11pt Tahoma",L=S.axisTickFontColor||C.majorTick&&C.majorTick.fontColor||C.tick&&C.tick.fontColor||"silver",D=S.axisFontColor||C.tick&&C.tick.titleFontColor||"black",P=S.axisColor||C.tick&&C.tick.axisColor||"silver",Q=S.spiderColor||C.tick&&C.tick.spiderColor||"silver",q=S.axisWidth||C.stroke&&C.stroke.width||2,R=S.spiderWidth||C.stroke&&C.stroke.width||2,O=S.seriesWidth||C.stroke&&C.stroke.width||2,B=c.normalizedLength(c.splitFontString(H).size),V=h._degToRad(S.startAngle),K=V,W=S.spiderOrigin,U=S.divisions>=3?S.divisions:3,$=S.markerSize,J=S.spiderType,Y=S.animationType,Z=S.labelOffset<-10?S.labelOffset:-10,X=.2;S.labels&&(n=i.map(this.series,function(e){return e.name},this),d=y.foldl1(y.map(n,function(e){var t=o.series.font;return c._base._getTextBox(e,{font:t}).w},this),"Math.max(a, b)")/2,N=Math.min(A-2*d,G-B)+Z,s=N-Z),"radius"in S&&(N=S.radius,s=N-Z),N/=1+X;var ee={cx:t.l+A,cy:t.t+G,r:N};for(g=this.series.length-1;g>=0;g--)if(I=this.series[g],this.dirty||I.dirty){if(I.cleanGroup(),j=I.data,null!==j&&(w=this._getObjectLength(j),(!l||l.length<=0)&&(l=[],m=[],p=[],this._buildPoints(l,w,ee,N,K,!0,e),this._buildPoints(m,w,ee,N*W,K,!0,e),this._buildPoints(p,w,ee,s,K,!1,e),U>2)))for(f=[],v=[],M=0;U-2>M;M++)f[M]=[],this._buildPoints(f[M],w,ee,N*(W+(1-W)*(M+1)/(U-1)),K,!0,e),v[M]=N*(W+(1-W)*(M+1)/(U-1))}else o.skip();var te=a.createGroup(),ae={color:P,width:q},ie={color:Q,width:R};for(M=l.length-1;M>=0;--M){b=l[M];var re={x:b.x+(b.x-ee.cx)*X,y:b.y+(b.y-ee.cy)*X},oe={x:b.x+(b.x-ee.cx)*X/2,y:b.y+(b.y-ee.cy)*X/2};te.createLine({x1:ee.cx,y1:ee.cy,x2:re.x,y2:re.y}).setStroke(ae),this._drawArrow(te,re,oe,ae)}var ne=a.createGroup();for(M=p.length-1;M>=0;--M){b=p[M],k=c._base._getTextBox(this.labelKey[M],{font:H}).w||0,F=this.opt.htmlLabels&&"vml"!=c.renderer?"html":"gfx";var de=u.createText[F](this.chart,ne,r.isBodyLtr()||"html"!=F?b.x:b.x+k-e.width,b.y,"middle",this.labelKey[M],H,D);this.opt.htmlLabels&&this.htmlElements.push(de)}var se=a.createGroup();if("polygon"==J){if(se.createPolyline(l).setStroke(ie),se.createPolyline(m).setStroke(ie),f.length>0)for(M=f.length-1;M>=0;--M)se.createPolyline(f[M]).setStroke(ie)}else if(se.createCircle({cx:ee.cx,cy:ee.cy,r:N}).setStroke(ie),se.createCircle({cx:ee.cx,cy:ee.cy,r:N*W}).setStroke(ie),v.length>0)for(M=v.length-1;M>=0;--M)se.createCircle({cx:ee.cx,cy:ee.cy,r:v[M]}).setStroke(ie);w=this._getObjectLength(this.datas);var le=a.createGroup(),me=0;for(var ue in this.datas){for(_=this.datas[ue],E=_.min,x=_.max,T=x-E,Me=K+2*Math.PI*me/w,g=0;U>g;g++){var ce=E+T*g/(U-1);b=this._getCoordinate(ee,N*(W+(1-W)*g/(U-1)),Me,e),ce=this._getLabel(ce),k=c._base._getTextBox(ce,{font:z}).w||0,F=this.opt.htmlLabels&&"vml"!=c.renderer?"html":"gfx",this.opt.htmlLabels&&this.htmlElements.push(u.createText[F](this.chart,le,r.isBodyLtr()||"html"!=F?b.x:b.x+k-e.width,b.y,"start",ce,z,L))}me++}for(this.chart.seriesShapes={},g=this.series.length-1;g>=0;g--)if(I=this.series[g],j=I.data,null!==j){var he=o.next("spider",[S,I]),fe=c.normalizeColor(he.series.fill),ye={color:he.series.fill,width:O};if(fe.a=S.seriesFillAlpha,I.dyn={fill:fe,stroke:ye},I.hidden)continue;var ve=[],pe=[];me=0;for(ue in j){_=this.datas[ue],E=_.min,x=_.max,T=x-E;var ge=j[ue],Me=K+2*Math.PI*me/w;b=this._getCoordinate(ee,N*(W+(1-W)*(ge-E)/T),Me,e),ve.push(b),pe.push({sname:I.name,key:ue,data:ge}),me++}ve[ve.length]=ve[0],pe[pe.length]=pe[0];var be=this._getBoundary(ve),we=I.group,ke=this.oldSeriePoints[I.name],Fe=this._createSeriesEntry(we,ke||m,ve,fe,ye,N,W,$,Y);this.chart.seriesShapes[I.name]=Fe,this.oldSeriePoints[I.name]=ve;var Ie={element:"spider_poly",index:g,id:"spider_poly_"+I.name,run:I,plot:this,shape:Fe.poly,parent:we,brect:be,cx:ee.cx,cy:ee.cy,cr:N,f:fe,s:a};this._connectEvents(Ie);var je={element:"spider_plot",index:g,id:"spider_plot_"+I.name,run:I,plot:this,shape:I.group};this._connectEvents(je),i.forEach(Fe.circles,function(e,t){var i={element:"spider_circle",index:t,id:"spider_circle_"+I.name+t,run:I,plot:this,shape:e,parent:we,tdata:pe[t],cx:ve[t].x,cy:ve[t].y,f:fe,s:a};this._connectEvents(i)},this)}return this},_createSeriesEntry:function(t,r,d,s,l,m,u,c,h){for(var f=this.animate?r:d,y=t.createPolyline(f).setFill(s).setStroke(l),v=[],p=0;p<f.length;p++){var g=f[p],M=c,b=t.createCircle({cx:g.x,cy:g.y,r:M}).setFill(s).setStroke(l);v.push(b)}if(this.animate){var w=i.map(d,function(t,i){var n=r[i],d=new o.Animation(e.delegate({duration:1e3,easing:h,curve:[n.y,t.y]},this.animate)),s=y,l=v[i];return a.connect(d,"onAnimate",function(e){var t=s.getShape();t.points[i].y=e,s.setShape(t);var a=l.getShape();a.cy=e,l.setShape(a)}),d},this),k=i.map(d,function(t,i){var n=r[i],d=new o.Animation(e.delegate({duration:1e3,easing:h,curve:[n.x,t.x]},this.animate)),s=y,l=v[i];return a.connect(d,"onAnimate",function(e){var t=s.getShape();t.points[i].x=e,s.setShape(t);var a=l.getShape();a.cx=e,l.setShape(a)}),d},this),F=n.combine(w.concat(k));F.play()}return{group:t,poly:y,circles:v}},plotEvent:function(e){"spider_plot"==e.element&&("onmouseover"!=e.type||d("ie")||e.shape.moveToFront())},tooltipFunc:function(e){return"spider_circle"==e.element?e.tdata.sname+"<br/>"+e.tdata.key+"<br/>"+e.tdata.data:null},_getBoundary:function(e){for(var t=e[0].x,a=e[0].x,i=e[0].y,r=e[0].y,o=0;o<e.length;o++){var n=e[o];t=Math.max(n.x,t),i=Math.max(n.y,i),a=Math.min(n.x,a),r=Math.min(n.y,r)}return{x:a,y:r,width:t-a,height:i-r}},_drawArrow:function(e,t,a,i){var r=Math.sqrt(Math.pow(a.x-t.x,2)+Math.pow(a.y-t.y,2)),o=(a.y-t.y)/r,n=(a.x-t.x)/r,d={x:a.x+r/3*-o,y:a.y+r/3*n},s={x:a.x+r/3*o,y:a.y+r/3*-n};e.createPolyline([t,d,s]).setFill(i.color).setStroke(i)},_buildPoints:function(e,t,a,i,r,o,n){for(var d=0;t>d;d++){var s=r+2*Math.PI*d/t;e.push(this._getCoordinate(a,i,s,n))}o&&e.push(this._getCoordinate(a,i,r+2*Math.PI,n))},_getCoordinate:function(e,t,a,i){var r=e.cx+t*Math.cos(a);return d("dojo-bidi")&&this.chart.isRightToLeft()&&i&&(r=i.width-r),{x:r,y:e.cy+t*Math.sin(a)}},_getObjectLength:function(t){var a=0;if(e.isObject(t))for(var i in t)a++;return a},_getLabel:function(e){return m.getLabel(e,this.opt.fixed,this.opt.precision)}});return g});//# sourceMappingURL=Spider.js.map