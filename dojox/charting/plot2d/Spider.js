//>>built
define("dojox/charting/plot2d/Spider",["dojo/_base/lang","dojo/_base/declare","dojo/_base/connect","dojo/_base/array","dojo/dom-geometry","dojo/_base/fx","dojo/fx","dojo/sniff","./Base","./_PlotEvents","./common","../axis2d/common","dojox/gfx","dojox/gfx/matrix","dojox/gfx/fx","dojox/lang/functional","dojox/lang/utils","dojo/fx/easing"],function(e,t,i,a,r,o,n,d,s,l,m,u,h,f,c,y,p,v){var g=t("dojox.charting.plot2d.Spider",[s,l],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:-10,labelStyle:"default",htmlLabels:!0,startAngle:-90,divisions:3,axisColor:"",axisWidth:0,spiderColor:"",spiderWidth:0,seriesWidth:0,seriesFillAlpha:.2,spiderOrigin:.16,markerSize:3,spiderType:"polygon",animationType:v.backOut,animate:null,axisTickFont:"",axisTickFontColor:"",axisFont:"",axisFontColor:""},optionalParams:{radius:0,font:"",fontColor:""},constructor:function(t,i){this.opt=e.clone(this.defaultParams),p.updateWithObject(this.opt,i),p.updateWithPattern(this.opt,i,this.optionalParams),this.dyn=[],this.datas={},this.labelKey=[],this.oldSeriePoints={},this.animate=null===this.opt.animate?{}:this.opt.animate,this.animations={}},clear:function(){return this.inherited(arguments),this.dyn=[],this.axes=[],this.datas={},this.labelKey=[],this.oldSeriePoints={},this.animations={},this},setAxis:function(e){return e&&(void 0!=e.opt.min&&(this.datas[e.name].min=e.opt.min),void 0!=e.opt.max&&(this.datas[e.name].max=e.opt.max)),this},addSeries:function(e){this.series.push(e);var t;for(t in e.data){var i=e.data[t],a=this.datas[t];if(a)a.vlist.push(i),a.min=Math.min(a.min,i),a.max=Math.max(a.max,i);else{var r="__"+t;this.axes.push(r),this[r]=t,this.datas[t]={min:i,max:i,vlist:[i]}}}if(this.labelKey.length<=0)for(t in e.data)this.labelKey.push(t);return this},getSeriesStats:function(){return m.collectSimpleStats(this.series)},render:function(e,t){if(!this.dirty)return this;this.dirty=!1,this.cleanGroup();var i=this.group,o=this.chart.theme;if(this.resetEvents(),!this.series||!this.series.length)return this;var n,d,s,l,m,c,p,v,g,M,b,k,w,_,j,F,x,I,E,S,C=this.opt,z=o.axis,N=(e.width-t.l-t.r)/2,T=(e.height-t.t-t.b)/2,A=Math.min(N,T),G=C.font||z.majorTick&&z.majorTick.font||z.tick&&z.tick.font||"normal normal normal 7pt Tahoma",D=C.axisFont||z.tick&&z.tick.titleFont||"normal normal normal 11pt Tahoma",P=C.axisTickFontColor||z.majorTick&&z.majorTick.fontColor||z.tick&&z.tick.fontColor||"silver",L=C.axisFontColor||z.tick&&z.tick.titleFontColor||"black",q=C.axisColor||z.tick&&z.tick.axisColor||"silver",H=C.spiderColor||z.tick&&z.tick.spiderColor||"silver",B=C.axisWidth||z.stroke&&z.stroke.width||2,R=C.spiderWidth||z.stroke&&z.stroke.width||2,Q=C.seriesWidth||z.stroke&&z.stroke.width||2,O=h.normalizedLength(h.splitFontString(D).size),V=f._degToRad(C.startAngle),W=V,U=C.spiderOrigin,K=C.divisions>=3?C.divisions:3,$=C.markerSize,Y=C.spiderType,J=C.animationType,Z=C.labelOffset<-10?C.labelOffset:-10,X=.2;C.labels&&(n=a.map(this.series,function(e){return e.name},this),d=y.foldl1(y.map(n,function(e){var t=o.series.font;return h._base._getTextBox(e,{font:t}).w},this),"Math.max(a, b)")/2,A=Math.min(N-2*d,T-O)+Z,s=A-Z),"radius"in C&&(A=C.radius,s=A-Z),A/=1+X;var ee={cx:t.l+N,cy:t.t+T,r:A};for(g=this.series.length-1;g>=0;g--)if(j=this.series[g],this.dirty||j.dirty){if(j.cleanGroup(),F=j.data,null!==F&&(k=this._getObjectLength(F),(!l||l.length<=0)&&(l=[],m=[],v=[],this._buildPoints(l,k,ee,A,W,!0,e),this._buildPoints(m,k,ee,A*U,W,!0,e),this._buildPoints(v,k,ee,s,W,!1,e),K>2)))for(c=[],p=[],M=0;K-2>M;M++)c[M]=[],this._buildPoints(c[M],k,ee,A*(U+(1-U)*(M+1)/(K-1)),W,!0,e),p[M]=A*(U+(1-U)*(M+1)/(K-1))}else o.skip();var te=i.createGroup(),ie={color:q,width:B},ae={color:H,width:R};for(M=l.length-1;M>=0;--M){b=l[M];var re={x:b.x+(b.x-ee.cx)*X,y:b.y+(b.y-ee.cy)*X},oe={x:b.x+(b.x-ee.cx)*X/2,y:b.y+(b.y-ee.cy)*X/2};te.createLine({x1:ee.cx,y1:ee.cy,x2:re.x,y2:re.y}).setStroke(ie),this._drawArrow(te,re,oe,ie)}var ne=i.createGroup();for(M=v.length-1;M>=0;--M){b=v[M],w=h._base._getTextBox(this.labelKey[M],{font:D}).w||0,_=this.opt.htmlLabels&&"vml"!=h.renderer?"html":"gfx";var de=u.createText[_](this.chart,ne,r.isBodyLtr()||"html"!=_?b.x:b.x+w-e.width,b.y,"middle",this.labelKey[M],D,L);this.opt.htmlLabels&&this.htmlElements.push(de)}var se=i.createGroup();if("polygon"==Y){if(se.createPolyline(l).setStroke(ae),se.createPolyline(m).setStroke(ae),c.length>0)for(M=c.length-1;M>=0;--M)se.createPolyline(c[M]).setStroke(ae)}else if(se.createCircle({cx:ee.cx,cy:ee.cy,r:A}).setStroke(ae),se.createCircle({cx:ee.cx,cy:ee.cy,r:A*U}).setStroke(ae),p.length>0)for(M=p.length-1;M>=0;--M)se.createCircle({cx:ee.cx,cy:ee.cy,r:p[M]}).setStroke(ae);k=this._getObjectLength(this.datas);var le=i.createGroup(),me=0;for(var ue in this.datas){for(x=this.datas[ue],I=x.min,E=x.max,S=E-I,Me=W+2*Math.PI*me/k,g=0;K>g;g++){var he=I+S*g/(K-1);b=this._getCoordinate(ee,A*(U+(1-U)*g/(K-1)),Me,e),he=this._getLabel(he),w=h._base._getTextBox(he,{font:G}).w||0,_=this.opt.htmlLabels&&"vml"!=h.renderer?"html":"gfx",this.opt.htmlLabels&&this.htmlElements.push(u.createText[_](this.chart,le,r.isBodyLtr()||"html"!=_?b.x:b.x+w-e.width,b.y,"start",he,G,P))}me++}for(this.chart.seriesShapes={},g=this.series.length-1;g>=0;g--)if(j=this.series[g],F=j.data,null!==F){var fe=o.next("spider",[C,j]),ce=h.normalizeColor(fe.series.fill),ye={color:fe.series.fill,width:Q};if(ce.a=C.seriesFillAlpha,j.dyn={fill:ce,stroke:ye},j.hidden)continue;var pe=[],ve=[];me=0;for(ue in F){x=this.datas[ue],I=x.min,E=x.max,S=E-I;var ge=F[ue],Me=W+2*Math.PI*me/k;b=this._getCoordinate(ee,A*(U+(1-U)*(ge-I)/S),Me,e),pe.push(b),ve.push({sname:j.name,key:ue,data:ge}),me++}pe[pe.length]=pe[0],ve[ve.length]=ve[0];var be=this._getBoundary(pe),ke=j.group,we=this.oldSeriePoints[j.name],_e=this._createSeriesEntry(ke,we||m,pe,ce,ye,A,U,$,J);this.chart.seriesShapes[j.name]=_e,this.oldSeriePoints[j.name]=pe;var je={element:"spider_poly",index:g,id:"spider_poly_"+j.name,run:j,plot:this,shape:_e.poly,parent:ke,brect:be,cx:ee.cx,cy:ee.cy,cr:A,f:ce,s:i};this._connectEvents(je);var Fe={element:"spider_plot",index:g,id:"spider_plot_"+j.name,run:j,plot:this,shape:j.group};this._connectEvents(Fe),a.forEach(_e.circles,function(e,t){var a={element:"spider_circle",index:t,id:"spider_circle_"+j.name+t,run:j,plot:this,shape:e,parent:ke,tdata:ve[t],cx:pe[t].x,cy:pe[t].y,f:ce,s:i};this._connectEvents(a)},this)}return this},_createSeriesEntry:function(t,r,d,s,l,m,u,h,f){for(var c=this.animate?r:d,y=t.createPolyline(c).setFill(s).setStroke(l),p=[],v=0;v<c.length;v++){var g=c[v],M=h,b=t.createCircle({cx:g.x,cy:g.y,r:M}).setFill(s).setStroke(l);p.push(b)}if(this.animate){var k=a.map(d,function(t,a){var n=r[a],d=new o.Animation(e.delegate({duration:1e3,easing:f,curve:[n.y,t.y]},this.animate)),s=y,l=p[a];return i.connect(d,"onAnimate",function(e){var t=s.getShape();t.points[a].y=e,s.setShape(t);var i=l.getShape();i.cy=e,l.setShape(i)}),d},this),w=a.map(d,function(t,a){var n=r[a],d=new o.Animation(e.delegate({duration:1e3,easing:f,curve:[n.x,t.x]},this.animate)),s=y,l=p[a];return i.connect(d,"onAnimate",function(e){var t=s.getShape();t.points[a].x=e,s.setShape(t);var i=l.getShape();i.cx=e,l.setShape(i)}),d},this),_=n.combine(k.concat(w));_.play()}return{group:t,poly:y,circles:p}},plotEvent:function(e){"spider_plot"==e.element&&("onmouseover"!=e.type||d("ie")||e.shape.moveToFront())},tooltipFunc:function(e){return"spider_circle"==e.element?e.tdata.sname+"<br/>"+e.tdata.key+"<br/>"+e.tdata.data:null},_getBoundary:function(e){for(var t=e[0].x,i=e[0].x,a=e[0].y,r=e[0].y,o=0;o<e.length;o++){var n=e[o];t=Math.max(n.x,t),a=Math.max(n.y,a),i=Math.min(n.x,i),r=Math.min(n.y,r)}return{x:i,y:r,width:t-i,height:a-r}},_drawArrow:function(e,t,i,a){var r=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)),o=(i.y-t.y)/r,n=(i.x-t.x)/r,d={x:i.x+r/3*-o,y:i.y+r/3*n},s={x:i.x+r/3*o,y:i.y+r/3*-n};e.createPolyline([t,d,s]).setFill(a.color).setStroke(a)},_buildPoints:function(e,t,i,a,r,o,n){for(var d=0;t>d;d++){var s=r+2*Math.PI*d/t;e.push(this._getCoordinate(i,a,s,n))}o&&e.push(this._getCoordinate(i,a,r+2*Math.PI,n))},_getCoordinate:function(e,t,i,a){var r=e.cx+t*Math.cos(i);return d("dojo-bidi")&&this.chart.isRightToLeft()&&a&&(r=a.width-r),{x:r,y:e.cy+t*Math.sin(i)}},_getObjectLength:function(t){var i=0;if(e.isObject(t))for(var a in t)i++;return i},_getLabel:function(e){return m.getLabel(e,this.opt.fixed,this.opt.precision)}});return g});//# sourceMappingURL=Spider.js.map