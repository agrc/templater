//>>built
define("dojox/charting/plot2d/Spider",["dojo/_base/lang","dojo/_base/declare","dojo/_base/connect","dojo/_base/array","dojo/dom-geometry","dojo/_base/fx","dojo/fx","dojo/sniff","./Base","./_PlotEvents","./common","../axis2d/common","dojox/gfx","dojox/gfx/matrix","dojox/gfx/fx","dojox/lang/functional","dojox/lang/utils","dojo/fx/easing"],function(e,t,i,a,r,o,n,d,s,l,u,c,m,f,h,y,p,v){var g=t("dojox.charting.plot2d.Spider",[s,l],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:-10,labelStyle:"default",htmlLabels:!0,startAngle:-90,divisions:3,axisColor:"",axisWidth:0,spiderColor:"",spiderWidth:0,seriesWidth:0,seriesFillAlpha:.2,spiderOrigin:.16,markerSize:3,spiderType:"polygon",animationType:v.backOut,animate:null,axisTickFont:"",axisTickFontColor:"",axisFont:"",axisFontColor:""},optionalParams:{radius:0,font:"",fontColor:""},constructor:function(t,i){this.opt=e.clone(this.defaultParams),p.updateWithObject(this.opt,i),p.updateWithPattern(this.opt,i,this.optionalParams),this.dyn=[],this.datas={},this.labelKey=[],this.oldSeriePoints={},this.animate=null===this.opt.animate?{}:this.opt.animate,this.animations={}},clear:function(){return this.inherited(arguments),this.dyn=[],this.axes=[],this.datas={},this.labelKey=[],this.oldSeriePoints={},this.animations={},this},setAxis:function(e){return e&&(void 0!=e.opt.min&&(this.datas[e.name].min=e.opt.min),void 0!=e.opt.max&&(this.datas[e.name].max=e.opt.max)),this},addSeries:function(e){this.series.push(e);var t;for(t in e.data){var i=e.data[t],a=this.datas[t];if(a)a.vlist.push(i),a.min=Math.min(a.min,i),a.max=Math.max(a.max,i);else{var r="__"+t;this.axes.push(r),this[r]=t,this.datas[t]={min:i,max:i,vlist:[i]}}}if(this.labelKey.length<=0)for(t in e.data)this.labelKey.push(t);return this},getSeriesStats:function(){return u.collectSimpleStats(this.series)},render:function(e,t){if(!this.dirty)return this;this.dirty=!1,this.cleanGroup();var i=this.group,o=this.chart.theme;if(this.resetEvents(),!this.series||!this.series.length)return this;var n,d,s,l,u,h,p,v,g,b,M,w,k,_,j,F,x,E,I,A,C=this.opt,S=o.axis,T=(e.width-t.l-t.r)/2,z=(e.height-t.t-t.b)/2,N=Math.min(T,z),G=C.font||S.majorTick&&S.majorTick.font||S.tick&&S.tick.font||"normal normal normal 7pt Tahoma",D=C.axisFont||S.tick&&S.tick.titleFont||"normal normal normal 11pt Tahoma",L=C.axisTickFontColor||S.majorTick&&S.majorTick.fontColor||S.tick&&S.tick.fontColor||"silver",P=C.axisFontColor||S.tick&&S.tick.titleFontColor||"black",R=C.axisColor||S.tick&&S.tick.axisColor||"silver",H=C.spiderColor||S.tick&&S.tick.spiderColor||"silver",q=C.axisWidth||S.stroke&&S.stroke.width||2,O=C.spiderWidth||S.stroke&&S.stroke.width||2,Q=C.seriesWidth||S.stroke&&S.stroke.width||2,B=m.normalizedLength(m.splitFontString(D).size),W=f._degToRad(C.startAngle),K=W,U=C.spiderOrigin,V=C.divisions>=3?C.divisions:3,$=C.markerSize,X=C.spiderType,Y=C.animationType,J=C.labelOffset<-10?C.labelOffset:-10,Z=.2;C.labels&&(n=a.map(this.series,function(e){return e.name},this),d=y.foldl1(y.map(n,function(e){var t=o.series.font;return m._base._getTextBox(e,{font:t}).w},this),"Math.max(a, b)")/2,N=Math.min(T-2*d,z-B)+J,s=N-J),"radius"in C&&(N=C.radius,s=N-J),N/=1+Z;var ee={cx:t.l+T,cy:t.t+z,r:N};for(g=this.series.length-1;g>=0;g--)if(j=this.series[g],this.dirty||j.dirty){if(j.cleanGroup(),F=j.data,null!==F&&(w=this._getObjectLength(F),(!l||l.length<=0)&&(l=[],u=[],v=[],this._buildPoints(l,w,ee,N,K,!0,e),this._buildPoints(u,w,ee,N*U,K,!0,e),this._buildPoints(v,w,ee,s,K,!1,e),V>2)))for(h=[],p=[],b=0;V-2>b;b++)h[b]=[],this._buildPoints(h[b],w,ee,N*(U+(1-U)*(b+1)/(V-1)),K,!0,e),p[b]=N*(U+(1-U)*(b+1)/(V-1))}else o.skip();var te=i.createGroup(),ie={color:R,width:q},ae={color:H,width:O};for(b=l.length-1;b>=0;--b){M=l[b];var re={x:M.x+(M.x-ee.cx)*Z,y:M.y+(M.y-ee.cy)*Z},oe={x:M.x+(M.x-ee.cx)*Z/2,y:M.y+(M.y-ee.cy)*Z/2};te.createLine({x1:ee.cx,y1:ee.cy,x2:re.x,y2:re.y}).setStroke(ie),this._drawArrow(te,re,oe,ie)}var ne=i.createGroup();for(b=v.length-1;b>=0;--b){M=v[b],k=m._base._getTextBox(this.labelKey[b],{font:D}).w||0,_=this.opt.htmlLabels&&"vml"!=m.renderer?"html":"gfx";var de=c.createText[_](this.chart,ne,r.isBodyLtr()||"html"!=_?M.x:M.x+k-e.width,M.y,"middle",this.labelKey[b],D,P);this.opt.htmlLabels&&this.htmlElements.push(de)}var se=i.createGroup();if("polygon"==X){if(se.createPolyline(l).setStroke(ae),se.createPolyline(u).setStroke(ae),h.length>0)for(b=h.length-1;b>=0;--b)se.createPolyline(h[b]).setStroke(ae)}else if(se.createCircle({cx:ee.cx,cy:ee.cy,r:N}).setStroke(ae),se.createCircle({cx:ee.cx,cy:ee.cy,r:N*U}).setStroke(ae),p.length>0)for(b=p.length-1;b>=0;--b)se.createCircle({cx:ee.cx,cy:ee.cy,r:p[b]}).setStroke(ae);w=this._getObjectLength(this.datas);var le=i.createGroup(),ue=0;for(var ce in this.datas){for(x=this.datas[ce],E=x.min,I=x.max,A=I-E,be=K+2*Math.PI*ue/w,g=0;V>g;g++){var me=E+A*g/(V-1);M=this._getCoordinate(ee,N*(U+(1-U)*g/(V-1)),be,e),me=this._getLabel(me),k=m._base._getTextBox(me,{font:G}).w||0,_=this.opt.htmlLabels&&"vml"!=m.renderer?"html":"gfx",this.opt.htmlLabels&&this.htmlElements.push(c.createText[_](this.chart,le,r.isBodyLtr()||"html"!=_?M.x:M.x+k-e.width,M.y,"start",me,G,L))}ue++}for(this.chart.seriesShapes={},g=this.series.length-1;g>=0;g--)if(j=this.series[g],F=j.data,null!==F){var fe=o.next("spider",[C,j]),he=m.normalizeColor(fe.series.fill),ye={color:fe.series.fill,width:Q};if(he.a=C.seriesFillAlpha,j.dyn={fill:he,stroke:ye},j.hidden)continue;var pe=[],ve=[];ue=0;for(ce in F){x=this.datas[ce],E=x.min,I=x.max,A=I-E;var ge=F[ce],be=K+2*Math.PI*ue/w;M=this._getCoordinate(ee,N*(U+(1-U)*(ge-E)/A),be,e),pe.push(M),ve.push({sname:j.name,key:ce,data:ge}),ue++}pe[pe.length]=pe[0],ve[ve.length]=ve[0];var Me=this._getBoundary(pe),we=j.group,ke=this.oldSeriePoints[j.name],_e=this._createSeriesEntry(we,ke||u,pe,he,ye,N,U,$,Y);this.chart.seriesShapes[j.name]=_e,this.oldSeriePoints[j.name]=pe;var je={element:"spider_poly",index:g,id:"spider_poly_"+j.name,run:j,plot:this,shape:_e.poly,parent:we,brect:Me,cx:ee.cx,cy:ee.cy,cr:N,f:he,s:i};this._connectEvents(je);var Fe={element:"spider_plot",index:g,id:"spider_plot_"+j.name,run:j,plot:this,shape:j.group};this._connectEvents(Fe),a.forEach(_e.circles,function(e,t){var a={element:"spider_circle",index:t,id:"spider_circle_"+j.name+t,run:j,plot:this,shape:e,parent:we,tdata:ve[t],cx:pe[t].x,cy:pe[t].y,f:he,s:i};this._connectEvents(a)},this)}return this},_createSeriesEntry:function(t,r,d,s,l,u,c,m,f){for(var h=this.animate?r:d,y=t.createPolyline(h).setFill(s).setStroke(l),p=[],v=0;v<h.length;v++){var g=h[v],b=m,M=t.createCircle({cx:g.x,cy:g.y,r:b}).setFill(s).setStroke(l);p.push(M)}if(this.animate){var w=a.map(d,function(t,a){var n=r[a],d=new o.Animation(e.delegate({duration:1e3,easing:f,curve:[n.y,t.y]},this.animate)),s=y,l=p[a];return i.connect(d,"onAnimate",function(e){var t=s.getShape();t.points[a].y=e,s.setShape(t);var i=l.getShape();i.cy=e,l.setShape(i)}),d},this),k=a.map(d,function(t,a){var n=r[a],d=new o.Animation(e.delegate({duration:1e3,easing:f,curve:[n.x,t.x]},this.animate)),s=y,l=p[a];return i.connect(d,"onAnimate",function(e){var t=s.getShape();t.points[a].x=e,s.setShape(t);var i=l.getShape();i.cx=e,l.setShape(i)}),d},this),_=n.combine(w.concat(k));_.play()}return{group:t,poly:y,circles:p}},plotEvent:function(e){"spider_plot"==e.element&&("onmouseover"!=e.type||d("ie")||e.shape.moveToFront())},tooltipFunc:function(e){return"spider_circle"==e.element?e.tdata.sname+"<br/>"+e.tdata.key+"<br/>"+e.tdata.data:null},_getBoundary:function(e){for(var t=e[0].x,i=e[0].x,a=e[0].y,r=e[0].y,o=0;o<e.length;o++){var n=e[o];t=Math.max(n.x,t),a=Math.max(n.y,a),i=Math.min(n.x,i),r=Math.min(n.y,r)}return{x:i,y:r,width:t-i,height:a-r}},_drawArrow:function(e,t,i,a){var r=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)),o=(i.y-t.y)/r,n=(i.x-t.x)/r,d={x:i.x+r/3*-o,y:i.y+r/3*n},s={x:i.x+r/3*o,y:i.y+r/3*-n};e.createPolyline([t,d,s]).setFill(a.color).setStroke(a)},_buildPoints:function(e,t,i,a,r,o,n){for(var d=0;t>d;d++){var s=r+2*Math.PI*d/t;e.push(this._getCoordinate(i,a,s,n))}o&&e.push(this._getCoordinate(i,a,r+2*Math.PI,n))},_getCoordinate:function(e,t,i,a){var r=e.cx+t*Math.cos(i);return d("dojo-bidi")&&this.chart.isRightToLeft()&&a&&(r=a.width-r),{x:r,y:e.cy+t*Math.sin(i)}},_getObjectLength:function(t){var i=0;if(e.isObject(t))for(var a in t)i++;return i},_getLabel:function(e){return u.getLabel(e,this.opt.fixed,this.opt.precision)}});return g});//# sourceMappingURL=Spider.js.map