//>>built
define("dojox/charting/plot2d/Spider",["dojo/_base/lang","dojo/_base/declare","dojo/_base/connect","dojo/_base/array","dojo/dom-geometry","dojo/_base/fx","dojo/fx","dojo/sniff","./Base","./_PlotEvents","./common","../axis2d/common","dojox/gfx","dojox/gfx/matrix","dojox/gfx/fx","dojox/lang/functional","dojox/lang/utils","dojo/fx/easing"],function(e,t,a,i,r,o,n,d,s,l,m,h,u,f,c,y,v,p){var g=t("dojox.charting.plot2d.Spider",[s,l],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:-10,labelStyle:"default",htmlLabels:!0,startAngle:-90,divisions:3,axisColor:"",axisWidth:0,spiderColor:"",spiderWidth:0,seriesWidth:0,seriesFillAlpha:.2,spiderOrigin:.16,markerSize:3,spiderType:"polygon",animationType:p.backOut,animate:null,axisTickFont:"",axisTickFontColor:"",axisFont:"",axisFontColor:""},optionalParams:{radius:0,font:"",fontColor:""},constructor:function(t,a){this.opt=e.clone(this.defaultParams),v.updateWithObject(this.opt,a),v.updateWithPattern(this.opt,a,this.optionalParams),this.dyn=[],this.datas={},this.labelKey=[],this.oldSeriePoints={},this.animate=null===this.opt.animate?{}:this.opt.animate,this.animations={}},clear:function(){return this.inherited(arguments),this.dyn=[],this.axes=[],this.datas={},this.labelKey=[],this.oldSeriePoints={},this.animations={},this},setAxis:function(e){return e&&(void 0!=e.opt.min&&(this.datas[e.name].min=e.opt.min),void 0!=e.opt.max&&(this.datas[e.name].max=e.opt.max)),this},addSeries:function(e){this.series.push(e);var t;for(t in e.data){var a=e.data[t],i=this.datas[t];if(i)i.vlist.push(a),i.min=Math.min(i.min,a),i.max=Math.max(i.max,a);else{var r="__"+t;this.axes.push(r),this[r]=t,this.datas[t]={min:a,max:a,vlist:[a]}}}if(this.labelKey.length<=0)for(t in e.data)this.labelKey.push(t);return this},getSeriesStats:function(){return m.collectSimpleStats(this.series)},render:function(e,t){if(!this.dirty)return this;this.dirty=!1,this.cleanGroup();var a=this.group,o=this.chart.theme;if(this.resetEvents(),!this.series||!this.series.length)return this;var n,d,s,l,m,c,v,p,g,M,b,k,w,F,x,_,j,I,E,T,A=this.opt,z=o.axis,C=(e.width-t.l-t.r)/2,S=(e.height-t.t-t.b)/2,N=Math.min(C,S),G=A.font||z.majorTick&&z.majorTick.font||z.tick&&z.tick.font||"normal normal normal 7pt Tahoma",L=A.axisFont||z.tick&&z.tick.titleFont||"normal normal normal 11pt Tahoma",P=A.axisTickFontColor||z.majorTick&&z.majorTick.fontColor||z.tick&&z.tick.fontColor||"silver",D=A.axisFontColor||z.tick&&z.tick.titleFontColor||"black",H=A.axisColor||z.tick&&z.tick.axisColor||"silver",Q=A.spiderColor||z.tick&&z.tick.spiderColor||"silver",R=A.axisWidth||z.stroke&&z.stroke.width||2,q=A.spiderWidth||z.stroke&&z.stroke.width||2,B=A.seriesWidth||z.stroke&&z.stroke.width||2,O=u.normalizedLength(u.splitFontString(L).size),U=f._degToRad(A.startAngle),W=U,K=A.spiderOrigin,V=A.divisions>=3?A.divisions:3,J=A.markerSize,Y=A.spiderType,$=A.animationType,X=A.labelOffset<-10?A.labelOffset:-10,Z=.2;A.labels&&(n=i.map(this.series,function(e){return e.name},this),d=y.foldl1(y.map(n,function(e){var t=o.series.font;return u._base._getTextBox(e,{font:t}).w},this),"Math.max(a, b)")/2,N=Math.min(C-2*d,S-O)+X,s=N-X),"radius"in A&&(N=A.radius,s=N-X),N/=1+Z;var ee={cx:t.l+C,cy:t.t+S,r:N};for(g=this.series.length-1;g>=0;g--)if(x=this.series[g],this.dirty||x.dirty){if(x.cleanGroup(),_=x.data,null!==_&&(k=this._getObjectLength(_),(!l||l.length<=0)&&(l=[],m=[],p=[],this._buildPoints(l,k,ee,N,W,!0,e),this._buildPoints(m,k,ee,N*K,W,!0,e),this._buildPoints(p,k,ee,s,W,!1,e),V>2)))for(c=[],v=[],M=0;V-2>M;M++)c[M]=[],this._buildPoints(c[M],k,ee,N*(K+(1-K)*(M+1)/(V-1)),W,!0,e),v[M]=N*(K+(1-K)*(M+1)/(V-1))}else o.skip();var te=a.createGroup(),ae={color:H,width:R},ie={color:Q,width:q};for(M=l.length-1;M>=0;--M){b=l[M];var re={x:b.x+(b.x-ee.cx)*Z,y:b.y+(b.y-ee.cy)*Z},oe={x:b.x+(b.x-ee.cx)*Z/2,y:b.y+(b.y-ee.cy)*Z/2};te.createLine({x1:ee.cx,y1:ee.cy,x2:re.x,y2:re.y}).setStroke(ae),this._drawArrow(te,re,oe,ae)}var ne=a.createGroup();for(M=p.length-1;M>=0;--M){b=p[M],w=u._base._getTextBox(this.labelKey[M],{font:L}).w||0,F=this.opt.htmlLabels&&"vml"!=u.renderer?"html":"gfx";var de=h.createText[F](this.chart,ne,r.isBodyLtr()||"html"!=F?b.x:b.x+w-e.width,b.y,"middle",this.labelKey[M],L,D);this.opt.htmlLabels&&this.htmlElements.push(de)}var se=a.createGroup();if("polygon"==Y){if(se.createPolyline(l).setStroke(ie),se.createPolyline(m).setStroke(ie),c.length>0)for(M=c.length-1;M>=0;--M)se.createPolyline(c[M]).setStroke(ie)}else if(se.createCircle({cx:ee.cx,cy:ee.cy,r:N}).setStroke(ie),se.createCircle({cx:ee.cx,cy:ee.cy,r:N*K}).setStroke(ie),v.length>0)for(M=v.length-1;M>=0;--M)se.createCircle({cx:ee.cx,cy:ee.cy,r:v[M]}).setStroke(ie);k=this._getObjectLength(this.datas);var le=a.createGroup(),me=0;for(var he in this.datas){for(j=this.datas[he],I=j.min,E=j.max,T=E-I,Me=W+2*Math.PI*me/k,g=0;V>g;g++){var ue=I+T*g/(V-1);b=this._getCoordinate(ee,N*(K+(1-K)*g/(V-1)),Me,e),ue=this._getLabel(ue),w=u._base._getTextBox(ue,{font:G}).w||0,F=this.opt.htmlLabels&&"vml"!=u.renderer?"html":"gfx",this.opt.htmlLabels&&this.htmlElements.push(h.createText[F](this.chart,le,r.isBodyLtr()||"html"!=F?b.x:b.x+w-e.width,b.y,"start",ue,G,P))}me++}for(this.chart.seriesShapes={},g=this.series.length-1;g>=0;g--)if(x=this.series[g],_=x.data,null!==_){var fe=o.next("spider",[A,x]),ce=u.normalizeColor(fe.series.fill),ye={color:fe.series.fill,width:B};if(ce.a=A.seriesFillAlpha,x.dyn={fill:ce,stroke:ye},x.hidden)continue;var ve=[],pe=[];me=0;for(he in _){j=this.datas[he],I=j.min,E=j.max,T=E-I;var ge=_[he],Me=W+2*Math.PI*me/k;b=this._getCoordinate(ee,N*(K+(1-K)*(ge-I)/T),Me,e),ve.push(b),pe.push({sname:x.name,key:he,data:ge}),me++}ve[ve.length]=ve[0],pe[pe.length]=pe[0];var be=this._getBoundary(ve),ke=x.group,we=this.oldSeriePoints[x.name],Fe=this._createSeriesEntry(ke,we||m,ve,ce,ye,N,K,J,$);this.chart.seriesShapes[x.name]=Fe,this.oldSeriePoints[x.name]=ve;var xe={element:"spider_poly",index:g,id:"spider_poly_"+x.name,run:x,plot:this,shape:Fe.poly,parent:ke,brect:be,cx:ee.cx,cy:ee.cy,cr:N,f:ce,s:a};this._connectEvents(xe);var _e={element:"spider_plot",index:g,id:"spider_plot_"+x.name,run:x,plot:this,shape:x.group};this._connectEvents(_e),i.forEach(Fe.circles,function(e,t){var i={element:"spider_circle",index:t,id:"spider_circle_"+x.name+t,run:x,plot:this,shape:e,parent:ke,tdata:pe[t],cx:ve[t].x,cy:ve[t].y,f:ce,s:a};this._connectEvents(i)},this)}return this},_createSeriesEntry:function(t,r,d,s,l,m,h,u,f){for(var c=this.animate?r:d,y=t.createPolyline(c).setFill(s).setStroke(l),v=[],p=0;p<c.length;p++){var g=c[p],M=u,b=t.createCircle({cx:g.x,cy:g.y,r:M}).setFill(s).setStroke(l);v.push(b)}if(this.animate){var k=i.map(d,function(t,i){var n=r[i],d=new o.Animation(e.delegate({duration:1e3,easing:f,curve:[n.y,t.y]},this.animate)),s=y,l=v[i];return a.connect(d,"onAnimate",function(e){var t=s.getShape();t.points[i].y=e,s.setShape(t);var a=l.getShape();a.cy=e,l.setShape(a)}),d},this),w=i.map(d,function(t,i){var n=r[i],d=new o.Animation(e.delegate({duration:1e3,easing:f,curve:[n.x,t.x]},this.animate)),s=y,l=v[i];return a.connect(d,"onAnimate",function(e){var t=s.getShape();t.points[i].x=e,s.setShape(t);var a=l.getShape();a.cx=e,l.setShape(a)}),d},this),F=n.combine(k.concat(w));F.play()}return{group:t,poly:y,circles:v}},plotEvent:function(e){"spider_plot"==e.element&&("onmouseover"!=e.type||d("ie")||e.shape.moveToFront())},tooltipFunc:function(e){return"spider_circle"==e.element?e.tdata.sname+"<br/>"+e.tdata.key+"<br/>"+e.tdata.data:null},_getBoundary:function(e){for(var t=e[0].x,a=e[0].x,i=e[0].y,r=e[0].y,o=0;o<e.length;o++){var n=e[o];t=Math.max(n.x,t),i=Math.max(n.y,i),a=Math.min(n.x,a),r=Math.min(n.y,r)}return{x:a,y:r,width:t-a,height:i-r}},_drawArrow:function(e,t,a,i){var r=Math.sqrt(Math.pow(a.x-t.x,2)+Math.pow(a.y-t.y,2)),o=(a.y-t.y)/r,n=(a.x-t.x)/r,d={x:a.x+r/3*-o,y:a.y+r/3*n},s={x:a.x+r/3*o,y:a.y+r/3*-n};e.createPolyline([t,d,s]).setFill(i.color).setStroke(i)},_buildPoints:function(e,t,a,i,r,o,n){for(var d=0;t>d;d++){var s=r+2*Math.PI*d/t;e.push(this._getCoordinate(a,i,s,n))}o&&e.push(this._getCoordinate(a,i,r+2*Math.PI,n))},_getCoordinate:function(e,t,a,i){var r=e.cx+t*Math.cos(a);return d("dojo-bidi")&&this.chart.isRightToLeft()&&i&&(r=i.width-r),{x:r,y:e.cy+t*Math.sin(a)}},_getObjectLength:function(t){var a=0;if(e.isObject(t))for(var i in t)a++;return a},_getLabel:function(e){return m.getLabel(e,this.opt.fixed,this.opt.precision)}});return g});//# sourceMappingURL=Spider.js.map