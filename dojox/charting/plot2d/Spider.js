//>>built
define("dojox/charting/plot2d/Spider",["dojo/_base/lang","dojo/_base/declare","dojo/_base/connect","dojo/_base/array","dojo/dom-geometry","dojo/_base/fx","dojo/fx","dojo/sniff","./Base","./_PlotEvents","./common","../axis2d/common","dojox/gfx","dojox/gfx/matrix","dojox/gfx/fx","dojox/lang/functional","dojox/lang/utils","dojo/fx/easing"],function(e,t,i,a,r,n,o,s,d,l,u,c,f,h,m,p,y,v){var g=t("dojox.charting.plot2d.Spider",[d,l],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:-10,labelStyle:"default",htmlLabels:!0,startAngle:-90,divisions:3,axisColor:"",axisWidth:0,spiderColor:"",spiderWidth:0,seriesWidth:0,seriesFillAlpha:.2,spiderOrigin:.16,markerSize:3,spiderType:"polygon",animationType:v.backOut,animate:null,axisTickFont:"",axisTickFontColor:"",axisFont:"",axisFontColor:""},optionalParams:{radius:0,font:"",fontColor:""},constructor:function(t,i){this.opt=e.clone(this.defaultParams),y.updateWithObject(this.opt,i),y.updateWithPattern(this.opt,i,this.optionalParams),this.dyn=[],this.datas={},this.labelKey=[],this.oldSeriePoints={},this.animate=null===this.opt.animate?{}:this.opt.animate,this.animations={}},clear:function(){return this.inherited(arguments),this.dyn=[],this.axes=[],this.datas={},this.labelKey=[],this.oldSeriePoints={},this.animations={},this},setAxis:function(e){return e&&(void 0!=e.opt.min&&(this.datas[e.name].min=e.opt.min),void 0!=e.opt.max&&(this.datas[e.name].max=e.opt.max)),this},addSeries:function(e){this.series.push(e);var t;for(t in e.data){var i=e.data[t],a=this.datas[t];if(a)a.vlist.push(i),a.min=Math.min(a.min,i),a.max=Math.max(a.max,i);else{var r="__"+t;this.axes.push(r),this[r]=t,this.datas[t]={min:i,max:i,vlist:[i]}}}if(this.labelKey.length<=0)for(t in e.data)this.labelKey.push(t);return this},getSeriesStats:function(){return u.collectSimpleStats(this.series)},render:function(e,t){if(!this.dirty)return this;this.dirty=!1,this.cleanGroup();var i=this.group,n=this.chart.theme;if(this.resetEvents(),!this.series||!this.series.length)return this;var o,s,d,l,u,m,y,v,g,b,M,k,w,_,x,j,F,I,E,S,A=this.opt,C=n.axis,T=(e.width-t.l-t.r)/2,z=(e.height-t.t-t.b)/2,P=Math.min(T,z),N=A.font||C.majorTick&&C.majorTick.font||C.tick&&C.tick.font||"normal normal normal 7pt Tahoma",L=A.axisFont||C.tick&&C.tick.titleFont||"normal normal normal 11pt Tahoma",D=A.axisTickFontColor||C.majorTick&&C.majorTick.fontColor||C.tick&&C.tick.fontColor||"silver",G=A.axisFontColor||C.tick&&C.tick.titleFontColor||"black",R=A.axisColor||C.tick&&C.tick.axisColor||"silver",O=A.spiderColor||C.tick&&C.tick.spiderColor||"silver",H=A.axisWidth||C.stroke&&C.stroke.width||2,q=A.spiderWidth||C.stroke&&C.stroke.width||2,B=A.seriesWidth||C.stroke&&C.stroke.width||2,Q=f.normalizedLength(f.splitFontString(L).size),U=h._degToRad(A.startAngle),K=U,W=A.spiderOrigin,$=A.divisions>=3?A.divisions:3,V=A.markerSize,X=A.spiderType,J=A.animationType,Y=A.labelOffset<-10?A.labelOffset:-10,Z=.2;A.labels&&(o=a.map(this.series,function(e){return e.name},this),s=p.foldl1(p.map(o,function(e){var t=n.series.font;return f._base._getTextBox(e,{font:t}).w},this),"Math.max(a, b)")/2,P=Math.min(T-2*s,z-Q)+Y,d=P-Y),"radius"in A&&(P=A.radius,d=P-Y),P/=1+Z;var ee={cx:t.l+T,cy:t.t+z,r:P};for(g=this.series.length-1;g>=0;g--)if(x=this.series[g],this.dirty||x.dirty){if(x.cleanGroup(),j=x.data,null!==j&&(k=this._getObjectLength(j),(!l||l.length<=0)&&(l=[],u=[],v=[],this._buildPoints(l,k,ee,P,K,!0,e),this._buildPoints(u,k,ee,P*W,K,!0,e),this._buildPoints(v,k,ee,d,K,!1,e),$>2)))for(m=[],y=[],b=0;$-2>b;b++)m[b]=[],this._buildPoints(m[b],k,ee,P*(W+(1-W)*(b+1)/($-1)),K,!0,e),y[b]=P*(W+(1-W)*(b+1)/($-1))}else n.skip();var te=i.createGroup(),ie={color:R,width:H},ae={color:O,width:q};for(b=l.length-1;b>=0;--b){M=l[b];var re={x:M.x+(M.x-ee.cx)*Z,y:M.y+(M.y-ee.cy)*Z},ne={x:M.x+(M.x-ee.cx)*Z/2,y:M.y+(M.y-ee.cy)*Z/2};te.createLine({x1:ee.cx,y1:ee.cy,x2:re.x,y2:re.y}).setStroke(ie),this._drawArrow(te,re,ne,ie)}var oe=i.createGroup();for(b=v.length-1;b>=0;--b){M=v[b],w=f._base._getTextBox(this.labelKey[b],{font:L}).w||0,_=this.opt.htmlLabels&&"vml"!=f.renderer?"html":"gfx";var se=c.createText[_](this.chart,oe,r.isBodyLtr()||"html"!=_?M.x:M.x+w-e.width,M.y,"middle",this.labelKey[b],L,G);this.opt.htmlLabels&&this.htmlElements.push(se)}var de=i.createGroup();if("polygon"==X){if(de.createPolyline(l).setStroke(ae),de.createPolyline(u).setStroke(ae),m.length>0)for(b=m.length-1;b>=0;--b)de.createPolyline(m[b]).setStroke(ae)}else if(de.createCircle({cx:ee.cx,cy:ee.cy,r:P}).setStroke(ae),de.createCircle({cx:ee.cx,cy:ee.cy,r:P*W}).setStroke(ae),y.length>0)for(b=y.length-1;b>=0;--b)de.createCircle({cx:ee.cx,cy:ee.cy,r:y[b]}).setStroke(ae);k=this._getObjectLength(this.datas);var le=i.createGroup(),ue=0;for(var ce in this.datas){for(F=this.datas[ce],I=F.min,E=F.max,S=E-I,be=K+2*Math.PI*ue/k,g=0;$>g;g++){var fe=I+S*g/($-1);M=this._getCoordinate(ee,P*(W+(1-W)*g/($-1)),be,e),fe=this._getLabel(fe),w=f._base._getTextBox(fe,{font:N}).w||0,_=this.opt.htmlLabels&&"vml"!=f.renderer?"html":"gfx",this.opt.htmlLabels&&this.htmlElements.push(c.createText[_](this.chart,le,r.isBodyLtr()||"html"!=_?M.x:M.x+w-e.width,M.y,"start",fe,N,D))}ue++}for(this.chart.seriesShapes={},g=this.series.length-1;g>=0;g--)if(x=this.series[g],j=x.data,null!==j){var he=n.next("spider",[A,x]),me=f.normalizeColor(he.series.fill),pe={color:he.series.fill,width:B};if(me.a=A.seriesFillAlpha,x.dyn={fill:me,stroke:pe},x.hidden)continue;var ye=[],ve=[];ue=0;for(ce in j){F=this.datas[ce],I=F.min,E=F.max,S=E-I;var ge=j[ce],be=K+2*Math.PI*ue/k;M=this._getCoordinate(ee,P*(W+(1-W)*(ge-I)/S),be,e),ye.push(M),ve.push({sname:x.name,key:ce,data:ge}),ue++}ye[ye.length]=ye[0],ve[ve.length]=ve[0];var Me=this._getBoundary(ye),ke=x.group,we=this.oldSeriePoints[x.name],_e=this._createSeriesEntry(ke,we||u,ye,me,pe,P,W,V,J);this.chart.seriesShapes[x.name]=_e,this.oldSeriePoints[x.name]=ye;var xe={element:"spider_poly",index:g,id:"spider_poly_"+x.name,run:x,plot:this,shape:_e.poly,parent:ke,brect:Me,cx:ee.cx,cy:ee.cy,cr:P,f:me,s:i};this._connectEvents(xe);var je={element:"spider_plot",index:g,id:"spider_plot_"+x.name,run:x,plot:this,shape:x.group};this._connectEvents(je),a.forEach(_e.circles,function(e,t){var a={element:"spider_circle",index:t,id:"spider_circle_"+x.name+t,run:x,plot:this,shape:e,parent:ke,tdata:ve[t],cx:ye[t].x,cy:ye[t].y,f:me,s:i};this._connectEvents(a)},this)}return this},_createSeriesEntry:function(t,r,s,d,l,u,c,f,h){for(var m=this.animate?r:s,p=t.createPolyline(m).setFill(d).setStroke(l),y=[],v=0;v<m.length;v++){var g=m[v],b=f,M=t.createCircle({cx:g.x,cy:g.y,r:b}).setFill(d).setStroke(l);y.push(M)}if(this.animate){var k=a.map(s,function(t,a){var o=r[a],s=new n.Animation(e.delegate({duration:1e3,easing:h,curve:[o.y,t.y]},this.animate)),d=p,l=y[a];return i.connect(s,"onAnimate",function(e){var t=d.getShape();t.points[a].y=e,d.setShape(t);var i=l.getShape();i.cy=e,l.setShape(i)}),s},this),w=a.map(s,function(t,a){var o=r[a],s=new n.Animation(e.delegate({duration:1e3,easing:h,curve:[o.x,t.x]},this.animate)),d=p,l=y[a];return i.connect(s,"onAnimate",function(e){var t=d.getShape();t.points[a].x=e,d.setShape(t);var i=l.getShape();i.cx=e,l.setShape(i)}),s},this),_=o.combine(k.concat(w));_.play()}return{group:t,poly:p,circles:y}},plotEvent:function(e){"spider_plot"==e.element&&("onmouseover"!=e.type||s("ie")||e.shape.moveToFront())},tooltipFunc:function(e){return"spider_circle"==e.element?e.tdata.sname+"<br/>"+e.tdata.key+"<br/>"+e.tdata.data:null},_getBoundary:function(e){for(var t=e[0].x,i=e[0].x,a=e[0].y,r=e[0].y,n=0;n<e.length;n++){var o=e[n];t=Math.max(o.x,t),a=Math.max(o.y,a),i=Math.min(o.x,i),r=Math.min(o.y,r)}return{x:i,y:r,width:t-i,height:a-r}},_drawArrow:function(e,t,i,a){var r=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)),n=(i.y-t.y)/r,o=(i.x-t.x)/r,s={x:i.x+r/3*-n,y:i.y+r/3*o},d={x:i.x+r/3*n,y:i.y+r/3*-o};e.createPolyline([t,s,d]).setFill(a.color).setStroke(a)},_buildPoints:function(e,t,i,a,r,n,o){for(var s=0;t>s;s++){var d=r+2*Math.PI*s/t;e.push(this._getCoordinate(i,a,d,o))}n&&e.push(this._getCoordinate(i,a,r+2*Math.PI,o))},_getCoordinate:function(e,t,i,a){var r=e.cx+t*Math.cos(i);return s("dojo-bidi")&&this.chart.isRightToLeft()&&a&&(r=a.width-r),{x:r,y:e.cy+t*Math.sin(i)}},_getObjectLength:function(t){var i=0;if(e.isObject(t))for(var a in t)i++;return i},_getLabel:function(e){return u.getLabel(e,this.opt.fixed,this.opt.precision)}});return g});//# sourceMappingURL=Spider.js.map