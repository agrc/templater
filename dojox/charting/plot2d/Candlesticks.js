//>>built
define("dojox/charting/plot2d/Candlesticks",["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/has","./CartesianBase","./_PlotEvents","./common","dojox/lang/functional","dojox/lang/functional/reversed","dojox/lang/utils","dojox/gfx/fx"],function(e,t,i,a,r,o,n,d,s,l,m){var h=s.lambda("item.purgeGroup()");return t("dojox.charting.plot2d.Candlesticks",[r,o],{defaultParams:{gap:2,animate:null},optionalParams:{minBarSize:1,maxBarSize:1,stroke:{},outline:{},shadow:{},fill:{},font:"",fontColor:""},constructor:function(t,i){this.opt=e.clone(this.defaultParams),l.updateWithObject(this.opt,i),l.updateWithPattern(this.opt,i,this.optionalParams),this.animate=this.opt.animate},collectStats:function(t){for(var a=e.delegate(n.defaultStats),r=0;r<t.length;r++){var o=t[r];if(o.data.length){var d=a.vmin,s=a.vmax;"ymin"in o&&"ymax"in o||i.forEach(o.data,function(e,t){if(!this.isNullValue(e)){var i=e.x||t+1;a.hmin=Math.min(a.hmin,i),a.hmax=Math.max(a.hmax,i),a.vmin=Math.min(a.vmin,e.open,e.close,e.high,e.low),a.vmax=Math.max(a.vmax,e.open,e.close,e.high,e.low)}},this),"ymin"in o&&(a.vmin=Math.min(d,o.ymin)),"ymax"in o&&(a.vmax=Math.max(s,o.ymax))}}return a},getSeriesStats:function(){var e=this.collectStats(this.series);return e.hmin-=.5,e.hmax+=.5,e},render:function(e,t){if(this.zoom&&!this.isDataDirty())return this.performZoom(e,t);this.resetEvents(),this.dirty=this.isDirty();var r;this.dirty&&(i.forEach(this.series,h),this._eventSeries={},this.cleanGroup(),r=this.getGroup(),d.forEachRev(this.series,function(e){e.cleanGroup(r)}));var o,s,l,m=this.chart.theme,u=this._hScaler.scaler.getTransformerFromModel(this._hScaler),f=this._vScaler.scaler.getTransformerFromModel(this._vScaler),c=this.events();o=n.calculateBarSize(this._hScaler.bounds.scale,this.opt),s=o.gap,l=o.size;for(var y=this.series.length-1;y>=0;--y){var p=this.series[y];if(this.dirty||p.dirty){p.cleanGroup();var v=m.next("candlestick",[this.opt,p]),g=new Array(p.data.length);if(p.hidden)p.dyn.fill=v.series.fill,p.dyn.stroke=v.series.stroke;else{r=p.group;for(var M=0;M<p.data.length;++M){var b=p.data[M];if(!this.isNullValue(b)){var k=m.addMixin(v,"candlestick",b,!0),w=u(b.x||M+.5)+t.l+s,_=e.height-t.b,j=f(b.open),F=f(b.close),x=f(b.high),I=f(b.low);if("mid"in b)var E=f(b.mid);if(I>x){var C=x;x=I,I=C}if(l>=1){var A=j>F,N={x1:l/2,x2:l/2,y1:_-x,y2:_-I},T={x:0,y:_-Math.max(j,F),width:l,height:Math.max(A?j-F:F-j,1)},S=r.createGroup();S.setTransform({dx:w,dy:0});var z=S.createGroup();if(z.createLine(N).setStroke(k.series.stroke),z.createRect(T).setStroke(k.series.stroke).setFill(A?k.series.fill:"white"),"mid"in b&&z.createLine({x1:k.series.stroke?k.series.stroke.width||1:1,x2:l-(k.series.stroke?k.series.stroke.width||1:1),y1:_-E,y2:_-E}).setStroke(A?"white":k.series.stroke),p.dyn.fill=k.series.fill,p.dyn.stroke=k.series.stroke,c){var G={element:"candlestick",index:M,run:p,shape:z,x:w,y:_-Math.max(j,F),cx:l/2,cy:_-Math.max(j,F)+Math.max(A?j-F:F-j,1)/2,width:l,height:Math.max(A?j-F:F-j,1),data:b};this._connectEvents(G),g[M]=G}}this.animate&&this._animateCandlesticks(S,_-I,x-I)}}this._eventSeries[p.name]=g,p.dirty=!1}}else m.skip(),this._reconnectEvents(p.name)}return this.dirty=!1,a("dojo-bidi")&&this._checkOrientation(this.group,e,t),this},tooltipFunc:function(e){return'<table cellpadding="1" cellspacing="0" border="0" style="font-size:0.9em;"><tr><td>Open:</td><td align="right"><strong>'+e.data.open+'</strong></td></tr><tr><td>High:</td><td align="right"><strong>'+e.data.high+'</strong></td></tr><tr><td>Low:</td><td align="right"><strong>'+e.data.low+'</strong></td></tr><tr><td>Close:</td><td align="right"><strong>'+e.data.close+"</strong></td></tr>"+(void 0!==e.data.mid?'<tr><td>Mid:</td><td align="right"><strong>'+e.data.mid+"</strong></td></tr>":"")+"</table>"},_animateCandlesticks:function(t,i,a){m.animateTransform(e.delegate({shape:t,duration:1200,transform:[{name:"translate",start:[0,i-i/a],end:[0,0]},{name:"scale",start:[1,1/a],end:[1,1]},{name:"original"}]},this.animate)).play()}})});//# sourceMappingURL=Candlesticks.js.map