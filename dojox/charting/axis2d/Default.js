//>>built
define("dojox/charting/axis2d/Default",["dojo/_base/lang","dojo/_base/array","dojo/sniff","dojo/_base/declare","dojo/_base/connect","dojo/dom-geometry","./Invisible","../scaler/linear","./common","dojox/gfx","dojox/lang/utils","dojox/lang/functional","dojo/has!dojo-bidi?../bidi/axis2d/Default"],function(e,t,a,i,r,o,n,d,s,l,m,h,u){var f=45,c=i(a("dojo-bidi")?"dojox.charting.axis2d.NonBidiDefault":"dojox.charting.axis2d.Default",n,{defaultParams:{vertical:!1,fixUpper:"none",fixLower:"none",natural:!1,leftBottom:!0,includeZero:!1,fixed:!0,majorLabels:!0,minorTicks:!0,minorLabels:!0,microTicks:!1,rotation:0,htmlLabels:!0,enableCache:!1,dropLabels:!0,labelSizeChange:!1,position:"leftOrBottom"},optionalParams:{min:0,max:1,from:0,to:1,majorTickStep:4,minorTickStep:2,microTickStep:1,labels:[],labelFunc:null,maxLabelSize:0,maxLabelCharCount:0,trailingSymbol:null,stroke:{},majorTick:{},minorTick:{},microTick:{},tick:{},font:"",fontColor:"",title:"",titleGap:0,titleFont:"",titleFontColor:"",titleOrientation:""},constructor:function(t,a){this.opt=e.clone(this.defaultParams),m.updateWithObject(this.opt,a),m.updateWithPattern(this.opt,a,this.optionalParams),this.opt.enableCache&&(this._textFreePool=[],this._lineFreePool=[],this._textUsePool=[],this._lineUsePool=[]),this._invalidMaxLabelSize=!0,a&&"position"in a||(this.opt.position=this.opt.leftBottom?"leftOrBottom":"rightOrTop"),this.renderingOptions={"shape-rendering":"crispEdges"}},setWindow:function(e,t){return e!=this.scale&&(this._invalidMaxLabelSize=!0),this.inherited(arguments)},_groupLabelWidth:function(t,a,i){if(!t.length)return 0;t.length>50&&(t.length=50),e.isObject(t[0])&&(t=h.map(t,function(e){return e.text})),i&&(t=h.map(t,function(t){return 0==e.trim(t).length?"":t.substring(0,i)+this.trailingSymbol},this));var r=t.join("<br>");return l._base._getTextBox(r,{font:a}).w||0},_getMaxLabelSize:function(a,i,r,o,n,s){if(null==this._maxLabelSize&&6==arguments.length){var l=this.opt;this.scaler.minMinorStep=this._prevMinMinorStep=0;var m=e.clone(l);delete m.to,delete m.from;var h=d.buildScaler(a,i,r,m,l.to-l.from);h.minMinorStep=0,this._majorStart=h.major.start;var u=d.buildTicks(h,l);if(s&&u){var f=0,c=0,y=function(e){e.label&&this.push(e.label)},p=[];this.opt.majorLabels&&(t.forEach(u.major,y,p),f=this._groupLabelWidth(p,n,m.maxLabelCharCount),m.maxLabelSize&&(f=Math.min(m.maxLabelSize,f))),p=[],this.opt.dropLabels&&this.opt.minorLabels&&(t.forEach(u.minor,y,p),c=this._groupLabelWidth(p,n,m.maxLabelCharCount),m.maxLabelSize&&(c=Math.min(m.maxLabelSize,c))),this._maxLabelSize={majLabelW:f,minLabelW:c,majLabelH:s,minLabelH:s}}else this._maxLabelSize=null}return this._maxLabelSize},calculate:function(e,t,a){if(this.inherited(arguments),this.scaler.minMinorStep=this._prevMinMinorStep,(this._invalidMaxLabelSize||a!=this._oldSpan)&&e!=1/0&&t!=-1/0){this._invalidMaxLabelSize=!1,this.opt.labelSizeChange&&(this._maxLabelSize=null),this._oldSpan=a;var i=this.opt,r=this.chart.theme.axis,o=i.rotation%360,n=this.chart.theme.axis.tick.labelGap,s=i.font||r.majorTick&&r.majorTick.font||r.tick&&r.tick.font,m=s?l.normalizedLength(l.splitFontString(s).size):0,h=this._getMaxLabelSize(e,t,a,o,s,m);if("number"!=typeof n&&(n=4),h&&i.dropLabels){var u,f,c=Math.abs(Math.cos(o*Math.PI/180)),y=Math.abs(Math.sin(o*Math.PI/180));switch(o<0&&(o+=360),o){case 0:case 180:this.vertical?u=f=m:(u=h.majLabelW,f=h.minLabelW);break;case 90:case 270:this.vertical?(u=h.majLabelW,f=h.minLabelW):u=f=m;break;default:u=this.vertical?Math.min(h.majLabelW,m/c):Math.min(h.majLabelW,m/y);var p=Math.sqrt(h.minLabelW*h.minLabelW+m*m),v=this.vertical?m*c+h.minLabelW*y:h.minLabelW*c+m*y;f=Math.min(p,v)}this.scaler.minMinorStep=this._prevMinMinorStep=Math.max(u,f)+n;var g=this.scaler.minMinorStep<=this.scaler.minor.tick*this.scaler.bounds.scale;this._skipInterval=g?0:Math.floor((u+n)/(this.scaler.major.tick*this.scaler.bounds.scale))}else this._skipInterval=0}return this.ticks=d.buildTicks(this.scaler,this.opt),this},getOffsets:function(){var e=this.scaler,t={l:0,r:0,t:0,b:0};if(!e)return t;var a=this.opt,i=this.chart.theme.axis,r=this.chart.theme.axis.tick.labelGap,o=a.titleFont||i.title&&i.title.font,n=0==a.titleGap?0:a.titleGap||i.title&&i.title.gap,d=this.chart.theme.getTick("major",a),s=this.chart.theme.getTick("minor",a),m=o?l.normalizedLength(l.splitFontString(o).size):0,h=a.rotation%360,u=a.position,c="rightOrTop"!==u,y=Math.abs(Math.cos(h*Math.PI/180)),p=Math.abs(Math.sin(h*Math.PI/180));this.trailingSymbol=void 0===a.trailingSymbol||null===a.trailingSymbol?this.trailingSymbol:a.trailingSymbol,"number"!=typeof r&&(r=4),h<0&&(h+=360);var v=this._getMaxLabelSize();if(v){var g,M=Math.ceil(Math.max(v.majLabelW,v.minLabelW))+1,b=Math.ceil(Math.max(v.majLabelH,v.minLabelH))+1;if(this.vertical){switch(g=c?"l":"r",h){case 0:case 180:t[g]="center"===u?0:M,t.t=t.b=b/2;break;case 90:case 270:t[g]=b,t.t=t.b=M/2;break;default:h<=f||180<h&&h<=180+f?(t[g]=b*p/2+M*y,t[c?"t":"b"]=b*y/2+M*p,t[c?"b":"t"]=b*y/2):h>360-f||180>h&&h>180-f?(t[g]=b*p/2+M*y,t[c?"b":"t"]=b*y/2+M*p,t[c?"t":"b"]=b*y/2):h<90||180<h&&h<270?(t[g]=b*p+M*y,t[c?"t":"b"]=b*y+M*p):(t[g]=b*p+M*y,t[c?"b":"t"]=b*y+M*p)}"center"===u?t[g]=0:t[g]+=r+Math.max(d.length>0?d.length:0,s.length>0?s.length:0)+(a.title?m+n:0)}else{switch(g=c?"b":"t",h){case 0:case 180:t[g]="center"===u?0:b,t.l=t.r=M/2;break;case 90:case 270:t[g]=M,t.l=t.r=b/2;break;default:90-f<=h&&h<=90||270-f<=h&&h<=270?(t[g]=b*y/2+M*p,t[c?"r":"l"]=b*p/2+M*y,t[c?"l":"r"]=b*p/2):90<=h&&h<=90+f||270<=h&&h<=270+f?(t[g]=b*y/2+M*p,t[c?"l":"r"]=b*p/2+M*y,t[c?"r":"l"]=b*p/2):h<f||180<h&&h<180+f?(t[g]=b*y+M*p,t[c?"r":"l"]=b*p+M*y):(t[g]=b*y+M*p,t[c?"l":"r"]=b*p+M*y)}"center"===u?t[g]=0:t[g]+=r+Math.max(d.length>0?d.length:0,s.length>0?s.length:0)+(a.title?m+n:0)}}return t},cleanGroup:function(e){this.opt.enableCache&&this.group&&(this._lineFreePool=this._lineFreePool.concat(this._lineUsePool),this._lineUsePool=[],this._textFreePool=this._textFreePool.concat(this._textUsePool),this._textUsePool=[]),this.inherited(arguments)},createText:function(e,t,a,i,r,o,n,d,l){if(!this.opt.enableCache||"html"==e)return s.createText[e](this.chart,t,a,i,r,o,n,d,l);var m;return this._textFreePool.length>0?(m=this._textFreePool.pop(),m.setShape({x:a,y:i,text:o,align:r}),t.add(m)):m=s.createText[e](this.chart,t,a,i,r,o,n,d),this._textUsePool.push(m),m},createLine:function(e,t){var a;return this.opt.enableCache&&this._lineFreePool.length>0?(a=this._lineFreePool.pop(),a.setShape(t),e.add(a)):a=e.createLine(t),this.opt.enableCache&&this._lineUsePool.push(a),a},render:function(e,i){var r=this._isRtl();if(!this.dirty||!this.scaler)return this;var o,n,m,h,u,c,y,p,v,g=this.opt,M=this.chart.theme.axis,b=g.position,k="rightOrTop"!==b,w=g.rotation%360,_=0,j=this.chart.theme.axis.tick.labelGap,F=g.font||M.majorTick&&M.majorTick.font||M.tick&&M.tick.font,x=g.titleFont||M.title&&M.title.font,I=g.fontColor||M.majorTick&&M.majorTick.fontColor||M.tick&&M.tick.fontColor||"black",E=g.titleFontColor||M.title&&M.title.fontColor||"black",C=0==g.titleGap?0:g.titleGap||M.title&&M.title.gap||15,A=g.titleOrientation||M.title&&M.title.orientation||"axis",N=this.chart.theme.getTick("major",g),T=this.chart.theme.getTick("minor",g),S=this.chart.theme.getTick("micro",g),z="stroke"in g?g.stroke:M.stroke,G=F?l.normalizedLength(l.splitFontString(F).size):0,D=Math.abs(Math.cos(w*Math.PI/180)),L=Math.abs(Math.sin(w*Math.PI/180)),P=x?l.normalizedLength(l.splitFontString(x).size):0;"number"!=typeof j&&(j=4),w<0&&(w+=360);var H=this._getMaxLabelSize();if(H=H&&H.majLabelW,this.vertical){switch(o={y:e.height-i.b},n={y:i.t},m={y:(e.height-i.b+i.t)/2},h=G*L+(H||0)*D+j+Math.max(N.length>0?N.length:0,T.length>0?T.length:0)+P+C,u={x:0,y:-1},p={x:0,y:0},c={x:1,y:0},y={x:j,y:0},w){case 0:v="end",p.y=.4*G;break;case 90:v="middle",p.x=-G;break;case 180:v="start",p.y=.4*-G;break;case 270:v="middle";break;default:w<f?(v="end",p.y=.4*G):w<90?(v="end",p.y=.4*G):w<180-f?v="start":w<180+f?(v="start",p.y=.4*-G):w<270?(v="start",p.x=k?0:.4*G):w<360-f?(v="end",p.x=k?0:.4*G):(v="end",p.y=.4*G)}if(k)o.x=n.x="center"===b?e.width/2:i.l,_=A&&"away"==A?90:270,m.x=i.l-h+(270==_?P:0),c.x=-1,y.x=-y.x;else switch(o.x=n.x=e.width-i.r,_=A&&"axis"==A?90:270,m.x=e.width-i.r+h-(270==_?0:P),v){case"start":v="end";break;case"end":v="start";break;case"middle":p.x+=G}}else{switch(o={x:i.l},n={x:e.width-i.r},m={x:(e.width-i.r+i.l)/2},h=G*D+(H||0)*L+j+Math.max(N.length>0?N.length:0,T.length>0?T.length:0)+P+C,u={x:r?-1:1,y:0},p={x:0,y:0},c={x:0,y:1},y={x:0,y:j},w){case 0:v="middle",p.y=G;break;case 90:v="start",p.x=.4*-G;break;case 180:v="middle";break;case 270:v="end",p.x=.4*G;break;default:w<90-f?(v="start",p.y=k?G:0):w<90+f?(v="start",p.x=.4*-G):w<180?(v="start",p.y=k?0:-G):w<270-f?(v="end",p.y=k?0:-G):w<270+f?(v="end",p.y=k?.4*G:0):(v="end",p.y=k?G:0)}if(k)o.y=n.y="center"===b?e.height/2:e.height-i.b,_=A&&"axis"==A?180:0,m.y=e.height-i.b+h-(_?P:0);else switch(o.y=n.y=i.t,_=A&&"away"==A?180:0,m.y=i.t-h+(_?0:P),c.y=-1,y.y=-y.y,v){case"start":v="end";break;case"end":v="start";break;case"middle":p.y-=G}}this.cleanGroup();var q=this.group,R=this.scaler,Q=this.ticks,B=d.getTransformerFromModel(this.scaler),O=g.title&&_||w||!this.opt.htmlLabels||a("ie")||a("opera")?"gfx":"html",K=c.x*N.length,U=c.y*N.length,V=this._skipInterval;if(q.createLine({x1:o.x,y1:o.y,x2:n.x,y2:n.y}).setStroke(z),g.title){var W=s.createText[O](this.chart,q,m.x,m.y,"middle",g.title,x,E);"html"==O?this.htmlElements.push(W):W.setTransform(l.matrix.rotategAt(_,m.x,m.y))}if(null==Q)return this.dirty=!1,this;var $=Q.major.length>0?(Q.major[0].value-this._majorStart)/R.major.tick:0,J=this.opt.majorLabels;return t.forEach(Q.major,function(e,t){var a,i=B(e.value),d=(r?n.x:o.x)+u.x*i,s=o.y+u.y*i;if(t+=$,this.createLine(q,{x1:d,y1:s,x2:d+K,y2:s+U}).setStroke(N),e.label&&(!V||(t-(1+V))%(1+V)==0)){var m=g.maxLabelCharCount?this.getTextWithLimitCharCount(e.label,F,g.maxLabelCharCount):{text:e.label,truncated:!1};m=g.maxLabelSize?this.getTextWithLimitLength(m.text,F,g.maxLabelSize,m.truncated):m,a=this.createText(O,q,d+(N.length>0?K:0)+y.x+(w?0:p.x),s+(N.length>0?U:0)+y.y+(w?0:p.y),v,m.text,F,I),m.truncated&&this.chart.formatTruncatedLabel(a,e.label,O),m.truncated&&this.labelTooltip(a,this.chart,e.label,m.text,F,O),"html"==O?this.htmlElements.push(a):w&&a.setTransform([{dx:p.x,dy:p.y},l.matrix.rotategAt(w,d+(N.length>0?K:0)+y.x,s+(N.length>0?U:0)+y.y)])}},this),K=c.x*T.length,U=c.y*T.length,J=this.opt.minorLabels&&R.minMinorStep<=R.minor.tick*R.bounds.scale,t.forEach(Q.minor,function(e){var t,a=B(e.value),i=(r?n.x:o.x)+u.x*a,d=o.y+u.y*a;if(this.createLine(q,{x1:i,y1:d,x2:i+K,y2:d+U}).setStroke(T),J&&e.label){var s=g.maxLabelCharCount?this.getTextWithLimitCharCount(e.label,F,g.maxLabelCharCount):{text:e.label,truncated:!1};s=g.maxLabelSize?this.getTextWithLimitLength(s.text,F,g.maxLabelSize,s.truncated):s,t=this.createText(O,q,i+(T.length>0?K:0)+y.x+(w?0:p.x),d+(T.length>0?U:0)+y.y+(w?0:p.y),v,s.text,F,I),s.truncated&&this.chart.formatTruncatedLabel(t,e.label,O),s.truncated&&this.labelTooltip(t,this.chart,e.label,s.text,F,O),"html"==O?this.htmlElements.push(t):w&&t.setTransform([{dx:p.x,dy:p.y},l.matrix.rotategAt(w,i+(T.length>0?K:0)+y.x,d+(T.length>0?U:0)+y.y)])}},this),K=c.x*S.length,U=c.y*S.length,t.forEach(Q.micro,function(e){var t=B(e.value),a=o.x+u.x*t,i=o.y+u.y*t;this.createLine(q,{x1:a,y1:i,x2:a+K,y2:i+U}).setStroke(S)},this),this.dirty=!1,this},labelTooltip:function(t,a,i,n,d,s){var m=["dijit/Tooltip"],h={type:"rect"},u=["above","below"],f=l._base._getTextBox(n,{font:d}).w||0,c=d?l.normalizedLength(l.splitFontString(d).size):0;if("html"==s)e.mixin(h,o.position(t.firstChild,!0)),h.width=Math.ceil(f),h.height=Math.ceil(c),this._events.push({shape:dojo,handle:r.connect(t.firstChild,"onmouseover",this,function(e){require(m,function(e){e.show(i,h,u)})})}),this._events.push({shape:dojo,handle:r.connect(t.firstChild,"onmouseout",this,function(e){require(m,function(e){e.hide(h)})})});else{var y=t.getShape(),p=a.getCoords();h=e.mixin(h,{x:y.x-f/2,y:y.y}),h.x+=p.x,h.y+=p.y,h.x=Math.round(h.x),h.y=Math.round(h.y),h.width=Math.ceil(f),h.height=Math.ceil(c),this._events.push({shape:t,handle:t.connect("onmouseenter",this,function(e){require(m,function(e){e.show(i,h,u)})})}),this._events.push({shape:t,handle:t.connect("onmouseleave",this,function(e){require(m,function(e){e.hide(h)})})})}},_isRtl:function(){return!1}});return a("dojo-bidi")?i("dojox.charting.axis2d.Default",[c,u]):c});//# sourceMappingURL=Default.js.map