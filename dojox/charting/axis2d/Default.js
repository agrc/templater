//>>built
define("dojox/charting/axis2d/Default",["dojo/_base/lang","dojo/_base/array","dojo/sniff","dojo/_base/declare","dojo/_base/connect","dojo/dom-geometry","./Invisible","../scaler/linear","./common","dojox/gfx","dojox/lang/utils","dojox/lang/functional","dojo/has!dojo-bidi?../bidi/axis2d/Default"],function(e,t,a,i,r,d,o,n,l,s,m,u,h){var f=45,y=i(a("dojo-bidi")?"dojox.charting.axis2d.NonBidiDefault":"dojox.charting.axis2d.Default",o,{defaultParams:{vertical:!1,fixUpper:"none",fixLower:"none",natural:!1,leftBottom:!0,includeZero:!1,fixed:!0,majorLabels:!0,minorTicks:!0,minorLabels:!0,microTicks:!1,rotation:0,htmlLabels:!0,enableCache:!1,dropLabels:!0,labelSizeChange:!1,position:"leftOrBottom"},optionalParams:{min:0,max:1,from:0,to:1,majorTickStep:4,minorTickStep:2,microTickStep:1,labels:[],labelFunc:null,maxLabelSize:0,maxLabelCharCount:0,trailingSymbol:null,stroke:{},majorTick:{},minorTick:{},microTick:{},tick:{},font:"",fontColor:"",title:"",titleGap:0,titleFont:"",titleFontColor:"",titleOrientation:""},constructor:function(t,a){this.opt=e.clone(this.defaultParams),m.updateWithObject(this.opt,a),m.updateWithPattern(this.opt,a,this.optionalParams),this.opt.enableCache&&(this._textFreePool=[],this._lineFreePool=[],this._textUsePool=[],this._lineUsePool=[]),this._invalidMaxLabelSize=!0,a&&"position"in a||(this.opt.position=this.opt.leftBottom?"leftOrBottom":"rightOrTop"),this.renderingOptions={"shape-rendering":"crispEdges"}},setWindow:function(e,t){return e!=this.scale&&(this._invalidMaxLabelSize=!0),this.inherited(arguments)},_groupLabelWidth:function(t,a,i){if(!t.length)return 0;t.length>50&&(t.length=50),e.isObject(t[0])&&(t=u.map(t,function(e){return e.text})),i&&(t=u.map(t,function(t){return 0==e.trim(t).length?"":t.substring(0,i)+this.trailingSymbol},this));var r=t.join("<br>");return s._base._getTextBox(r,{font:a}).w||0},_getMaxLabelSize:function(a,i,r,d,o,l){if(null==this._maxLabelSize&&6==arguments.length){var s=this.opt;this.scaler.minMinorStep=this._prevMinMinorStep=0;var m=e.clone(s);delete m.to,delete m.from;var u=n.buildScaler(a,i,r,m,s.to-s.from);u.minMinorStep=0,this._majorStart=u.major.start;var h=n.buildTicks(u,s);if(l&&h){var f=0,y=0,c=function(e){e.label&&this.push(e.label)},v=[];this.opt.majorLabels&&(t.forEach(h.major,c,v),f=this._groupLabelWidth(v,o,m.maxLabelCharCount),m.maxLabelSize&&(f=Math.min(m.maxLabelSize,f))),v=[],this.opt.dropLabels&&this.opt.minorLabels&&(t.forEach(h.minor,c,v),y=this._groupLabelWidth(v,o,m.maxLabelCharCount),m.maxLabelSize&&(y=Math.min(m.maxLabelSize,y))),this._maxLabelSize={majLabelW:f,minLabelW:y,majLabelH:l,minLabelH:l}}else this._maxLabelSize=null}return this._maxLabelSize},calculate:function(e,t,a){if(this.inherited(arguments),this.scaler.minMinorStep=this._prevMinMinorStep,(this._invalidMaxLabelSize||a!=this._oldSpan)&&e!=1/0&&t!=-(1/0)){this._invalidMaxLabelSize=!1,this.opt.labelSizeChange&&(this._maxLabelSize=null),this._oldSpan=a;var i=this.opt,r=this.chart.theme.axis,d=i.rotation%360,o=this.chart.theme.axis.tick.labelGap,l=i.font||r.majorTick&&r.majorTick.font||r.tick&&r.tick.font,m=l?s.normalizedLength(s.splitFontString(l).size):0,u=this._getMaxLabelSize(e,t,a,d,l,m);if("number"!=typeof o&&(o=4),u&&i.dropLabels){var h,f,y=Math.abs(Math.cos(d*Math.PI/180)),c=Math.abs(Math.sin(d*Math.PI/180));switch(0>d&&(d+=360),d){case 0:case 180:this.vertical?h=f=m:(h=u.majLabelW,f=u.minLabelW);break;case 90:case 270:this.vertical?(h=u.majLabelW,f=u.minLabelW):h=f=m;break;default:h=this.vertical?Math.min(u.majLabelW,m/y):Math.min(u.majLabelW,m/c);var v=Math.sqrt(u.minLabelW*u.minLabelW+m*m),M=this.vertical?m*y+u.minLabelW*c:u.minLabelW*y+m*c;f=Math.min(v,M)}this.scaler.minMinorStep=this._prevMinMinorStep=Math.max(h,f)+o;var g=this.scaler.minMinorStep<=this.scaler.minor.tick*this.scaler.bounds.scale;g?this._skipInterval=0:this._skipInterval=Math.floor((h+o)/(this.scaler.major.tick*this.scaler.bounds.scale))}else this._skipInterval=0}return this.ticks=n.buildTicks(this.scaler,this.opt),this},getOffsets:function(){var e=this.scaler,t={l:0,r:0,t:0,b:0};if(!e)return t;var a=this.opt,i=this.chart.theme.axis,r=this.chart.theme.axis.tick.labelGap,d=a.titleFont||i.title&&i.title.font,o=0==a.titleGap?0:a.titleGap||i.title&&i.title.gap,n=this.chart.theme.getTick("major",a),l=this.chart.theme.getTick("minor",a),m=d?s.normalizedLength(s.splitFontString(d).size):0,u=a.rotation%360,h=a.position,y="rightOrTop"!==h,c=Math.abs(Math.cos(u*Math.PI/180)),v=Math.abs(Math.sin(u*Math.PI/180));this.trailingSymbol=void 0===a.trailingSymbol||null===a.trailingSymbol?this.trailingSymbol:a.trailingSymbol,"number"!=typeof r&&(r=4),0>u&&(u+=360);var M=this._getMaxLabelSize();if(M){var g,p=Math.ceil(Math.max(M.majLabelW,M.minLabelW))+1,b=Math.ceil(Math.max(M.majLabelH,M.minLabelH))+1;if(this.vertical){switch(g=y?"l":"r",u){case 0:case 180:t[g]="center"===h?0:p,t.t=t.b=b/2;break;case 90:case 270:t[g]=b,t.t=t.b=p/2;break;default:f>=u||u>180&&180+f>=u?(t[g]=b*v/2+p*c,t[y?"t":"b"]=b*c/2+p*v,t[y?"b":"t"]=b*c/2):u>360-f||180>u&&u>180-f?(t[g]=b*v/2+p*c,t[y?"b":"t"]=b*c/2+p*v,t[y?"t":"b"]=b*c/2):90>u||u>180&&270>u?(t[g]=b*v+p*c,t[y?"t":"b"]=b*c+p*v):(t[g]=b*v+p*c,t[y?"b":"t"]=b*c+p*v)}"center"===h?t[g]=0:t[g]+=r+Math.max(n.length>0?n.length:0,l.length>0?l.length:0)+(a.title?m+o:0)}else{switch(g=y?"b":"t",u){case 0:case 180:t[g]="center"===h?0:b,t.l=t.r=p/2;break;case 90:case 270:t[g]=p,t.l=t.r=b/2;break;default:u>=90-f&&90>=u||u>=270-f&&270>=u?(t[g]=b*c/2+p*v,t[y?"r":"l"]=b*v/2+p*c,t[y?"l":"r"]=b*v/2):u>=90&&90+f>=u||u>=270&&270+f>=u?(t[g]=b*c/2+p*v,t[y?"l":"r"]=b*v/2+p*c,t[y?"r":"l"]=b*v/2):f>u||u>180&&180+f>u?(t[g]=b*c+p*v,t[y?"r":"l"]=b*v+p*c):(t[g]=b*c+p*v,t[y?"l":"r"]=b*v+p*c)}"center"===h?t[g]=0:t[g]+=r+Math.max(n.length>0?n.length:0,l.length>0?l.length:0)+(a.title?m+o:0)}}return t},cleanGroup:function(e){this.opt.enableCache&&this.group&&(this._lineFreePool=this._lineFreePool.concat(this._lineUsePool),this._lineUsePool=[],this._textFreePool=this._textFreePool.concat(this._textUsePool),this._textUsePool=[]),this.inherited(arguments)},createText:function(e,t,a,i,r,d,o,n,s){if(!this.opt.enableCache||"html"==e)return l.createText[e](this.chart,t,a,i,r,d,o,n,s);var m;return this._textFreePool.length>0?(m=this._textFreePool.pop(),m.setShape({x:a,y:i,text:d,align:r}),t.add(m)):m=l.createText[e](this.chart,t,a,i,r,d,o,n),this._textUsePool.push(m),m},createLine:function(e,t){var a;return this.opt.enableCache&&this._lineFreePool.length>0?(a=this._lineFreePool.pop(),a.setShape(t),e.add(a)):a=e.createLine(t),this.opt.enableCache&&this._lineUsePool.push(a),a},render:function(e,i){var r=this._isRtl();if(!this.dirty||!this.scaler)return this;var d,o,m,u,h,y,c,v,M,g=this.opt,p=this.chart.theme.axis,b=g.position,k="rightOrTop"!==b,w=g.rotation%360,F=0,I=this.chart.theme.axis.tick.labelGap,j=g.font||p.majorTick&&p.majorTick.font||p.tick&&p.tick.font,E=g.titleFont||p.title&&p.title.font,_=g.fontColor||p.majorTick&&p.majorTick.fontColor||p.tick&&p.tick.fontColor||"black",x=g.titleFontColor||p.title&&p.title.fontColor||"black",G=0==g.titleGap?0:g.titleGap||p.title&&p.title.gap||15,T=g.titleOrientation||p.title&&p.title.orientation||"axis",S=this.chart.theme.getTick("major",g),z=this.chart.theme.getTick("minor",g),A=this.chart.theme.getTick("micro",g),C="stroke"in g?g.stroke:p.stroke,D=j?s.normalizedLength(s.splitFontString(j).size):0,N=Math.abs(Math.cos(w*Math.PI/180)),H=Math.abs(Math.sin(w*Math.PI/180)),L=E?s.normalizedLength(s.splitFontString(E).size):0;"number"!=typeof I&&(I=4),0>w&&(w+=360);var Q=this._getMaxLabelSize();if(Q=Q&&Q.majLabelW,this.vertical){switch(d={y:e.height-i.b},o={y:i.t},m={y:(e.height-i.b+i.t)/2},u=D*H+(Q||0)*N+I+Math.max(S.length>0?S.length:0,z.length>0?z.length:0)+L+G,h={x:0,y:-1},v={x:0,y:0},y={x:1,y:0},c={x:I,y:0},w){case 0:M="end",v.y=.4*D;break;case 90:M="middle",v.x=-D;break;case 180:M="start",v.y=.4*-D;break;case 270:M="middle";break;default:f>w?(M="end",v.y=.4*D):90>w?(M="end",v.y=.4*D):180-f>w?M="start":180+f>w?(M="start",v.y=.4*-D):270>w?(M="start",v.x=k?0:.4*D):360-f>w?(M="end",v.x=k?0:.4*D):(M="end",v.y=.4*D)}if(k)d.x=o.x="center"===b?e.width/2:i.l,F=T&&"away"==T?90:270,m.x=i.l-u+(270==F?L:0),y.x=-1,c.x=-c.x;else switch(d.x=o.x=e.width-i.r,F=T&&"axis"==T?90:270,m.x=e.width-i.r+u-(270==F?0:L),M){case"start":M="end";break;case"end":M="start";break;case"middle":v.x+=D}}else{switch(d={x:i.l},o={x:e.width-i.r},m={x:(e.width-i.r+i.l)/2},u=D*N+(Q||0)*H+I+Math.max(S.length>0?S.length:0,z.length>0?z.length:0)+L+G,h={x:r?-1:1,y:0},v={x:0,y:0},y={x:0,y:1},c={x:0,y:I},w){case 0:M="middle",v.y=D;break;case 90:M="start",v.x=.4*-D;break;case 180:M="middle";break;case 270:M="end",v.x=.4*D;break;default:90-f>w?(M="start",v.y=k?D:0):90+f>w?(M="start",v.x=.4*-D):180>w?(M="start",v.y=k?0:-D):270-f>w?(M="end",v.y=k?0:-D):270+f>w?(M="end",v.y=k?.4*D:0):(M="end",v.y=k?D:0)}if(k)d.y=o.y="center"===b?e.height/2:e.height-i.b,F=T&&"axis"==T?180:0,m.y=e.height-i.b+u-(F?L:0);else switch(d.y=o.y=i.t,F=T&&"away"==T?180:0,m.y=i.t-u+(F?0:L),y.y=-1,c.y=-c.y,M){case"start":M="end";break;case"end":M="start";break;case"middle":v.y-=D}}this.cleanGroup();var q=this.group,P=this.scaler,B=this.ticks,K=n.getTransformerFromModel(this.scaler),O=g.title&&F||w||!this.opt.htmlLabels||a("ie")||a("opera")?"gfx":"html",R=y.x*S.length,W=y.y*S.length,U=this._skipInterval;if(q.createLine({x1:d.x,y1:d.y,x2:o.x,y2:o.y}).setStroke(C),g.title){var V=l.createText[O](this.chart,q,m.x,m.y,"middle",g.title,E,x);"html"==O?this.htmlElements.push(V):V.setTransform(s.matrix.rotategAt(F,m.x,m.y))}if(null==B)return this.dirty=!1,this;var J=B.major.length>0?(B.major[0].value-this._majorStart)/P.major.tick:0,$=this.opt.majorLabels;return t.forEach(B.major,function(e,t){var a,i=K(e.value),n=(r?o.x:d.x)+h.x*i,l=d.y+h.y*i;if(t+=J,this.createLine(q,{x1:n,y1:l,x2:n+R,y2:l+W}).setStroke(S),e.label&&(!U||(t-(1+U))%(1+U)==0)){var m=g.maxLabelCharCount?this.getTextWithLimitCharCount(e.label,j,g.maxLabelCharCount):{text:e.label,truncated:!1};m=g.maxLabelSize?this.getTextWithLimitLength(m.text,j,g.maxLabelSize,m.truncated):m,a=this.createText(O,q,n+(S.length>0?R:0)+c.x+(w?0:v.x),l+(S.length>0?W:0)+c.y+(w?0:v.y),M,m.text,j,_),m.truncated&&this.chart.formatTruncatedLabel(a,e.label,O),m.truncated&&this.labelTooltip(a,this.chart,e.label,m.text,j,O),"html"==O?this.htmlElements.push(a):w&&a.setTransform([{dx:v.x,dy:v.y},s.matrix.rotategAt(w,n+(S.length>0?R:0)+c.x,l+(S.length>0?W:0)+c.y)])}},this),R=y.x*z.length,W=y.y*z.length,$=this.opt.minorLabels&&P.minMinorStep<=P.minor.tick*P.bounds.scale,t.forEach(B.minor,function(e){var t,a=K(e.value),i=(r?o.x:d.x)+h.x*a,n=d.y+h.y*a;if(this.createLine(q,{x1:i,y1:n,x2:i+R,y2:n+W}).setStroke(z),$&&e.label){var l=g.maxLabelCharCount?this.getTextWithLimitCharCount(e.label,j,g.maxLabelCharCount):{text:e.label,truncated:!1};l=g.maxLabelSize?this.getTextWithLimitLength(l.text,j,g.maxLabelSize,l.truncated):l,t=this.createText(O,q,i+(z.length>0?R:0)+c.x+(w?0:v.x),n+(z.length>0?W:0)+c.y+(w?0:v.y),M,l.text,j,_),l.truncated&&this.chart.formatTruncatedLabel(t,e.label,O),l.truncated&&this.labelTooltip(t,this.chart,e.label,l.text,j,O),"html"==O?this.htmlElements.push(t):w&&t.setTransform([{dx:v.x,dy:v.y},s.matrix.rotategAt(w,i+(z.length>0?R:0)+c.x,n+(z.length>0?W:0)+c.y)])}},this),R=y.x*A.length,W=y.y*A.length,t.forEach(B.micro,function(e){var t=K(e.value),a=d.x+h.x*t,i=d.y+h.y*t;this.createLine(q,{x1:a,y1:i,x2:a+R,y2:i+W}).setStroke(A)},this),this.dirty=!1,this},labelTooltip:function(t,a,i,o,n,l){var m=["dijit/Tooltip"],u={type:"rect"},h=["above","below"],f=s._base._getTextBox(o,{font:n}).w||0,y=n?s.normalizedLength(s.splitFontString(n).size):0;if("html"==l)e.mixin(u,d.position(t.firstChild,!0)),u.width=Math.ceil(f),u.height=Math.ceil(y),this._events.push({shape:dojo,handle:r.connect(t.firstChild,"onmouseover",this,function(e){require(m,function(e){e.show(i,u,h)})})}),this._events.push({shape:dojo,handle:r.connect(t.firstChild,"onmouseout",this,function(e){require(m,function(e){e.hide(u)})})});else{var c=t.getShape(),v=a.getCoords();u=e.mixin(u,{x:c.x-f/2,y:c.y}),u.x+=v.x,u.y+=v.y,u.x=Math.round(u.x),u.y=Math.round(u.y),u.width=Math.ceil(f),u.height=Math.ceil(y),this._events.push({shape:t,handle:t.connect("onmouseenter",this,function(e){require(m,function(e){e.show(i,u,h)})})}),this._events.push({shape:t,handle:t.connect("onmouseleave",this,function(e){require(m,function(e){e.hide(u)})})})}},_isRtl:function(){return!1}});return a("dojo-bidi")?i("dojox.charting.axis2d.Default",[y,h]):y});//# sourceMappingURL=Default.js.map