//>>built
define("dojox/charting/action2d/_IndicatorElement",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","../plot2d/Indicator","dojo/has","../plot2d/common","../axis2d/common","dojox/gfx"],function(e,t,a,i,r){var o=function(e,t,a){var i,r=e?{x:t[0],y:a[0][0]}:{x:a[0][0],y:t[0]};return t.length>1&&(i=e?{x:t[1],y:a[1][0]}:{x:a[1][0],y:t[1]}),[r,i]},d=a("dojox.charting.action2d._IndicatorElement",i,{constructor:function(e,t){t||(t={}),this.inter=t.inter},_updateVisibility:function(e,t,a){var i="x"==a?this._hAxis:this._vAxis,r=i.getWindowScale();this.chart.setAxisWindow(i.name,r,i.getWindowOffset()+(e[a]-t[a])/r),this._noDirty=!0,this.chart.render(),this._noDirty=!1,this._initTrack()},_trackMove:function(){this._updateIndicator(this.pageCoord),this._tracker=setTimeout(e.hitch(this,this._trackMove),100)},_initTrack:function(){this._tracker||(this._tracker=setTimeout(e.hitch(this,this._trackMove),500))},stopTrack:function(){this._tracker&&(clearTimeout(this._tracker),this._tracker=null)},render:function(){if(this.isDirty()){var t=this.inter,a=t.plot,i=t.opt.vertical;this.opt.offset=t.opt.offset||(i?{x:0,y:5}:{x:5,y:0}),t.opt.labelFunc&&(this.opt.labelFunc=function(e,a,r,d,n){var l=o(i,a,r);return t.opt.labelFunc(l[0],l[1],d,n)}),t.opt.fillFunc&&(this.opt.fillFunc=function(e,a,r){var d=o(i,a,r);return t.opt.fillFunc(d[0],d[1])}),this.opt=e.delegate(t.opt,this.opt),this.pageCoord?(this.opt.values=[],this.opt.labels=this.secondCoord?"trend":"markers"):(this.opt.values=null,this.inter.onChange({})),this.hAxis=a.hAxis,this.vAxis=a.vAxis,this.inherited(arguments)}},_updateIndicator:function(){var e=this._updateCoordinates(this.pageCoord,this.secondCoord);if(!(e.length>1))return void this.inter.onChange({});var a=this.opt.vertical;this._data=[],this.opt.values=[],t.forEach(e,function(e){e&&(this.opt.values.push(a?e.x:e.y),this._data.push([a?e.y:e.x]))},this),this.inherited(arguments)},_renderText:function(e,t,a,i,r,d,n,l){this.inter.opt.labels&&this.inherited(arguments);var s=o(this.opt.vertical,n,l);this.inter.onChange({start:s[0],end:s[1],label:t})},_updateCoordinates:function(e,t){r("dojo-bidi")&&this._checkXCoords(e,t);var a=this.inter,i=a.plot,o=a.opt.vertical,d=this.chart.getAxis(i.hAxis),n=this.chart.getAxis(i.vAxis),l=d.name,s=n.name,m=d.getScaler().bounds,f=n.getScaler().bounds,u=o?"x":"y",h=o?l:s,c=o?m:f;if(t){var y;o?e.x>t.x&&(y=t,t=e,e=y):e.y>t.y&&(y=t,t=e,e=y)}var v,M=i.toData(e);t&&(v=i.toData(t));var g={};g[l]=m.from,g[s]=f.from;var p=i.toPage(g);g[l]=m.to,g[s]=f.to;var b=i.toPage(g);if(M[h]<c.from){if(!v&&a.opt.autoScroll&&!a.opt.mouseOver)return this._updateVisibility(e,p,u),[];if(a.opt.mouseOver)return[];e[u]=p[u],M=i.toData(e)}else if(M[h]>c.to){if(!v&&a.opt.autoScroll&&!a.opt.mouseOver)return this._updateVisibility(e,b,u),[];if(a.opt.mouseOver)return[];e[u]=b[u],M=i.toData(e)}var k,w=this._snapData(M,u,o);return null==w.y?[]:(t&&(v[h]<c.from?(t[u]=p[u],v=i.toData(t)):v[h]>c.to&&(t[u]=b[u],v=i.toData(t)),k=this._snapData(v,u,o),null==k.y&&(k=null)),[w,k])},_snapData:function(e,t,a){var i,r,o=this.chart.getSeries(this.inter.opt.series).data,d=o.length;for(i=0;i<d;++i)if(null==(r=o[i]));else if("number"==typeof r){if(i+1>e[t])break}else if(r[t]>e[t])break;var n,l,s,m;if("number"==typeof r?(n=i+1,l=r,i>0&&(s=i,m=o[i-1])):(n=r.x,l=r.y,i>0&&(s=o[i-1].x,m=o[i-1].y)),i>0){var f=a?(n+s)/2:(l+m)/2;e[t]<=f&&(n=s,l=m)}return{x:n,y:l}},cleanGroup:function(e){return this.inherited(arguments),this.group.moveToFront(),this},isDirty:function(){return!this._noDirty&&(this.dirty||this.inter.plot.isDirty())}});return r("dojo-bidi")&&d.extend({_checkXCoords:function(e,t){function a(e,t){var a=t.x-i,r=e.chart.offsets.l-e.chart.offsets.r;return e.chart.dim.width+r-a+i}if(this.chart.isRightToLeft()&&this.isDirty()){var i=this.chart.node.offsetLeft;e&&(e.x=a(this,e)),t&&(t.x=a(this,t))}}}),d});//# sourceMappingURL=_IndicatorElement.js.map