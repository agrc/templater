//>>built
define("dojox/charting/action2d/_IndicatorElement",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","../plot2d/Indicator","dojo/has","../plot2d/common","../axis2d/common","dojox/gfx"],function(e,t,a,i,r){var o=function(e,t,a){var i,r=e?{x:t[0],y:a[0][0]}:{x:a[0][0],y:t[0]};return t.length>1&&(i=e?{x:t[1],y:a[1][0]}:{x:a[1][0],y:t[1]}),[r,i]},d=a("dojox.charting.action2d._IndicatorElement",i,{constructor:function(e,t){t||(t={}),this.inter=t.inter},_updateVisibility:function(e,t,a){var i="x"==a?this._hAxis:this._vAxis,r=i.getWindowScale();this.chart.setAxisWindow(i.name,r,i.getWindowOffset()+(e[a]-t[a])/r),this._noDirty=!0,this.chart.render(),this._noDirty=!1,this._initTrack()},_trackMove:function(){this._updateIndicator(this.pageCoord),this._tracker=setTimeout(e.hitch(this,this._trackMove),100)},_initTrack:function(){this._tracker||(this._tracker=setTimeout(e.hitch(this,this._trackMove),500))},stopTrack:function(){this._tracker&&(clearTimeout(this._tracker),this._tracker=null)},render:function(){if(this.isDirty()){var t=this.inter,a=t.plot,i=t.opt.vertical;this.opt.offset=t.opt.offset||(i?{x:0,y:5}:{x:5,y:0}),t.opt.labelFunc&&(this.opt.labelFunc=function(e,a,r,d,n){var l=o(i,a,r);return t.opt.labelFunc(l[0],l[1],d,n)}),t.opt.fillFunc&&(this.opt.fillFunc=function(e,a,r){var d=o(i,a,r);return t.opt.fillFunc(d[0],d[1])}),this.opt=e.delegate(t.opt,this.opt),this.pageCoord?(this.opt.values=[],this.opt.labels=this.secondCoord?"trend":"markers"):(this.opt.values=null,this.inter.onChange({})),this.hAxis=a.hAxis,this.vAxis=a.vAxis,this.inherited(arguments)}},_updateIndicator:function(){var e=this._updateCoordinates(this.pageCoord,this.secondCoord);if(!(e.length>1))return void this.inter.onChange({});var a=this.opt.vertical;this._data=[],this.opt.values=[],t.forEach(e,function(e){e&&(this.opt.values.push(a?e.x:e.y),this._data.push([a?e.y:e.x]))},this),this.inherited(arguments)},_renderText:function(e,t,a,i,r,d,n,l){this.inter.opt.labels&&this.inherited(arguments);var s=o(this.opt.vertical,n,l);this.inter.onChange({start:s[0],end:s[1],label:t})},_updateCoordinates:function(e,t){r("dojo-bidi")&&this._checkXCoords(e,t);var a=this.inter,i=a.plot,o=a.opt.vertical,d=this.chart.getAxis(i.hAxis),n=this.chart.getAxis(i.vAxis),l=d.name,s=n.name,m=d.getScaler().bounds,u=n.getScaler().bounds,f=o?"x":"y",h=o?l:s,y=o?m:u;if(t){var c;o?e.x>t.x&&(c=t,t=e,e=c):e.y>t.y&&(c=t,t=e,e=c)}var v,M=i.toData(e);t&&(v=i.toData(t));var p={};p[l]=m.from,p[s]=u.from;var g=i.toPage(p);p[l]=m.to,p[s]=u.to;var b=i.toPage(p);if(M[h]<y.from){if(!v&&a.opt.autoScroll&&!a.opt.mouseOver)return this._updateVisibility(e,g,f),[];if(a.opt.mouseOver)return[];e[f]=g[f],M=i.toData(e)}else if(M[h]>y.to){if(!v&&a.opt.autoScroll&&!a.opt.mouseOver)return this._updateVisibility(e,b,f),[];if(a.opt.mouseOver)return[];e[f]=b[f],M=i.toData(e)}var w,k=this._snapData(M,f,o);return null==k.y?[]:(t&&(v[h]<y.from?(t[f]=g[f],v=i.toData(t)):v[h]>y.to&&(t[f]=b[f],v=i.toData(t)),w=this._snapData(v,f,o),null==w.y&&(w=null)),[k,w])},_snapData:function(e,t,a){var i,o,d=this.chart.getSeries(this.inter.opt.series).data,n=d.length;for(i=0;n>i;++i)if(o=d[i],null==o);else if("number"==typeof o){if(i+1>e[t])break}else if(o[t]>e[t])break;r("dojo-bidi")&&(i=n-i,o=d[i],e[t]>1&&(e[t]=n-e[t]+1,e[t]>n&&(e[t]=n-.1)));var l,s,m,u;if("number"==typeof o?(l=i+1,s=o,i>0&&(m=i,u=d[i-1])):(l=o.x,s=o.y,i>0&&(m=d[i-1].x,u=d[i-1].y)),i>0){var f=a?(l+m)/2:(s+u)/2;e[t]<=f&&(l=m,s=u)}return{x:l,y:s}},cleanGroup:function(e){return this.inherited(arguments),this.group.moveToFront(),this},isDirty:function(){return!this._noDirty&&(this.dirty||this.inter.plot.isDirty())}});return r("dojo-bidi")&&d.extend({_checkXCoords:function(e,t){this.chart.isRightToLeft()&&(e&&(e.x=this.chart.dim.width+(this.chart.offsets.l-this.chart.offsets.r)-e.x),t&&(t.x=this.chart.dim.width+(this.chart.offsets.l-this.chart.offsets.r)-t.x))}}),d});//# sourceMappingURL=_IndicatorElement.js.map