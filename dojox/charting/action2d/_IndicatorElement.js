//>>built
define("dojox/charting/action2d/_IndicatorElement",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","../plot2d/Indicator","dojo/has","../plot2d/common","../axis2d/common","dojox/gfx"],function(e,t,i,a,r){var n=function(e,t,i){var a,r=e?{x:t[0],y:i[0][0]}:{x:i[0][0],y:t[0]};return t.length>1&&(a=e?{x:t[1],y:i[1][0]}:{x:i[1][0],y:t[1]}),[r,a]},o=i("dojox.charting.action2d._IndicatorElement",a,{constructor:function(e,t){t||(t={}),this.inter=t.inter},_updateVisibility:function(e,t,i){var a="x"==i?this._hAxis:this._vAxis,r=a.getWindowScale();this.chart.setAxisWindow(a.name,r,a.getWindowOffset()+(e[i]-t[i])/r),this._noDirty=!0,this.chart.render(),this._noDirty=!1,this._initTrack()},_trackMove:function(){this._updateIndicator(this.pageCoord),this._tracker=setTimeout(e.hitch(this,this._trackMove),100)},_initTrack:function(){this._tracker||(this._tracker=setTimeout(e.hitch(this,this._trackMove),500))},stopTrack:function(){this._tracker&&(clearTimeout(this._tracker),this._tracker=null)},render:function(){if(this.isDirty()){var t=this.inter,i=t.plot,a=t.opt.vertical;this.opt.offset=t.opt.offset||(a?{x:0,y:5}:{x:5,y:0}),t.opt.labelFunc&&(this.opt.labelFunc=function(e,i,r,o,d){var s=n(a,i,r);return t.opt.labelFunc(s[0],s[1],o,d)}),t.opt.fillFunc&&(this.opt.fillFunc=function(e,i,r){var o=n(a,i,r);return t.opt.fillFunc(o[0],o[1])}),this.opt=e.delegate(t.opt,this.opt),this.pageCoord?(this.opt.values=[],this.opt.labels=this.secondCoord?"trend":"markers"):(this.opt.values=null,this.inter.onChange({})),this.hAxis=i.hAxis,this.vAxis=i.vAxis,this.inherited(arguments)}},_updateIndicator:function(){var e=this._updateCoordinates(this.pageCoord,this.secondCoord);if(!(e.length>1))return void this.inter.onChange({});var i=this.opt.vertical;this._data=[],this.opt.values=[],t.forEach(e,function(e){e&&(this.opt.values.push(i?e.x:e.y),this._data.push([i?e.y:e.x]))},this),this.inherited(arguments)},_renderText:function(e,t,i,a,r,o,d,s){this.inter.opt.labels&&this.inherited(arguments);var l=n(this.opt.vertical,d,s);this.inter.onChange({start:l[0],end:l[1],label:t})},_updateCoordinates:function(e,t){r("dojo-bidi")&&this._checkXCoords(e,t);var i=this.inter,a=i.plot,n=i.opt.vertical,o=this.chart.getAxis(a.hAxis),d=this.chart.getAxis(a.vAxis),s=o.name,l=d.name,u=o.getScaler().bounds,c=d.getScaler().bounds,f=n?"x":"y",m=n?s:l,h=n?u:c;if(t){var y;n?e.x>t.x&&(y=t,t=e,e=y):e.y>t.y&&(y=t,t=e,e=y)}var p,v=a.toData(e);t&&(p=a.toData(t));var g={};g[s]=u.from,g[l]=c.from;var b=a.toPage(g);g[s]=u.to,g[l]=c.to;var M=a.toPage(g);if(v[m]<h.from){if(!p&&i.opt.autoScroll&&!i.opt.mouseOver)return this._updateVisibility(e,b,f),[];if(i.opt.mouseOver)return[];e[f]=b[f],v=a.toData(e)}else if(v[m]>h.to){if(!p&&i.opt.autoScroll&&!i.opt.mouseOver)return this._updateVisibility(e,M,f),[];if(i.opt.mouseOver)return[];e[f]=M[f],v=a.toData(e)}var w,k=this._snapData(v,f,n);return null==k.y?[]:(t&&(p[m]<h.from?(t[f]=b[f],p=a.toData(t)):p[m]>h.to&&(t[f]=M[f],p=a.toData(t)),w=this._snapData(p,f,n),null==w.y&&(w=null)),[k,w])},_snapData:function(e,t,i){var a,n,o=this.chart.getSeries(this.inter.opt.series).data,d=o.length;for(a=0;d>a;++a)if(n=o[a],null==n);else if("number"==typeof n){if(a+1>e[t])break}else if(n[t]>e[t])break;r("dojo-bidi")&&(a=d-a,n=o[a],e[t]>1&&(e[t]=d-e[t]+1,e[t]>d&&(e[t]=d-.1)));var s,l,u,c;if("number"==typeof n?(s=a+1,l=n,a>0&&(u=a,c=o[a-1])):(s=n.x,l=n.y,a>0&&(u=o[a-1].x,c=o[a-1].y)),a>0){var f=i?(s+u)/2:(l+c)/2;e[t]<=f&&(s=u,l=c)}return{x:s,y:l}},cleanGroup:function(e){return this.inherited(arguments),this.group.moveToFront(),this},isDirty:function(){return!this._noDirty&&(this.dirty||this.inter.plot.isDirty())}});return r("dojo-bidi")&&o.extend({_checkXCoords:function(e,t){this.chart.isRightToLeft()&&(e&&(e.x=this.chart.dim.width+(this.chart.offsets.l-this.chart.offsets.r)-e.x),t&&(t.x=this.chart.dim.width+(this.chart.offsets.l-this.chart.offsets.r)-t.x))}}),o});//# sourceMappingURL=_IndicatorElement.js.map