//>>built
define("dojox/charting/action2d/_IndicatorElement",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","../plot2d/Indicator","dojo/has","../plot2d/common","../axis2d/common","dojox/gfx"],function(e,t,a,i,r){var o=function(e,t,a){var i,r=e?{x:t[0],y:a[0][0]}:{x:a[0][0],y:t[0]};return t.length>1&&(i=e?{x:t[1],y:a[1][0]}:{x:a[1][0],y:t[1]}),[r,i]},n=a("dojox.charting.action2d._IndicatorElement",i,{constructor:function(e,t){t||(t={}),this.inter=t.inter},_updateVisibility:function(e,t,a){var i="x"==a?this._hAxis:this._vAxis,r=i.getWindowScale();this.chart.setAxisWindow(i.name,r,i.getWindowOffset()+(e[a]-t[a])/r),this._noDirty=!0,this.chart.render(),this._noDirty=!1,this._initTrack()},_trackMove:function(){this._updateIndicator(this.pageCoord),this._tracker=setTimeout(e.hitch(this,this._trackMove),100)},_initTrack:function(){this._tracker||(this._tracker=setTimeout(e.hitch(this,this._trackMove),500))},stopTrack:function(){this._tracker&&(clearTimeout(this._tracker),this._tracker=null)},render:function(){if(this.isDirty()){var t=this.inter,a=t.plot,i=t.opt.vertical;this.opt.offset=t.opt.offset||(i?{x:0,y:5}:{x:5,y:0}),t.opt.labelFunc&&(this.opt.labelFunc=function(e,a,r,n,d){var s=o(i,a,r);return t.opt.labelFunc(s[0],s[1],n,d)}),t.opt.fillFunc&&(this.opt.fillFunc=function(e,a,r){var n=o(i,a,r);return t.opt.fillFunc(n[0],n[1])}),this.opt=e.delegate(t.opt,this.opt),this.pageCoord?(this.opt.values=[],this.opt.labels=this.secondCoord?"trend":"markers"):(this.opt.values=null,this.inter.onChange({})),this.hAxis=a.hAxis,this.vAxis=a.vAxis,this.inherited(arguments)}},_updateIndicator:function(){var e=this._updateCoordinates(this.pageCoord,this.secondCoord);if(!(e.length>1))return void this.inter.onChange({});var a=this.opt.vertical;this._data=[],this.opt.values=[],t.forEach(e,function(e){e&&(this.opt.values.push(a?e.x:e.y),this._data.push([a?e.y:e.x]))},this),this.inherited(arguments)},_renderText:function(e,t,a,i,r,n,d,s){this.inter.opt.labels&&this.inherited(arguments);var l=o(this.opt.vertical,d,s);this.inter.onChange({start:l[0],end:l[1],label:t})},_updateCoordinates:function(e,t){r("dojo-bidi")&&this._checkXCoords(e,t);var a=this.inter,i=a.plot,o=a.opt.vertical,n=this.chart.getAxis(i.hAxis),d=this.chart.getAxis(i.vAxis),s=n.name,l=d.name,m=n.getScaler().bounds,u=d.getScaler().bounds,h=o?"x":"y",f=o?s:l,c=o?m:u;if(t){var y;o?e.x>t.x&&(y=t,t=e,e=y):e.y>t.y&&(y=t,t=e,e=y)}var p,v=i.toData(e);t&&(p=i.toData(t));var g={};g[s]=m.from,g[l]=u.from;var M=i.toPage(g);g[s]=m.to,g[l]=u.to;var b=i.toPage(g);if(v[f]<c.from){if(!p&&a.opt.autoScroll&&!a.opt.mouseOver)return this._updateVisibility(e,M,h),[];if(a.opt.mouseOver)return[];e[h]=M[h],v=i.toData(e)}else if(v[f]>c.to){if(!p&&a.opt.autoScroll&&!a.opt.mouseOver)return this._updateVisibility(e,b,h),[];if(a.opt.mouseOver)return[];e[h]=b[h],v=i.toData(e)}var k,w=this._snapData(v,h,o);return null==w.y?[]:(t&&(p[f]<c.from?(t[h]=M[h],p=i.toData(t)):p[f]>c.to&&(t[h]=b[h],p=i.toData(t)),k=this._snapData(p,h,o),null==k.y&&(k=null)),[w,k])},_snapData:function(e,t,a){var i,o,n=this.chart.getSeries(this.inter.opt.series).data,d=n.length;for(i=0;d>i;++i)if(o=n[i],null==o);else if("number"==typeof o){if(i+1>e[t])break}else if(o[t]>e[t])break;r("dojo-bidi")&&(i=d-i,o=n[i],e[t]>1&&(e[t]=d-e[t]+1,e[t]>d&&(e[t]=d-.1)));var s,l,m,u;if("number"==typeof o?(s=i+1,l=o,i>0&&(m=i,u=n[i-1])):(s=o.x,l=o.y,i>0&&(m=n[i-1].x,u=n[i-1].y)),i>0){var h=a?(s+m)/2:(l+u)/2;e[t]<=h&&(s=m,l=u)}return{x:s,y:l}},cleanGroup:function(e){return this.inherited(arguments),this.group.moveToFront(),this},isDirty:function(){return!this._noDirty&&(this.dirty||this.inter.plot.isDirty())}});return r("dojo-bidi")&&n.extend({_checkXCoords:function(e,t){this.chart.isRightToLeft()&&(e&&(e.x=this.chart.dim.width+(this.chart.offsets.l-this.chart.offsets.r)-e.x),t&&(t.x=this.chart.dim.width+(this.chart.offsets.l-this.chart.offsets.r)-t.x))}}),n});//# sourceMappingURL=_IndicatorElement.js.map