//>>built
define("dojox/charting/action2d/TouchZoomAndPan",["dojo/_base/lang","dojo/_base/declare","dojo/_base/event","dojo/sniff","./ChartAction","../Element","dojo/touch","../plot2d/common","dojo/has!dojo-bidi?../bidi/action2d/ZoomAndPan"],function(e,t,a,i,r,o,d,n,l){var s=t(o,{constructor:function(e){},render:function(){this.isDirty()&&(this.cleanGroup(),this.group.createRect({width:this.chart.dim.width,height:this.chart.dim.height}).setFill("rgba(0,0,0,0)"))},clear:function(){return this.dirty=!0,this.chart.stack[0]!=this&&this.chart.movePlotToFront(this.name),this},getSeriesStats:function(){return e.delegate(n.defaultStats)},initializeScalers:function(){return this},isDirty:function(){return this.dirty}}),m=t(i("dojo-bidi")?"dojox.charting.action2d.NonBidiTouchZoomAndPan":"dojox.charting.action2d.TouchZoomAndPan",r,{defaultParams:{axis:"x",scaleFactor:1.2,maxScale:100,enableScroll:!0,enableZoom:!0},optionalParams:{},constructor:function(e,t,a){this._listeners=[{eventName:d.press,methodName:"onTouchStart"},{eventName:d.move,methodName:"onTouchMove"},{eventName:d.release,methodName:"onTouchEnd"}],a||(a={}),this.axis=a.axis?a.axis:"x",this.scaleFactor=a.scaleFactor?a.scaleFactor:1.2,this.maxScale=a.maxScale?a.maxScale:100,this.enableScroll=void 0!=a.enableScroll?a.enableScroll:!0,this.enableZoom=void 0!=a.enableScroll?a.enableZoom:!0,this._uName="touchZoomPan"+this.axis,this.connect()},connect:function(){this.inherited(arguments),-1!=this.chart.surface.declaredClass.indexOf("svg")&&this.chart.addPlot(this._uName,{type:s})},disconnect:function(){-1!=this.chart.surface.declaredClass.indexOf("svg")&&this.chart.removePlot(this._uName),this.inherited(arguments)},onTouchStart:function(e){var t=this.chart,i=t.getAxis(this.axis),r=e.touches?e.touches.length:1,o=e.touches?e.touches[0]:e,d=this._startPageCoord;if(this._startPageCoord={x:o.pageX,y:o.pageY},(this.enableZoom||this.enableScroll)&&t._delayedRenderHandle&&t.render(),this.enableZoom&&r>=2){this._startTime=0,this._endPageCoord={x:e.touches[1].pageX,y:e.touches[1].pageY};var n={x:(this._startPageCoord.x+this._endPageCoord.x)/2,y:(this._startPageCoord.y+this._endPageCoord.y)/2},l=i.getScaler();this._initScale=i.getWindowScale();var s=this._initData=this.plot.toData();this._middleCoord=s(n)[this.axis],this._startCoord=l.bounds.from,this._endCoord=l.bounds.to}else e.touches&&1!=e.touches.length?this._startTime=0:this._startTime?(new Date).getTime()-this._startTime<250&&Math.abs(this._startPageCoord.x-d.x)<30&&Math.abs(this._startPageCoord.y-d.y)<30?(this._startTime=0,this.onDoubleTap(e)):this._startTime=0:this._startTime=(new Date).getTime(),this.enableScroll&&(this._startScroll(i),a.stop(e))},onTouchMove:function(e){var t=this.chart,i=t.getAxis(this.axis),r=e.touches?e.touches.length:1,o=i.vertical?"pageY":"pageX",d=i.vertical?"y":"x";if(this._startTime=0,this.enableZoom&&r>=2){var n={x:(e.touches[1].pageX+e.touches[0].pageX)/2,y:(e.touches[1].pageY+e.touches[0].pageY)/2},l=(this._endPageCoord[d]-this._startPageCoord[d])/(e.touches[1][o]-e.touches[0][o]);if(this._initScale/l>this.maxScale)return;var s=this._initData(n)[this.axis],m=l*(this._startCoord-s)+this._middleCoord,u=l*(this._endCoord-s)+this._middleCoord;t.zoomIn(this.axis,[m,u]),a.stop(e)}else if(this.enableScroll){var h=this._getDelta(e);t.setAxisWindow(this.axis,this._lastScale,this._initOffset-h/this._lastFactor/this._lastScale),t.delayedRender(),a.stop(e)}},onTouchEnd:function(e){var t=this.chart,a=t.getAxis(this.axis);if((!e.touches||1==e.touches.length)&&this.enableScroll){var i=e.touches?e.touches[0]:e;this._startPageCoord={x:i.pageX,y:i.pageY},this._startScroll(a)}},_startScroll:function(e){var t=e.getScaler().bounds;this._initOffset=e.getWindowOffset(),this._lastScale=e.getWindowScale(),this._lastFactor=t.span/(t.upper-t.lower)},onDoubleTap:function(e){var t=this.chart,i=t.getAxis(this.axis),r=1/this.scaleFactor;if(1==i.getWindowScale()){var o=i.getScaler(),d=o.bounds.from,n=o.bounds.to,l=(d+n)/2,s=this.plot.toData(this._startPageCoord)[this.axis],m=r*(d-l)+s,u=r*(n-l)+s;t.zoomIn(this.axis,[m,u])}else t.setAxisWindow(this.axis,1,0),t.render();a.stop(e)},_getDelta:function(e){var t=this.chart.getAxis(this.axis),a=t.vertical?"pageY":"pageX",i=t.vertical?"y":"x",r=e.touches?e.touches[0]:e;return t.vertical?this._startPageCoord[i]-r[a]:r[a]-this._startPageCoord[i]}});return i("dojo-bidi")?t("dojox.charting.action2d.TouchZoomAndPan",[m,l]):m});//# sourceMappingURL=TouchZoomAndPan.js.map