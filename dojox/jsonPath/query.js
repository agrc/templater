//>>built
define("dojox/jsonPath/query",["dojo/_base/kernel","dojo/_base/lang"],function(kernel,lang){var query=function(obj,expr,arg){function _str(e){return strs[e]}arg||(arg={});var strs=[],_strName=_str.name;if("PATH"==arg.resultType&&"RESULT"==arg.evalType)throw Error("RESULT based evaluation not supported with PATH based results");var P={resultType:arg.resultType||"VALUE",normalize:function(expr){var subx=[];expr=expr.replace(/'([^']|'')*'/g,function(t){return _strName+"("+(strs.push(eval(t))-1)+")"});for(var ll=-1;ll!=subx.length;)ll=subx.length,expr=expr.replace(/(\??\([^\(\)]*\))/g,function(e){return"#"+(subx.push(e)-1)});for(expr=expr.replace(/[\['](#[0-9]+)[\]']/g,"[$1]").replace(/'?\.'?|\['?/g,";").replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,""),ll=-1;ll!=expr;)ll=expr,expr=expr.replace(/#([0-9]+)/g,function(e,t){return subx[t]});return expr.split(";")},asPaths:function(e){var t,i,a,o,n;for(i=0;i<e.length;i++){for(a="$",o=e[i],t=1,n=o.length;t<n;t++)a+=/^[0-9*]+$/.test(o[t])?"["+o[t]+"]":"['"+o[t]+"']";e[i]=a}return e},exec:function(e,t,i){function a(e,t,i){e&&e.hasOwnProperty(t)&&"VALUE"!=P.resultType&&h.push(c.concat([t])),i?u=e[t]:e&&e.hasOwnProperty(t)&&u.push(e[t])}function o(e){u.push(e),h.push(c),P.walk(e,function(t){if("object"==typeof e[t]){var i=c;c=c.concat(t),o(e[t]),c=i}})}function n(e,t){if(t instanceof Array){var i=t.length,o=0,n=i,r=1;e.replace(/^(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)$/g,function(e,t,i,a){o=parseInt(t||o,10),n=parseInt(i||n,10),r=parseInt(a||r,10)}),o=o<0?Math.max(0,o+i):Math.min(i,o),n=n<0?Math.max(0,n+i):Math.min(i,n);var s;for(s=o;s<n;s+=r)a(t,s)}}function r(e,t){var i=t.match(/^_str\(([0-9]+)\)$/);return i?strs[i[1]]:e}function s(e,t){if(/^\(.*?\)$/.test(t))a(e,P.eval(t,e),i);else if("*"===t)P.walk(e,i&&e instanceof Array?function(t){P.walk(e[t],function(i){a(e[t],i)})}:function(t){a(e,t)});else if(".."===t)o(e);else if(/,/.test(t)){var s,l,d;for(s=t.split(/'?,'?/),d=0,l=s.length;d<l;d++)a(e,r(s[d],t))}else/^\?\(.*?\)$/.test(t)?P.walk(e,function(i){P.eval(t.replace(/^\?\((.*?)\)$/,"$1"),e[i])&&a(e,i)}):/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(t)?n(t,e):(t=r(t,t),i&&e instanceof Array&&!/^[0-9*]+$/.test(t)?P.walk(e,function(i){a(e[i],t)}):a(e,t,i))}for(var l,d,c=["$"],u=i?t:[t],h=[c];e.length;){if(l=e.shift(),null===(t=u)||void 0===t)return t;u=[],d=h,h=[],i?s(t,l):P.walk(t,function(e){c=d[e]||c,s(t[e],l)})}if("BOTH"==P.resultType){h=P.asPaths(h);var m,f=[];for(m=0;m<h.length;m++)f.push({path:h[m],value:u[m]});return f}return"PATH"==P.resultType?P.asPaths(h):u},walk:function(e,t){var i,a,o;if(e instanceof Array)for(i=0,a=e.length;i<a;i++)i in e&&t(i);else if("object"==typeof e)for(o in e)e.hasOwnProperty(o)&&t(o)},eval:function(x,v){try{return obj&&v&&eval(x.replace(/@/g,"v"))}catch(e){throw new SyntaxError("jsonPath: "+e.message+": "+x.replace(/@/g,"v").replace(/\^/g,"_a"))}}};return!(!expr||!obj)&&P.exec(P.normalize(expr).slice(1),obj,"RESULT"==arg.evalType)};if(!kernel.isAsync){var obj=lang.getObject("dojox.jsonPath",!0);obj.query=query}return query});//# sourceMappingURL=query.js.map