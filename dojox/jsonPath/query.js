//>>built
define("dojox/jsonPath/query",["dojo","dijit","dojox"],function(dojo,dijit,dojox){dojo.provide("dojox.jsonPath.query"),dojox.jsonPath.query=function(obj,expr,arg){function _str(e){return strs[e]}var re=dojox.jsonPath._regularExpressions;arg||(arg={});var strs=[],_strName=_str.name,acc;if("PATH"==arg.resultType&&"RESULT"==arg.evalType)throw Error("RESULT based evaluation not supported with PATH based results");var P={resultType:arg.resultType||"VALUE",normalize:function(expr){var subx=[];expr=expr.replace(/'([^']|'')*'/g,function(t){return _strName+"("+(strs.push(eval(t))-1)+")"});for(var ll=-1;ll!=subx.length;)ll=subx.length,expr=expr.replace(/(\??\([^\(\)]*\))/g,function(e){return"#"+(subx.push(e)-1)});for(expr=expr.replace(/[\['](#[0-9]+)[\]']/g,"[$1]").replace(/'?\.'?|\['?/g,";").replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,""),ll=-1;ll!=expr;)ll=expr,expr=expr.replace(/#([0-9]+)/g,function(e,t){return subx[t]});return expr.split(";")},asPaths:function(e){for(var t=0;t<e.length;t++){for(var a="$",i=e[t],n=1,r=i.length;r>n;n++)a+=/^[0-9*]+$/.test(i[n])?"["+i[n]+"]":"['"+i[n]+"']";e[t]=a}return e},exec:function(e,t,a){function i(e,t,a){e&&e.hasOwnProperty(t)&&"VALUE"!=P.resultType&&u.push(d.concat([t])),a?l=e[t]:e&&e.hasOwnProperty(t)&&l.push(e[t])}function n(e){l.push(e),u.push(d),P.walk(e,function(t){if("object"==typeof e[t]){var a=d;d=d.concat(t),n(e[t]),d=a}})}function r(e,t){if(t instanceof Array){var a=t.length,n=0,r=a,o=1;e.replace(/^(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)$/g,function(e,t,a,i){n=parseInt(t||n),r=parseInt(a||r),o=parseInt(i||o)}),n=0>n?Math.max(0,n+a):Math.min(a,n),r=0>r?Math.max(0,r+a):Math.min(a,r);for(var s=n;r>s;s+=o)i(t,s)}}function o(e){var t=h.match(/^_str\(([0-9]+)\)$/);return t?strs[t[1]]:e}function s(e){if(/^\(.*?\)$/.test(h))i(e,P.eval(h,e),a);else if("*"===h)P.walk(e,a&&e instanceof Array?function(t){P.walk(e[t],function(a){i(e[t],a)})}:function(t){i(e,t)});else if(".."===h)n(e);else if(/,/.test(h))for(var t=h.split(/'?,'?/),s=0,d=t.length;d>s;s++)i(e,o(t[s]));else/^\?\(.*?\)$/.test(h)?P.walk(e,function(t){P.eval(h.replace(/^\?\((.*?)\)$/,"$1"),e[t])&&i(e,t)}):/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(h)?r(h,e):(h=o(h),a&&e instanceof Array&&!/^[0-9*]+$/.test(h)?P.walk(e,function(t){i(e[t],h)}):i(e,h,a))}for(var d=["$"],l=a?t:[t],u=[d];e.length;){var h=e.shift();if(null===(t=l)||void 0===t)return t;l=[];var c=u;u=[],a?s(t):P.walk(t,function(e){d=c[e]||d,s(t[e])})}if("BOTH"==P.resultType){u=P.asPaths(u);for(var m=[],f=0;f<u.length;f++)m.push({path:u[f],value:l[f]});return m}return"PATH"==P.resultType?P.asPaths(u):l},walk:function(e,t){if(e instanceof Array)for(var a=0,i=e.length;i>a;a++)a in e&&t(a);else if("object"==typeof e)for(var n in e)e.hasOwnProperty(n)&&t(n)},eval:function(x,v){try{return $&&v&&eval(x.replace(/@/g,"v"))}catch(e){throw new SyntaxError("jsonPath: "+e.message+": "+x.replace(/@/g,"v").replace(/\^/g,"_a"))}}},$=obj;return expr&&obj?P.exec(P.normalize(expr).slice(1),obj,"RESULT"==arg.evalType):!1}});//# sourceMappingURL=query.js.map