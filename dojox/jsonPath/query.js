//>>built
define("dojox/jsonPath/query",["dojo","dijit","dojox"],function(dojo,dijit,dojox){dojo.provide("dojox.jsonPath.query"),dojox.jsonPath.query=function(obj,expr,arg){function _str(e){return strs[e]}var re=dojox.jsonPath._regularExpressions;arg||(arg={});var strs=[],_strName=_str.name,acc;if("PATH"==arg.resultType&&"RESULT"==arg.evalType)throw Error("RESULT based evaluation not supported with PATH based results");var P={resultType:arg.resultType||"VALUE",normalize:function(expr){var subx=[];expr=expr.replace(/'([^']|'')*'/g,function(t){return _strName+"("+(strs.push(eval(t))-1)+")"});for(var ll=-1;ll!=subx.length;)ll=subx.length,expr=expr.replace(/(\??\([^\(\)]*\))/g,function(e){return"#"+(subx.push(e)-1)});for(expr=expr.replace(/[\['](#[0-9]+)[\]']/g,"[$1]").replace(/'?\.'?|\['?/g,";").replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,""),ll=-1;ll!=expr;)ll=expr,expr=expr.replace(/#([0-9]+)/g,function(e,t){return subx[t]});return expr.split(";")},asPaths:function(e){for(var t=0;t<e.length;t++){for(var i="$",a=e[t],n=1,r=a.length;r>n;n++)i+=/^[0-9*]+$/.test(a[n])?"["+a[n]+"]":"['"+a[n]+"']";e[t]=i}return e},exec:function(e,t,i){function a(e,t,i){e&&e.hasOwnProperty(t)&&"VALUE"!=P.resultType&&h.push(d.concat([t])),i?l=e[t]:e&&e.hasOwnProperty(t)&&l.push(e[t])}function n(e){l.push(e),h.push(d),P.walk(e,function(t){if("object"==typeof e[t]){var i=d;d=d.concat(t),n(e[t]),d=i}})}function r(e,t){if(t instanceof Array){var i=t.length,n=0,r=i,o=1;e.replace(/^(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)$/g,function(e,t,i,a){n=parseInt(t||n),r=parseInt(i||r),o=parseInt(a||o)}),n=0>n?Math.max(0,n+i):Math.min(i,n),r=0>r?Math.max(0,r+i):Math.min(i,r);for(var s=n;r>s;s+=o)a(t,s)}}function o(e){var t=u.match(/^_str\(([0-9]+)\)$/);return t?strs[t[1]]:e}function s(e){if(/^\(.*?\)$/.test(u))a(e,P.eval(u,e),i);else if("*"===u)P.walk(e,i&&e instanceof Array?function(t){P.walk(e[t],function(i){a(e[t],i)})}:function(t){a(e,t)});else if(".."===u)n(e);else if(/,/.test(u))for(var t=u.split(/'?,'?/),s=0,d=t.length;d>s;s++)a(e,o(t[s]));else/^\?\(.*?\)$/.test(u)?P.walk(e,function(t){P.eval(u.replace(/^\?\((.*?)\)$/,"$1"),e[t])&&a(e,t)}):/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(u)?r(u,e):(u=o(u),i&&e instanceof Array&&!/^[0-9*]+$/.test(u)?P.walk(e,function(t){a(e[t],u)}):a(e,u,i))}for(var d=["$"],l=i?t:[t],h=[d];e.length;){var u=e.shift();if(null===(t=l)||void 0===t)return t;l=[];var c=h;h=[],i?s(t):P.walk(t,function(e){d=c[e]||d,s(t[e])})}if("BOTH"==P.resultType){h=P.asPaths(h);for(var m=[],f=0;f<h.length;f++)m.push({path:h[f],value:l[f]});return m}return"PATH"==P.resultType?P.asPaths(h):l},walk:function(e,t){if(e instanceof Array)for(var i=0,a=e.length;a>i;i++)i in e&&t(i);else if("object"==typeof e)for(var n in e)e.hasOwnProperty(n)&&t(n)},eval:function(x,v){try{return $&&v&&eval(x.replace(/@/g,"v"))}catch(e){throw new SyntaxError("jsonPath: "+e.message+": "+x.replace(/@/g,"v").replace(/\^/g,"_a"))}}},$=obj;return expr&&obj?P.exec(P.normalize(expr).slice(1),obj,"RESULT"==arg.evalType):!1}});//# sourceMappingURL=query.js.map