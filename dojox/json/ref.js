//>>built
define("dojox/json/ref",["dojo/_base/array","dojo/_base/json","dojo/_base/kernel","dojo/_base/lang","dojo/date/stamp","dojox"],function(array,djson,dojo,lang,stamp,dojox){return lang.getObject("json",!0,dojox),dojox.json.ref={resolveJson:function(e,t){function i(p,g,y,v,b,_,w){var M,k,x,j=r in p?p[r]:y;(r in p||void 0!==j&&v)&&(j=(s+j).replace(u,"$2$3"));var T=_||p;if(void 0!==j){if(d&&(p.__id=j),!t.schemas||p instanceof Array||!(x=j.match(/^(.+\/)[^\.\[]*$/))||(b=t.schemas[x[1]]),l[j]&&p instanceof Array==l[j]instanceof Array)T=l[j],delete T.$ref,delete T._loadObject,k=!0;else{var C=b&&b.prototype;C&&(f.prototype=C,T=new f)}l[j]=T,h&&(h[j]=t.time)}for(;b;){var I=b.properties;if(I)for(M in p){var S=I[M];S&&"date-time"==S.format&&"string"==typeof p[M]&&(p[M]=stamp.fromISOString(p[M]))}b=b["extends"]}var F=p.length;for(M in p){if(M==F)break;if(p.hasOwnProperty(M)){if(x=p[M],"object"==typeof x&&x&&!(x instanceof Date)&&"__parent"!=M)if(a=x[o]||n&&x[r],p==c||a&&x.__parent||(x.__parent=w?w:T),a){delete p[M];var E=a.toString().replace(/(#)([^\.\[])/,"$1.$2").match(/(^([^\[]*\/)?[^#\.\[]*)#?([\.\[].*)?/);if(l[(s+a).replace(u,"$2$3")]?a=l[(s+a).replace(u,"$2$3")]:(a="$"==E[1]||"this"==E[1]||""==E[1]?e:l[(s+E[1]).replace(u,"$2$3")])&&E[3]&&E[3].replace(/(\[([^\]]+)\])|(\.?([^\.\[]+))/g,function(e,t,i,r,o){a=a&&a[i?i.replace(/[\"\'\\]/,""):o]}),a)x=a;else if(!g){var A;A||c.push(T),A=!0,x=i(x,!1,x[o],!0,S),x._loadObject=t.loader}}else g||(x=i(x,c==p,void 0===j?void 0:m(j,M),!1,S,T!=p&&"object"==typeof T[M]&&T[M],p));if(p[M]=x,T!=p&&!T.__isDirty){var N=T[M];T[M]=x,!k||x===N||T._loadObject||"_"==M.charAt(0)&&"_"==M.charAt(1)||"$ref"==M||x instanceof Date&&N instanceof Date&&x.getTime()==N.getTime()||"function"==typeof x&&"function"==typeof N&&x.toString()==N.toString()||!l.onUpdate||l.onUpdate(T,M,N,x)}}}if(k&&(r in p||T instanceof Array)){for(M in T)if(!T.__isDirty&&T.hasOwnProperty(M)&&!p.hasOwnProperty(M)&&("_"!=M.charAt(0)||"_"!=M.charAt(1))&&!(T instanceof Array&&isNaN(M)))for(l.onUpdate&&"_loadObject"!=M&&"_idAttr"!=M&&l.onUpdate(T,M,T[M],void 0),delete T[M];T instanceof Array&&T.length&&void 0===T[T.length-1];)T.length--}else l.onLoad&&l.onLoad(T);return T}t=t||{};var a,r=t.idAttribute||"id",o=this.refAttribute,n=t.idAsRef,s=t.idPrefix||"",d=t.assignAbsoluteIds,l=t.index||{},h=t.timeStamps,c=[],u=/^(.*\/)?(\w+:\/\/)|[^\/\.]+\/\.\.\/|^.*\/(\/)/,m=this._addProp,f=function(){};return e&&"object"==typeof e&&(e=i(e,!1,t.defaultId,!0),i(c,!1)),e},fromJson:function(str,args){function ref(e){var t={};return t[this.refAttribute]=e,t}try{var root=eval("("+str+")")}catch(e){throw new SyntaxError("Invalid JSON string: "+e.message+" parsing: "+str)}return root?this.resolveJson(root,args):root},toJson:function(e,t,i,a){function r(e,a,h){if("object"==typeof e&&e){if(e instanceof Date)return'"'+stamp.toISOString(e,{zulu:!0})+'"';var c=e.__id;if(c){if("#"!=a&&(o&&!c.match(/#/)||d[c])){var u=c;"#"!=c.charAt(0)&&(u=e.__clientId==c?"cid:"+c:c.substring(0,i.length)==i?c.substring(i.length):c);var m={};return m[s]=u,djson.toJson(m,t)}a=c}else e.__id=a,l[a]=e;d[a]=e,h=h||"";var f=t?h+djson.toJsonIndentStr:"",p=t?"\n":"",g=t?" ":"";if(e instanceof Array){var y=array.map(e,function(e,t){var i=r(e,n(a,t),f);return"string"!=typeof i&&(i="undefined"),p+f+i});return"["+y.join(","+g)+p+h+"]"}var v=[];for(var b in e)if(e.hasOwnProperty(b)){var _;if("number"==typeof b)_='"'+b+'"';else{if("string"!=typeof b||"_"==b.charAt(0)&&"_"==b.charAt(1))continue;_=djson._escapeString(b)}var w=r(e[b],n(a,b),f);if("string"!=typeof w)continue;v.push(p+f+_+":"+g+w)}return"{"+v.join(","+g)+p+h+"}"}return"function"==typeof e&&dojox.json.ref.serializeFunctions?e.toString():djson.toJson(e)}var o=this._useRefs,n=this._addProp,s=this.refAttribute;i=i||"";var d={},l={},h=r(e,"#","");if(!a)for(var c in l)delete l[c].__id;return h},_addProp:function(e,t){return e+(e.match(/#/)?1==e.length?"":".":"#")+t},refAttribute:"$ref",_useRefs:!1,serializeFunctions:!1}});//# sourceMappingURL=ref.js.map