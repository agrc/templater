//>>built
define("dojox/date/timezone",["dojo/_base/array","dojo/_base/config","dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","dojo/date","dojo/date/locale","dojo/request","dojo/request/handlers"],function(e,t,a,i,r,o,d,n,s){function l(e){e=e||{},x=r.mixin(x,e.zones||{}),A=r.mixin(A,e.rules||{})}function m(e){_[e]=!0,n.get(require.toUrl((t.timezoneFileBasePath||"dojox/date/zoneinfo")+"/"+e),{handleAs:"olson_zoneinfo",sync:!0}).then(l,function(e){throw e})}function u(e){throw new Error('Timezone "'+e+'" is either incorrect, or not loaded in the timezone registry.')}function h(e){var t=z[e];if(!t){var a=e.split("/")[0];if(t=D[a],!t){var i=x[e];if("string"==typeof i)return h(i);if(!_.backward)return m("backward"),h(e);u(e)}}return t}function f(e){var t=/(\d+)(?::0*(\d*))?(?::0*(\d*))?([su])?$/,a=e.match(t);return a?(a[1]=parseInt(a[1],10),a[2]=a[2]?parseInt(a[2],10):0,a[3]=a[3]?parseInt(a[3],10):0,a):null}function c(e,t,a,i,r,o,d){return Date.UTC(e,t,a,i,r,o)+60*(d||0)*1e3}function y(e){return G[e.substr(0,3).toLowerCase()]}function v(e){var t=f(e);if(null===t)return 0;var a=0===e.indexOf("-")?-1:1;return t=a*(1e3*(60*(60*t[1]+t[2])+t[3])),-t/60/1e3}function p(e,t,a){var i=y(e[3]),r=e[4],d=f(e[5]);"u"==d[4]&&(a=0);var n,s,l;if(!isNaN(r))return n=new Date(c(t,i,parseInt(r,10),d[1],d[2],d[3],a));if("last"==r.substr(0,4))return r=S[r.substr(4,3).toLowerCase()],n=new Date(c(t,i+1,1,d[1]-24,d[2],d[3],a)),s=o.add(n,"minute",-a).getUTCDay(),l=r>s?r-s-7:r-s,0!==l&&(n=o.add(n,"hour",24*l)),n;if(r=S[r.substr(0,3).toLowerCase()],"undefined"!=r){if(">="==e[4].substr(3,2))return n=new Date(c(t,i,parseInt(e[4].substr(5),10),d[1],d[2],d[3],a)),s=o.add(n,"minute",-a).getUTCDay(),l=s>r?r-s+7:r-s,0!==l&&(n=o.add(n,"hour",24*l)),n;if("<="==r.substr(3,2))return n=new Date(c(t,i,parseInt(e[4].substr(5),10),d[1],d[2],d[3],a)),s=o.add(n,"minute",-a).getUTCDay(),l=r>s?r-s-7:r-s,0!==l&&(n=o.add(n,"hour",24*l)),n}return null}function M(t,a){var i=[];return e.forEach(A[t[1]]||[],function(e){for(var r=0;2>r;r++)switch(e[r]){case"min":e[r]=I;break;case"max":e[r]=F;break;case"only":break;default:if(e[r]=parseInt(e[r],10),isNaN(e[r]))throw new Error("Invalid year found on rule")}"string"==typeof e[6]&&(e[6]=v(e[6])),(e[0]<=a&&e[1]>=a||e[0]==a&&"only"==e[1])&&i.push({r:e,d:p(e,a,t[0])})}),i}function g(t,a){for(var i=E[t]=[],r=0;r<a.length;r++){var d=a[r],n=i[r]=[],s=null,l=null,m=[];"string"==typeof d[0]&&(d[0]=v(d[0])),0===r?n[0]=Date.UTC(I,0,1,0,0,0,0):(n[0]=i[r-1][1],s=a[r-1],l=i[r-1],m=l[2]);var u,h=new Date(n[0]).getUTCFullYear(),g=d[3]?parseInt(d[3],10):F,b=[];for(u=h;g>=u;u++)b=b.concat(M(d,u));b.sort(function(e,t){return o.compare(e.d,t.d)});var w;for(u=0,w;w=b[u];u++){var j=u>0?b[u-1]:null;w.r[5].indexOf("u")<0&&w.r[5].indexOf("s")<0&&(0===u&&r>0?m.length?w.d=o.add(w.d,"minute",m[m.length-1].r[6]):0===o.compare(new Date(l[1]),w.d,"date")?w.d=new Date(l[1]):w.d=o.add(w.d,"minute",v(s[1])):u>0&&(w.d=o.add(w.d,"minute",j.r[6])))}if(n[2]=b,d[3]){var k=parseInt(d[3],10),_=y(d[4]||"Jan"),x=parseInt(d[5]||"1",10),A=f(d[6]||"0"),T=n[1]=c(k,_,x,A[1],A[2],A[3],"u"==A[4]?0:d[0]);isNaN(T)&&(T=n[1]=p([0,0,0,d[4],d[5],d[6]||"0"],k,"u"==A[4]?0:d[0]).getTime());var C=e.filter(b,function(e,t){var a=t>0?60*b[t-1].r[6]*1e3:0;return e.d.getTime()<T+a});"u"!=A[4]&&"s"!=A[4]&&(C.length?n[1]+=60*C[C.length-1].r[6]*1e3:n[1]+=60*v(d[1])*1e3)}else n[1]=Date.UTC(F,11,31,23,59,59,999)}}function b(e,t){for(var a=t,i=x[a];"string"==typeof i;)a=i,i=x[a];if(!i){if(!_.backward){m("backward",!0);return b(e,t)}u(a)}E[t]||g(t,i);for(var r,o=E[t],d=e.getTime(),n=0;r=o[n];n++)if(d>=r[0]&&d<r[1])return{zone:i[n],range:o[n],idx:n};throw new Error('No Zone found for "'+t+'" on '+e)}function w(e,t){for(var a,i=-1,r=t.range[2]||[],o=e.getTime(),d=(t.range,0);a=r[d];d++)o>=a.d.getTime()&&(i=d);return i>=0?r[i].r:null}function j(e,t,a){var i,r=t.zone,o=r[2];if(o.indexOf("%s")>-1){var d;if(a)d=a[7],"-"==d&&(d="");else if(r[1]in N)d=N[r[1]];else if(t.idx>0){var n=x[e][t.idx-1],s=n[2];d=s.indexOf("%s")<0&&o.replace("%s","S")==s?"S":""}else d="";i=o.replace("%s",d)}else if(o.indexOf("/")>-1){var l=o.split("/");i=a?l[0===a[6]?0:1]:l[0]}else i=o;return i}i.experimental("dojox.date.timezone");var k=["africa","antarctica","asia","australasia","backward","etcetera","europe","northamerica","pacificnew","southamerica"],I=1835,F=2038,_={},x={},E={},A={},T=t.timezoneLoadingScheme||"preloadAll",C=t.defaultZoneFile||("preloadAll"==T?k:"northamerica");s.register("olson_zoneinfo",function(e){for(var t=e.text,a=t.split("\n"),i=[],r="",o=null,d=null,n={zones:{},rules:{}},s=0;s<a.length;s++){var l=a[s];if(l.match(/^\s/)&&(l="Zone "+o+l),l=l.split("#")[0],l.length>3)switch(i=l.split(/\s+/),r=i.shift()){case"Zone":o=i.shift(),i[0]&&(n.zones[o]||(n.zones[o]=[]),n.zones[o].push(i));break;case"Rule":d=i.shift(),n.rules[d]||(n.rules[d]=[]),n.rules[d].push(i);break;case"Link":if(n.zones[i[1]])throw new Error("Error with Link "+i[1]);n.zones[i[1]]=i[0];break;case"Leap":}}return n});var G={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11},S={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},D={EST:"northamerica",MST:"northamerica",HST:"northamerica",EST5EDT:"northamerica",CST6CDT:"northamerica",MST7MDT:"northamerica",PST8PDT:"northamerica",America:"northamerica",Pacific:"australasia",Atlantic:"europe",Africa:"africa",Indian:"africa",Antarctica:"antarctica",Asia:"asia",Australia:"australasia",Europe:"europe",WET:"europe",CET:"europe",MET:"europe",EET:"europe"},z={"Pacific/Honolulu":"northamerica","Atlantic/Bermuda":"northamerica","Atlantic/Cape_Verde":"africa","Atlantic/St_Helena":"africa","Indian/Kerguelen":"antarctica","Indian/Chagos":"asia","Indian/Maldives":"asia","Indian/Christmas":"australasia","Indian/Cocos":"australasia","America/Danmarkshavn":"europe","America/Scoresbysund":"europe","America/Godthab":"europe","America/Thule":"europe","Asia/Yekaterinburg":"europe","Asia/Omsk":"europe","Asia/Novosibirsk":"europe","Asia/Krasnoyarsk":"europe","Asia/Irkutsk":"europe","Asia/Yakutsk":"europe","Asia/Vladivostok":"europe","Asia/Sakhalin":"europe","Asia/Magadan":"europe","Asia/Kamchatka":"europe","Asia/Anadyr":"europe","Africa/Ceuta":"europe","America/Argentina/Buenos_Aires":"southamerica","America/Argentina/Cordoba":"southamerica","America/Argentina/Tucuman":"southamerica","America/Argentina/La_Rioja":"southamerica","America/Argentina/San_Juan":"southamerica","America/Argentina/Jujuy":"southamerica","America/Argentina/Catamarca":"southamerica","America/Argentina/Mendoza":"southamerica","America/Argentina/Rio_Gallegos":"southamerica","America/Argentina/Ushuaia":"southamerica","America/Aruba":"southamerica","America/La_Paz":"southamerica","America/Noronha":"southamerica","America/Belem":"southamerica","America/Fortaleza":"southamerica","America/Recife":"southamerica","America/Araguaina":"southamerica","America/Maceio":"southamerica","America/Bahia":"southamerica","America/Sao_Paulo":"southamerica","America/Campo_Grande":"southamerica","America/Cuiaba":"southamerica","America/Porto_Velho":"southamerica","America/Boa_Vista":"southamerica","America/Manaus":"southamerica","America/Eirunepe":"southamerica","America/Rio_Branco":"southamerica","America/Santiago":"southamerica","Pacific/Easter":"southamerica","America/Bogota":"southamerica","America/Curacao":"southamerica","America/Guayaquil":"southamerica","Pacific/Galapagos":"southamerica","Atlantic/Stanley":"southamerica","America/Cayenne":"southamerica","America/Guyana":"southamerica","America/Asuncion":"southamerica","America/Lima":"southamerica","Atlantic/South_Georgia":"southamerica","America/Paramaribo":"southamerica","America/Port_of_Spain":"southamerica","America/Montevideo":"southamerica","America/Caracas":"southamerica"},N={US:"S",Chatham:"S",NZ:"S",NT_YK:"S",Edm:"S",Salv:"S",Canada:"S",StJohns:"S",TC:"S",Guat:"S",Mexico:"S",Haiti:"S",Barb:"S",Belize:"S",CR:"S",Moncton:"S",Swift:"S",Hond:"S",Thule:"S",NZAQ:"S",Zion:"S",ROK:"S",PRC:"S",Taiwan:"S",Ghana:"GMT",SL:"WAT",Chicago:"S",Detroit:"S",Vanc:"S",Denver:"S",Halifax:"S",Cuba:"S",Indianapolis:"S",Starke:"S",Marengo:"S",Pike:"S",Perry:"S",Vincennes:"S",Pulaski:"S",Louisville:"S",CA:"S",Nic:"S",Menominee:"S",Mont:"S",Bahamas:"S",NYC:"S",Regina:"S",Resolute:"ES",DR:"S",Toronto:"S",Winn:"S"};r.setObject("dojox.date.timezone",{getTzInfo:function(e,t){if("lazyLoad"==T){var a=h(t);if(!a)throw new Error("Not a valid timezone ID.");_[a]||m(a)}var i=b(e,t),r=i.zone[0],o=w(e,i);r+=o?o[6]:v(A[i.zone[1]]&&i.idx>0?x[t][i.idx-1][1]:i.zone[1]);var d=j(t,i,o);return{tzOffset:r,tzAbbr:d}},loadZoneData:function(e){l(e)},getAllZones:function(){var e=[];for(var t in x)e.push(t);return e.sort(),e}}),"string"==typeof C&&C&&(C=[C]),C instanceof Array&&e.forEach(C,m);var P=d.format,Q=d._getZone;return d.format=function(e,t){if(t=t||{},t.timezone&&!t._tzInfo&&(t._tzInfo=dojox.date.timezone.getTzInfo(e,t.timezone)),t._tzInfo){var a=e.getTimezoneOffset()-t._tzInfo.tzOffset;e=new Date(e.getTime()+60*a*1e3)}return P.call(this,e,t)},d._getZone=function(e,t,a){return a._tzInfo?t?a._tzInfo.tzAbbr:a._tzInfo.tzOffset:Q.call(this,e,t,a)},dojox.date.timezone});//# sourceMappingURL=timezone.js.map