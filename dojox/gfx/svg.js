//>>built
define("dojox/gfx/svg",["dojo/_base/lang","dojo/_base/sniff","dojo/_base/window","dojo/dom","dojo/_base/declare","dojo/_base/array","dojo/dom-geometry","dojo/dom-attr","dojo/_base/Color","./_base","./shape","./path"],function(e,t,i,r,a,n,o,s,d,l,u,c){function h(e,t){return i.doc.createElementNS?i.doc.createElementNS(e,t):i.doc.createElement(t)}function f(e,t,i,r){return e.setAttributeNS?e.setAttributeNS(t,i,r):e.setAttribute(i,r)}function m(e){return g.useSvgWeb?i.doc.createTextNode(e,!0):i.doc.createTextNode(e)}function p(){return g.useSvgWeb?i.doc.createDocumentFragment(!0):i.doc.createDocumentFragment()}var g=l.svg={};g.useSvgWeb=void 0!==window.svgweb;var y=navigator.userAgent,v=t("ios"),b=t("android"),M=t("chrome")||b&&b>=4?"auto":"optimizeLegibility";g.xmlns={xlink:"http://www.w3.org/1999/xlink",svg:"http://www.w3.org/2000/svg"},g.getRef=function(e){return e&&"none"!=e?e.match(/^url\(#.+\)$/)?r.byId(e.slice(5,-1)):e.match(/^#dojoUnique\d+$/)?r.byId(e.slice(1)):null:null},g.dasharray={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};var _=0;g.Shape=a("dojox.gfx.svg.Shape",u.Shape,{destroy:function(){if(this.fillStyle&&"type"in this.fillStyle){var e=this.rawNode.getAttribute("fill"),t=g.getRef(e);t&&t.parentNode.removeChild(t)}if(this.clip){var i=this.rawNode.getAttribute("clip-path");if(i){var a=r.byId(i.match(/gfx_clip[\d]+/)[0]);a&&a.parentNode.removeChild(a)}}u.Shape.prototype.destroy.apply(this,arguments)},setFill:function(e){if(!e)return this.fillStyle=null,this.rawNode.setAttribute("fill","none"),this.rawNode.setAttribute("fill-opacity",0),this;var t,i=function(e){this.setAttribute(e,t[e].toFixed(8))};if("object"==typeof e&&"type"in e){switch(e.type){case"linear":t=l.makeParameters(l.defaultLinearGradient,e);var r=this._setFillObject(t,"linearGradient");n.forEach(["x1","y1","x2","y2"],i,r);break;case"radial":t=l.makeParameters(l.defaultRadialGradient,e);var a=this._setFillObject(t,"radialGradient");n.forEach(["cx","cy","r"],i,a);break;case"pattern":t=l.makeParameters(l.defaultPattern,e);var o=this._setFillObject(t,"pattern");n.forEach(["x","y","width","height"],i,o)}return this.fillStyle=t,this}return t=l.normalizeColor(e),this.fillStyle=t,this.rawNode.setAttribute("fill",t.toCss()),this.rawNode.setAttribute("fill-opacity",t.a),this.rawNode.setAttribute("fill-rule","evenodd"),this},setStroke:function(t){var i=this.rawNode;if(!t)return this.strokeStyle=null,i.setAttribute("stroke","none"),i.setAttribute("stroke-opacity",0),this;("string"==typeof t||e.isArray(t)||t instanceof d)&&(t={color:t});var r=this.strokeStyle=l.makeParameters(l.defaultStroke,t);if(r.color=l.normalizeColor(r.color),r){var a=r.width<0?0:r.width;i.setAttribute("stroke",r.color.toCss()),i.setAttribute("stroke-opacity",r.color.a),i.setAttribute("stroke-width",a),i.setAttribute("stroke-linecap",r.cap),"number"==typeof r.join?(i.setAttribute("stroke-linejoin","miter"),i.setAttribute("stroke-miterlimit",r.join)):i.setAttribute("stroke-linejoin",r.join);var n=r.style.toLowerCase();if(n in g.dasharray&&(n=g.dasharray[n]),n instanceof Array){n=e._toArray(n);var o;for(o=0;o<n.length;++o)n[o]*=a;if("butt"!=r.cap){for(o=0;o<n.length;o+=2)n[o]-=a,n[o]<1&&(n[o]=1);for(o=1;o<n.length;o+=2)n[o]+=a}n=n.join(",")}i.setAttribute("stroke-dasharray",n),i.setAttribute("dojoGfxStrokeStyle",r.style)}return this},_getParentSurface:function(){for(var e=this.parent;e&&!(e instanceof l.Surface);e=e.parent);return e},_setFillObject:function(e,t){var i=g.xmlns.svg;this.fillStyle=e;var r=this._getParentSurface(),a=r.defNode,n=this.rawNode.getAttribute("fill"),o=g.getRef(n);if(o)if(n=o,n.tagName.toLowerCase()!=t.toLowerCase()){var s=n.id;n.parentNode.removeChild(n),n=h(i,t),n.setAttribute("id",s),a.appendChild(n)}else for(;n.childNodes.length;)n.removeChild(n.lastChild);else n=h(i,t),n.setAttribute("id",l._base._getUniqueId()),a.appendChild(n);if("pattern"==t){n.setAttribute("patternUnits","userSpaceOnUse");var d=h(i,"image");d.setAttribute("x",0),d.setAttribute("y",0),d.setAttribute("width",(e.width<0?0:e.width).toFixed(8)),d.setAttribute("height",(e.height<0?0:e.height).toFixed(8)),f(d,g.xmlns.xlink,"xlink:href",e.src),n.appendChild(d)}else{n.setAttribute("gradientUnits","userSpaceOnUse");for(var u=0;u<e.colors.length;++u){var c=e.colors[u],m=h(i,"stop"),p=c.color=l.normalizeColor(c.color);m.setAttribute("offset",c.offset.toFixed(8)),m.setAttribute("stop-color",p.toCss()),m.setAttribute("stop-opacity",p.a),n.appendChild(m)}}return this.rawNode.setAttribute("fill","url(#"+n.getAttribute("id")+")"),this.rawNode.removeAttribute("fill-opacity"),this.rawNode.setAttribute("fill-rule","evenodd"),n},_applyTransform:function(){if(this.matrix){var e=this.matrix;this.rawNode.setAttribute("transform","matrix("+e.xx.toFixed(8)+","+e.yx.toFixed(8)+","+e.xy.toFixed(8)+","+e.yy.toFixed(8)+","+e.dx.toFixed(8)+","+e.dy.toFixed(8)+")")}else this.rawNode.removeAttribute("transform");return this},setRawNode:function(e){var t=this.rawNode=e;"image"!=this.shape.type&&t.setAttribute("fill","none"),t.setAttribute("fill-opacity",0),t.setAttribute("stroke","none"),t.setAttribute("stroke-opacity",0),t.setAttribute("stroke-width",1),t.setAttribute("stroke-linecap","butt"),t.setAttribute("stroke-linejoin","miter"),t.setAttribute("stroke-miterlimit",4),t.__gfxObject__=this},setShape:function(e){this.shape=l.makeParameters(this.shape,e);for(var t in this.shape)if("type"!=t){var i=this.shape[t];"width"!==t&&"height"!==t||(i=i<0?0:i),this.rawNode.setAttribute(t,i)}return this.bbox=null,this},_moveToFront:function(){return this.rawNode.parentNode.appendChild(this.rawNode),this},_moveToBack:function(){return this.rawNode.parentNode.insertBefore(this.rawNode,this.rawNode.parentNode.firstChild),this},setClip:function(t){this.inherited(arguments);var i=t?"width"in t?"rect":"cx"in t?"ellipse":"points"in t?"polyline":"d"in t?"path":null:null;if(t&&!i)return this;"polyline"===i&&(t=e.clone(t),t.points=t.points.join(","));var a,n,o=s.get(this.rawNode,"clip-path");if(o&&(a=r.byId(o.match(/gfx_clip[\d]+/)[0]))&&a.removeChild(a.childNodes[0]),t){if(a)n=h(g.xmlns.svg,i),a.appendChild(n);else{var d=++_,l="gfx_clip"+d,u="url(#"+l+")";this.rawNode.setAttribute("clip-path",u),a=h(g.xmlns.svg,"clipPath"),n=h(g.xmlns.svg,i),a.appendChild(n),this.rawNode.parentNode.insertBefore(a,this.rawNode),s.set(a,"id",l)}s.set(n,t)}else this.rawNode.removeAttribute("clip-path"),a&&a.parentNode.removeChild(a);return this},_removeClipNode:function(){var e,t=s.get(this.rawNode,"clip-path");return t&&(e=r.byId(t.match(/gfx_clip[\d]+/)[0]))&&e.parentNode.removeChild(e),e}}),g.Group=a("dojox.gfx.svg.Group",g.Shape,{constructor:function(){u.Container._init.call(this)},setRawNode:function(e){this.rawNode=e,this.rawNode.__gfxObject__=this},destroy:function(){this.clear(!0),g.Shape.prototype.destroy.apply(this,arguments)}}),g.Group.nodeType="g",g.Rect=a("dojox.gfx.svg.Rect",[g.Shape,u.Rect],{setShape:function(e){this.shape=l.makeParameters(this.shape,e),this.bbox=null;for(var t in this.shape)if("type"!=t&&"r"!=t){var i=this.shape[t];"width"!==t&&"height"!==t||(i=i<0?0:i),this.rawNode.setAttribute(t,i)}return null!=this.shape.r&&(this.rawNode.setAttribute("ry",this.shape.r),this.rawNode.setAttribute("rx",this.shape.r)),this}}),g.Rect.nodeType="rect",g.Ellipse=a("dojox.gfx.svg.Ellipse",[g.Shape,u.Ellipse],{}),g.Ellipse.nodeType="ellipse",g.Circle=a("dojox.gfx.svg.Circle",[g.Shape,u.Circle],{}),g.Circle.nodeType="circle",g.Line=a("dojox.gfx.svg.Line",[g.Shape,u.Line],{}),g.Line.nodeType="line",g.Polyline=a("dojox.gfx.svg.Polyline",[g.Shape,u.Polyline],{setShape:function(e,t){e&&e instanceof Array?(this.shape=l.makeParameters(this.shape,{points:e}),t&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.shape=l.makeParameters(this.shape,e),this.bbox=null,this._normalizePoints();for(var i=[],r=this.shape.points,a=0;a<r.length;++a)i.push(r[a].x.toFixed(8),r[a].y.toFixed(8));return this.rawNode.setAttribute("points",i.join(" ")),this}}),g.Polyline.nodeType="polyline",g.Image=a("dojox.gfx.svg.Image",[g.Shape,u.Image],{setShape:function(e){this.shape=l.makeParameters(this.shape,e),this.bbox=null;var t=this.rawNode;for(var i in this.shape)if("type"!=i&&"src"!=i){var r=this.shape[i];"width"!==i&&"height"!==i||(r=r<0?0:r),t.setAttribute(i,r)}return t.setAttribute("preserveAspectRatio","none"),f(t,g.xmlns.xlink,"xlink:href",this.shape.src),t.__gfxObject__=this,this}}),g.Image.nodeType="image",g.Text=a("dojox.gfx.svg.Text",[g.Shape,u.Text],{setShape:function(e){this.shape=l.makeParameters(this.shape,e),this.bbox=null;var t=this.rawNode,i=this.shape;return t.setAttribute("x",i.x),t.setAttribute("y",i.y),t.setAttribute("text-anchor",i.align),t.setAttribute("text-decoration",i.decoration),t.setAttribute("rotate",i.rotated?90:0),t.setAttribute("kerning",i.kerning?"auto":0),t.setAttribute("text-rendering",M),t.firstChild?t.firstChild.nodeValue=i.text:t.appendChild(m(i.text)),this},getTextWidth:function(){var e=this.rawNode,t=e.parentNode,i=e.cloneNode(!0);i.style.visibility="hidden";var r=0,a=i.firstChild.nodeValue;if(t.appendChild(i),""!=a)for(;!r;)r=i.getBBox?parseInt(i.getBBox().width):68;return t.removeChild(i),r},getBoundingBox:function(){var e=this.getShape(),t=null;if(e.text)try{t=this.rawNode.getBBox()}catch(e){t={x:0,y:0,width:0,height:0}}return t}}),g.Text.nodeType="text",g.Path=a("dojox.gfx.svg.Path",[g.Shape,c.Path],{_updateWithSegment:function(e){this.inherited(arguments),"string"==typeof this.shape.path&&this.rawNode.setAttribute("d",this.shape.path)},setShape:function(e){return this.inherited(arguments),this.shape.path?this.rawNode.setAttribute("d",this.shape.path):this.rawNode.removeAttribute("d"),this}}),g.Path.nodeType="path",g.TextPath=a("dojox.gfx.svg.TextPath",[g.Shape,c.TextPath],{_updateWithSegment:function(e){this.inherited(arguments),this._setTextPath()},setShape:function(e){return this.inherited(arguments),this._setTextPath(),this},_setTextPath:function(){if("string"==typeof this.shape.path){var e=this.rawNode;if(!e.firstChild){var t=h(g.xmlns.svg,"textPath"),i=m("");t.appendChild(i),e.appendChild(t)}var r=e.firstChild.getAttributeNS(g.xmlns.xlink,"href"),a=r&&g.getRef(r);if(!a){var n=this._getParentSurface();if(n){var o=n.defNode;a=h(g.xmlns.svg,"path");var s=l._base._getUniqueId();a.setAttribute("id",s),o.appendChild(a),f(e.firstChild,g.xmlns.xlink,"xlink:href","#"+s)}}a&&a.setAttribute("d",this.shape.path)}},_setText:function(){var e=this.rawNode;if(!e.firstChild){var t=h(g.xmlns.svg,"textPath"),i=m("");t.appendChild(i),e.appendChild(t)}e=e.firstChild;var r=this.text;switch(e.setAttribute("alignment-baseline","middle"),r.align){case"middle":e.setAttribute("text-anchor","middle"),e.setAttribute("startOffset","50%");break;case"end":e.setAttribute("text-anchor","end"),e.setAttribute("startOffset","100%");break;default:e.setAttribute("text-anchor","start"),e.setAttribute("startOffset","0%")}e.setAttribute("baseline-shift","0.5ex"),e.setAttribute("text-decoration",r.decoration),e.setAttribute("rotate",r.rotated?90:0),e.setAttribute("kerning",r.kerning?"auto":0),e.firstChild.data=r.text}}),g.TextPath.nodeType="text";var w=function(){var e=/WebKit\/(\d*)/.exec(y);return e?e[1]:0}()>534;g.Surface=a("dojox.gfx.svg.Surface",u.Surface,{constructor:function(){u.Container._init.call(this)},destroy:function(){u.Container.clear.call(this,!0),this.defNode=null,this.inherited(arguments)},setDimensions:function(e,t){if(!this.rawNode)return this;var i=e<0?0:e,r=t<0?0:t;return this.rawNode.setAttribute("width",i),this.rawNode.setAttribute("height",r),w&&(this.rawNode.style.width=i,this.rawNode.style.height=r),this},getDimensions:function(){return this.rawNode?{width:l.normalizedLength(this.rawNode.getAttribute("width")),height:l.normalizedLength(this.rawNode.getAttribute("height"))}:null}}),g.createSurface=function(e,t,i){var a=new g.Surface;a.rawNode=h(g.xmlns.svg,"svg"),a.rawNode.setAttribute("overflow","hidden"),t&&a.rawNode.setAttribute("width",t<0?0:t),i&&a.rawNode.setAttribute("height",i<0?0:i);var n=h(g.xmlns.svg,"defs");return a.rawNode.appendChild(n),a.defNode=n,a._parent=r.byId(e),a._parent.appendChild(a.rawNode),l._base._fixMsTouchAction(a),a};var x={_setFont:function(){var e=this.fontStyle;this.rawNode.setAttribute("font-style",e.style),this.rawNode.setAttribute("font-variant",e.variant),this.rawNode.setAttribute("font-weight",e.weight),this.rawNode.setAttribute("font-size",e.size),this.rawNode.setAttribute("font-family",e.family)}},k=u.Container,j=g.Container={openBatch:function(){return this._batch||(this.fragment=p()),++this._batch,this},closeBatch:function(){return this._batch=this._batch>0?--this._batch:0,this.fragment&&!this._batch&&(this.rawNode.appendChild(this.fragment),delete this.fragment),this},add:function(e){return this!=e.getParent()&&(this.fragment?this.fragment.appendChild(e.rawNode):this.rawNode.appendChild(e.rawNode),k.add.apply(this,arguments),e.setClip(e.clip)),this},remove:function(e,t){return this==e.getParent()&&(this.rawNode==e.rawNode.parentNode&&this.rawNode.removeChild(e.rawNode),this.fragment&&this.fragment==e.rawNode.parentNode&&this.fragment.removeChild(e.rawNode),e._removeClipNode(),k.remove.apply(this,arguments)),this},clear:function(){for(var e=this.rawNode;e.lastChild;)e.removeChild(e.lastChild);var t=this.defNode;if(t){for(;t.lastChild;)t.removeChild(t.lastChild);e.appendChild(t)}return k.clear.apply(this,arguments)},getBoundingBox:k.getBoundingBox,_moveChildToFront:k._moveChildToFront,_moveChildToBack:k._moveChildToBack},S=g.Creator={createObject:function(e,t){if(!this.rawNode)return null;var i=new e,r=h(g.xmlns.svg,e.nodeType);return i.setRawNode(r),i.setShape(t),this.add(i),i}};if(e.extend(g.Text,x),e.extend(g.TextPath,x),e.extend(g.Group,j),e.extend(g.Group,u.Creator),e.extend(g.Group,S),e.extend(g.Surface,j),e.extend(g.Surface,u.Creator),e.extend(g.Surface,S),g.fixTarget=function(e,t){return e.gfxTarget||(v&&e.target.wholeText?e.gfxTarget=e.target.parentElement.__gfxObject__:e.gfxTarget=e.target.__gfxObject__),!0},g.useSvgWeb){g.createSurface=function(e,t,i){var a=new g.Surface;if(t=t<0?0:t,i=i<0?0:i,!t||!i){var n=o.position(e);t=t||n.w,i=i||n.h}e=r.byId(e);var s=e.id?e.id+"_svgweb":l._base._getUniqueId(),d=h(g.xmlns.svg,"svg");return d.id=s,d.setAttribute("width",t),d.setAttribute("height",i),svgweb.appendChild(d,e),d.addEventListener("SVGLoad",function(){a.rawNode=this,a.isLoaded=!0;var e=h(g.xmlns.svg,"defs");a.rawNode.appendChild(e),a.defNode=e,a.onLoad&&a.onLoad(a)},!1),a.isLoaded=!1,a},g.Surface.extend({destroy:function(){var e=this.rawNode;svgweb.removeChild(e,e.parentNode)}});var C={connect:function(t,i,r){return"on"===t.substring(0,2)&&(t=t.substring(2)),r=2==arguments.length?i:e.hitch(i,r),this.getEventSource().addEventListener(t,r,!1),[this,t,r]},disconnect:function(e){this.getEventSource().removeEventListener(e[1],e[2],!1),delete e[0]}};e.extend(g.Shape,C),e.extend(g.Surface,C)}return g});//# sourceMappingURL=svg.js.map