//>>built
define("dojox/gfx/svg_attach",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/Color","./_base","./svg","./matrix"],function(e,t,a,i,r,o,n){function s(e){var n=e.rawNode.getAttribute("fill");if("none"==n)return void(e.fillStyle=null);var s=null,l=o.getRef(n);if(l)switch(l.tagName.toLowerCase()){case"lineargradient":s=d(r.defaultLinearGradient,l),a.forEach(["x1","y1","x2","y2"],function(e){s[e]=l.getAttribute(e)});break;case"radialgradient":s=d(r.defaultRadialGradient,l),a.forEach(["cx","cy","r"],function(e){s[e]=l.getAttribute(e)}),s.cx=l.getAttribute("cx"),s.cy=l.getAttribute("cy"),s.r=l.getAttribute("r");break;case"pattern":s=t.clone(r.defaultPattern),a.forEach(["x","y","width","height"],function(e){s[e]=l.getAttribute(e)}),s.src=l.firstChild.getAttributeNS(o.xmlns.xlink,"href")}else{s=new i(n);var u=e.rawNode.getAttribute("fill-opacity");null!=u&&(s.a=u)}e.fillStyle=s}function d(e,a){var r=t.clone(e);r.colors=[];for(var o=0;o<a.childNodes.length;++o)r.colors.push({offset:a.childNodes[o].getAttribute("offset"),color:new i(a.childNodes[o].getAttribute("stop-color"))});return r}function l(e){var a=e.rawNode,o=a.getAttribute("stroke");if(null==o||"none"==o)return void(e.strokeStyle=null);var n=e.strokeStyle=t.clone(r.defaultStroke),s=new i(o);s&&(n.color=s,n.color.a=a.getAttribute("stroke-opacity"),n.width=a.getAttribute("stroke-width"),n.cap=a.getAttribute("stroke-linecap"),n.join=a.getAttribute("stroke-linejoin"),"miter"==n.join&&(n.join=a.getAttribute("stroke-miterlimit")),n.style=a.getAttribute("dojoGfxStrokeStyle"))}function u(e){var t=e.rawNode.getAttribute("transform");if(t.match(/^matrix\(.+\)$/)){var a=t.slice(7,-1).split(",");e.matrix=n.normalize({xx:parseFloat(a[0]),xy:parseFloat(a[2]),yx:parseFloat(a[1]),yy:parseFloat(a[3]),dx:parseFloat(a[4]),dy:parseFloat(a[5])})}else e.matrix=null}function h(e){var a=e.fontStyle=t.clone(r.defaultFont),i=e.rawNode;a.style=i.getAttribute("font-style"),a.variant=i.getAttribute("font-variant"),a.weight=i.getAttribute("font-weight"),a.size=i.getAttribute("font-size"),a.family=i.getAttribute("font-family")}function c(e,a){var i=e.shape=t.clone(a),r=e.rawNode;for(var o in i)i[o]=r.getAttribute(o)}function m(e){c(e,r.defaultRect),e.shape.r=Math.min(e.rawNode.getAttribute("rx"),e.rawNode.getAttribute("ry"))}function f(e){var a=e.shape=t.clone(r.defaultText),i=e.rawNode;a.x=i.getAttribute("x"),a.y=i.getAttribute("y"),a.align=i.getAttribute("text-anchor"),a.decoration=i.getAttribute("text-decoration"),a.rotated=0!=parseFloat(i.getAttribute("rotate")),a.kerning="auto"==i.getAttribute("kerning"),a.text=i.firstChild.nodeValue}function g(e){var a=e.shape=t.clone(r.defaultTextPath),i=e.rawNode;a.align=i.getAttribute("text-anchor"),a.decoration=i.getAttribute("text-decoration"),a.rotated=0!=parseFloat(i.getAttribute("rotate")),a.kerning="auto"==i.getAttribute("kerning"),a.text=i.firstChild.nodeValue}return e.experimental("dojox.gfx.svg_attach"),o.attachNode=function(e){if(!e)return null;var t=null;switch(e.tagName.toLowerCase()){case o.Rect.nodeType:t=new o.Rect(e),m(t);break;case o.Ellipse.nodeType:t=new o.Ellipse(e),c(t,r.defaultEllipse);break;case o.Polyline.nodeType:t=new o.Polyline(e),c(t,r.defaultPolyline);break;case o.Path.nodeType:t=new o.Path(e),c(t,r.defaultPath);break;case o.Circle.nodeType:t=new o.Circle(e),c(t,r.defaultCircle);break;case o.Line.nodeType:t=new o.Line(e),c(t,r.defaultLine);break;case o.Image.nodeType:t=new o.Image(e),c(t,r.defaultImage);break;case o.Text.nodeType:var a=e.getElementsByTagName("textPath");a&&a.length?(t=new o.TextPath(e),c(t,r.defaultPath),g(t)):(t=new o.Text(e),f(t)),h(t);break;default:return null}return t instanceof o.Image||(s(t),l(t)),u(t),t},o.attachSurface=function(e){var t=new o.Surface;t.rawNode=e;var a=e.getElementsByTagName("defs");return 0==a.length?null:(t.defNode=a[0],t)},o});//# sourceMappingURL=svg_attach.js.map