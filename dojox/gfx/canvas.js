//>>built
define("dojox/gfx/canvas",["./_base","dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/_base/window","dojo/dom-geometry","dojo/dom","./shape","./path","./arc","./matrix","./decompose","./bezierutils"],function(e,t,a,o,r,n,s,d,l,h,u,c,m){function f(e,t,i,a,o,r,n,s,d,l){var h,u,c=t.length,m=0;for(l?(u=l.l/o,m=l.i):u=t[0]/o;n>r;)r+u>n&&(h={l:(r+u-n)*o,i:m},u=n-r),m%2||(e.beginPath(),e.arc(i,a,o,r,r+u,s),d&&e.stroke()),r+=u,++m,u=t[m%c]/o;return h}function y(e,t,i,a){var o,r=0,n=0,s=0;for(a?(o=a.l,s=a.i):o=t[0];1>n;){if(n=m.tAtLength(e,o),1==n){var d=m.computeLength(e);r={l:o-d,i:s}}var l=m.splitBezierAtT(e,n);s%2||i.push(l[0]),e=l[1],++s,o=t[s%t.length]}return r}function g(e,t,i,a){for(var o=[t.last.x,t.last.y].concat(i),r=4===i.length,n=!(e instanceof Array),s=r?"quadraticCurveTo":"bezierCurveTo",d=[],l=y(o,t.canvasDash,d,a),h=0;h<d.length;++h){var u=d[h];n?(e.moveTo(u[0],u[1]),e[s].apply(e,u.slice(2))):(e.push("moveTo",[u[0],u[1]]),e.push(s,u.slice(2)))}return l}function v(e,t,i,a,o,r,n){var s,d,l=0,h=0,u=0,c=m.distance(i,a,o,r),f=0,p=t.canvasDash,y=i,g=a,v=!(e instanceof Array);for(n?(u=n.l,f=n.i):u+=p[0];Math.abs(1-h)>.01;)u>c&&(l={l:u-c,i:f},u=c),h=u/c,s=i+(o-i)*h,d=a+(r-a)*h,f++%2||(v?(e.moveTo(y,g),e.lineTo(s,d)):(e.push("moveTo",[y,g]),e.push("lineTo",[s,d]))),y=s,g=d,u+=p[f%p.length];return l}var b=e.canvas={},M=null,j=u.multiplyPoint,k=Math.PI,w=2*k,_=k/2,x=t.extend;if(r.global.CanvasRenderingContext2D)var T=r.doc.createElement("canvas").getContext("2d"),C="function"==typeof T.setLineDash,I="function"==typeof T.fillText;var F={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};b.Shape=o("dojox.gfx.canvas.Shape",d.Shape,{_render:function(e){e.save(),this._renderTransform(e),this._renderClip(e),this._renderShape(e),this._renderFill(e,!0),this._renderStroke(e,!0),e.restore()},_renderClip:function(e){this.canvasClip&&(this.canvasClip.render(e),e.clip())},_renderTransform:function(e){if("canvasTransform"in this){var t=this.canvasTransform;e.translate(t.dx,t.dy),e.rotate(t.angle2),e.scale(t.sx,t.sy),e.rotate(t.angle1)}},_renderShape:function(e){},_renderFill:function(e,t){if("canvasFill"in this){var i=this.fillStyle;if("canvasFillImage"in this){var a=i.width,o=i.height,r=this.canvasFillImage.width,n=this.canvasFillImage.height,s=a==r?1:a/r,d=o==n?1:o/n,l=Math.min(s,d),h=(a-l*r)/2,u=(o-l*n)/2;M.width=a,M.height=o;var c=M.getContext("2d");c.clearRect(0,0,a,o),c.drawImage(this.canvasFillImage,0,0,r,n,h,u,l*r,l*n),this.canvasFill=e.createPattern(M,"repeat"),delete this.canvasFillImage}e.fillStyle=this.canvasFill,t&&("pattern"!==i.type||0===i.x&&0===i.y||e.translate(i.x,i.y),e.fill())}else e.fillStyle="rgba(0,0,0,0.0)"},_renderStroke:function(e,t){var i=this.strokeStyle;i?(e.strokeStyle=i.color.toString(),e.lineWidth=i.width,e.lineCap=i.cap,"number"==typeof i.join?(e.lineJoin="miter",e.miterLimit=i.join):e.lineJoin=i.join,this.canvasDash?C?(e.setLineDash(this.canvasDash),t&&e.stroke()):this._renderDashedStroke(e,t):t&&e.stroke()):t||(e.strokeStyle="rgba(0,0,0,0.0)")},_renderDashedStroke:function(e,t){},getEventSource:function(){return null},on:function(){},connect:function(){},disconnect:function(){},canvasClip:null,setClip:function(e){this.inherited(arguments);var t=e?"width"in e?"rect":"cx"in e?"ellipse":"points"in e?"polyline":"d"in e?"path":null:null;return e&&!t?this:(this.canvasClip=e?S(t,e):null,this.parent&&this.parent._makeDirty(),this)}});var S=function(e,i){switch(e){case"ellipse":return{canvasEllipse:B({shape:i}),render:function(e){return b.Ellipse.prototype._renderShape.call(this,e)}};case"rect":return{shape:t.delegate(i,{r:0}),render:function(e){return b.Rect.prototype._renderShape.call(this,e)}};case"path":return{canvasPath:E(i),render:function(e){this.canvasPath._renderShape(e)}};case"polyline":return{canvasPolyline:i.points,render:function(e){return b.Polyline.prototype._renderShape.call(this,e)}}}return null},E=function(e){var t=new dojox.gfx.canvas.Path;return t.canvasPath=[],t._setPath(e.d),t},A=function(e,t,i){var a=e.prototype[t];e.prototype[t]=i?function(){return this.parent&&this.parent._makeDirty(),a.apply(this,arguments),i.call(this),this}:function(){return this.parent&&this.parent._makeDirty(),a.apply(this,arguments)}};A(b.Shape,"setTransform",function(){this.matrix?this.canvasTransform=e.decompose(this.matrix):delete this.canvasTransform}),A(b.Shape,"setFill",function(){var t,i=this.fillStyle;if(i){if("object"==typeof i&&"type"in i){var o=this.surface.rawNode.getContext("2d");switch(i.type){case"linear":case"radial":t="linear"==i.type?o.createLinearGradient(i.x1,i.y1,i.x2,i.y2):o.createRadialGradient(i.cx,i.cy,0,i.cx,i.cy,i.r),a.forEach(i.colors,function(i){t.addColorStop(i.offset,e.normalizeColor(i.color).toString())});break;case"pattern":M||(M=document.createElement("canvas"));var r=new Image;this.surface.downloadImage(r,i.src),this.canvasFillImage=r}}else t=i.toString();this.canvasFill=t}else delete this.canvasFill}),A(b.Shape,"setStroke",function(){var e=this.strokeStyle;if(e){var t=this.strokeStyle.style.toLowerCase();if(t in F&&(t=F[t]),t instanceof Array){t=t.slice(),this.canvasDash=t;var i;for(i=0;i<t.length;++i)t[i]*=e.width;if("butt"!=e.cap){for(i=0;i<t.length;i+=2)t[i]-=e.width,t[i]<1&&(t[i]=1);for(i=1;i<t.length;i+=2)t[i]+=e.width}}else delete this.canvasDash}else delete this.canvasDash;this._needsDash=!C&&!!this.canvasDash}),A(b.Shape,"setShape"),b.Group=o("dojox.gfx.canvas.Group",b.Shape,{constructor:function(){d.Container._init.call(this)},_render:function(e){e.save(),this._renderTransform(e),this._renderClip(e);for(var t=0;t<this.children.length;++t)this.children[t]._render(e);e.restore()},destroy:function(){d.Container.clear.call(this,!0),b.Shape.prototype.destroy.apply(this,arguments)}}),b.Rect=o("dojox.gfx.canvas.Rect",[b.Shape,d.Rect],{_renderShape:function(e){var t=this.shape,i=Math.min(t.r,t.height/2,t.width/2),a=t.x,o=a+t.width,r=t.y,n=r+t.height,s=a+i,d=o-i,l=r+i,h=n-i;e.beginPath(),e.moveTo(s,r),i?(e.arc(d,l,i,-_,0,!1),e.arc(d,h,i,0,_,!1),e.arc(s,h,i,_,k,!1),e.arc(s,l,i,k,k+_,!1)):(e.lineTo(d,r),e.lineTo(o,h),e.lineTo(s,n),e.lineTo(a,l)),e.closePath()},_renderDashedStroke:function(e,t){var i,a=this.shape,o=Math.min(a.r,a.height/2,a.width/2),r=a.x,n=r+a.width,s=a.y,d=s+a.height,l=r+o,h=n-o,u=s+o,c=d-o;o?(e.beginPath(),i=v(e,this,l,s,h,s),t&&e.stroke(),i=f(e,this.canvasDash,h,u,o,-_,0,!1,t,i),e.beginPath(),i=v(e,this,n,u,n,c,i),t&&e.stroke(),i=f(e,this.canvasDash,h,c,o,0,_,!1,t,i),e.beginPath(),i=v(e,this,h,d,l,d,i),t&&e.stroke(),i=f(e,this.canvasDash,l,c,o,_,k,!1,t,i),e.beginPath(),i=v(e,this,r,c,r,u,i),t&&e.stroke(),f(e,this.canvasDash,l,u,o,k,k+_,!1,t,i)):(e.beginPath(),i=v(e,this,l,s,h,s),i=v(e,this,h,s,n,c,i),i=v(e,this,n,c,l,d,i),v(e,this,l,d,r,u,i),t&&e.stroke())}});var P=[];!function(){var e=h.curvePI4;P.push(e.s,e.c1,e.c2,e.e);for(var t=45;360>t;t+=45){var i=u.rotateg(t);P.push(j(i,e.c1),j(i,e.c2),j(i,e.e))}}();var B=function(e){var t,i,a,o=[],r=e.shape,n=u.normalize([u.translate(r.cx,r.cy),u.scale(r.rx,r.ry)]);t=j(n,P[0]),o.push([t.x,t.y]);for(var s=1;s<P.length;s+=3)i=j(n,P[s]),a=j(n,P[s+1]),t=j(n,P[s+2]),o.push([i.x,i.y,a.x,a.y,t.x,t.y]);if(e._needsDash){var d=[],l=o[0];for(s=1;s<o.length;++s){var h=[];y(l.concat(o[s]),e.canvasDash,h),l=[o[s][4],o[s][5]],d.push(h)}e._dashedPoints=d}return o};b.Ellipse=o("dojox.gfx.canvas.Ellipse",[b.Shape,d.Ellipse],{setShape:function(){return this.inherited(arguments),this.canvasEllipse=B(this),this},setStroke:function(){return this.inherited(arguments),C||(this.canvasEllipse=B(this)),this},_renderShape:function(e){var t,i=this.canvasEllipse;for(e.beginPath(),e.moveTo.apply(e,i[0]),t=1;t<i.length;++t)e.bezierCurveTo.apply(e,i[t]);e.closePath()},_renderDashedStroke:function(e,t){var i=this._dashedPoints;e.beginPath();for(var a=0;a<i.length;++a)for(var o=i[a],r=0;r<o.length;++r){var n=o[r];e.moveTo(n[0],n[1]),e.bezierCurveTo(n[2],n[3],n[4],n[5],n[6],n[7])}t&&e.stroke()}}),b.Circle=o("dojox.gfx.canvas.Circle",[b.Shape,d.Circle],{_renderShape:function(e){var t=this.shape;e.beginPath(),e.arc(t.cx,t.cy,t.r,0,w,1)},_renderDashedStroke:function(e,t){var a,o=this.shape,r=0,n=this.canvasDash.length;for(i=0;w>r;)a=this.canvasDash[i%n]/o.r,i%2||(e.beginPath(),e.arc(o.cx,o.cy,o.r,r,r+a,0),t&&e.stroke()),r+=a,++i}}),b.Line=o("dojox.gfx.canvas.Line",[b.Shape,d.Line],{_renderShape:function(e){var t=this.shape;e.beginPath(),e.moveTo(t.x1,t.y1),e.lineTo(t.x2,t.y2)},_renderDashedStroke:function(e,t){var i=this.shape;e.beginPath(),v(e,this,i.x1,i.y1,i.x2,i.y2),t&&e.stroke()}}),b.Polyline=o("dojox.gfx.canvas.Polyline",[b.Shape,d.Polyline],{setShape:function(){this.inherited(arguments);var e,t,i,a=this.shape.points,o=a[0];if(this.bbox=null,this._normalizePoints(),a.length)if("number"==typeof o)e=a;else for(e=[],i=0;i<a.length;++i)t=a[i],e.push(t.x,t.y);else e=[];return this.canvasPolyline=e,this},_renderShape:function(e){var t=this.canvasPolyline;if(t.length){e.beginPath(),e.moveTo(t[0],t[1]);for(var i=2;i<t.length;i+=2)e.lineTo(t[i],t[i+1])}},_renderDashedStroke:function(e,t){var i=this.canvasPolyline,a=0;e.beginPath();for(var o=0;o<i.length;o+=2)a=v(e,this,i[o],i[o+1],i[o+2],i[o+3],a);t&&e.stroke()}}),b.Image=o("dojox.gfx.canvas.Image",[b.Shape,d.Image],{setShape:function(){this.inherited(arguments);var e=new Image;return this.surface.downloadImage(e,this.shape.src),this.canvasImage=e,this},_renderShape:function(e){var t=this.shape;e.drawImage(this.canvasImage,t.x,t.y,t.width,t.height)}}),b.Text=o("dojox.gfx.canvas.Text",[b.Shape,d.Text],{_setFont:function(){this.fontStyle?this.canvasFont=e.makeFontString(this.fontStyle):delete this.canvasFont},getTextWidth:function(){var e,t=this.shape,i=0;return t.text&&(e=this.surface.rawNode.getContext("2d"),e.save(),this._renderTransform(e),this._renderFill(e,!1),this._renderStroke(e,!1),this.canvasFont&&(e.font=this.canvasFont),i=e.measureText(t.text).width,e.restore()),i},_render:function(e){e.save(),this._renderTransform(e),this._renderFill(e,!1),this._renderStroke(e,!1),this._renderShape(e),e.restore()},_renderShape:function(e){var t,i=this.shape;i.text&&(t="middle"===i.align?"center":i.align,e.textAlign=t,this.canvasFont&&(e.font=this.canvasFont),this.canvasFill&&e.fillText(i.text,i.x,i.y),this.strokeStyle&&(e.beginPath(),e.strokeText(i.text,i.x,i.y),e.closePath()))}}),A(b.Text,"setFont"),I||b.Text.extend({getTextWidth:function(){return 0},getBoundingBox:function(){return null},_renderShape:function(){}});var N={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"};b.Path=o("dojox.gfx.canvas.Path",[b.Shape,l.Path],{constructor:function(){this.lastControl={}},setShape:function(){return this.canvasPath=[],this._dashedPath=[],this.inherited(arguments)},setStroke:function(){return this.inherited(arguments),C||(this.segmented=!1,this._confirmSegmented()),this},_setPath:function(){this._dashResidue=null,this.inherited(arguments)},_updateWithSegment:function(e){var i=t.clone(this.last);this[N[e.action]](this.canvasPath,e.action,e.args,this._needsDash?this._dashedPath:null),this.last=i,this.inherited(arguments)},_renderShape:function(e){var t=this.canvasPath;e.beginPath();for(var i=0;i<t.length;i+=2)e[t[i]].apply(e,t[i+1])},_renderDashedStroke:C?function(){}:function(e,t){var i=this._dashedPath;e.beginPath();for(var a=0;a<i.length;a+=2)e[i[a]].apply(e,i[a+1]);t&&e.stroke()},_moveToA:function(e,t,i,a){e.push("moveTo",[i[0],i[1]]),a&&a.push("moveTo",[i[0],i[1]]);for(var o=2;o<i.length;o+=2)e.push("lineTo",[i[o],i[o+1]]),a&&(this._dashResidue=v(a,this,i[o-2],i[o-1],i[o],i[o+1],this._dashResidue));this.last.x=i[i.length-2],this.last.y=i[i.length-1],this.lastControl={}},_moveToR:function(e,t,i,a){var o;"x"in this.last?(o=[this.last.x+=i[0],this.last.y+=i[1]],e.push("moveTo",o),a&&a.push("moveTo",o)):(o=[this.last.x=i[0],this.last.y=i[1]],e.push("moveTo",o),a&&a.push("moveTo",o));for(var r=2;r<i.length;r+=2)e.push("lineTo",[this.last.x+=i[r],this.last.y+=i[r+1]]),a&&(this._dashResidue=v(a,this,a[a.length-1][0],a[a.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_lineToA:function(e,t,i,a){for(var o=0;o<i.length;o+=2)a&&(this._dashResidue=v(a,this,this.last.x,this.last.y,i[o],i[o+1],this._dashResidue)),e.push("lineTo",[i[o],i[o+1]]);this.last.x=i[i.length-2],this.last.y=i[i.length-1],this.lastControl={}},_lineToR:function(e,t,i,a){for(var o=0;o<i.length;o+=2)e.push("lineTo",[this.last.x+=i[o],this.last.y+=i[o+1]]),a&&(this._dashResidue=v(a,this,a[a.length-1][0],a[a.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_hLineToA:function(e,t,i,a){for(var o=0;o<i.length;++o)e.push("lineTo",[i[o],this.last.y]),a&&(this._dashResidue=v(a,this,a[a.length-1][0],a[a.length-1][1],i[o],this.last.y,this._dashResidue));this.last.x=i[i.length-1],this.lastControl={}},_hLineToR:function(e,t,i,a){for(var o=0;o<i.length;++o)e.push("lineTo",[this.last.x+=i[o],this.last.y]),a&&(this._dashResidue=v(a,this,a[a.length-1][0],a[a.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_vLineToA:function(e,t,i,a){for(var o=0;o<i.length;++o)e.push("lineTo",[this.last.x,i[o]]),a&&(this._dashResidue=v(a,this,a[a.length-1][0],a[a.length-1][1],this.last.x,i[o],this._dashResidue));this.last.y=i[i.length-1],this.lastControl={}},_vLineToR:function(e,t,i,a){for(var o=0;o<i.length;++o)e.push("lineTo",[this.last.x,this.last.y+=i[o]]),a&&(this._dashResidue=v(a,this,a[a.length-1][0],a[a.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_curveToA:function(e,t,i,a){for(var o=0;o<i.length;o+=6)e.push("bezierCurveTo",i.slice(o,o+6)),a&&(this._dashResidue=g(a,this,e[e.length-1],this._dashResidue));this.last.x=i[i.length-2],this.last.y=i[i.length-1],this.lastControl.x=i[i.length-4],this.lastControl.y=i[i.length-3],this.lastControl.type="C"},_curveToR:function(e,t,i,a){for(var o=0;o<i.length;o+=6)e.push("bezierCurveTo",[this.last.x+i[o],this.last.y+i[o+1],this.lastControl.x=this.last.x+i[o+2],this.lastControl.y=this.last.y+i[o+3],this.last.x+i[o+4],this.last.y+i[o+5]]),a&&(this._dashResidue=g(a,this,e[e.length-1],this._dashResidue)),this.last.x+=i[o+4],this.last.y+=i[o+5];this.lastControl.type="C"},_smoothCurveToA:function(e,t,i,a){for(var o=0;o<i.length;o+=4){var r="C"==this.lastControl.type;e.push("bezierCurveTo",[r?2*this.last.x-this.lastControl.x:this.last.x,r?2*this.last.y-this.lastControl.y:this.last.y,i[o],i[o+1],i[o+2],i[o+3]]),a&&(this._dashResidue=g(a,this,e[e.length-1],this._dashResidue)),this.lastControl.x=i[o],this.lastControl.y=i[o+1],this.lastControl.type="C"}this.last.x=i[i.length-2],this.last.y=i[i.length-1]},_smoothCurveToR:function(e,t,i,a){for(var o=0;o<i.length;o+=4){var r="C"==this.lastControl.type;e.push("bezierCurveTo",[r?2*this.last.x-this.lastControl.x:this.last.x,r?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+i[o],this.last.y+i[o+1],this.last.x+i[o+2],this.last.y+i[o+3]]),a&&(this._dashResidue=g(a,this,e[e.length-1],this._dashResidue)),this.lastControl.x=this.last.x+i[o],this.lastControl.y=this.last.y+i[o+1],this.lastControl.type="C",this.last.x+=i[o+2],this.last.y+=i[o+3]}},_qCurveToA:function(e,t,i,a){for(var o=0;o<i.length;o+=4)e.push("quadraticCurveTo",i.slice(o,o+4));a&&(this._dashResidue=g(a,this,e[e.length-1],this._dashResidue)),this.last.x=i[i.length-2],this.last.y=i[i.length-1],this.lastControl.x=i[i.length-4],this.lastControl.y=i[i.length-3],this.lastControl.type="Q"},_qCurveToR:function(e,t,i,a){for(var o=0;o<i.length;o+=4)e.push("quadraticCurveTo",[this.lastControl.x=this.last.x+i[o],this.lastControl.y=this.last.y+i[o+1],this.last.x+i[o+2],this.last.y+i[o+3]]),a&&(this._dashResidue=g(a,this,e[e.length-1],this._dashResidue)),this.last.x+=i[o+2],this.last.y+=i[o+3];this.lastControl.type="Q"},_qSmoothCurveToA:function(e,t,i,a){for(var o=0;o<i.length;o+=2){var r="Q"==this.lastControl.type;e.push("quadraticCurveTo",[this.lastControl.x=r?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=r?2*this.last.y-this.lastControl.y:this.last.y,i[o],i[o+1]]),a&&(this._dashResidue=g(a,this,e[e.length-1],this._dashResidue)),this.lastControl.type="Q"}this.last.x=i[i.length-2],this.last.y=i[i.length-1]},_qSmoothCurveToR:function(e,t,i,a){for(var o=0;o<i.length;o+=2){var r="Q"==this.lastControl.type;e.push("quadraticCurveTo",[this.lastControl.x=r?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=r?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+i[o],this.last.y+i[o+1]]),a&&(this._dashResidue=g(a,this,e[e.length-1],this._dashResidue)),this.lastControl.type="Q",this.last.x+=i[o],this.last.y+=i[o+1]}},_arcTo:function(e,t,i,o){for(var r="a"==t,n=0;n<i.length;n+=7){var s=i[n+5],d=i[n+6];r&&(s+=this.last.x,d+=this.last.y);var l=h.arcAsBezier(this.last,i[n],i[n+1],i[n+2],i[n+3]?1:0,i[n+4]?1:0,s,d);a.forEach(l,function(t){e.push("bezierCurveTo",t)}),o&&(this._dashResidue=g(o,this,p,this._dashResidue)),this.last.x=s,this.last.y=d}this.lastControl={}},_closePath:function(e,t,i,a){e.push("closePath",[]),a&&(this._dashResidue=v(a,this,this.last.x,this.last.y,a[1][0],a[1][1],this._dashResidue)),this.lastControl={}}}),a.forEach(["moveTo","lineTo","hLineTo","vLineTo","curveTo","smoothCurveTo","qCurveTo","qSmoothCurveTo","arcTo","closePath"],function(e){A(b.Path,e)}),b.TextPath=o("dojox.gfx.canvas.TextPath",[b.Shape,l.TextPath],{_renderShape:function(e){this.shape},_setText:function(){},_setFont:function(){}}),b.Surface=o("dojox.gfx.canvas.Surface",d.Surface,{constructor:function(){d.Container._init.call(this),this.pendingImageCount=0,this.makeDirty()},destroy:function(){d.Container.clear.call(this,!0),this.inherited(arguments)},setDimensions:function(t,i){if(this.width=e.normalizedLength(t),this.height=e.normalizedLength(i),!this.rawNode)return this;var a=!1;return this.rawNode.width!=this.width&&(this.rawNode.width=this.width,a=!0),this.rawNode.height!=this.height&&(this.rawNode.height=this.height,a=!0),a&&this.makeDirty(),this},getDimensions:function(){return this.rawNode?{width:this.rawNode.width,height:this.rawNode.height}:null},_render:function(e){if(this.rawNode&&(e||!this.pendingImageCount)){var t=this.rawNode.getContext("2d");t.clearRect(0,0,this.rawNode.width,this.rawNode.height),this.render(t),"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender)}},render:function(e){e.save();for(var t=0;t<this.children.length;++t)this.children[t]._render(e);e.restore()},makeDirty:function(){this.pendingImagesCount||"pendingRender"in this||this._batch||(this.pendingRender=setTimeout(t.hitch(this,this._render),0))},downloadImage:function(e,i){var a=t.hitch(this,this.onImageLoad);!this.pendingImageCount++&&"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender),e.onload=a,e.onerror=a,e.onabort=a,e.src=i},onImageLoad:function(){--this.pendingImageCount||(this.onImagesLoaded(),this._render())},onImagesLoaded:function(){},getEventSource:function(){return null},connect:function(){},disconnect:function(){},on:function(){}}),b.createSurface=function(t,i,a){if(!i&&!a){var o=n.position(t);i=i||o.w,a=a||o.h}"number"==typeof i&&(i+="px"),"number"==typeof a&&(a+="px");var r=new b.Surface,d=s.byId(t),l=d.ownerDocument.createElement("canvas");return l.width=e.normalizedLength(i),l.height=e.normalizedLength(a),d.appendChild(l),r.rawNode=l,r._parent=d,r.surface=r,r};var z=d.Container,D={openBatch:function(){return++this._batch,this},closeBatch:function(){return this._batch=this._batch>0?--this._batch:0,this._makeDirty(),this},_makeDirty:function(){this._batch||this.surface.makeDirty()},add:function(e){return this._makeDirty(),z.add.apply(this,arguments)},remove:function(e,t){return this._makeDirty(),z.remove.apply(this,arguments)},clear:function(){return this._makeDirty(),z.clear.apply(this,arguments)},getBoundingBox:z.getBoundingBox,_moveChildToFront:function(e){return this._makeDirty(),z._moveChildToFront.apply(this,arguments)},_moveChildToBack:function(e){return this._makeDirty(),z._moveChildToBack.apply(this,arguments)}},G={createObject:function(e,t){var i=new e;return i.surface=this.surface,i.setShape(t),this.add(i),i}};return x(b.Group,D),x(b.Group,d.Creator),x(b.Group,G),x(b.Surface,D),x(b.Surface,d.Creator),x(b.Surface,G),b.fixTarget=function(e,t){return!0},b});//# sourceMappingURL=canvas.js.map