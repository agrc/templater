//>>built
define("dojox/gfx/vml_attach",["dojo/_base/kernel","dojo/_base/lang","./_base","./matrix","./path","dojo/_base/Color","./vml"],function(e,t,a,i,r,n,o){e.experimental("dojox.gfx.vml_attach"),o.attachNode=function(e){if(!e)return null;var t=null;switch(e.tagName.toLowerCase()){case o.Rect.nodeType:t=new o.Rect(e),m(t);break;case o.Ellipse.nodeType:e.style.width==e.style.height?(t=new o.Circle(e),c(t)):(t=new o.Ellipse(e),u(t));break;case o.Path.nodeType:switch(e.getAttribute("dojoGfxType")){case"line":t=new o.Line(e),f(t);break;case"polyline":t=new o.Polyline(e),g(t);break;case"path":t=new o.Path(e),M(t);break;case"text":t=new o.Text(e),v(t),k(t),b(t);break;case"textpath":t=new o.TextPath(e),M(t),v(t),k(t)}break;case o.Image.nodeType:switch(e.getAttribute("dojoGfxType")){case"image":t=new o.Image(e),p(t),y(t)}break;default:return null}return t instanceof o.Image||(s(t),l(t),t instanceof o.Text||d(t)),t},o.attachSurface=function(e){var t=new o.Surface;t.clipNode=e;var a=t.rawNode=e.firstChild,i=a.firstChild;return i&&"rect"==i.tagName?(t.bgNode=a,t):null};var s=function(e){var r,s,l,d=null,m=e.rawNode,u=m.fill;if(u.on&&"gradient"==u.type)for(d=t.clone(a.defaultLinearGradient),rad=i._degToRad(u.angle),d.x2=Math.cos(rad),d.y2=Math.sin(rad),d.colors=[],r=u.colors.value.split(";"),s=0;s<r.length;++s)(l=r[s].match(/\S+/g))&&2==l.length&&d.colors.push({offset:o._parseFloat(l[0]),color:new n(l[1])});else if(u.on&&"gradientradial"==u.type)for(d=t.clone(a.defaultRadialGradient),w=parseFloat(m.style.width),h=parseFloat(m.style.height),d.cx=isNaN(w)?0:u.focusposition.x*w,d.cy=isNaN(h)?0:u.focusposition.y*h,d.r=isNaN(w)?1:w/2,d.colors=[],r=u.colors.value.split(";"),s=r.length-1;s>=0;--s)(l=r[s].match(/\S+/g))&&2==l.length&&d.colors.push({offset:o._parseFloat(l[0]),color:new n(l[1])});else u.on&&"tile"==u.type?(d=t.clone(a.defaultPattern),d.width=a.pt2px(u.size.x),d.height=a.pt2px(u.size.y),d.x=u.origin.x*d.width,d.y=u.origin.y*d.height,d.src=u.src):u.on&&m.fillcolor&&(d=new n(m.fillcolor+""),d.a=u.opacity);e.fillStyle=d},l=function(e){var i=e.rawNode;if(!i.stroked)return void(e.strokeStyle=null);var r=e.strokeStyle=t.clone(a.defaultStroke),o=i.stroke;r.color=new n(i.strokecolor.value),r.width=a.normalizedLength(i.strokeweight+""),r.color.a=o.opacity,r.cap=this._translate(this._capMapReversed,o.endcap),r.join="miter"==o.joinstyle?o.miterlimit:o.joinstyle,r.style=o.dashstyle},d=function(e){var t=e.rawNode.skew,r=t.matrix,n=t.offset;e.matrix=i.normalize({xx:r.xtox,xy:r.ytox,yx:r.xtoy,yy:r.ytoy,dx:a.pt2px(n.x),dy:a.pt2px(n.y)})},m=function(e){var t=e.rawNode,i=t.outerHTML.match(/arcsize = \"(\d*\.?\d+[%f]?)\"/)[1],r=t.style,n=parseFloat(r.width),s=parseFloat(r.height);i=i.indexOf("%")>=0?parseFloat(i)/100:o._parseFloat(i),e.shape=a.makeParameters(a.defaultRect,{x:parseInt(r.left),y:parseInt(r.top),width:n,height:s,r:Math.min(n,s)*i})},u=function(e){var t=e.rawNode.style,i=parseInt(t.width)/2,r=parseInt(t.height)/2;e.shape=a.makeParameters(a.defaultEllipse,{cx:parseInt(t.left)+i,cy:parseInt(t.top)+r,rx:i,ry:r})},c=function(e){var t=e.rawNode.style,i=parseInt(t.width)/2;e.shape=a.makeParameters(a.defaultCircle,{cx:parseInt(t.left)+i,cy:parseInt(t.top)+i,r:i})},f=function(e){var i=e.shape=t.clone(a.defaultLine),r=e.rawNode.path.v.match(a.pathVmlRegExp);do{if(r.length<7||"m"!=r[0]||"l"!=r[3]||"e"!=r[6])break;i.x1=parseInt(r[1]),i.y1=parseInt(r[2]),i.x2=parseInt(r[4]),i.y2=parseInt(r[5])}while(!1)},g=function(e){var i=e.shape=t.clone(a.defaultPolyline),r=e.rawNode.path.v.match(a.pathVmlRegExp);do{if(r.length<3||"m"!=r[0])break;var n=parseInt(r[0]),o=parseInt(r[1]);if(isNaN(n)||isNaN(o))break;if(i.points.push({x:n,y:o}),r.length<6||"l"!=r[3])break;for(var s=4;s<r.length&&(n=parseInt(r[s]),o=parseInt(r[s+1]),!isNaN(n)&&!isNaN(o));s+=2)i.points.push({x:n,y:o})}while(!1)},p=function(e){e.shape=t.clone(a.defaultImage),e.shape.src=e.rawNode.firstChild.src},y=function(e){var t=e.rawNode.filters["DXImageTransform.Microsoft.Matrix"];e.matrix=i.normalize({xx:t.M11,xy:t.M12,yx:t.M21,yy:t.M22,dx:t.Dx,dy:t.Dy})},v=function(e){var i=e.shape=t.clone(a.defaultText),r=e.rawNode,n=r.path.v.match(a.pathVmlRegExp);do{if(!n||7!=n.length)break;for(var s=r.childNodes,l=0;l<s.length&&"textpath"!=s[l].tagName;++l);if(l>=s.length)break;var d=s[l].style;switch(i.text=s[l].string,d["v-text-align"]){case"left":i.x=parseInt(n[1]),i.align="start";break;case"center":i.x=(parseInt(n[1])+parseInt(n[4]))/2,i.align="middle";break;case"right":i.x=parseInt(n[4]),i.align="end"}return i.y=parseInt(n[2]),i.decoration=d["text-decoration"],i.rotated=d["v-rotate-letters"].toLowerCase()in o._bool,void(i.kerning=d["v-text-kern"].toLowerCase()in o._bool)}while(!1);e.shape=null},k=function(e){for(var i=e.fontStyle=t.clone(a.defaultFont),r=e.rawNode.childNodes,n=0;n<r.length&&"textpath"==r[n].tagName;++n);if(n>=r.length)return void(e.fontStyle=null);var o=r[n].style;i.style=o.fontstyle,i.variant=o.fontvariant,i.weight=o.fontweight,i.size=o.fontsize,i.family=o.fontfamily},b=function(e){d(e);var t=e.matrix,r=e.fontStyle;t&&r&&(e.matrix=i.multiply(t,{dy:.35*a.normalizedLength(r.size)}))},M=function(e){for(var i=e.shape=t.clone(a.defaultPath),n=e.rawNode.path.v.match(a.pathVmlRegExp),o=[],s=!1,l=r._pathVmlToSvgMap,d=0;d<n.length;++n){var m=n[d];if(m in l)s=!1,o.push(l[m]);else if(!s){var u=parseInt(m);isNaN(u)?s=!0:o.push(u)}}var c=o.length;c>=4&&""==o[c-1]&&0==o[c-2]&&0==o[c-3]&&"l"==o[c-4]&&o.splice(c-4,4),c&&(i.path=o.join(" "))};return o});//# sourceMappingURL=vml_attach.js.map