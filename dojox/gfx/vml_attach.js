//>>built
define("dojox/gfx/vml_attach",["dojo/_base/kernel","dojo/_base/lang","./_base","./matrix","./path","dojo/_base/Color","./vml"],function(e,t,i,a,o,r,n){e.experimental("dojox.gfx.vml_attach"),n.attachNode=function(e){if(!e)return null;var t=null;switch(e.tagName.toLowerCase()){case n.Rect.nodeType:t=new n.Rect(e),u(t);break;case n.Ellipse.nodeType:e.style.width==e.style.height?(t=new n.Circle(e),c(t)):(t=new n.Ellipse(e),m(t));break;case n.Path.nodeType:switch(e.getAttribute("dojoGfxType")){case"line":t=new n.Line(e),f(t);break;case"polyline":t=new n.Polyline(e),p(t);break;case"path":t=new n.Path(e),k(t);break;case"text":t=new n.Text(e),v(t),b(t),M(t);break;case"textpath":t=new n.TextPath(e),k(t),v(t),b(t)}break;case n.Image.nodeType:switch(e.getAttribute("dojoGfxType")){case"image":t=new n.Image(e),g(t),y(t)}break;default:return null}return t instanceof n.Image||(s(t),l(t),t instanceof n.Text||d(t)),t},n.attachSurface=function(e){var t=new n.Surface;t.clipNode=e;var i=t.rawNode=e.firstChild,a=i.firstChild;return a&&"rect"==a.tagName?(t.bgNode=i,t):null};var s=function(e){var o,s,l,d=null,u=e.rawNode,m=u.fill;if(m.on&&"gradient"==m.type)for(d=t.clone(i.defaultLinearGradient),rad=a._degToRad(m.angle),d.x2=Math.cos(rad),d.y2=Math.sin(rad),d.colors=[],o=m.colors.value.split(";"),s=0;s<o.length;++s)l=o[s].match(/\S+/g),l&&2==l.length&&d.colors.push({offset:n._parseFloat(l[0]),color:new r(l[1])});else if(m.on&&"gradientradial"==m.type)for(d=t.clone(i.defaultRadialGradient),w=parseFloat(u.style.width),h=parseFloat(u.style.height),d.cx=isNaN(w)?0:m.focusposition.x*w,d.cy=isNaN(h)?0:m.focusposition.y*h,d.r=isNaN(w)?1:w/2,d.colors=[],o=m.colors.value.split(";"),s=o.length-1;s>=0;--s)l=o[s].match(/\S+/g),l&&2==l.length&&d.colors.push({offset:n._parseFloat(l[0]),color:new r(l[1])});else m.on&&"tile"==m.type?(d=t.clone(i.defaultPattern),d.width=i.pt2px(m.size.x),d.height=i.pt2px(m.size.y),d.x=m.origin.x*d.width,d.y=m.origin.y*d.height,d.src=m.src):m.on&&u.fillcolor&&(d=new r(u.fillcolor+""),d.a=m.opacity);e.fillStyle=d},l=function(e){var a=e.rawNode;if(!a.stroked)return void(e.strokeStyle=null);var o=e.strokeStyle=t.clone(i.defaultStroke),n=a.stroke;o.color=new r(a.strokecolor.value),o.width=i.normalizedLength(a.strokeweight+""),o.color.a=n.opacity,o.cap=this._translate(this._capMapReversed,n.endcap),o.join="miter"==n.joinstyle?n.miterlimit:n.joinstyle,o.style=n.dashstyle},d=function(e){var t=e.rawNode.skew,o=t.matrix,r=t.offset;e.matrix=a.normalize({xx:o.xtox,xy:o.ytox,yx:o.xtoy,yy:o.ytoy,dx:i.pt2px(r.x),dy:i.pt2px(r.y)})},u=function(e){var t=e.rawNode,a=t.outerHTML.match(/arcsize = \"(\d*\.?\d+[%f]?)\"/)[1],o=t.style,r=parseFloat(o.width),s=parseFloat(o.height);a=a.indexOf("%")>=0?parseFloat(a)/100:n._parseFloat(a),e.shape=i.makeParameters(i.defaultRect,{x:parseInt(o.left),y:parseInt(o.top),width:r,height:s,r:Math.min(r,s)*a})},m=function(e){var t=e.rawNode.style,a=parseInt(t.width)/2,o=parseInt(t.height)/2;e.shape=i.makeParameters(i.defaultEllipse,{cx:parseInt(t.left)+a,cy:parseInt(t.top)+o,rx:a,ry:o})},c=function(e){var t=e.rawNode.style,a=parseInt(t.width)/2;e.shape=i.makeParameters(i.defaultCircle,{cx:parseInt(t.left)+a,cy:parseInt(t.top)+a,r:a})},f=function(e){var a=e.shape=t.clone(i.defaultLine),o=e.rawNode.path.v.match(i.pathVmlRegExp);do{if(o.length<7||"m"!=o[0]||"l"!=o[3]||"e"!=o[6])break;a.x1=parseInt(o[1]),a.y1=parseInt(o[2]),a.x2=parseInt(o[4]),a.y2=parseInt(o[5])}while(!1)},p=function(e){var a=e.shape=t.clone(i.defaultPolyline),o=e.rawNode.path.v.match(i.pathVmlRegExp);do{if(o.length<3||"m"!=o[0])break;var r=parseInt(o[0]),n=parseInt(o[1]);if(isNaN(r)||isNaN(n))break;if(a.points.push({x:r,y:n}),o.length<6||"l"!=o[3])break;for(var s=4;s<o.length&&(r=parseInt(o[s]),n=parseInt(o[s+1]),!isNaN(r)&&!isNaN(n));s+=2)a.points.push({x:r,y:n})}while(!1)},g=function(e){e.shape=t.clone(i.defaultImage),e.shape.src=e.rawNode.firstChild.src},y=function(e){var t=e.rawNode.filters["DXImageTransform.Microsoft.Matrix"];e.matrix=a.normalize({xx:t.M11,xy:t.M12,yx:t.M21,yy:t.M22,dx:t.Dx,dy:t.Dy})},v=function(e){var a=e.shape=t.clone(i.defaultText),o=e.rawNode,r=o.path.v.match(i.pathVmlRegExp);do{if(!r||7!=r.length)break;for(var s=o.childNodes,l=0;l<s.length&&"textpath"!=s[l].tagName;++l);if(l>=s.length)break;var d=s[l].style;switch(a.text=s[l].string,d["v-text-align"]){case"left":a.x=parseInt(r[1]),a.align="start";break;case"center":a.x=(parseInt(r[1])+parseInt(r[4]))/2,a.align="middle";break;case"right":a.x=parseInt(r[4]),a.align="end"}return a.y=parseInt(r[2]),a.decoration=d["text-decoration"],a.rotated=d["v-rotate-letters"].toLowerCase()in n._bool,void(a.kerning=d["v-text-kern"].toLowerCase()in n._bool)}while(!1);e.shape=null},b=function(e){for(var a=e.fontStyle=t.clone(i.defaultFont),o=e.rawNode.childNodes,r=0;r<o.length&&"textpath"==o[r].tagName;++r);if(r>=o.length)return void(e.fontStyle=null);var n=o[r].style;a.style=n.fontstyle,a.variant=n.fontvariant,a.weight=n.fontweight,a.size=n.fontsize,a.family=n.fontfamily},M=function(e){d(e);var t=e.matrix,o=e.fontStyle;t&&o&&(e.matrix=a.multiply(t,{dy:.35*i.normalizedLength(o.size)}))},k=function(e){for(var a=e.shape=t.clone(i.defaultPath),r=e.rawNode.path.v.match(i.pathVmlRegExp),n=[],s=!1,l=o._pathVmlToSvgMap,d=0;d<r.length;++r){var u=r[d];if(u in l)s=!1,n.push(l[u]);else if(!s){var h=parseInt(u);isNaN(h)?s=!0:n.push(h)}}var m=n.length;m>=4&&""==n[m-1]&&0==n[m-2]&&0==n[m-3]&&"l"==n[m-4]&&n.splice(m-4,4),m&&(a.path=n.join(" "))};return n});//# sourceMappingURL=vml_attach.js.map