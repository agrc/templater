//>>built
define("dojox/gfx/vml_attach",["dojo/_base/kernel","dojo/_base/lang","./_base","./matrix","./path","dojo/_base/Color","./vml"],function(e,t,a,i,r,o,n){e.experimental("dojox.gfx.vml_attach"),n.attachNode=function(e){if(!e)return null;var t=null;switch(e.tagName.toLowerCase()){case n.Rect.nodeType:t=new n.Rect(e),u(t);break;case n.Ellipse.nodeType:e.style.width==e.style.height?(t=new n.Circle(e),c(t)):(t=new n.Ellipse(e),m(t));break;case n.Path.nodeType:switch(e.getAttribute("dojoGfxType")){case"line":t=new n.Line(e),f(t);break;case"polyline":t=new n.Polyline(e),p(t);break;case"path":t=new n.Path(e),k(t);break;case"text":t=new n.Text(e),v(t),b(t),M(t);break;case"textpath":t=new n.TextPath(e),k(t),v(t),b(t)}break;case n.Image.nodeType:switch(e.getAttribute("dojoGfxType")){case"image":t=new n.Image(e),g(t),y(t)}break;default:return null}return t instanceof n.Image||(s(t),d(t),t instanceof n.Text||l(t)),t},n.attachSurface=function(e){var t=new n.Surface;t.clipNode=e;var a=t.rawNode=e.firstChild,i=a.firstChild;return i&&"rect"==i.tagName?(t.bgNode=a,t):null};var s=function(e){var r,s,d,l=null,u=e.rawNode,m=u.fill;if(m.on&&"gradient"==m.type)for(l=t.clone(a.defaultLinearGradient),rad=i._degToRad(m.angle),l.x2=Math.cos(rad),l.y2=Math.sin(rad),l.colors=[],r=m.colors.value.split(";"),s=0;s<r.length;++s)(d=r[s].match(/\S+/g))&&2==d.length&&l.colors.push({offset:n._parseFloat(d[0]),color:new o(d[1])});else if(m.on&&"gradientradial"==m.type)for(l=t.clone(a.defaultRadialGradient),w=parseFloat(u.style.width),h=parseFloat(u.style.height),l.cx=isNaN(w)?0:m.focusposition.x*w,l.cy=isNaN(h)?0:m.focusposition.y*h,l.r=isNaN(w)?1:w/2,l.colors=[],r=m.colors.value.split(";"),s=r.length-1;s>=0;--s)(d=r[s].match(/\S+/g))&&2==d.length&&l.colors.push({offset:n._parseFloat(d[0]),color:new o(d[1])});else m.on&&"tile"==m.type?(l=t.clone(a.defaultPattern),l.width=a.pt2px(m.size.x),l.height=a.pt2px(m.size.y),l.x=m.origin.x*l.width,l.y=m.origin.y*l.height,l.src=m.src):m.on&&u.fillcolor&&(l=new o(u.fillcolor+""),l.a=m.opacity);e.fillStyle=l},d=function(e){var i=e.rawNode;if(!i.stroked)return void(e.strokeStyle=null);var r=e.strokeStyle=t.clone(a.defaultStroke),n=i.stroke;r.color=new o(i.strokecolor.value),r.width=a.normalizedLength(i.strokeweight+""),r.color.a=n.opacity,r.cap=this._translate(this._capMapReversed,n.endcap),r.join="miter"==n.joinstyle?n.miterlimit:n.joinstyle,r.style=n.dashstyle},l=function(e){var t=e.rawNode.skew,r=t.matrix,o=t.offset;e.matrix=i.normalize({xx:r.xtox,xy:r.ytox,yx:r.xtoy,yy:r.ytoy,dx:a.pt2px(o.x),dy:a.pt2px(o.y)})},u=function(e){var t=e.rawNode,i=t.outerHTML.match(/arcsize = \"(\d*\.?\d+[%f]?)\"/)[1],r=t.style,o=parseFloat(r.width),s=parseFloat(r.height);i=i.indexOf("%")>=0?parseFloat(i)/100:n._parseFloat(i),e.shape=a.makeParameters(a.defaultRect,{x:parseInt(r.left),y:parseInt(r.top),width:o,height:s,r:Math.min(o,s)*i})},m=function(e){var t=e.rawNode.style,i=parseInt(t.width)/2,r=parseInt(t.height)/2;e.shape=a.makeParameters(a.defaultEllipse,{cx:parseInt(t.left)+i,cy:parseInt(t.top)+r,rx:i,ry:r})},c=function(e){var t=e.rawNode.style,i=parseInt(t.width)/2;e.shape=a.makeParameters(a.defaultCircle,{cx:parseInt(t.left)+i,cy:parseInt(t.top)+i,r:i})},f=function(e){var i=e.shape=t.clone(a.defaultLine),r=e.rawNode.path.v.match(a.pathVmlRegExp);do{if(r.length<7||"m"!=r[0]||"l"!=r[3]||"e"!=r[6])break;i.x1=parseInt(r[1]),i.y1=parseInt(r[2]),i.x2=parseInt(r[4]),i.y2=parseInt(r[5])}while(!1)},p=function(e){var i=e.shape=t.clone(a.defaultPolyline),r=e.rawNode.path.v.match(a.pathVmlRegExp);do{if(r.length<3||"m"!=r[0])break;var o=parseInt(r[0]),n=parseInt(r[1]);if(isNaN(o)||isNaN(n))break;if(i.points.push({x:o,y:n}),r.length<6||"l"!=r[3])break;for(var s=4;s<r.length&&(o=parseInt(r[s]),n=parseInt(r[s+1]),!isNaN(o)&&!isNaN(n));s+=2)i.points.push({x:o,y:n})}while(!1)},g=function(e){e.shape=t.clone(a.defaultImage),e.shape.src=e.rawNode.firstChild.src},y=function(e){var t=e.rawNode.filters["DXImageTransform.Microsoft.Matrix"];e.matrix=i.normalize({xx:t.M11,xy:t.M12,yx:t.M21,yy:t.M22,dx:t.Dx,dy:t.Dy})},v=function(e){var i=e.shape=t.clone(a.defaultText),r=e.rawNode,o=r.path.v.match(a.pathVmlRegExp);do{if(!o||7!=o.length)break;for(var s=r.childNodes,d=0;d<s.length&&"textpath"!=s[d].tagName;++d);if(d>=s.length)break;var l=s[d].style;switch(i.text=s[d].string,l["v-text-align"]){case"left":i.x=parseInt(o[1]),i.align="start";break;case"center":i.x=(parseInt(o[1])+parseInt(o[4]))/2,i.align="middle";break;case"right":i.x=parseInt(o[4]),i.align="end"}return i.y=parseInt(o[2]),i.decoration=l["text-decoration"],i.rotated=l["v-rotate-letters"].toLowerCase()in n._bool,void(i.kerning=l["v-text-kern"].toLowerCase()in n._bool)}while(!1);e.shape=null},b=function(e){for(var i=e.fontStyle=t.clone(a.defaultFont),r=e.rawNode.childNodes,o=0;o<r.length&&"textpath"==r[o].tagName;++o);if(o>=r.length)return void(e.fontStyle=null);var n=r[o].style;i.style=n.fontstyle,i.variant=n.fontvariant,i.weight=n.fontweight,i.size=n.fontsize,i.family=n.fontfamily},M=function(e){l(e);var t=e.matrix,r=e.fontStyle;t&&r&&(e.matrix=i.multiply(t,{dy:.35*a.normalizedLength(r.size)}))},k=function(e){for(var i=e.shape=t.clone(a.defaultPath),o=e.rawNode.path.v.match(a.pathVmlRegExp),n=[],s=!1,d=r._pathVmlToSvgMap,l=0;l<o.length;++o){var h=o[l];if(h in d)s=!1,n.push(d[h]);else if(!s){var u=parseInt(h);isNaN(u)?s=!0:n.push(u)}}var m=n.length;m>=4&&""==n[m-1]&&0==n[m-2]&&0==n[m-3]&&"l"==n[m-4]&&n.splice(m-4,4),m&&(i.path=n.join(" "))};return n});//# sourceMappingURL=vml_attach.js.map