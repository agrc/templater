//>>built
define("dojox/gfx/vml",["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/_base/Color","dojo/_base/sniff","dojo/_base/config","dojo/dom","dojo/dom-geometry","dojo/_base/kernel","./_base","./shape","./path","./arc","./gradient","./matrix"],function(e,t,a,i,r,n,o,s,l,d,u,m,h,c,f){function g(e,t,i){i=i||l.global,t.call(i,e),(e instanceof d.Surface||e instanceof d.Group)&&a.forEach(e.children,function(e){g(e,t,i)})}var p=d.vml={};p.xmlns="urn:schemas-microsoft-com:vml",document.namespaces.add("v",p.xmlns);var y=["*","group","roundrect","oval","shape","rect","imagedata","path","textpath","text"],v=0,k=1,b=document.createStyleSheet();for(r("ie")>=8&&(v=1,k=y.length);v<k;++v)b.addRule("v\\:"+y[v],"behavior:url(#default#VML); display:inline-block");p.text_alignment={start:"left",middle:"center",end:"right"},p._parseFloat=function(e){return e.match(/^\d+f$/i)?parseInt(e)/65536:parseFloat(e)},p._bool={t:1,true:1},p._reparentEvents=function(e,t){for(var a in t)"on"==a.substr(0,2).toLowerCase()&&(e[a]=t[a],t[a]=null)},p.Shape=t("dojox.gfx.vml.Shape",u.Shape,{setFill:function(e){if(!e)return this.fillStyle=null,this.rawNode.filled="f",this;var t,r,n,o,s;if("object"==typeof e&&"type"in e){switch(e.type){case"linear":var l=this._getRealMatrix(),u=this.getBoundingBox(),m=this._getRealBBox?this._getRealBBox():this.getTransformedBoundingBox();for(s=[],this.fillStyle!==e&&(this.fillStyle=d.makeParameters(d.defaultLinearGradient,e)),r=d.gradient.project(l,this.fillStyle,{x:u.x,y:u.y},{x:u.x+u.width,y:u.y+u.height},m[0],m[2]),o=r.colors,"0.00000"!=o[0].offset.toFixed(5)&&s.push("0 "+d.normalizeColor(o[0].color).toHex()),t=0;t<o.length;++t)s.push(o[t].offset.toFixed(5)+" "+d.normalizeColor(o[t].color).toHex());t=o.length-1,"1.00000"!=o[t].offset.toFixed(5)&&s.push("1 "+d.normalizeColor(o[t].color).toHex()),n=this.rawNode.fill,n.colors.value=s.join(";"),n.method="sigma",n.type="gradient",n.angle=(270-f._radToDeg(r.angle))%360,n.on=!0;break;case"radial":r=d.makeParameters(d.defaultRadialGradient,e),this.fillStyle=r;var h=parseFloat(this.rawNode.style.left),c=parseFloat(this.rawNode.style.top),g=parseFloat(this.rawNode.style.width),p=parseFloat(this.rawNode.style.height),y=isNaN(g)?1:2*r.r/g;for(o=[],r.colors[0].offset>0&&o.push({offset:1,color:d.normalizeColor(r.colors[0].color)}),a.forEach(r.colors,function(e,t){o.push({offset:1-e.offset*y,color:d.normalizeColor(e.color)})}),t=o.length-1;t>=0&&o[t].offset<0;)--t;if(t<o.length-1){var v=o[t],k=o[t+1];for(k.color=i.blendColors(v.color,k.color,v.offset/(v.offset-k.offset)),k.offset=0;o.length-t>2;)o.pop()}for(t=o.length-1,s=[],o[t].offset>0&&s.push("0 "+o[t].color.toHex());t>=0;--t)s.push(o[t].offset.toFixed(5)+" "+o[t].color.toHex());n=this.rawNode.fill,n.colors.value=s.join(";"),n.method="sigma",n.type="gradientradial",isNaN(g)||isNaN(p)||isNaN(h)||isNaN(c)?n.focusposition="0.5 0.5":n.focusposition=((r.cx-h)/g).toFixed(5)+" "+((r.cy-c)/p).toFixed(5),n.focussize="0 0",n.on=!0;break;case"pattern":r=d.makeParameters(d.defaultPattern,e),this.fillStyle=r,n=this.rawNode.fill,n.type="tile",n.src=r.src,r.width&&r.height&&(n.size.x=d.px2pt(r.width),n.size.y=d.px2pt(r.height)),n.alignShape="f",n.position.x=0,n.position.y=0,n.origin.x=r.width?r.x/r.width:0,n.origin.y=r.height?r.y/r.height:0,n.on=!0}return this.rawNode.fill.opacity=1,this}this.fillStyle=d.normalizeColor(e),n=this.rawNode.fill,n||(n=this.rawNode.ownerDocument.createElement("v:fill")),n.method="any",n.type="solid",n.opacity=this.fillStyle.a;var b=this.rawNode.filters["DXImageTransform.Microsoft.Alpha"];return b&&(b.opacity=Math.round(100*this.fillStyle.a)),this.rawNode.fillcolor=this.fillStyle.toHex(),this.rawNode.filled=!0,this},setStroke:function(t){if(!t)return this.strokeStyle=null,this.rawNode.stroked="f",this;("string"==typeof t||e.isArray(t)||t instanceof i)&&(t={color:t});var a=this.strokeStyle=d.makeParameters(d.defaultStroke,t);a.color=d.normalizeColor(a.color);var r=this.rawNode;return r.stroked=!0,r.strokecolor=a.color.toCss(),r.strokeweight=a.width+"px",r.stroke&&(r.stroke.opacity=a.color.a,r.stroke.endcap=this._translate(this._capMap,a.cap),"number"==typeof a.join?(r.stroke.joinstyle="miter",r.stroke.miterlimit=a.join):r.stroke.joinstyle=a.join,r.stroke.dashstyle="none"==a.style?"Solid":a.style),this},_capMap:{butt:"flat"},_capMapReversed:{flat:"butt"},_translate:function(e,t){return t in e?e[t]:t},_applyTransform:function(){var e=this._getRealMatrix();if(e){var t=this.rawNode.skew;if(void 0===t)for(var a=0;a<this.rawNode.childNodes.length;++a)if("skew"==this.rawNode.childNodes[a].tagName){t=this.rawNode.childNodes[a];break}if(t){t.on="f";var i=e.xx.toFixed(8)+" "+e.xy.toFixed(8)+" "+e.yx.toFixed(8)+" "+e.yy.toFixed(8)+" 0 0",r=Math.floor(e.dx).toFixed()+"px "+Math.floor(e.dy).toFixed()+"px",n=this.rawNode.style,o=parseFloat(n.left),s=parseFloat(n.top),l=parseFloat(n.width),d=parseFloat(n.height);isNaN(o)&&(o=0),isNaN(s)&&(s=0),!isNaN(l)&&l||(l=1),!isNaN(d)&&d||(d=1);var u=(-o/l-.5).toFixed(8)+" "+(-s/d-.5).toFixed(8);t.matrix=i,t.origin=u,t.offset=r,t.on=!0}}return this.fillStyle&&"linear"==this.fillStyle.type&&this.setFill(this.fillStyle),this.clip&&this.setClip(this.clip),this},_setDimensions:function(e,t){return this},setRawNode:function(e){e.stroked="f",e.filled="f",this.rawNode=e,this.rawNode.__gfxObject__=this},_moveToFront:function(){return this.rawNode.parentNode.appendChild(this.rawNode),this},_moveToBack:function(){var e=this.rawNode,t=e.parentNode,a=t.firstChild;return t.insertBefore(e,a),"rect"==a.tagName&&a.swapNode(e),this},_getRealMatrix:function(){return this.parentMatrix?new f.Matrix2D([this.parentMatrix,this.matrix]):this.matrix},setClip:function(e){this.inherited(arguments);var t=this.rawNode.style;if(e){if("width"in e){var a=this._getRealMatrix(),i=parseFloat(t.left),r=parseFloat(t.top);isNaN(i)&&(i=0),isNaN(r)&&(r=0);var n=f.multiplyRectangle(a,e),o=f.multiplyPoint(a,{x:i,y:r});t.clip="rect("+Math.round(n.y-o.y)+"px "+Math.round(n.x-o.x+n.width)+"px "+Math.round(n.y-o.y+n.height)+"px "+Math.round(n.x-o.x)+"px)"}}else t.position="absolute",t.clip="rect(0px "+t.width+" "+t.height+" 0px)";return this}}),p.Group=t("dojox.gfx.vml.Group",p.Shape,{constructor:function(){u.Container._init.call(this)},_applyTransform:function(){for(var e=this._getRealMatrix(),t=0;t<this.children.length;++t)this.children[t]._updateParentMatrix(e);return this.clip&&this.setClip(this.clip),this},_setDimensions:function(e,t){var a=this.rawNode,i=a.style,r=this.bgNode.style;i.width=e,i.height=t,a.coordsize=e+" "+t,r.width=e,r.height=t;for(var n=0;n<this.children.length;++n)this.children[n]._setDimensions(e,t);return this},setClip:function(e){this.clip=e;var t=this.rawNode.style;if(e){if("width"in e){var a=this._getRealMatrix(),i=f.multiplyRectangle(a,e),r=this.getBoundingBox();r=r?f.multiplyRectangle(a,r):null;var n=r&&r.x<0?r.x:0,o=r&&r.y<0?r.y:0;t.position="absolute",t.clip="rect("+Math.round(i.y-o)+"px "+Math.round(i.x+i.width-n)+"px "+Math.round(i.y+i.height-o)+"px "+Math.round(i.x-n)+"px)"}}else t.position="absolute",t.clip="rect(0px "+t.width+" "+t.height+" 0px)";return this},destroy:function(){this.clear(!0),p.Shape.prototype.destroy.apply(this,arguments)}}),p.Group.nodeType="group",p.Rect=t("dojox.gfx.vml.Rect",[p.Shape,u.Rect],{setShape:function(e){var t=this.shape=d.makeParameters(this.shape,e);this.bbox=null;var a=Math.min(1,t.r/Math.min(parseFloat(t.width),parseFloat(t.height))).toFixed(8),i=this.rawNode.parentNode,n=null;if(i){if(i.lastChild!==this.rawNode)for(var o=0;o<i.childNodes.length;++o)if(i.childNodes[o]===this.rawNode){n=i.childNodes[o+1];break}i.removeChild(this.rawNode)}if(r("ie")>7){var s=this.rawNode.ownerDocument.createElement("v:roundrect");s.arcsize=a,s.style.display="inline-block",p._reparentEvents(s,this.rawNode),this.rawNode=s,this.rawNode.__gfxObject__=this}else this.rawNode.arcsize=a;i&&(n?i.insertBefore(this.rawNode,n):i.appendChild(this.rawNode));var l=this.rawNode.style;return l.left=t.x.toFixed(),l.top=t.y.toFixed(),l.width="string"==typeof t.width&&t.width.indexOf("%")>=0?t.width:Math.max(t.width.toFixed(),0),l.height="string"==typeof t.height&&t.height.indexOf("%")>=0?t.height:Math.max(t.height.toFixed(),0),this.setTransform(this.matrix).setFill(this.fillStyle).setStroke(this.strokeStyle)}}),p.Rect.nodeType="roundrect",p.Ellipse=t("dojox.gfx.vml.Ellipse",[p.Shape,u.Ellipse],{setShape:function(e){var t=this.shape=d.makeParameters(this.shape,e);this.bbox=null;var a=this.rawNode.style;return a.left=(t.cx-t.rx).toFixed(),a.top=(t.cy-t.ry).toFixed(),a.width=(2*t.rx).toFixed(),a.height=(2*t.ry).toFixed(),this.setTransform(this.matrix)}}),p.Ellipse.nodeType="oval",p.Circle=t("dojox.gfx.vml.Circle",[p.Shape,u.Circle],{setShape:function(e){var t=this.shape=d.makeParameters(this.shape,e);this.bbox=null;var a=this.rawNode.style;return a.left=(t.cx-t.r).toFixed(),a.top=(t.cy-t.r).toFixed(),a.width=(2*t.r).toFixed(),a.height=(2*t.r).toFixed(),this}}),p.Circle.nodeType="oval",p.Line=t("dojox.gfx.vml.Line",[p.Shape,u.Line],{constructor:function(e){e&&e.setAttribute("dojoGfxType","line")},setShape:function(e){var t=this.shape=d.makeParameters(this.shape,e);return this.bbox=null,this.rawNode.path.v="m"+t.x1.toFixed()+" "+t.y1.toFixed()+"l"+t.x2.toFixed()+" "+t.y2.toFixed()+"e",this.setTransform(this.matrix)}}),p.Line.nodeType="shape",p.Polyline=t("dojox.gfx.vml.Polyline",[p.Shape,u.Polyline],{constructor:function(e){e&&e.setAttribute("dojoGfxType","polyline")},setShape:function(e,t){e&&e instanceof Array?(this.shape=d.makeParameters(this.shape,{points:e}),t&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.shape=d.makeParameters(this.shape,e),this.bbox=null,this._normalizePoints();var a=[],i=this.shape.points;if(i.length>0&&(a.push("m"),a.push(i[0].x.toFixed(),i[0].y.toFixed()),i.length>1)){a.push("l");for(var r=1;r<i.length;++r)a.push(i[r].x.toFixed(),i[r].y.toFixed())}return a.push("e"),this.rawNode.path.v=a.join(" "),this.setTransform(this.matrix)}}),p.Polyline.nodeType="shape",p.Image=t("dojox.gfx.vml.Image",[p.Shape,u.Image],{setShape:function(e){var t=this.shape=d.makeParameters(this.shape,e);return this.bbox=null,this.rawNode.firstChild.src=t.src,this.setTransform(this.matrix)},_applyTransform:function(){var e=this._getRealMatrix(),t=this.rawNode,a=t.style,i=this.shape;if(e=e?f.multiply(e,{dx:i.x,dy:i.y}):f.normalize({dx:i.x,dy:i.y}),0==e.xy&&0==e.yx&&e.xx>0&&e.yy>0)a.filter="",a.width=Math.floor(e.xx*i.width),a.height=Math.floor(e.yy*i.height),a.left=Math.floor(e.dx),a.top=Math.floor(e.dy);else{var r=t.parentNode.style;a.left="0px",a.top="0px",a.width=r.width,a.height=r.height,e=f.multiply(e,{xx:i.width/parseInt(a.width),yy:i.height/parseInt(a.height)});var n=t.filters["DXImageTransform.Microsoft.Matrix"];n?(n.M11=e.xx,n.M12=e.xy,n.M21=e.yx,n.M22=e.yy,n.Dx=e.dx,n.Dy=e.dy):a.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+e.xx+", M12="+e.xy+", M21="+e.yx+", M22="+e.yy+", Dx="+e.dx+", Dy="+e.dy+")"}return this},_setDimensions:function(e,t){var a=this.rawNode;if(a.filters["DXImageTransform.Microsoft.Matrix"]){var i=a.style;return i.width=e,i.height=t,this._applyTransform()}return this}}),p.Image.nodeType="rect",p.Text=t("dojox.gfx.vml.Text",[p.Shape,u.Text],{constructor:function(e){e&&e.setAttribute("dojoGfxType","text"),this.fontStyle=null},_alignment:{start:"left",middle:"center",end:"right"},setShape:function(e){this.shape=d.makeParameters(this.shape,e),this.bbox=null;var t,a=this.rawNode,i=this.shape,r=i.x,n=i.y.toFixed();switch(i.align){case"middle":r-=5;break;case"end":r-=10}t="m"+r.toFixed()+","+n+"l"+(r+10).toFixed()+","+n+"e";for(var o=null,s=null,l=a.childNodes,u=0;u<l.length;++u){var m=l[u].tagName;if("path"==m){if(o=l[u],s)break}else if("textpath"==m&&(s=l[u],o))break}o||(o=a.ownerDocument.createElement("v:path"),a.appendChild(o)),s||(s=a.ownerDocument.createElement("v:textpath"),a.appendChild(s)),o.v=t,o.textPathOk=!0,s.on=!0;var h=p.text_alignment[i.align];return s.style["v-text-align"]=h||"left",s.style["text-decoration"]=i.decoration,s.style["v-rotate-letters"]=i.rotated,s.style["v-text-kern"]=i.kerning,s.string=i.text,this.setTransform(this.matrix)},_setFont:function(){for(var e=this.fontStyle,t=this.rawNode.childNodes,a=0;a<t.length;++a)if("textpath"==t[a].tagName){t[a].style.font=d.makeFontString(e);break}this.setTransform(this.matrix)},_getRealMatrix:function(){var e=this.inherited(arguments);return e&&(e=f.multiply(e,{dy:.35*-d.normalizedLength(this.fontStyle?this.fontStyle.size:"10pt")})),e},getTextWidth:function(){var e=this.rawNode,t=e.style.display;e.style.display="inline";var a=d.pt2px(parseFloat(e.currentStyle.width));return e.style.display=t,a}}),p.Text.nodeType="shape",p.Path=t("dojox.gfx.vml.Path",[p.Shape,m.Path],{constructor:function(e){e&&!e.getAttribute("dojoGfxType")&&e.setAttribute("dojoGfxType","path"),this.vmlPath="",this.lastControl={}},_updateWithSegment:function(t){var a=e.clone(this.last);if(this.inherited(arguments),!(arguments.length>1)){var i=this[this.renderers[t.action]](t,a);"string"==typeof this.vmlPath?(this.vmlPath+=i.join(""),this.rawNode.path.v=this.vmlPath+" r0,0 e"):Array.prototype.push.apply(this.vmlPath,i)}},setShape:function(e){return this.vmlPath=[],this.lastControl.type="",this.inherited(arguments),this.vmlPath=this.vmlPath.join(""),this.rawNode.path.v=this.vmlPath+" r0,0 e",this},_pathVmlToSvgMap:{m:"M",l:"L",t:"m",r:"l",c:"C",v:"c",qb:"Q",x:"z",e:""},renderers:{M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"},_addArgs:function(e,t,a,i){for(var r=t instanceof Array?t:t.args,n=a;n<i;++n)e.push(" ",r[n].toFixed())},_adjustRelCrd:function(e,t,a){var i=t instanceof Array?t:t.args,r=i.length,n=new Array(r),o=0,s=e.x,l=e.y;if("number"!=typeof s&&(n[0]=s=i[0],n[1]=l=i[1],o=2),"number"==typeof a&&2!=a)for(var d=a;d<=r;){for(;o<d;o+=2)n[o]=s+i[o],n[o+1]=l+i[o+1];s=n[d-2],l=n[d-1],d+=a}else for(;o<r;o+=2)n[o]=s+=i[o],n[o+1]=l+=i[o+1];return n},_adjustRelPos:function(e,t){for(var a=t instanceof Array?t:t.args,i=a.length,r=new Array(i),n=0;n<i;++n)r[n]=e+=a[n];return r},_moveToA:function(e){var t=[" m"],a=e instanceof Array?e:e.args,i=a.length;return this._addArgs(t,a,0,2),i>2&&(t.push(" l"),this._addArgs(t,a,2,i)),this.lastControl.type="",t},_moveToR:function(e,t){return this._moveToA(this._adjustRelCrd(t,e))},_lineToA:function(e){var t=[" l"],a=e instanceof Array?e:e.args;return this._addArgs(t,a,0,a.length),this.lastControl.type="",t},_lineToR:function(e,t){return this._lineToA(this._adjustRelCrd(t,e))},_hLineToA:function(e,t){for(var a=[" l"],i=" "+t.y.toFixed(),r=e instanceof Array?e:e.args,n=r.length,o=0;o<n;++o)a.push(" ",r[o].toFixed(),i);return this.lastControl.type="",a},_hLineToR:function(e,t){return this._hLineToA(this._adjustRelPos(t.x,e),t)},_vLineToA:function(e,t){for(var a=[" l"],i=" "+t.x.toFixed(),r=e instanceof Array?e:e.args,n=r.length,o=0;o<n;++o)a.push(i," ",r[o].toFixed());return this.lastControl.type="",a},_vLineToR:function(e,t){return this._vLineToA(this._adjustRelPos(t.y,e),t)},_curveToA:function(e){for(var t=[],a=e instanceof Array?e:e.args,i=a.length,r=this.lastControl,n=0;n<i;n+=6)t.push(" c"),this._addArgs(t,a,n,n+6);return r.x=a[i-4],r.y=a[i-3],r.type="C",t},_curveToR:function(e,t){return this._curveToA(this._adjustRelCrd(t,e,6))},_smoothCurveToA:function(e,t){var a=[],i=e instanceof Array?e:e.args,r=i.length,n=this.lastControl,o=0;for("C"!=n.type&&(a.push(" c"),this._addArgs(a,[t.x,t.y],0,2),this._addArgs(a,i,0,4),n.x=i[0],n.y=i[1],n.type="C",o=4);o<r;o+=4)a.push(" c"),this._addArgs(a,[2*t.x-n.x,2*t.y-n.y],0,2),this._addArgs(a,i,o,o+4),n.x=i[o],n.y=i[o+1];return a},_smoothCurveToR:function(e,t){return this._smoothCurveToA(this._adjustRelCrd(t,e,4),t)},_qCurveToA:function(e){for(var t=[],a=e instanceof Array?e:e.args,i=a.length,r=this.lastControl,n=0;n<i;n+=4)t.push(" qb"),this._addArgs(t,a,n,n+4);return r.x=a[i-4],r.y=a[i-3],r.type="Q",t},_qCurveToR:function(e,t){return this._qCurveToA(this._adjustRelCrd(t,e,4))},_qSmoothCurveToA:function(e,t){var a=[],i=e instanceof Array?e:e.args,r=i.length,n=this.lastControl,o=0;for("Q"!=n.type&&(a.push(" qb"),this._addArgs(a,[n.x=t.x,n.y=t.y],0,2),n.type="Q",this._addArgs(a,i,0,2),o=2);o<r;o+=2)a.push(" qb"),this._addArgs(a,[n.x=2*t.x-n.x,n.y=2*t.y-n.y],0,2),this._addArgs(a,i,o,o+2);return a},_qSmoothCurveToR:function(e,t){return this._qSmoothCurveToA(this._adjustRelCrd(t,e,2),t)},_arcTo:function(e,t){for(var a=[],i=e.args,r=i.length,n="a"==e.action,o=0;o<r;o+=7){var s=i[o+5],l=i[o+6];n&&(s+=t.x,l+=t.y);for(var d=h.arcAsBezier(t,i[o],i[o+1],i[o+2],i[o+3]?1:0,i[o+4]?1:0,s,l),u=0;u<d.length;++u){a.push(" c");var m=d[u];this._addArgs(a,m,0,m.length),this._updateBBox(m[0],m[1]),this._updateBBox(m[2],m[3]),this._updateBBox(m[4],m[5])}t.x=s,t.y=l}return this.lastControl.type="",a},_closePath:function(){return this.lastControl.type="",["x"]},_getRealBBox:function(){return this._confirmSegmented(),this.tbbox?this.tbbox:("string"==typeof this.shape.path&&(this.shape.path=""),this.inherited(arguments))}}),p.Path.nodeType="shape",p.TextPath=t("dojox.gfx.vml.TextPath",[p.Path,m.TextPath],{constructor:function(t){t&&t.setAttribute("dojoGfxType","textpath"),this.fontStyle=null,"text"in this||(this.text=e.clone(d.defaultTextPath)),"fontStyle"in this||(this.fontStyle=e.clone(d.defaultFont))},setText:function(e){return this.text=d.makeParameters(this.text,"string"==typeof e?{text:e}:e),this._setText(),this},setFont:function(e){return this.fontStyle="string"==typeof e?d.splitFontString(e):d.makeParameters(d.defaultFont,e),this._setFont(),this},_setText:function(){this.bbox=null;for(var e=this.rawNode,t=this.text,a=null,i=null,r=e.childNodes,n=0;n<r.length;++n){var o=r[n].tagName;if("path"==o){if(a=r[n],i)break}else if("textpath"==o&&(i=r[n],a))break}a||(a=this.rawNode.ownerDocument.createElement("v:path"),e.appendChild(a)),i||(i=this.rawNode.ownerDocument.createElement("v:textpath"),e.appendChild(i)),a.textPathOk=!0,i.on=!0;var s=p.text_alignment[t.align];i.style["v-text-align"]=s||"left",i.style["text-decoration"]=t.decoration,i.style["v-rotate-letters"]=t.rotated,i.style["v-text-kern"]=t.kerning,i.string=t.text},_setFont:function(){for(var e=this.fontStyle,t=this.rawNode.childNodes,a=0;a<t.length;++a)if("textpath"==t[a].tagName){t[a].style.font=d.makeFontString(e);break}}}),p.TextPath.nodeType="shape",p.Surface=t("dojox.gfx.vml.Surface",u.Surface,{constructor:function(){u.Container._init.call(this)},destroy:function(){this.clear(!0),this.inherited(arguments)},setDimensions:function(e,t){if(this.width=d.normalizedLength(e),this.height=d.normalizedLength(t),!this.rawNode)return this;var a,i=this.clipNode.style,r=this.rawNode,n=r.style,o=this.bgNode.style,s=this._parent.style;for(s.width=e,s.height=t,i.width=e,i.height=t,i.clip="rect(0px "+e+"px "+t+"px 0px)",n.width=e,n.height=t,r.coordsize=e+" "+t,o.width=e,o.height=t,a=0;a<this.children.length;++a)this.children[a]._setDimensions(e,t);return this},getDimensions:function(){var e=this.rawNode?{width:d.normalizedLength(this.rawNode.style.width),height:d.normalizedLength(this.rawNode.style.height)}:null;return e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),e}}),p.createSurface=function(e,t,a){if(!t&&!a){var i=s.position(e);t=t||i.w,a=a||i.h}"number"==typeof t&&(t+="px"),"number"==typeof a&&(a+="px");var n=new p.Surface,l=o.byId(e),u=n.clipNode=l.ownerDocument.createElement("div"),m=n.rawNode=l.ownerDocument.createElement("v:group"),h=u.style,c=m.style;r("ie")>7&&(c.display="inline-block"),n._parent=l,n._nodes.push(u),l.style.width=t,l.style.height=a,h.position="absolute",h.width=t,h.height=a,h.clip="rect(0px "+t+" "+a+" 0px)",c.position="absolute",c.width=t,c.height=a,m.coordsize=("100%"===t?t:parseFloat(t))+" "+("100%"===a?a:parseFloat(a)),m.coordorigin="0 0";var f=n.bgNode=m.ownerDocument.createElement("v:rect"),g=f.style;return g.left=g.top=0,g.width=c.width,g.height=c.height,f.filled=f.stroked="f",m.appendChild(f),u.appendChild(m),l.appendChild(u),n.width=d.normalizedLength(t),n.height=d.normalizedLength(a),n};var M=function(e){if(this!=e.getParent()){var t=e.getParent();t&&t.remove(e),this.rawNode.appendChild(e.rawNode),w.add.apply(this,arguments),g(this,function(e){"function"==typeof e.getFont&&(e.setShape(e.getShape()),e.setFont(e.getFont())),"function"==typeof e.setFill&&(e.setFill(e.getFill()),e.setStroke(e.getStroke()))})}return this},_=function(e){return this!=e.getParent()&&(this.rawNode.appendChild(e.rawNode),e.getParent()||(e.setFill(e.getFill()),e.setStroke(e.getStroke())),w.add.apply(this,arguments)),this},w=u.Container,x={add:!0===n.fixVmlAdd?M:_,remove:function(e,t){return this==e.getParent()&&(this.rawNode==e.rawNode.parentNode&&this.rawNode.removeChild(e.rawNode),w.remove.apply(this,arguments)),this},clear:function(){for(var e=this.rawNode;e.firstChild!=e.lastChild;)e.firstChild!=this.bgNode&&e.removeChild(e.firstChild),e.lastChild!=this.bgNode&&e.removeChild(e.lastChild);return w.clear.apply(this,arguments)},getBoundingBox:w.getBoundingBox,_moveChildToFront:w._moveChildToFront,_moveChildToBack:w._moveChildToBack},j={createGroup:function(){var e=this.createObject(p.Group,null),t=e.rawNode.ownerDocument.createElement("v:rect");return t.style.left=t.style.top=0,t.style.width=e.rawNode.style.width,t.style.height=e.rawNode.style.height,t.filled=t.stroked="f",e.rawNode.appendChild(t),e.bgNode=t,e},createImage:function(e){if(!this.rawNode)return null;var t=new p.Image,a=this.rawNode.ownerDocument,i=a.createElement("v:rect");i.stroked="f",i.style.width=this.rawNode.style.width,i.style.height=this.rawNode.style.height;var r=a.createElement("v:imagedata");return i.appendChild(r),t.setRawNode(i),this.rawNode.appendChild(i),t.setShape(e),this.add(t),t},createRect:function(e){if(!this.rawNode)return null;var t=new p.Rect,a=this.rawNode.ownerDocument.createElement("v:roundrect");return r("ie")>7&&(a.style.display="inline-block"),t.setRawNode(a),this.rawNode.appendChild(a),t.setShape(e),this.add(t),t},createObject:function(e,t){if(!this.rawNode)return null;var a=new e,i=this.rawNode.ownerDocument.createElement("v:"+e.nodeType);switch(a.setRawNode(i),this.rawNode.appendChild(i),e){case p.Group:case p.Line:case p.Polyline:case p.Image:case p.Text:case p.Path:case p.TextPath:this._overrideSize(i)}return a.setShape(t),this.add(a),a},_overrideSize:function(e){var t=this.rawNode.style,a=t.width,i=t.height;e.style.width=a,e.style.height=i,e.coordsize=parseInt(a)+" "+parseInt(i)}};return e.extend(p.Group,x),e.extend(p.Group,u.Creator),e.extend(p.Group,j),e.extend(p.Surface,x),e.extend(p.Surface,u.Creator),e.extend(p.Surface,j),p.fixTarget=function(e,t){return e.gfxTarget||(e.gfxTarget=e.target.__gfxObject__),!0},p});//# sourceMappingURL=vml.js.map