//>>built
define("dojox/gfx/vml",["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/_base/Color","dojo/_base/sniff","dojo/_base/config","dojo/dom","dojo/dom-geometry","dojo/_base/kernel","./_base","./shape","./path","./arc","./gradient","./matrix"],function(e,t,i,a,o,r,n,s,l,d,h,u,c,m,f){function p(e,t,a){a=a||l.global,t.call(a,e),(e instanceof d.Surface||e instanceof d.Group)&&i.forEach(e.children,function(e){p(e,t,a)})}var g=d.vml={};g.xmlns="urn:schemas-microsoft-com:vml",document.namespaces.add("v",g.xmlns);var y=["*","group","roundrect","oval","shape","rect","imagedata","path","textpath","text"],v=0,b=1,x=document.createStyleSheet();for(o("ie")>=8&&(v=1,b=y.length);b>v;++v)x.addRule("v\\:"+y[v],"behavior:url(#default#VML); display:inline-block");g.text_alignment={start:"left",middle:"center",end:"right"},g._parseFloat=function(e){return e.match(/^\d+f$/i)?parseInt(e)/65536:parseFloat(e)},g._bool={t:1,"true":1},g._reparentEvents=function(e,t){for(var i in t)"on"==i.substr(0,2).toLowerCase()&&(e[i]=t[i],t[i]=null)},g.Shape=t("dojox.gfx.vml.Shape",h.Shape,{setFill:function(e){if(!e)return this.fillStyle=null,this.rawNode.filled="f",this;var t,o,r,n,s;if("object"==typeof e&&"type"in e){switch(e.type){case"linear":var l=this._getRealMatrix(),h=this.getBoundingBox(),u=this._getRealBBox?this._getRealBBox():this.getTransformedBoundingBox();for(s=[],this.fillStyle!==e&&(this.fillStyle=d.makeParameters(d.defaultLinearGradient,e)),o=d.gradient.project(l,this.fillStyle,{x:h.x,y:h.y},{x:h.x+h.width,y:h.y+h.height},u[0],u[2]),n=o.colors,"0.00000"!=n[0].offset.toFixed(5)&&s.push("0 "+d.normalizeColor(n[0].color).toHex()),t=0;t<n.length;++t)s.push(n[t].offset.toFixed(5)+" "+d.normalizeColor(n[t].color).toHex());t=n.length-1,"1.00000"!=n[t].offset.toFixed(5)&&s.push("1 "+d.normalizeColor(n[t].color).toHex()),r=this.rawNode.fill,r.colors.value=s.join(";"),r.method="sigma",r.type="gradient",r.angle=(270-f._radToDeg(o.angle))%360,r.on=!0;break;case"radial":o=d.makeParameters(d.defaultRadialGradient,e),this.fillStyle=o;var c=parseFloat(this.rawNode.style.left),m=parseFloat(this.rawNode.style.top),p=parseFloat(this.rawNode.style.width),g=parseFloat(this.rawNode.style.height),y=isNaN(p)?1:2*o.r/p;for(n=[],o.colors[0].offset>0&&n.push({offset:1,color:d.normalizeColor(o.colors[0].color)}),i.forEach(o.colors,function(e,t){n.push({offset:1-e.offset*y,color:d.normalizeColor(e.color)})}),t=n.length-1;t>=0&&n[t].offset<0;)--t;if(t<n.length-1){var v=n[t],b=n[t+1];for(b.color=a.blendColors(v.color,b.color,v.offset/(v.offset-b.offset)),b.offset=0;n.length-t>2;)n.pop()}for(t=n.length-1,s=[],n[t].offset>0&&s.push("0 "+n[t].color.toHex());t>=0;--t)s.push(n[t].offset.toFixed(5)+" "+n[t].color.toHex());r=this.rawNode.fill,r.colors.value=s.join(";"),r.method="sigma",r.type="gradientradial",isNaN(p)||isNaN(g)||isNaN(c)||isNaN(m)?r.focusposition="0.5 0.5":r.focusposition=((o.cx-c)/p).toFixed(5)+" "+((o.cy-m)/g).toFixed(5),r.focussize="0 0",r.on=!0;break;case"pattern":o=d.makeParameters(d.defaultPattern,e),this.fillStyle=o,r=this.rawNode.fill,r.type="tile",r.src=o.src,o.width&&o.height&&(r.size.x=d.px2pt(o.width),r.size.y=d.px2pt(o.height)),r.alignShape="f",r.position.x=0,r.position.y=0,r.origin.x=o.width?o.x/o.width:0,r.origin.y=o.height?o.y/o.height:0,r.on=!0}return this.rawNode.fill.opacity=1,this}this.fillStyle=d.normalizeColor(e),r=this.rawNode.fill,r||(r=this.rawNode.ownerDocument.createElement("v:fill")),r.method="any",r.type="solid",r.opacity=this.fillStyle.a;var x=this.rawNode.filters["DXImageTransform.Microsoft.Alpha"];return x&&(x.opacity=Math.round(100*this.fillStyle.a)),this.rawNode.fillcolor=this.fillStyle.toHex(),this.rawNode.filled=!0,this},setStroke:function(t){if(!t)return this.strokeStyle=null,this.rawNode.stroked="f",this;("string"==typeof t||e.isArray(t)||t instanceof a)&&(t={color:t});var i=this.strokeStyle=d.makeParameters(d.defaultStroke,t);i.color=d.normalizeColor(i.color);var o=this.rawNode;return o.stroked=!0,o.strokecolor=i.color.toCss(),o.strokeweight=i.width+"px",o.stroke&&(o.stroke.opacity=i.color.a,o.stroke.endcap=this._translate(this._capMap,i.cap),"number"==typeof i.join?(o.stroke.joinstyle="miter",o.stroke.miterlimit=i.join):o.stroke.joinstyle=i.join,o.stroke.dashstyle="none"==i.style?"Solid":i.style),this},_capMap:{butt:"flat"},_capMapReversed:{flat:"butt"},_translate:function(e,t){return t in e?e[t]:t},_applyTransform:function(){var e=this._getRealMatrix();if(e){var t=this.rawNode.skew;if("undefined"==typeof t)for(var i=0;i<this.rawNode.childNodes.length;++i)if("skew"==this.rawNode.childNodes[i].tagName){t=this.rawNode.childNodes[i];break}if(t){t.on="f";var a=e.xx.toFixed(8)+" "+e.xy.toFixed(8)+" "+e.yx.toFixed(8)+" "+e.yy.toFixed(8)+" 0 0",o=Math.floor(e.dx).toFixed()+"px "+Math.floor(e.dy).toFixed()+"px",r=this.rawNode.style,n=parseFloat(r.left),s=parseFloat(r.top),l=parseFloat(r.width),d=parseFloat(r.height);isNaN(n)&&(n=0),isNaN(s)&&(s=0),!isNaN(l)&&l||(l=1),!isNaN(d)&&d||(d=1);var h=(-n/l-.5).toFixed(8)+" "+(-s/d-.5).toFixed(8);t.matrix=a,t.origin=h,t.offset=o,t.on=!0}}return this.fillStyle&&"linear"==this.fillStyle.type&&this.setFill(this.fillStyle),this.clip&&this.setClip(this.clip),this},_setDimensions:function(e,t){return this},setRawNode:function(e){e.stroked="f",e.filled="f",this.rawNode=e,this.rawNode.__gfxObject__=this},_moveToFront:function(){return this.rawNode.parentNode.appendChild(this.rawNode),this},_moveToBack:function(){var e=this.rawNode,t=e.parentNode,i=t.firstChild;return t.insertBefore(e,i),"rect"==i.tagName&&i.swapNode(e),this},_getRealMatrix:function(){return this.parentMatrix?new f.Matrix2D([this.parentMatrix,this.matrix]):this.matrix},setClip:function(e){this.inherited(arguments);var t=this.rawNode.style;if(e){if("width"in e){var i=this._getRealMatrix(),a=parseFloat(t.left),o=parseFloat(t.top);isNaN(a)&&(a=0),isNaN(o)&&(o=0);var r=f.multiplyRectangle(i,e),n=f.multiplyPoint(i,{x:a,y:o});t.clip="rect("+Math.round(r.y-n.y)+"px "+Math.round(r.x-n.x+r.width)+"px "+Math.round(r.y-n.y+r.height)+"px "+Math.round(r.x-n.x)+"px)"}}else t.position="absolute",t.clip="rect(0px "+t.width+" "+t.height+" 0px)";return this}}),g.Group=t("dojox.gfx.vml.Group",g.Shape,{constructor:function(){h.Container._init.call(this)},_applyTransform:function(){for(var e=this._getRealMatrix(),t=0;t<this.children.length;++t)this.children[t]._updateParentMatrix(e);return this.clip&&this.setClip(this.clip),this},_setDimensions:function(e,t){var i=this.rawNode,a=i.style,o=this.bgNode.style;a.width=e,a.height=t,i.coordsize=e+" "+t,o.width=e,o.height=t;for(var r=0;r<this.children.length;++r)this.children[r]._setDimensions(e,t);return this},setClip:function(e){this.clip=e;var t=this.rawNode.style;if(e){if("width"in e){var i=this._getRealMatrix(),a=f.multiplyRectangle(i,e),o=this.getBoundingBox();o=o?f.multiplyRectangle(i,o):null;var r=o&&o.x<0?o.x:0,n=o&&o.y<0?o.y:0;t.position="absolute",t.clip="rect("+Math.round(a.y-n)+"px "+Math.round(a.x+a.width-r)+"px "+Math.round(a.y+a.height-n)+"px "+Math.round(a.x-r)+"px)"}}else t.position="absolute",t.clip="rect(0px "+t.width+" "+t.height+" 0px)";return this},destroy:function(){this.clear(!0),g.Shape.prototype.destroy.apply(this,arguments)}}),g.Group.nodeType="group",g.Rect=t("dojox.gfx.vml.Rect",[g.Shape,h.Rect],{setShape:function(e){var t=this.shape=d.makeParameters(this.shape,e);this.bbox=null;var i=Math.min(1,t.r/Math.min(parseFloat(t.width),parseFloat(t.height))).toFixed(8),a=this.rawNode.parentNode,r=null;if(a){if(a.lastChild!==this.rawNode)for(var n=0;n<a.childNodes.length;++n)if(a.childNodes[n]===this.rawNode){r=a.childNodes[n+1];break}a.removeChild(this.rawNode)}if(o("ie")>7){var s=this.rawNode.ownerDocument.createElement("v:roundrect");s.arcsize=i,s.style.display="inline-block",g._reparentEvents(s,this.rawNode),this.rawNode=s,this.rawNode.__gfxObject__=this}else this.rawNode.arcsize=i;a&&(r?a.insertBefore(this.rawNode,r):a.appendChild(this.rawNode));var l=this.rawNode.style;return l.left=t.x.toFixed(),l.top=t.y.toFixed(),l.width="string"==typeof t.width&&t.width.indexOf("%")>=0?t.width:Math.max(t.width.toFixed(),0),l.height="string"==typeof t.height&&t.height.indexOf("%")>=0?t.height:Math.max(t.height.toFixed(),0),this.setTransform(this.matrix).setFill(this.fillStyle).setStroke(this.strokeStyle)}}),g.Rect.nodeType="roundrect",g.Ellipse=t("dojox.gfx.vml.Ellipse",[g.Shape,h.Ellipse],{setShape:function(e){var t=this.shape=d.makeParameters(this.shape,e);this.bbox=null;var i=this.rawNode.style;return i.left=(t.cx-t.rx).toFixed(),i.top=(t.cy-t.ry).toFixed(),i.width=(2*t.rx).toFixed(),i.height=(2*t.ry).toFixed(),this.setTransform(this.matrix)}}),g.Ellipse.nodeType="oval",g.Circle=t("dojox.gfx.vml.Circle",[g.Shape,h.Circle],{setShape:function(e){var t=this.shape=d.makeParameters(this.shape,e);this.bbox=null;var i=this.rawNode.style;return i.left=(t.cx-t.r).toFixed(),i.top=(t.cy-t.r).toFixed(),i.width=(2*t.r).toFixed(),i.height=(2*t.r).toFixed(),this}}),g.Circle.nodeType="oval",g.Line=t("dojox.gfx.vml.Line",[g.Shape,h.Line],{constructor:function(e){e&&e.setAttribute("dojoGfxType","line")},setShape:function(e){var t=this.shape=d.makeParameters(this.shape,e);return this.bbox=null,this.rawNode.path.v="m"+t.x1.toFixed()+" "+t.y1.toFixed()+"l"+t.x2.toFixed()+" "+t.y2.toFixed()+"e",this.setTransform(this.matrix)}}),g.Line.nodeType="shape",g.Polyline=t("dojox.gfx.vml.Polyline",[g.Shape,h.Polyline],{constructor:function(e){e&&e.setAttribute("dojoGfxType","polyline")},setShape:function(e,t){e&&e instanceof Array?(this.shape=d.makeParameters(this.shape,{points:e}),t&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.shape=d.makeParameters(this.shape,e),this.bbox=null,this._normalizePoints();var i=[],a=this.shape.points;if(a.length>0&&(i.push("m"),i.push(a[0].x.toFixed(),a[0].y.toFixed()),a.length>1)){i.push("l");for(var o=1;o<a.length;++o)i.push(a[o].x.toFixed(),a[o].y.toFixed())}return i.push("e"),this.rawNode.path.v=i.join(" "),this.setTransform(this.matrix)}}),g.Polyline.nodeType="shape",g.Image=t("dojox.gfx.vml.Image",[g.Shape,h.Image],{setShape:function(e){var t=this.shape=d.makeParameters(this.shape,e);return this.bbox=null,this.rawNode.firstChild.src=t.src,this.setTransform(this.matrix)},_applyTransform:function(){var e=this._getRealMatrix(),t=this.rawNode,i=t.style,a=this.shape;if(e=e?f.multiply(e,{dx:a.x,dy:a.y}):f.normalize({dx:a.x,dy:a.y}),0==e.xy&&0==e.yx&&e.xx>0&&e.yy>0)i.filter="",i.width=Math.floor(e.xx*a.width),i.height=Math.floor(e.yy*a.height),i.left=Math.floor(e.dx),i.top=Math.floor(e.dy);else{var o=t.parentNode.style;i.left="0px",i.top="0px",i.width=o.width,i.height=o.height,e=f.multiply(e,{xx:a.width/parseInt(i.width),yy:a.height/parseInt(i.height)});var r=t.filters["DXImageTransform.Microsoft.Matrix"];r?(r.M11=e.xx,r.M12=e.xy,r.M21=e.yx,r.M22=e.yy,r.Dx=e.dx,r.Dy=e.dy):i.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+e.xx+", M12="+e.xy+", M21="+e.yx+", M22="+e.yy+", Dx="+e.dx+", Dy="+e.dy+")"}return this},_setDimensions:function(e,t){var i=this.rawNode,a=i.filters["DXImageTransform.Microsoft.Matrix"];if(a){var o=i.style;return o.width=e,o.height=t,this._applyTransform()}return this}}),g.Image.nodeType="rect",g.Text=t("dojox.gfx.vml.Text",[g.Shape,h.Text],{constructor:function(e){e&&e.setAttribute("dojoGfxType","text"),this.fontStyle=null},_alignment:{start:"left",middle:"center",end:"right"},setShape:function(e){this.shape=d.makeParameters(this.shape,e),this.bbox=null;var t,i=this.rawNode,a=this.shape,o=a.x,r=a.y.toFixed();switch(a.align){case"middle":o-=5;break;case"end":o-=10}t="m"+o.toFixed()+","+r+"l"+(o+10).toFixed()+","+r+"e";for(var n=null,s=null,l=i.childNodes,h=0;h<l.length;++h){var u=l[h].tagName;if("path"==u){if(n=l[h],s)break}else if("textpath"==u&&(s=l[h],n))break}n||(n=i.ownerDocument.createElement("v:path"),i.appendChild(n)),s||(s=i.ownerDocument.createElement("v:textpath"),i.appendChild(s)),n.v=t,n.textPathOk=!0,s.on=!0;var c=g.text_alignment[a.align];return s.style["v-text-align"]=c?c:"left",s.style["text-decoration"]=a.decoration,s.style["v-rotate-letters"]=a.rotated,s.style["v-text-kern"]=a.kerning,s.string=a.text,this.setTransform(this.matrix)},_setFont:function(){for(var e=this.fontStyle,t=this.rawNode.childNodes,i=0;i<t.length;++i)if("textpath"==t[i].tagName){t[i].style.font=d.makeFontString(e);break}this.setTransform(this.matrix)},_getRealMatrix:function(){var e=this.inherited(arguments);return e&&(e=f.multiply(e,{dy:.35*-d.normalizedLength(this.fontStyle?this.fontStyle.size:"10pt")})),e},getTextWidth:function(){var e=this.rawNode,t=e.style.display;e.style.display="inline";var i=d.pt2px(parseFloat(e.currentStyle.width));return e.style.display=t,i}}),g.Text.nodeType="shape",g.Path=t("dojox.gfx.vml.Path",[g.Shape,u.Path],{constructor:function(e){e&&!e.getAttribute("dojoGfxType")&&e.setAttribute("dojoGfxType","path"),this.vmlPath="",this.lastControl={}},_updateWithSegment:function(t){var i=e.clone(this.last);if(this.inherited(arguments),!(arguments.length>1)){var a=this[this.renderers[t.action]](t,i);"string"==typeof this.vmlPath?(this.vmlPath+=a.join(""),this.rawNode.path.v=this.vmlPath+" r0,0 e"):Array.prototype.push.apply(this.vmlPath,a)}},setShape:function(e){return this.vmlPath=[],this.lastControl.type="",this.inherited(arguments),this.vmlPath=this.vmlPath.join(""),this.rawNode.path.v=this.vmlPath+" r0,0 e",this},_pathVmlToSvgMap:{m:"M",l:"L",t:"m",r:"l",c:"C",v:"c",qb:"Q",x:"z",e:""},renderers:{M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"},_addArgs:function(e,t,i,a){for(var o=t instanceof Array?t:t.args,r=i;a>r;++r)e.push(" ",o[r].toFixed())},_adjustRelCrd:function(e,t,i){var a=t instanceof Array?t:t.args,o=a.length,r=new Array(o),n=0,s=e.x,l=e.y;if("number"!=typeof s&&(r[0]=s=a[0],r[1]=l=a[1],n=2),"number"==typeof i&&2!=i)for(var d=i;o>=d;){for(;d>n;n+=2)r[n]=s+a[n],r[n+1]=l+a[n+1];s=r[d-2],l=r[d-1],d+=i}else for(;o>n;n+=2)r[n]=s+=a[n],r[n+1]=l+=a[n+1];return r},_adjustRelPos:function(e,t){for(var i=t instanceof Array?t:t.args,a=i.length,o=new Array(a),r=0;a>r;++r)o[r]=e+=i[r];return o},_moveToA:function(e){var t=[" m"],i=e instanceof Array?e:e.args,a=i.length;return this._addArgs(t,i,0,2),a>2&&(t.push(" l"),this._addArgs(t,i,2,a)),this.lastControl.type="",t},_moveToR:function(e,t){return this._moveToA(this._adjustRelCrd(t,e))},_lineToA:function(e){var t=[" l"],i=e instanceof Array?e:e.args;return this._addArgs(t,i,0,i.length),this.lastControl.type="",t},_lineToR:function(e,t){return this._lineToA(this._adjustRelCrd(t,e))},_hLineToA:function(e,t){for(var i=[" l"],a=" "+t.y.toFixed(),o=e instanceof Array?e:e.args,r=o.length,n=0;r>n;++n)i.push(" ",o[n].toFixed(),a);return this.lastControl.type="",i},_hLineToR:function(e,t){return this._hLineToA(this._adjustRelPos(t.x,e),t)},_vLineToA:function(e,t){for(var i=[" l"],a=" "+t.x.toFixed(),o=e instanceof Array?e:e.args,r=o.length,n=0;r>n;++n)i.push(a," ",o[n].toFixed());return this.lastControl.type="",i},_vLineToR:function(e,t){return this._vLineToA(this._adjustRelPos(t.y,e),t)},_curveToA:function(e){for(var t=[],i=e instanceof Array?e:e.args,a=i.length,o=this.lastControl,r=0;a>r;r+=6)t.push(" c"),this._addArgs(t,i,r,r+6);return o.x=i[a-4],o.y=i[a-3],o.type="C",t},_curveToR:function(e,t){return this._curveToA(this._adjustRelCrd(t,e,6))},_smoothCurveToA:function(e,t){var i=[],a=e instanceof Array?e:e.args,o=a.length,r=this.lastControl,n=0;for("C"!=r.type&&(i.push(" c"),this._addArgs(i,[t.x,t.y],0,2),this._addArgs(i,a,0,4),r.x=a[0],r.y=a[1],r.type="C",n=4);o>n;n+=4)i.push(" c"),this._addArgs(i,[2*t.x-r.x,2*t.y-r.y],0,2),this._addArgs(i,a,n,n+4),r.x=a[n],r.y=a[n+1];return i},_smoothCurveToR:function(e,t){return this._smoothCurveToA(this._adjustRelCrd(t,e,4),t)},_qCurveToA:function(e){for(var t=[],i=e instanceof Array?e:e.args,a=i.length,o=this.lastControl,r=0;a>r;r+=4)t.push(" qb"),this._addArgs(t,i,r,r+4);return o.x=i[a-4],o.y=i[a-3],o.type="Q",t},_qCurveToR:function(e,t){return this._qCurveToA(this._adjustRelCrd(t,e,4))},_qSmoothCurveToA:function(e,t){var i=[],a=e instanceof Array?e:e.args,o=a.length,r=this.lastControl,n=0;for("Q"!=r.type&&(i.push(" qb"),this._addArgs(i,[r.x=t.x,r.y=t.y],0,2),r.type="Q",this._addArgs(i,a,0,2),n=2);o>n;n+=2)i.push(" qb"),this._addArgs(i,[r.x=2*t.x-r.x,r.y=2*t.y-r.y],0,2),this._addArgs(i,a,n,n+2);return i},_qSmoothCurveToR:function(e,t){return this._qSmoothCurveToA(this._adjustRelCrd(t,e,2),t)},_arcTo:function(e,t){for(var i=[],a=e.args,o=a.length,r="a"==e.action,n=0;o>n;n+=7){var s=a[n+5],l=a[n+6];r&&(s+=t.x,l+=t.y);for(var d=c.arcAsBezier(t,a[n],a[n+1],a[n+2],a[n+3]?1:0,a[n+4]?1:0,s,l),h=0;h<d.length;++h){i.push(" c");var u=d[h];this._addArgs(i,u,0,u.length),this._updateBBox(u[0],u[1]),this._updateBBox(u[2],u[3]),this._updateBBox(u[4],u[5])}t.x=s,t.y=l}return this.lastControl.type="",i},_closePath:function(){return this.lastControl.type="",["x"]},_getRealBBox:function(){return this._confirmSegmented(),this.tbbox?this.tbbox:("string"==typeof this.shape.path&&(this.shape.path=""),this.inherited(arguments))}}),g.Path.nodeType="shape",g.TextPath=t("dojox.gfx.vml.TextPath",[g.Path,u.TextPath],{constructor:function(t){t&&t.setAttribute("dojoGfxType","textpath"),this.fontStyle=null,"text"in this||(this.text=e.clone(d.defaultTextPath)),"fontStyle"in this||(this.fontStyle=e.clone(d.defaultFont))},setText:function(e){return this.text=d.makeParameters(this.text,"string"==typeof e?{text:e}:e),this._setText(),this},setFont:function(e){return this.fontStyle="string"==typeof e?d.splitFontString(e):d.makeParameters(d.defaultFont,e),this._setFont(),this},_setText:function(){this.bbox=null;for(var e=this.rawNode,t=this.text,i=null,a=null,o=e.childNodes,r=0;r<o.length;++r){var n=o[r].tagName;if("path"==n){if(i=o[r],a)break}else if("textpath"==n&&(a=o[r],i))break}i||(i=this.rawNode.ownerDocument.createElement("v:path"),e.appendChild(i)),a||(a=this.rawNode.ownerDocument.createElement("v:textpath"),e.appendChild(a)),i.textPathOk=!0,a.on=!0;var s=g.text_alignment[t.align];a.style["v-text-align"]=s?s:"left",a.style["text-decoration"]=t.decoration,a.style["v-rotate-letters"]=t.rotated,a.style["v-text-kern"]=t.kerning,a.string=t.text},_setFont:function(){for(var e=this.fontStyle,t=this.rawNode.childNodes,i=0;i<t.length;++i)if("textpath"==t[i].tagName){t[i].style.font=d.makeFontString(e);break}}}),g.TextPath.nodeType="shape",g.Surface=t("dojox.gfx.vml.Surface",h.Surface,{constructor:function(){h.Container._init.call(this)},destroy:function(){this.clear(!0),this.inherited(arguments)},setDimensions:function(e,t){if(this.width=d.normalizedLength(e),this.height=d.normalizedLength(t),!this.rawNode)return this;var i,a=this.clipNode.style,o=this.rawNode,r=o.style,n=this.bgNode.style,s=this._parent.style;for(s.width=e,s.height=t,a.width=e,a.height=t,a.clip="rect(0px "+e+"px "+t+"px 0px)",r.width=e,r.height=t,o.coordsize=e+" "+t,n.width=e,n.height=t,i=0;i<this.children.length;++i)this.children[i]._setDimensions(e,t);return this},getDimensions:function(){var e=this.rawNode?{width:d.normalizedLength(this.rawNode.style.width),height:d.normalizedLength(this.rawNode.style.height)}:null;return e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),e}}),g.createSurface=function(e,t,i){if(!t&&!i){var a=s.position(e);t=t||a.w,i=i||a.h}"number"==typeof t&&(t+="px"),"number"==typeof i&&(i+="px");var r=new g.Surface,l=n.byId(e),h=r.clipNode=l.ownerDocument.createElement("div"),u=r.rawNode=l.ownerDocument.createElement("v:group"),c=h.style,m=u.style;o("ie")>7&&(m.display="inline-block"),r._parent=l,r._nodes.push(h),l.style.width=t,l.style.height=i,c.position="absolute",c.width=t,c.height=i,c.clip="rect(0px "+t+" "+i+" 0px)",m.position="absolute",m.width=t,m.height=i,u.coordsize=("100%"===t?t:parseFloat(t))+" "+("100%"===i?i:parseFloat(i)),u.coordorigin="0 0";var f=r.bgNode=u.ownerDocument.createElement("v:rect"),p=f.style;return p.left=p.top=0,p.width=m.width,p.height=m.height,f.filled=f.stroked="f",u.appendChild(f),h.appendChild(u),l.appendChild(h),r.width=d.normalizedLength(t),r.height=d.normalizedLength(i),r};var k=function(e){if(this!=e.getParent()){var t=e.getParent();t&&t.remove(e),this.rawNode.appendChild(e.rawNode),w.add.apply(this,arguments),p(this,function(e){"function"==typeof e.getFont&&(e.setShape(e.getShape()),e.setFont(e.getFont())),"function"==typeof e.setFill&&(e.setFill(e.getFill()),e.setStroke(e.getStroke()))})}return this},M=function(e){return this!=e.getParent()&&(this.rawNode.appendChild(e.rawNode),e.getParent()||(e.setFill(e.getFill()),e.setStroke(e.getStroke())),w.add.apply(this,arguments)),this},w=h.Container,_={add:r.fixVmlAdd===!0?k:M,remove:function(e,t){return this==e.getParent()&&(this.rawNode==e.rawNode.parentNode&&this.rawNode.removeChild(e.rawNode),w.remove.apply(this,arguments)),this},clear:function(){for(var e=this.rawNode;e.firstChild!=e.lastChild;)e.firstChild!=this.bgNode&&e.removeChild(e.firstChild),e.lastChild!=this.bgNode&&e.removeChild(e.lastChild);return w.clear.apply(this,arguments)},getBoundingBox:w.getBoundingBox,_moveChildToFront:w._moveChildToFront,_moveChildToBack:w._moveChildToBack},T={createGroup:function(){var e=this.createObject(g.Group,null),t=e.rawNode.ownerDocument.createElement("v:rect");return t.style.left=t.style.top=0,t.style.width=e.rawNode.style.width,t.style.height=e.rawNode.style.height,t.filled=t.stroked="f",e.rawNode.appendChild(t),e.bgNode=t,e},createImage:function(e){if(!this.rawNode)return null;var t=new g.Image,i=this.rawNode.ownerDocument,a=i.createElement("v:rect");a.stroked="f",a.style.width=this.rawNode.style.width,a.style.height=this.rawNode.style.height;var o=i.createElement("v:imagedata");return a.appendChild(o),t.setRawNode(a),this.rawNode.appendChild(a),t.setShape(e),this.add(t),t},createRect:function(e){if(!this.rawNode)return null;var t=new g.Rect,i=this.rawNode.ownerDocument.createElement("v:roundrect");return o("ie")>7&&(i.style.display="inline-block"),t.setRawNode(i),this.rawNode.appendChild(i),t.setShape(e),this.add(t),t},createObject:function(e,t){if(!this.rawNode)return null;var i=new e,a=this.rawNode.ownerDocument.createElement("v:"+e.nodeType);switch(i.setRawNode(a),this.rawNode.appendChild(a),e){case g.Group:case g.Line:case g.Polyline:case g.Image:case g.Text:case g.Path:case g.TextPath:this._overrideSize(a)}return i.setShape(t),this.add(i),i},_overrideSize:function(e){var t=this.rawNode.style,i=t.width,a=t.height;e.style.width=i,e.style.height=a,e.coordsize=parseInt(i)+" "+parseInt(a)}};return e.extend(g.Group,_),e.extend(g.Group,h.Creator),e.extend(g.Group,T),e.extend(g.Surface,_),e.extend(g.Surface,h.Creator),e.extend(g.Surface,T),g.fixTarget=function(e,t){return e.gfxTarget||(e.gfxTarget=e.target.__gfxObject__),!0},g});//# sourceMappingURL=vml.js.map