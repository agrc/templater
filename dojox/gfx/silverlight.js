//>>built
define("dojox/gfx/silverlight",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/declare","dojo/_base/Color","dojo/on","dojo/_base/array","dojo/dom-geometry","dojo/dom","dojo/_base/sniff","./_base","./shape","./path","./registry"],function(e,t,i,a,o,r,n,s,l,d,h,u){function c(e){var t=d.normalizeColor(e),i=t.toHex(),a=Math.round(255*t.a);return a=(0>a?0:a>255?255:a).toString(16),"#"+(a.length<2?"0"+a:a)+i.slice(1)}function m(e,t){var i={target:e,currentTarget:e,preventDefault:function(){},stopPropagation:function(){}};try{if(t.source){i.target=t.source;var a=i.target.tag;i.gfxTarget=h.byId(a)}}catch(o){}if(t)try{i.ctrlKey=t.ctrl,i.shiftKey=t.shift;var r=t.getPosition(null);i.x=i.offsetX=i.layerX=r.x,i.y=i.offsetY=i.layerY=r.y;var s=k[e.getHost().content.root.name],l=n.position(s);i.clientX=l.x+r.x,i.clientY=l.y+r.y}catch(o){}return i}function f(e,t){var i={keyCode:t.platformKeyCode,ctrlKey:t.ctrl,shiftKey:t.shift};try{t.source&&(i.target=t.source,i.gfxTarget=h.byId(i.target.tag))}catch(a){}return i}var p=d.silverlight={};e.experimental("dojox.gfx.silverlight");var y={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},g={normal:400,bold:700},v={butt:"Flat",round:"Round",square:"Square"},b={bevel:"Bevel",round:"Round"},M={serif:"Times New Roman",times:"Times New Roman","sans-serif":"Arial",helvetica:"Arial",monotone:"Courier New",courier:"Courier New"};p.Shape=i("dojox.gfx.silverlight.Shape",h.Shape,{destroy:function(){l("gfxRegistry")&&h.dispose(this),this.rawNode=null},setFill:function(e){var t,i=this.rawNode.getHost().content;this.rawNode;if(!e)return this.fillStyle=null,this._setFillAttr(null),this;if("object"==typeof e&&"type"in e){switch(e.type){case"linear":this.fillStyle=t=d.makeParameters(d.defaultLinearGradient,e);var a=i.createFromXaml("<LinearGradientBrush/>");a.mappingMode="Absolute",a.startPoint=t.x1+","+t.y1,a.endPoint=t.x2+","+t.y2,r.forEach(t.colors,function(e){var t=i.createFromXaml("<GradientStop/>");t.offset=e.offset,t.color=c(e.color),a.gradientStops.add(t)}),this._setFillAttr(a);break;case"radial":this.fillStyle=t=d.makeParameters(d.defaultRadialGradient,e);var o=i.createFromXaml("<RadialGradientBrush/>"),n=d.matrix.multiplyPoint(d.matrix.invert(this._getAdjustedMatrix()),t.cx,t.cy),s=n.x+","+n.y;o.mappingMode="Absolute",o.gradientOrigin=s,o.center=s,o.radiusX=o.radiusY=t.r,r.forEach(t.colors,function(e){var t=i.createFromXaml("<GradientStop/>");t.offset=e.offset,t.color=c(e.color),o.gradientStops.add(t)}),this._setFillAttr(o);break;case"pattern":this.fillStyle=null,this._setFillAttr(null)}return this}this.fillStyle=t=d.normalizeColor(e);var l=i.createFromXaml("<SolidColorBrush/>");return l.color=t.toHex(),l.opacity=t.a,this._setFillAttr(l),this},_setFillAttr:function(e){this.rawNode.fill=e},setStroke:function(e){var i=this.rawNode.getHost().content,o=this.rawNode;if(!e)return this.strokeStyle=null,o.stroke=null,this;("string"==typeof e||t.isArray(e)||e instanceof a)&&(e={color:e});var r=this.strokeStyle=d.makeParameters(d.defaultStroke,e);if(r.color=d.normalizeColor(r.color),r){var n=i.createFromXaml("<SolidColorBrush/>");n.color=r.color.toHex(),n.opacity=r.color.a,o.stroke=n,o.strokeThickness=r.width,o.strokeStartLineCap=o.strokeEndLineCap=o.strokeDashCap=v[r.cap],"number"==typeof r.join?(o.strokeLineJoin="Miter",o.strokeMiterLimit=r.join):o.strokeLineJoin=b[r.join];var s=r.style.toLowerCase();if(s in y&&(s=y[s]),s instanceof Array){s=t.clone(s);var l;if("butt"!=r.cap){for(l=0;l<s.length;l+=2)--s[l],s[l]<1&&(s[l]=1);for(l=1;l<s.length;l+=2)++s[l]}o.strokeDashArray=s.join(",")}else o.strokeDashArray=null}return this},_getParentSurface:function(){for(var e=this.parent;e&&!(e instanceof d.Surface);e=e.parent);return e},_applyTransform:function(){var e=this._getAdjustedMatrix(),t=this.rawNode;if(e){var i=this.rawNode.getHost().content,a=i.createFromXaml("<MatrixTransform/>"),o=i.createFromXaml("<Matrix/>");o.m11=e.xx,o.m21=e.xy,o.m12=e.yx,o.m22=e.yy,o.offsetX=e.dx,o.offsetY=e.dy,a.matrix=o,t.renderTransform=a}else t.renderTransform=null;return this},setRawNode:function(e){e.fill=null,e.stroke=null,this.rawNode=e,this.rawNode.tag=this.getUID()},_moveToFront:function(){var e=this.parent.rawNode.children,t=this.rawNode;return e.remove(t),e.add(t),this},_moveToBack:function(){var e=this.parent.rawNode.children,t=this.rawNode;return e.remove(t),e.insert(0,t),this},_getAdjustedMatrix:function(){return this.matrix},setClip:function(e){this.inherited(arguments);var t=this.rawNode;if(e){var i=e?"width"in e?"rect":"cx"in e?"ellipse":"points"in e?"polyline":"d"in e?"path":null:null;if(e&&!i)return this;var a=this.getBoundingBox()||{x:0,y:0,width:0,height:0},o="1,0,0,1,"+-a.x+","+-a.y;switch(i){case"rect":t.clip=t.getHost().content.createFromXaml("<RectangleGeometry/>"),t.clip.rect=e.x+","+e.y+","+e.width+","+e.height,t.clip.transform=o;break;case"ellipse":t.clip=t.getHost().content.createFromXaml("<EllipseGeometry/>"),t.clip.center=e.cx+","+e.cy,t.clip.radiusX=e.rx,t.clip.radiusY=e.ry,t.clip.transform="1,0,0,1,"+-a.x+","+-a.y;break;case"polyline":if(e.points.length>2){var r,n=t.getHost().content.createFromXaml("<PathGeometry/>"),s=t.getHost().content.createFromXaml("<PathFigure/>");s.StartPoint=e.points[0]+","+e.points[1];for(var l=2;l<=e.points.length-2;l+=2)r=t.getHost().content.createFromXaml("<LineSegment/>"),r.Point=e.points[l]+","+e.points[l+1],s.segments.add(r);n.figures.add(s),n.transform="1,0,0,1,"+-a.x+","+-a.y,t.clip=n}break;case"path":}}else t.clip=null;return this}}),p.Group=i("dojox.gfx.silverlight.Group",p.Shape,{constructor:function(){h.Container._init.call(this)},setRawNode:function(e){this.rawNode=e,this.rawNode.tag=this.getUID()},destroy:function(){this.clear(!0),p.Shape.prototype.destroy.apply(this,arguments)}}),p.Group.nodeType="Canvas",p.Rect=i("dojox.gfx.silverlight.Rect",[p.Shape,h.Rect],{setShape:function(e){this.shape=d.makeParameters(this.shape,e),this.bbox=null;var t=this.rawNode,i=this.shape;return t.width=i.width,t.height=i.height,t.radiusX=t.radiusY=i.r,this._applyTransform()},_getAdjustedMatrix:function(){var e=this.matrix,t=this.shape,i={dx:t.x,dy:t.y};return new d.Matrix2D(e?[e,i]:i)}}),p.Rect.nodeType="Rectangle",p.Ellipse=i("dojox.gfx.silverlight.Ellipse",[p.Shape,h.Ellipse],{setShape:function(e){this.shape=d.makeParameters(this.shape,e),this.bbox=null;var t=this.rawNode,i=this.shape;return t.width=2*i.rx,t.height=2*i.ry,this._applyTransform()},_getAdjustedMatrix:function(){var e=this.matrix,t=this.shape,i={dx:t.cx-t.rx,dy:t.cy-t.ry};return new d.Matrix2D(e?[e,i]:i)}}),p.Ellipse.nodeType="Ellipse",p.Circle=i("dojox.gfx.silverlight.Circle",[p.Shape,h.Circle],{setShape:function(e){this.shape=d.makeParameters(this.shape,e),this.bbox=null;var t=this.rawNode,i=this.shape;return t.width=t.height=2*i.r,this._applyTransform()},_getAdjustedMatrix:function(){var e=this.matrix,t=this.shape,i={dx:t.cx-t.r,dy:t.cy-t.r};return new d.Matrix2D(e?[e,i]:i)}}),p.Circle.nodeType="Ellipse",p.Line=i("dojox.gfx.silverlight.Line",[p.Shape,h.Line],{setShape:function(e){this.shape=d.makeParameters(this.shape,e),this.bbox=null;var t=this.rawNode,i=this.shape;return t.x1=i.x1,t.y1=i.y1,t.x2=i.x2,t.y2=i.y2,this}}),p.Line.nodeType="Line",p.Polyline=i("dojox.gfx.silverlight.Polyline",[p.Shape,h.Polyline],{setShape:function(e,t){e&&e instanceof Array?(this.shape=d.makeParameters(this.shape,{points:e}),t&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.shape=d.makeParameters(this.shape,e),this.bbox=null,this._normalizePoints();for(var i=this.shape.points,a=[],o=0;o<i.length;++o)a.push(i[o].x,i[o].y);return this.rawNode.points=a.join(","),this}}),p.Polyline.nodeType="Polyline",p.Image=i("dojox.gfx.silverlight.Image",[p.Shape,h.Image],{setShape:function(e){this.shape=d.makeParameters(this.shape,e),this.bbox=null;var t=this.rawNode,i=this.shape;return t.width=i.width,t.height=i.height,t.source=i.src,this._applyTransform()},_getAdjustedMatrix:function(){var e=this.matrix,t=this.shape,i={dx:t.x,dy:t.y};return new d.Matrix2D(e?[e,i]:i)},setRawNode:function(e){this.rawNode=e,this.rawNode.tag=this.getUID()}}),p.Image.nodeType="Image",p.Text=i("dojox.gfx.silverlight.Text",[p.Shape,h.Text],{setShape:function(e){this.shape=d.makeParameters(this.shape,e),this.bbox=null;var i=this.rawNode,a=this.shape;return i.text=""+a.text,i.textDecorations="underline"===a.decoration?"Underline":"None",i["Canvas.Left"]=-1e4,i["Canvas.Top"]=-1e4,this._delay||(this._delay=window.setTimeout(t.hitch(this,"_delayAlignment"),10)),this},_delayAlignment:function(){var e,t,i=this.rawNode,a=this.shape;try{e=i.actualWidth,t=i.actualHeight}catch(o){return}var r=a.x,n=a.y-.75*t;switch(a.align){case"middle":r-=e/2;break;case"end":r-=e}this._delta={dx:r,dy:n},i["Canvas.Left"]=0,i["Canvas.Top"]=0,this._applyTransform(),delete this._delay},_getAdjustedMatrix:function(){var e,t=this.matrix,i=this._delta;return e=t?i?[t,i]:t:i?i:{},new d.Matrix2D(e)},setStroke:function(){return this},_setFillAttr:function(e){this.rawNode.foreground=e},setRawNode:function(e){this.rawNode=e,this.rawNode.tag=this.getUID()},getTextWidth:function(){return this.rawNode.actualWidth},getBoundingBox:function(){var e=null,t=this.getShape().text,i=this.rawNode,a=0,o=0;if(!d._base._isRendered(this))return{x:0,y:0,width:0,height:0};if(t){try{a=i.actualWidth,o=i.actualHeight}catch(r){return null}var n=d._base._computeTextLocation(this.getShape(),a,o,!0);e={x:n.x,y:n.y,width:a,height:o}}return e}}),p.Text.nodeType="TextBlock",p.Path=i("dojox.gfx.silverlight.Path",[p.Shape,u.Path],{_updateWithSegment:function(e){this.inherited(arguments);var t=this.shape.path;"string"==typeof t&&(this.rawNode.data=t?t:null)},setShape:function(e){this.inherited(arguments);var t=this.shape.path;return this.rawNode.data=t?t:null,this}}),p.Path.nodeType="Path",p.TextPath=i("dojox.gfx.silverlight.TextPath",[p.Shape,u.TextPath],{_updateWithSegment:function(e){},setShape:function(e){},_setText:function(){}}),p.TextPath.nodeType="text";var k={},x=new Function;p.Surface=i("dojox.gfx.silverlight.Surface",h.Surface,{constructor:function(){h.Container._init.call(this)},destroy:function(){this.clear(!0),window[this._onLoadName]=x,delete k[this._nodeName],this.inherited(arguments)},setDimensions:function(e,t){this.width=d.normalizedLength(e),this.height=d.normalizedLength(t);var i=this.rawNode&&this.rawNode.getHost();return i&&(i.width=e,i.height=t),this},getDimensions:function(){var e=this.rawNode&&this.rawNode.getHost(),t=e?{width:e.content.actualWidth,height:e.content.actualHeight}:null;return t.width<=0&&(t.width=this.width),t.height<=0&&(t.height=this.height),t}}),p.createSurface=function(e,t,i){if(!t&&!i){var a=n.position(e);t=t||a.w,i=i||a.h}"number"==typeof t&&(t+="px"),"number"==typeof i&&(i+="px");var o=new p.Surface;e=s.byId(e),o._parent=e,o._nodeName=d._base._getUniqueId();var r=e.ownerDocument.createElement("script");r.type="text/xaml",r.id=d._base._getUniqueId(),r.text="<?xml version='1.0'?><Canvas xmlns='http://schemas.microsoft.com/client/2007' Name='"+o._nodeName+"'/>",e.parentNode.insertBefore(r,e),o._nodes.push(r);var h,u=d._base._getUniqueId(),c="__"+d._base._getUniqueId()+"_onLoad";o._onLoadName=c,window[c]=function(t){o.rawNode||(o.rawNode=s.byId(u,e.ownerDocument).content.root,k[o._nodeName]=e,o.onLoad(o))},h=l("safari")?"<embed type='application/x-silverlight' id='"+u+"' width='"+t+"' height='"+i+" background='transparent' source='#"+r.id+"' windowless='true' maxFramerate='60' onLoad='"+c+"' onError='__dojoSilverlightError' /><iframe style='visibility:hidden;height:0;width:0'/>":"<object type='application/x-silverlight' data='data:application/x-silverlight,' id='"+u+"' width='"+t+"' height='"+i+"'><param name='background' value='transparent' /><param name='source' value='#"+r.id+"' /><param name='windowless' value='true' /><param name='maxFramerate' value='60' /><param name='onLoad' value='"+c+"' /><param name='onError' value='__dojoSilverlightError' /></object>",e.innerHTML=h;var m=s.byId(u,e.ownerDocument);return m.content&&m.content.root?(o.rawNode=m.content.root,k[o._nodeName]=e):(o.rawNode=null,o.isLoaded=!1),o._nodes.push(m),o.width=d.normalizedLength(t),o.height=d.normalizedLength(i),o},__dojoSilverlightError=function(e,t){var i="Silverlight Error:\nCode: "+t.ErrorCode+"\nType: "+t.ErrorType+"\nMessage: "+t.ErrorMessage+"\n";switch(t.ErrorType){case"ParserError":i+="XamlFile: "+t.xamlFile+"\nLine: "+t.lineNumber+"\nPosition: "+t.charPosition+"\n";break;case"RuntimeError":i+="MethodName: "+t.methodName+"\n",0!=t.lineNumber&&(i+="Line: "+t.lineNumber+"\nPosition: "+t.charPosition+"\n")}};var w={_setFont:function(){var e=this.fontStyle,i=this.rawNode,a=e.family.toLowerCase();i.fontStyle="italic"==e.style?"Italic":"Normal",i.fontWeight=e.weight in g?g[e.weight]:e.weight,i.fontSize=d.normalizedLength(e.size),i.fontFamily=a in M?M[a]:e.family,this._delay||(this._delay=window.setTimeout(t.hitch(this,"_delayAlignment"),10))}},_=h.Container,j={add:function(e){return this!=e.getParent()&&(_.add.apply(this,arguments),this.rawNode.children.add(e.rawNode)),this},remove:function(e,t){if(this==e.getParent()){var i=e.rawNode.getParent();i&&i.children.remove(e.rawNode),_.remove.apply(this,arguments)}return this},clear:function(){return this.rawNode.children.clear(),_.clear.apply(this,arguments)},getBoundingBox:_.getBoundingBox,_moveChildToFront:_._moveChildToFront,_moveChildToBack:_._moveChildToBack},T={createObject:function(e,t){if(!this.rawNode)return null;var i=new e,a=this.rawNode.getHost().content.createFromXaml("<"+e.nodeType+"/>");return i.setRawNode(a),i.setShape(t),this.add(i),i}};t.extend(p.Text,w),t.extend(p.Group,j),t.extend(p.Group,h.Creator),t.extend(p.Group,T),t.extend(p.Surface,j),t.extend(p.Surface,h.Creator),t.extend(p.Surface,T);var C={onclick:{name:"MouseLeftButtonUp",fix:m},onmouseenter:{name:"MouseEnter",fix:m},onmouseleave:{name:"MouseLeave",fix:m},onmouseover:{name:"MouseEnter",fix:m},onmouseout:{name:"MouseLeave",fix:m},onmousedown:{name:"MouseLeftButtonDown",fix:m},onmouseup:{name:"MouseLeftButtonUp",fix:m},onmousemove:{name:"MouseMove",fix:m},onkeydown:{name:"KeyDown",fix:f},onkeyup:{name:"KeyUp",fix:f}},I={connect:function(e,i,a){return this.on(e,a?t.hitch(i,a):i)},on:function(e,i){if("string"==typeof e){0===e.indexOf("mouse")&&(e="on"+e);var a,r=e in C?C[e]:{name:e,fix:function(){return{}}};return a=this.getEventSource().addEventListener(r.name,function(e,t){i(r.fix(e,t))}),{name:r.name,token:a,remove:t.hitch(this,function(){this.getEventSource().removeEventListener(r.name,a)})}}return o(this,e,i)},disconnect:function(e){return e.remove()}};return t.extend(p.Shape,I),t.extend(p.Surface,I),d.equalSources=function(e,t){return e&&t&&e.equals(t)},p});//# sourceMappingURL=silverlight.js.map