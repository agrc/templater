//>>built
define("dojox/gfx/_gfxBidiSupport",["./_base","dojo/_base/lang","dojo/_base/sniff","dojo/dom","dojo/_base/html","dojo/_base/array","./utils","./shape","./path","dojox/string/BidiEngine"],function(e,t,i,r,a,n,o,s,d,l){function u(t,i){var r=c(i);return r&&e.utils.forEach(t,function(t){(t instanceof e.Surface||t instanceof e.Group)&&(t.textDir=r),t instanceof e.Text&&t.setShape({textDir:r}),t instanceof e.TextPath&&t.setText({textDir:r})},t),t}function c(e){var t=["ltr","rtl","auto"];return e&&(e=e.toLowerCase(),n.indexOf(t,e)<0)?null:e}switch(t.getObject("dojox.gfx._gfxBidiSupport",!0),e.renderer){case"vml":e.isVml=!0;break;case"svg":e.isSvg=!0,e.svg.useSvgWeb&&(e.isSvgWeb=!0);break;case"silverlight":e.isSilverlight=!0;break;case"canvas":case"canvasWithEvents":e.isCanvas=!0}var h={LRM:"‎",LRE:"‪",PDF:"‬",RLM:"‏",RLE:"‫"},f=new l;t.extend(e.shape.Surface,{textDir:"",setTextDir:function(e){u(this,e)},getTextDir:function(){return this.textDir}}),t.extend(e.Group,{textDir:"",setTextDir:function(e){u(this,e)},getTextDir:function(){return this.textDir}}),t.extend(e.Text,{textDir:"",formatText:function(t,r){if(r&&t&&t.length>1){var a="ltr",n=r;if("auto"==n){if(e.isVml)return t;n=f.checkContextual(t)}if(e.isVml)return a=f.checkContextual(t),n!=a?"rtl"==n?f.hasBidiChar(t)?h.RLM+h.RLM+t:f.bidiTransform(t,"IRNNN","ILNNN"):h.LRM+t:t;if(e.isSvgWeb)return"rtl"==n?f.bidiTransform(t,"IRNNN","ILNNN"):t;if(e.isSilverlight)return"rtl"==n?f.bidiTransform(t,"IRNNN","VLYNN"):f.bidiTransform(t,"ILNNN","VLYNN");if(e.isCanvas)return"rtl"==n?h.RLE+t+h.PDF:h.LRE+t+h.PDF;if(e.isSvg)return i("ff")<4?"rtl"==n?f.bidiTransform(t,"IRYNN","VLNNN"):f.bidiTransform(t,"ILYNN","VLNNN"):h.LRM+("rtl"==n?h.RLE:h.LRE)+t+h.PDF}return t},bidiPreprocess:function(e){return e}}),t.extend(e.TextPath,{textDir:"",formatText:function(t,r){if(r&&t&&t.length>1){var a="ltr",n=r;if("auto"==n){if(e.isVml)return t;n=f.checkContextual(t)}if(e.isVml)return a=f.checkContextual(t),n!=a?"rtl"==n?f.hasBidiChar(t)?h.RLM+h.RLM+t:f.bidiTransform(t,"IRNNN","ILNNN"):h.LRM+t:t;if(e.isSvgWeb)return"rtl"==n?f.bidiTransform(t,"IRNNN","ILNNN"):t;e.isSvg&&(t=i("opera")||i("ff")>=4?h.LRM+("rtl"==n?h.RLE:h.LRE)+t+h.PDF:"rtl"==n?f.bidiTransform(t,"IRYNN","VLNNN"):f.bidiTransform(t,"ILYNN","VLNNN"))}return t},bidiPreprocess:function(e){return e&&"string"==typeof e&&(this.origText=e,e=this.formatText(e,this.textDir)),e}});var m=function(e,t,i,r){var a=e.prototype[t];e.prototype[t]=function(){var e;i&&(e=i.apply(this,arguments));var t=a.call(this,e);return r&&(t=r.call(this,t,arguments)),t}},p=function(e){return e&&(e.textDir&&(e.textDir=c(e.textDir)),e.text&&e.text instanceof Array&&(e.text=e.text.join(","))),!e||void 0==e.text&&!e.textDir||this.textDir==e.textDir&&e.text==this.origText||(this.origText=void 0!=e.text?e.text:this.origText,e.textDir&&(this.textDir=e.textDir),e.text=this.formatText(this.origText,this.textDir)),this.bidiPreprocess(e)};m(e.Text,"setShape",p,null),m(e.TextPath,"setText",p,null);var g=function(e){var i=t.clone(e);return i&&this.origText&&(i.text=this.origText),i};m(e.Text,"getShape",null,g),m(e.TextPath,"getText",null,g);var y=function(e,t){var i;return t&&t[0]&&(i=c(t[0])),e.setTextDir(i?i:this.textDir),e};m(e.Surface,"createGroup",null,y),m(e.Group,"createGroup",null,y);var v=function(e){if(e){var t=e.textDir?c(e.textDir):this.textDir;t&&(e.textDir=t)}return e};return m(e.Surface,"createText",v,null),m(e.Surface,"createTextPath",v,null),m(e.Group,"createText",v,null),m(e.Group,"createTextPath",v,null),e.createSurface=function(t,i,n,o){var s=e[e.renderer].createSurface(t,i,n),d=c(o);return e.isSvgWeb?(s.textDir=d?d:a.style(r.byId(t),"direction"),s):((e.isVml||e.isSvg||e.isCanvas)&&(s.textDir=d?d:a.style(s.rawNode,"direction")),e.isSilverlight&&(s.textDir=d?d:a.style(s._nodes[1],"direction")),s)},e});//# sourceMappingURL=_gfxBidiSupport.js.map