//>>built
define("dojox/gfx/shape",["./_base","dojo/_base/lang","dojo/_base/declare","dojo/_base/kernel","dojo/_base/sniff","dojo/on","dojo/_base/array","dojo/dom-construct","dojo/_base/Color","./matrix"],function(e,t,i,a,r,o,n,s,l,d){var u=e.shape={};return u.Shape=i("dojox.gfx.shape.Shape",null,{constructor:function(){if(this.rawNode=null,this.shape=null,this.matrix=null,this.fillStyle=null,this.strokeStyle=null,this.bbox=null,this.parent=null,this.parentMatrix=null,r("gfxRegistry")){var e=u.register(this);this.getUID=function(){return e}}},destroy:function(){r("gfxRegistry")&&u.dispose(this),this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null),this.rawNode=null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var e=this.getBoundingBox();if(!e)return null;var t=this._getRealMatrix(),i=d;return[i.multiplyPoint(t,e.x,e.y),i.multiplyPoint(t,e.x+e.width,e.y),i.multiplyPoint(t,e.x+e.width,e.y+e.height),i.multiplyPoint(t,e.x,e.y+e.height)]},getEventSource:function(){return this.rawNode},setClip:function(e){this.clip=e},getClip:function(){return this.clip},setShape:function(t){return this.shape=e.makeParameters(this.shape,t),this.bbox=null,this},setFill:function(t){if(!t)return this.fillStyle=null,this;var i=null;if("object"==typeof t&&"type"in t)switch(t.type){case"linear":i=e.makeParameters(e.defaultLinearGradient,t);break;case"radial":i=e.makeParameters(e.defaultRadialGradient,t);break;case"pattern":i=e.makeParameters(e.defaultPattern,t)}else i=e.normalizeColor(t);return this.fillStyle=i,this},setStroke:function(i){if(!i)return this.strokeStyle=null,this;("string"==typeof i||t.isArray(i)||i instanceof l)&&(i={color:i});var a=this.strokeStyle=e.makeParameters(e.defaultStroke,i);return a.color=e.normalizeColor(a.color),this},setTransform:function(e){return this.matrix=d.clone(e?d.normalize(e):d.identity),this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var e=this.getParent();return e&&(e._moveChildToFront(this),this._moveToFront()),this},moveToBack:function(){var e=this.getParent();return e&&(e._moveChildToBack(this),this._moveToBack()),this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(e){return e?this.setTransform([this.matrix,e]):this},applyLeftTransform:function(e){return e?this.setTransform([e,this.matrix]):this},applyTransform:function(e){return e?this.setTransform([this.matrix,e]):this},removeShape:function(e){return this.parent&&this.parent.remove(this,e),this},_setParent:function(e,t){return this.parent=e,this._updateParentMatrix(t)},_updateParentMatrix:function(e){return this.parentMatrix=e?d.clone(e):null,this._applyTransform()},_getRealMatrix:function(){for(var e=this.matrix,t=this.parent;t;)t.matrix&&(e=d.multiply(t.matrix,e)),t=t.parent;return e}}),u._eventsProcessing={on:function(t,i){return o(this.getEventSource(),t,u.fixCallback(this,e.fixTarget,i))},connect:function(e,i,a){return"on"==e.substring(0,2)&&(e=e.substring(2)),this.on(e,a?t.hitch(i,a):i)},disconnect:function(e){return e.remove()}},u.fixCallback=function(e,i,r,o){if(o||(o=r,r=null),t.isString(o)){if(r=r||a.global,!r[o])throw['dojox.gfx.shape.fixCallback: scope["',o,'"] is null (scope="',r,'")'].join("");return function(t){return i(t,e)?r[o].apply(r,arguments||[]):void 0}}return r?function(t){return i(t,e)?o.apply(r,arguments||[]):void 0}:function(t){return i(t,e)?o.apply(r,arguments):void 0}},t.extend(u.Shape,u._eventsProcessing),u.Container={_init:function(){this.children=[],this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(e){var t=e.getParent();return t&&t.remove(e,!0),this.children.push(e),e._setParent(this,this._getRealMatrix())},remove:function(e,t){for(var i=0;i<this.children.length;++i)if(this.children[i]==e){t||(e.parent=null,e.parentMatrix=null),this.children.splice(i,1);break}return this},clear:function(e){for(var t,i=0;i<this.children.length;++i)t=this.children[i],t.parent=null,t.parentMatrix=null,e&&t.destroy();return this.children=[],this},getBoundingBox:function(){if(this.children){var e=null;return n.forEach(this.children,function(t){var i=t.getBoundingBox();if(i){var a=t.getTransform();a&&(i=d.multiplyRectangle(a,i)),e?(e.x=Math.min(e.x,i.x),e.y=Math.min(e.y,i.y),e.endX=Math.max(e.endX,i.x+i.width),e.endY=Math.max(e.endY,i.y+i.height)):e={x:i.x,y:i.y,endX:i.x+i.width,endY:i.y+i.height}}}),e&&(e.width=e.endX-e.x,e.height=e.endY-e.y),e}return null},_moveChildToFront:function(e){for(var t=0;t<this.children.length;++t)if(this.children[t]==e){this.children.splice(t,1),this.children.push(e);break}return this},_moveChildToBack:function(e){for(var t=0;t<this.children.length;++t)if(this.children[t]==e){this.children.splice(t,1),this.children.unshift(e);break}return this}},u.Surface=i("dojox.gfx.shape.Surface",null,{constructor:function(){this.rawNode=null,this._parent=null,this._nodes=[],this._events=[]},destroy:function(){if(n.forEach(this._nodes,s.destroy),this._nodes=[],n.forEach(this._events,function(e){e&&e.remove()}),this._events=[],this.rawNode=null,r("ie"))for(;this._parent.lastChild;)s.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(e){},whenLoaded:function(e,i){var a=t.hitch(e,i);this.isLoaded?a(this):o.once(this,"load",function(e){a(e)})}}),t.extend(u.Surface,u._eventsProcessing),u.Rect=i("dojox.gfx.shape.Rect",u.Shape,{constructor:function(t){this.shape=e.getDefault("Rect"),this.rawNode=t},getBoundingBox:function(){return this.shape}}),u.Ellipse=i("dojox.gfx.shape.Ellipse",u.Shape,{constructor:function(t){this.shape=e.getDefault("Ellipse"),this.rawNode=t},getBoundingBox:function(){if(!this.bbox){var e=this.shape;this.bbox={x:e.cx-e.rx,y:e.cy-e.ry,width:2*e.rx,height:2*e.ry}}return this.bbox}}),u.Circle=i("dojox.gfx.shape.Circle",u.Shape,{constructor:function(t){this.shape=e.getDefault("Circle"),this.rawNode=t},getBoundingBox:function(){if(!this.bbox){var e=this.shape;this.bbox={x:e.cx-e.r,y:e.cy-e.r,width:2*e.r,height:2*e.r}}return this.bbox}}),u.Line=i("dojox.gfx.shape.Line",u.Shape,{constructor:function(t){this.shape=e.getDefault("Line"),this.rawNode=t},getBoundingBox:function(){if(!this.bbox){var e=this.shape;this.bbox={x:Math.min(e.x1,e.x2),y:Math.min(e.y1,e.y2),width:Math.abs(e.x2-e.x1),height:Math.abs(e.y2-e.y1)}}return this.bbox}}),u.Polyline=i("dojox.gfx.shape.Polyline",u.Shape,{constructor:function(t){this.shape=e.getDefault("Polyline"),this.rawNode=t},setShape:function(e,t){return e&&e instanceof Array?(this.inherited(arguments,[{points:e}]),t&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[e]),this},_normalizePoints:function(){var e=this.shape.points,t=e&&e.length;if(t&&"number"==typeof e[0]){for(var i=[],a=0;t>a;a+=2)i.push({x:e[a],y:e[a+1]});this.shape.points=i}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var e=this.shape.points,t=e.length,i=e[0],a={l:i.x,t:i.y,r:i.x,b:i.y},r=1;t>r;++r)i=e[r],a.l>i.x&&(a.l=i.x),a.r<i.x&&(a.r=i.x),a.t>i.y&&(a.t=i.y),a.b<i.y&&(a.b=i.y);this.bbox={x:a.l,y:a.t,width:a.r-a.l,height:a.b-a.t}}return this.bbox}}),u.Image=i("dojox.gfx.shape.Image",u.Shape,{constructor:function(t){this.shape=e.getDefault("Image"),this.rawNode=t},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}}),u.Text=i(u.Shape,{constructor:function(t){this.fontStyle=null,this.shape=e.getDefault("Text"),this.rawNode=t},getFont:function(){return this.fontStyle},setFont:function(t){return this.fontStyle="string"==typeof t?e.splitFontString(t):e.makeParameters(e.defaultFont,t),this._setFont(),this},getBoundingBox:function(){var t=null,i=this.getShape();return i.text&&(t=e._base._computeTextBoundingBox(this)),t}}),u.Creator={createShape:function(t){switch(t.type){case e.defaultPath.type:return this.createPath(t);case e.defaultRect.type:return this.createRect(t);case e.defaultCircle.type:return this.createCircle(t);case e.defaultEllipse.type:return this.createEllipse(t);case e.defaultLine.type:return this.createLine(t);case e.defaultPolyline.type:return this.createPolyline(t);case e.defaultImage.type:return this.createImage(t);case e.defaultText.type:return this.createText(t);case e.defaultTextPath.type:return this.createTextPath(t)}return null},createGroup:function(){return this.createObject(e.Group)},createRect:function(t){return this.createObject(e.Rect,t)},createEllipse:function(t){return this.createObject(e.Ellipse,t)},createCircle:function(t){return this.createObject(e.Circle,t)},createLine:function(t){return this.createObject(e.Line,t)},createPolyline:function(t){return this.createObject(e.Polyline,t)},createImage:function(t){return this.createObject(e.Image,t)},createText:function(t){return this.createObject(e.Text,t)},createPath:function(t){return this.createObject(e.Path,t)},createTextPath:function(t){return this.createObject(e.TextPath,{}).setText(t)},createObject:function(e,t){return null}},u});//# sourceMappingURL=shape.js.map