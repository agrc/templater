//>>built
define("dojox/grid/_EditManager",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/_base/connect","dojo/_base/sniff","./util"],function(e,t,i,a,r,o){return i("dojox.grid._EditManager",null,{constructor:function(t){this.grid=t,this.connections=r("ie")?[a.connect(document.body,"onfocus",e.hitch(this,"_boomerangFocus"))]:[],this.connections.push(a.connect(this.grid,"onBlur",this,"apply")),this.connections.push(a.connect(this.grid,"prerender",this,"_onPreRender"))},info:{},destroy:function(){t.forEach(this.connections,a.disconnect)},cellFocus:function(e,t){this.grid.singleClickEdit||this.isEditRow(t)?this.setEditCell(e,t):this.apply(),(this.isEditing()||e&&e.editable&&e.alwaysEditing)&&this._focusEditor(e,t)},rowClick:function(e){this.isEditing()&&!this.isEditRow(e.rowIndex)&&this.apply()},styleRow:function(e){e.index==this.info.rowIndex&&(e.customClasses+=" dojoxGridRowEditing")},dispatchEvent:function(e){var t=e.cell,i=t&&t.editable?t:0;return i&&i.dispatchEvent(e.dispatch,e)},isEditing:function(){return void 0!==this.info.rowIndex},isEditCell:function(e,t){return this.info.rowIndex===e&&this.info.cell.index==t},isEditRow:function(e){return this.info.rowIndex===e},setEditCell:function(e,t){!this.isEditCell(t,e.index)&&this.grid.canEdit&&this.grid.canEdit(e,t)&&this.start(e,t,this.isEditRow(t)||e.editable)},_focusEditor:function(e,t){o.fire(e,"focus",[t])},focusEditor:function(){this.isEditing()&&this._focusEditor(this.info.cell,this.info.rowIndex)},_boomerangWindow:500,_shouldCatchBoomerang:function(){return this._catchBoomerang>(new Date).getTime()},_boomerangFocus:function(){this._shouldCatchBoomerang()&&(this.grid.focus.focusGrid(),this.focusEditor(),this._catchBoomerang=0)},_doCatchBoomerang:function(){r("ie")&&(this._catchBoomerang=(new Date).getTime()+this._boomerangWindow)},start:function(e,t,i){this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.isEditing()&&!this.isEditRow(t)&&(this.applyRowEdit(),this.grid.updateRow(t)),i?(this.info={cell:e,rowIndex:t},this.grid.doStartEdit(e,t),this.grid.updateRow(t)):this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._focusEditor(e,t),this._doCatchBoomerang())},_editorDo:function(e){var t=this.info.cell;t&&t.editable&&t[e](this.info.rowIndex)},editorApply:function(){this._editorDo("apply")},editorCancel:function(){this._editorDo("cancel")},applyCellEdit:function(e,t,i){this.grid.canEdit(t,i)&&this.grid.doApplyCellEdit(e,i,t.field)},applyRowEdit:function(){this.grid.doApplyEdit(this.info.rowIndex,this.info.cell.field)},apply:function(){this.isEditing()&&this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.applyRowEdit(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang())},cancel:function(){this.isEditing()&&(this.grid.beginUpdate(),this.editorCancel(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang())},save:function(e,t){var i=this.info.cell;!this.isEditRow(e)||t&&i.view!=t||!i.editable||i.save(i,this.info.rowIndex)},restore:function(e,t){var i=this.info.cell;this.isEditRow(t)&&i.view==e&&i.editable&&i.restore(this.info.rowIndex)},_isValidInput:function(){var e=(this.info.cell||{}).widget;return e&&e.isValid?(e.focused=!0,e.isValid(!0)):!0},_onPreRender:function(){this.isEditing()&&(this.info.value=this.info.cell.getValue())}})});//# sourceMappingURL=_EditManager.js.map