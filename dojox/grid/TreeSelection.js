//>>built
define("dojox/grid/TreeSelection",["../main","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-attr","dojo/query","./DataSelection"],function(e,t,i,a,r,o,n){return t("dojox.grid.TreeSelection",n,{setMode:function(e){this.selected={},this.sorted_sel=[],this.sorted_ltos={},this.sorted_stol={},n.prototype.setMode.call(this,e)},addToSelection:function(e){if("none"!=this.mode){var t=null;if(t="number"==typeof e||"string"==typeof e?e:this.grid.getItemIndex(e),this.selected[t])this.selectedIndex=t;else if(this.onCanSelect(t)!==!1){this.selectedIndex=t;var i=o("tr[dojoxTreeGridPath='"+t+"']",this.grid.domNode);i.length&&r.set(i[0],"aria-selected","true"),this._beginUpdate(),this.selected[t]=!0,this._insertSortedSelection(t),this.onSelected(t),this._endUpdate()}}},deselect:function(e){if("none"!=this.mode){var t=null;if(t="number"==typeof e||"string"==typeof e?e:this.grid.getItemIndex(e),this.selectedIndex==t&&(this.selectedIndex=-1),this.selected[t]){if(this.onCanDeselect(t)===!1)return;var i=o("tr[dojoxTreeGridPath='"+t+"']",this.grid.domNode);i.length&&r.set(i[0],"aria-selected","false"),this._beginUpdate(),delete this.selected[t],this._removeSortedSelection(t),this.onDeselected(t),this._endUpdate()}}},getSelected:function(){var e=[];for(var t in this.selected)this.selected[t]&&e.push(this.grid.getItem(t));return e},getSelectedCount:function(){var e=0;for(var t in this.selected)this.selected[t]&&e++;return e},_bsearch:function(e){for(var t,i=this.sorted_sel,a=i.length-1,r=0;a>=r;){var o=this._comparePaths(i[t=r+a>>1],e);if(0>o)r=t+1;else{if(!(o>0))return t;a=t-1}}return 0>o?t-o:t},_comparePaths:function(e,t){for(var i=0,a=e.length<t.length?e.length:t.length;a>i;i++){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1}return e.length<t.length?-1:e.length>t.length?1:0},_insertSortedSelection:function(e){e=String(e);var t=this.sorted_sel,a=this.sorted_ltos,r=this.sorted_stol,o=e.split("/");if(o=i.map(o,function(e){return parseInt(e,10)}),a[o]=e,r[e]=o,0===t.length)return void t.push(o);if(1==t.length){var n=this._comparePaths(t[0],o);return void(1==n?t.unshift(o):t.push(o))}var s=this._bsearch(o);this.sorted_sel.splice(s,0,o)},_removeSortedSelection:function(e){e=String(e);var t=this.sorted_sel,i=this.sorted_ltos,a=this.sorted_stol;if(0!==t.length){var r=a[e];if(r){var o=this._bsearch(r);o>-1&&(delete i[r],delete a[e],t.splice(o,1))}}},getFirstSelected:function(){if(!this.sorted_sel.length||"none"==this.mode)return-1;var e=this.sorted_sel[0];return e?(e=this.sorted_ltos[e],e?e:-1):-1},getNextSelected:function(e){if(!this.sorted_sel.length||"none"==this.mode)return-1;e=String(e);var t=this.sorted_stol[e];if(!t)return-1;var i=this._bsearch(t),a=this.sorted_sel[i+1];return a?this.sorted_ltos[a]:-1},_range:function(t,i,r){!a.isString(t)&&0>t&&(t=i);var o=(this.grid.layout.cells,this.grid.store,this.grid);if(t=new e.grid.TreePath(String(t),o),i=new e.grid.TreePath(String(i),o),t.compare(i)>0){var n=t;t=i,i=n}var s=t._str,l=i._str;r(s);for(var d=t;(d=d.next())&&d._str!=l;)r(d._str);r(l)}})});//# sourceMappingURL=TreeSelection.js.map