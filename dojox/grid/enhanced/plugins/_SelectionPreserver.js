//>>built
define("dojox/grid/enhanced/plugins/_SelectionPreserver",["dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","../../_SelectionPreserver"],function(e,t,i,a){return e("dojox.grid.enhanced.plugins._SelectionPreserver",a,{constructor:function(e){var a=this.grid;a.onSelectedById=this.onSelectedById,this._oldClearData=a._clearData;var o=this;a._clearData=function(){o._updateMapping(!a._noInternalMapping),o._trustSelection=[],o._oldClearData.apply(a,arguments)},this._connects.push(i.connect(e,"selectRange",t.hitch(this,"_updateMapping",!0,!0,!1)),i.connect(e,"deselectRange",t.hitch(this,"_updateMapping",!0,!1,!1)),i.connect(e,"deselectAll",t.hitch(this,"_updateMapping",!0,!1,!0)))},destroy:function(){this.inherited(arguments),this.grid._clearData=this._oldClearData},reset:function(){this.inherited(arguments),this._idMap=[],this._trustSelection=[],this._defaultSelected=!1},_reSelectById:function(e,t){var i=this.selection,a=this.grid;if(e&&a._hasIdentity){var o=a.store.getIdentity(e);void 0===this._selectedById[o]?this._trustSelection[t]||(i.selected[t]=this._defaultSelected):i.selected[t]=this._selectedById[o],this._idMap.push(o),a.onSelectedById(o,t,i.selected[t])}},_selectById:function(e,t){this.inherited(arguments)||(this._trustSelection[t]=!0)},onSelectedById:function(e,t,i){},_updateMapping:function(e,t,i,a,o){var n,r,s=this.selection,l=this.grid,d=0,u=0;for(n=l.rowCount-1;n>=0;--n)l._by_idx[n]?(r=l._by_idx[n].idty,r&&(e||void 0===this._selectedById[r])&&(this._selectedById[r]=!!s.selected[n])):(++u,d+=s.selected[n]?1:-1);if(u&&(this._defaultSelected=d>0),i||void 0===a||void 0===o||(i=!l.usingPagination&&Math.abs(o-a+1)===l.rowCount),i&&(!l.usingPagination||"single"===l.selectionMode))for(n=this._idMap.length-1;n>=0;--n)this._selectedById[this._idMap[n]]=t}})});//# sourceMappingURL=_SelectionPreserver.js.map