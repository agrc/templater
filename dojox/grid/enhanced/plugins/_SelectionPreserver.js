//>>built
define("dojox/grid/enhanced/plugins/_SelectionPreserver",["dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","../../_SelectionPreserver"],function(e,t,i,r){return e("dojox.grid.enhanced.plugins._SelectionPreserver",r,{constructor:function(e){var r=this.grid;r.onSelectedById=this.onSelectedById,this._oldClearData=r._clearData;var n=this;r._clearData=function(){n._updateMapping(!r._noInternalMapping),n._trustSelection=[],n._oldClearData.apply(r,arguments)},this._connects.push(i.connect(e,"selectRange",t.hitch(this,"_updateMapping",!0,!0,!1)),i.connect(e,"deselectRange",t.hitch(this,"_updateMapping",!0,!1,!1)),i.connect(e,"deselectAll",t.hitch(this,"_updateMapping",!0,!1,!0)))},destroy:function(){this.inherited(arguments),this.grid._clearData=this._oldClearData},reset:function(){this.inherited(arguments),this._idMap=[],this._trustSelection=[],this._defaultSelected=!1},_reSelectById:function(e,t){var i=this.selection,r=this.grid;if(e&&r._hasIdentity){var n=r.store.getIdentity(e);void 0===this._selectedById[n]?this._trustSelection[t]||(i.selected[t]=this._defaultSelected):i.selected[t]=this._selectedById[n],this._idMap.push(n),r.onSelectedById(n,t,i.selected[t])}},_selectById:function(e,t){this.inherited(arguments)||(this._trustSelection[t]=!0)},onSelectedById:function(e,t,i){},_updateMapping:function(e,t,i,r,n){var o,a,s=this.selection,d=this.grid,l=0,u=0;for(o=d.rowCount-1;o>=0;--o)d._by_idx[o]?(a=d._by_idx[o].idty,a&&(e||void 0===this._selectedById[a])&&(this._selectedById[a]=!!s.selected[o])):(++u,l+=s.selected[o]?1:-1);if(u&&(this._defaultSelected=l>0),i||void 0===r||void 0===n||(i=!d.usingPagination&&Math.abs(n-r+1)===d.rowCount),i&&(!d.usingPagination||"single"===d.selectionMode))for(o=this._idMap.length-1;o>=0;--o)this._selectedById[this._idMap[o]]=t}})});//# sourceMappingURL=_SelectionPreserver.js.map