//>>built
define("dojox/grid/enhanced/plugins/Printer",["dojo/_base/declare","dojo/_base/html","dojo/_base/Deferred","dojo/_base/lang","dojo/_base/sniff","dojo/_base/xhr","dojo/_base/array","dojo/query","dojo/DeferredList","../_Plugin","../../EnhancedGrid","./exporter/TableWriter"],function(e,t,a,i,r,n,o,s,l,d,u,c){var m=e("dojox.grid.enhanced.plugins.Printer",d,{name:"printer",constructor:function(e){this.grid=e,this._mixinGrid(e),e.setExportFormatter(function(e,t,a,i){return t.format(a,i)})},_mixinGrid:function(){var e=this.grid;e.printGrid=i.hitch(this,this.printGrid),e.printSelected=i.hitch(this,this.printSelected),e.exportToHTML=i.hitch(this,this.exportToHTML),e.exportSelectedToHTML=i.hitch(this,this.exportSelectedToHTML),e.normalizePrintedGrid=i.hitch(this,this.normalizeRowHeight)},printGrid:function(e){this.exportToHTML(e,i.hitch(this,this._print))},printSelected:function(e){this.exportSelectedToHTML(e,i.hitch(this,this._print))},exportToHTML:function(e,t){e=this._formalizeArgs(e);var a=this;this.grid.exportGrid("table",e,function(i){a._wrapHTML(e.title,e.cssFiles,e.titleInBody+i).then(t)})},exportSelectedToHTML:function(e,t){e=this._formalizeArgs(e);var a=this;this.grid.exportSelected("table",e.writerArgs,function(i){a._wrapHTML(e.title,e.cssFiles,e.titleInBody+i).then(t)})},_loadCSSFiles:function(e){var t=o.map(e,function(e){if(e=i.trim(e),".css"===e.substring(e.length-4).toLowerCase())return n.get({url:e});var t=new a;return t.callback(e),t});return l.prototype.gatherResults(t)},_print:function(e){var a,i=this,n=function(t){var a=t.document;a.open(),a.write(e),a.close(),i.normalizeRowHeight(a)};if(window.print)if(r("chrome")||r("opera"))a=window.open("javascript: ''","","status=0,menubar=0,location=0,toolbar=0,width=1,height=1,resizable=0,scrollbars=0"),n(a),a.print(),a.close();else{var o=this._printFrame,s=this.grid.domNode;if(!o){var l=s.id+"_print_frame";(o=t.byId(l))||(o=t.create("iframe"),o.id=l,o.frameBorder=0,t.style(o,{width:"1px",height:"1px",position:"absolute",right:0,bottom:0,border:"none",overflow:"hidden"}),r("ie")||t.style(o,"visibility","hidden"),s.appendChild(o)),this._printFrame=o}a=o.contentWindow,n(a),a.focus(),a.print()}},_wrapHTML:function(e,a,i){return this._loadCSSFiles(a).then(function(a){var r,n=['<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',"<html ",t._isBodyLtr()?"":'dir="rtl"',"><head><title>",e,'</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>'];for(r=0;r<a.length;++r)n.push('<style type="text/css">',a[r],"</style>");return n.push("</head>"),i.search(/^\s*<body/i)<0&&(i="<body>"+i+"</body>"),n.push(i,"</html>"),n.join("")})},normalizeRowHeight:function(e){var a,i,r,n=s(".grid_view",e.body),l=o.map(n,function(e){return s(".grid_header",e)[0]}),d=o.map(n,function(e){return s(".grid_row",e)}),u=d[0].length,c=0;for(i=n.length-1;i>=0;--i)r=t.contentBox(l[i]).h,r>c&&(c=r);for(i=n.length-1;i>=0;--i)t.style(l[i],"height",c+"px");for(a=0;u>a;++a){for(c=0,i=n.length-1;i>=0;--i)r=t.contentBox(d[i][a]).h,r>c&&(c=r);for(i=n.length-1;i>=0;--i)t.style(d[i][a],"height",c+"px")}var m=0,h=t._isBodyLtr();for(i=0;i<n.length;++i)t.style(n[i],h?"left":"right",m+"px"),m+=t.marginBox(n[i]).w},_formalizeArgs:function(e){return e=e&&i.isObject(e)?e:{},e.title=String(e.title)||"",i.isArray(e.cssFiles)||(e.cssFiles=[e.cssFiles]),e.titleInBody=e.title?["<h1>",e.title,"</h1>"].join(""):"",e}});return u.registerPlugin(m,{dependency:["exporter"]}),m});//# sourceMappingURL=Printer.js.map