//>>built
define("dojox/grid/enhanced/plugins/_StoreLayer",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/xhr"],function(e,t,i,a){var r=i.getObject("grid.enhanced.plugins",!0,dojox),n=function(e){for(var i=["reorder","sizeChange","normal","presentation"],a=i.length,r=e.length-1;r>=0;--r){var n=t.indexOf(i,e[r]);n>=0&&n<=a&&(a=n)}return a<i.length-1?i.slice(0,a+1):i},o=function(e){var t,i=this._layers,a=i.length;if(e){for(t=a-1;t>=0;--t)if(i[t].name()==e){i[t]._unwrap(i[t+1]);break}i.splice(t,1)}else for(t=a-1;t>=0;--t)i[t]._unwrap();return i.length||(delete this._layers,delete this.layer,delete this.unwrap,delete this.forEachLayer),this},s=function(e){var t,i=this._layers;if(void 0===e)return i.length;if("number"==typeof e)return i[e];for(t=i.length-1;t>=0;--t)if(i[t].name()==e)return i[t];return null},l=function(e,t){var i,a,r,n=this._layers.length;t?(i=0,a=n,r=1):(i=n-1,a=-1,r=-1);for(var o=i;o!=a;o+=r)if(!1===e(this._layers[o],o))return o;return a};r.wrap=function(e,a,r,d){e._layers||(e._layers=[],e.layer=i.hitch(e,s),e.unwrap=i.hitch(e,o),e.forEachLayer=i.hitch(e,l));var u=n(r.tags);return t.some(e._layers,function(i,n){return!t.some(i.tags,function(e){return t.indexOf(u,e)>=0})&&(e._layers.splice(n,0,r),r._wrap(e,a,d,i),!0)})||(e._layers.push(r),r._wrap(e,a,d)),e};var d=e("dojox.grid.enhanced.plugins._StoreLayer",null,{tags:["normal"],layerFuncName:"_fetch",constructor:function(){this._store=null,this._originFetch=null,this.__enabled=!0},initialize:function(e){},uninitialize:function(e){},invalidate:function(){},_wrap:function(e,t,a,r){this._store=e,this._funcName=t;var n=i.hitch(this,function(){return(this.enabled()?this[a||this.layerFuncName]:this.originFetch).apply(this,arguments)});r?(this._originFetch=r._originFetch,r._originFetch=n):(this._originFetch=e[t]||function(){},e[t]=n),this.initialize(e)},_unwrap:function(e){this.uninitialize(this._store),e?e._originFetch=this._originFetch:this._store[this._funcName]=this._originFetch,this._originFetch=null,this._store=null},enabled:function(e){return void 0!==e&&(this.__enabled=!!e),this.__enabled},name:function(){if(!this.__name){var e=this.declaredClass.match(/(?:\.(?:_*)([^\.]+)Layer$)|(?:\.([^\.]+)$)/i);this.__name=e?(e[1]||e[2]).toLowerCase():this.declaredClass}return this.__name},originFetch:function(){return i.hitch(this._store,this._originFetch).apply(this,arguments)}});return{_StoreLayer:d,_ServerSideLayer:e("dojox.grid.enhanced.plugins._ServerSideLayer",d,{constructor:function(e){e=e||{},this._url=e.url||"",this._isStateful=!!e.isStateful,this._onUserCommandLoad=e.onCommandLoad||function(){},this.__cmds={cmdlayer:this.name(),enable:!0},this.useCommands(this._isStateful)},enabled:function(e){var t=this.inherited(arguments);return this.__cmds.enable=this.__enabled,t},useCommands:function(e){return void 0!==e&&(this.__cmds.cmdlayer=e&&this._isStateful?this.name():null),!!this.__cmds.cmdlayer},_fetch:function(e){return this.__cmds.cmdlayer?a.post({url:this._url||this._store.url,content:this.__cmds,load:i.hitch(this,function(t){this.onCommandLoad(t,e),this.originFetch(e)}),error:i.hitch(this,this.onCommandError)}):(this.onCommandLoad("",e),this.originFetch(e)),e},command:function(e,t){var i=this.__cmds;return null===t?delete i[e]:void 0!==t&&(i[e]=t),i[e]},onCommandLoad:function(e,t){this._onUserCommandLoad(this.__cmds,t,e)},onCommandError:function(e){throw e}}),wrap:r.wrap}});//# sourceMappingURL=_StoreLayer.js.map