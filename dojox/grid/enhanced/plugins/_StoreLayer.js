//>>built
define("dojox/grid/enhanced/plugins/_StoreLayer",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/xhr"],function(e,t,a,i){var r=a.getObject("grid.enhanced.plugins",!0,dojox),n=function(e){for(var a=["reorder","sizeChange","normal","presentation"],i=a.length,r=e.length-1;r>=0;--r){var n=t.indexOf(a,e[r]);n>=0&&n<=i&&(i=n)}return i<a.length-1?a.slice(0,i+1):a},o=function(e){var t,a=this._layers,i=a.length;if(e){for(t=i-1;t>=0;--t)if(a[t].name()==e){a[t]._unwrap(a[t+1]);break}a.splice(t,1)}else for(t=i-1;t>=0;--t)a[t]._unwrap();return a.length||(delete this._layers,delete this.layer,delete this.unwrap,delete this.forEachLayer),this},s=function(e){var t,a=this._layers;if(void 0===e)return a.length;if("number"==typeof e)return a[e];for(t=a.length-1;t>=0;--t)if(a[t].name()==e)return a[t];return null},l=function(e,t){var a,i,r,n=this._layers.length;t?(a=0,i=n,r=1):(a=n-1,i=-1,r=-1);for(var o=a;o!=i;o+=r)if(!1===e(this._layers[o],o))return o;return i};r.wrap=function(e,i,r,d){e._layers||(e._layers=[],e.layer=a.hitch(e,s),e.unwrap=a.hitch(e,o),e.forEachLayer=a.hitch(e,l));var u=n(r.tags);return t.some(e._layers,function(a,n){return!t.some(a.tags,function(e){return t.indexOf(u,e)>=0})&&(e._layers.splice(n,0,r),r._wrap(e,i,d,a),!0)})||(e._layers.push(r),r._wrap(e,i,d)),e};var d=e("dojox.grid.enhanced.plugins._StoreLayer",null,{tags:["normal"],layerFuncName:"_fetch",constructor:function(){this._store=null,this._originFetch=null,this.__enabled=!0},initialize:function(e){},uninitialize:function(e){},invalidate:function(){},_wrap:function(e,t,i,r){this._store=e,this._funcName=t;var n=a.hitch(this,function(){return(this.enabled()?this[i||this.layerFuncName]:this.originFetch).apply(this,arguments)});r?(this._originFetch=r._originFetch,r._originFetch=n):(this._originFetch=e[t]||function(){},e[t]=n),this.initialize(e)},_unwrap:function(e){this.uninitialize(this._store),e?e._originFetch=this._originFetch:this._store[this._funcName]=this._originFetch,this._originFetch=null,this._store=null},enabled:function(e){return void 0!==e&&(this.__enabled=!!e),this.__enabled},name:function(){if(!this.__name){var e=this.declaredClass.match(/(?:\.(?:_*)([^\.]+)Layer$)|(?:\.([^\.]+)$)/i);this.__name=e?(e[1]||e[2]).toLowerCase():this.declaredClass}return this.__name},originFetch:function(){return a.hitch(this._store,this._originFetch).apply(this,arguments)}});return{_StoreLayer:d,_ServerSideLayer:e("dojox.grid.enhanced.plugins._ServerSideLayer",d,{constructor:function(e){e=e||{},this._url=e.url||"",this._isStateful=!!e.isStateful,this._onUserCommandLoad=e.onCommandLoad||function(){},this.__cmds={cmdlayer:this.name(),enable:!0},this.useCommands(this._isStateful)},enabled:function(e){var t=this.inherited(arguments);return this.__cmds.enable=this.__enabled,t},useCommands:function(e){return void 0!==e&&(this.__cmds.cmdlayer=e&&this._isStateful?this.name():null),!!this.__cmds.cmdlayer},_fetch:function(e){return this.__cmds.cmdlayer?i.post({url:this._url||this._store.url,content:this.__cmds,load:a.hitch(this,function(t){this.onCommandLoad(t,e),this.originFetch(e)}),error:a.hitch(this,this.onCommandError)}):(this.onCommandLoad("",e),this.originFetch(e)),e},command:function(e,t){var a=this.__cmds;return null===t?delete a[e]:void 0!==t&&(a[e]=t),a[e]},onCommandLoad:function(e,t){this._onUserCommandLoad(this.__cmds,t,e)},onCommandError:function(e){throw e}}),wrap:r.wrap}});//# sourceMappingURL=_StoreLayer.js.map