//>>built
define("dojox/grid/enhanced/plugins/Selector",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/_base/event","dojo/keys","dojo/query","dojo/_base/html","dojo/_base/window","dijit/focus","../../_RowSelector","../_Plugin","../../EnhancedGrid","../../cells/_base","./AutoScroll"],function(e,t,i,a,o,n,r,s,l,d,u,h,c){var m=0,f=1,p=2,g={col:"row",row:"col"},y=function(e,t,i,a,o){return"cell"!==e?(t=t[e],i=i[e],a=a[e],"number"==typeof t&&"number"==typeof i&&"number"==typeof a&&(o?t>=i&&t<a||t>a&&t<=i:t>=i&&t<=a||t>=a&&t<=i)):y("col",t,i,a,o)&&y("row",t,i,a,o)},v=function(e,t,i){try{if(t&&i)switch(e){case"col":case"row":return!(t[e]!=i[e]||"number"!=typeof t[e]||g[e]in t||g[e]in i);case"cell":return t.col==i.col&&t.row==i.row&&"number"==typeof t.col&&"number"==typeof t.row}}catch(e){}return!1},k=function(e){try{e&&e.preventDefault&&o.stop(e)}catch(e){}},b=function(e,t,i){switch(e){case"col":return{col:void 0===i?t:i,except:[]};case"row":return{row:t,except:[]};case"cell":return{row:t,col:i}}return null},M=i("dojox.grid.enhanced.plugins.Selector",h,{name:"selector",constructor:function(e,t){this.grid=e,this._config={row:p,col:p,cell:p},this.noClear=t&&t.noClear,this.setupConfig(t),"single"===e.selectionMode&&(this._config.row=f),this._enabled=!0,this._selecting={},this._selected={col:[],row:[],cell:[]},this._startPoint={},this._currentPoint={},this._lastAnchorPoint={},this._lastEndPoint={},this._lastSelectedAnchorPoint={},this._lastSelectedEndPoint={},this._keyboardSelect={},this._lastType=null,this._selectedRowModified={},this._hacks(),this._initEvents(),this._initAreas(),this._mixinGrid()},destroy:function(){this.inherited(arguments)},setupConfig:function(e){if(e&&t.isObject(e)){var i=["row","col","cell"];for(var o in e)a.indexOf(i,o)>=0&&(e[o]&&"disabled"!=e[o]?"single"==e[o]?this._config[o]=f:this._config[o]=p:this._config[o]=m);var n=["none","single","extended"][this._config.row];this.grid.selection.setMode(n)}},isSelected:function(e,t,i){return this._isSelected(e,b(e,t,i))},toggleSelect:function(e,t,i){this._startSelect(e,b(e,t,i),this._config[e]===p,!1,!1,!this.isSelected(e,t,i)),this._endSelect(e)},select:function(e,t,i){this.isSelected(e,t,i)||this.toggleSelect(e,t,i)},deselect:function(e,t,i){this.isSelected(e,t,i)&&this.toggleSelect(e,t,i)},selectRange:function(e,t,i,a){this.grid._selectingRange=!0;var o="cell"==e?b(e,t.row,t.col):b(e,t),n="cell"==e?b(e,i.row,i.col):b(e,i);this._startSelect(e,o,!1,!1,!1,a),this._highlight(e,n,void 0===a||a),this._endSelect(e),this.grid._selectingRange=!1},clear:function(e){this._clearSelection(e||"all")},isSelecting:function(e){return void 0===e?this._selecting.col||this._selecting.row||this._selecting.cell:this._selecting[e]},selectEnabled:function(e){return void 0===e||this.isSelecting()||(this._enabled=!!e),this._enabled},getSelected:function(e,t){switch(e){case"cell":return a.map(this._selected[e],function(e){return e});case"col":case"row":return a.map(t?this._selected[e]:a.filter(this._selected[e],function(e){return 0===e.except.length}),function(i){return t?i:i[e]})}return[]},getSelectedCount:function(e,t){switch(e){case"cell":return this._selected[e].length;case"col":case"row":return(t?this._selected[e]:a.filter(this._selected[e],function(e){return 0===e.except.length})).length}return 0},getSelectedType:function(){var e=this._selected;return["","cell","row","row|cell","col","col|cell","col|row","col|row|cell"][!!e.cell.length|!!e.row.length<<1|!!e.col.length<<2]},getLastSelectedRange:function(e){return this._lastAnchorPoint[e]?{start:this._lastAnchorPoint[e],end:this._lastEndPoint[e]}:null},_hacks:function(){var e=this.grid,i=function(t){t.cellNode&&e.onMouseUp(t),e.onMouseUpRow(t)},o=t.hitch(e,"onMouseUp"),n=t.hitch(e,"onMouseDown"),r=function(e){e.cellNode.style.border="solid 1px"};a.forEach(e.views.views,function(e){e.content.domouseup=i,e.header.domouseup=o,"dojox.grid._RowSelector"==e.declaredClass&&(e.domousedown=n,e.domouseup=o,e.dofocus=r)}),e.selection.clickSelect=function(){},this._oldDeselectAll=e.selection.deselectAll;var l=this;e.selection.selectRange=function(t,i){l.selectRange("row",t,i,!0),e.selection.preserver&&e.selection.preserver._updateMapping(!0,!0,!1,t,i),e.selection.onChanged()},e.selection.deselectRange=function(t,i){l.selectRange("row",t,i,!1),e.selection.preserver&&e.selection.preserver._updateMapping(!0,!1,!1,t,i),e.selection.onChanged()},e.selection.deselectAll=function(){e._selectingRange=!0,l._oldDeselectAll.apply(e.selection,arguments),l._clearSelection("all"),e._selectingRange=!1,e.selection.preserver&&e.selection.preserver._updateMapping(!0,!1,!0),e.selection.onChanged()};var d=e.views.views[0];d instanceof u&&(d.doStyleRowNode=function(t,i){s.removeClass(i,"dojoxGridRow"),s.addClass(i,"dojoxGridRowbar"),s.addClass(i,"dojoxGridNonNormalizedCell"),s.toggleClass(i,"dojoxGridRowbarOver",e.rows.isOver(t)),s.toggleClass(i,"dojoxGridRowbarSelected",!!e.selection.isSelected(t))}),this.connect(e,"updateRow",function(t){a.forEach(e.layout.cells,function(e){this.isSelected("cell",t,e.index)&&this._highlightNode(e.getNode(t),!0)},this)})},_mixinGrid:function(){var e=this.grid;e.setupSelectorConfig=t.hitch(this,this.setupConfig),e.onStartSelect=function(){},e.onEndSelect=function(){},e.onStartDeselect=function(){},e.onEndDeselect=function(){},e.onSelectCleared=function(){}},_initEvents:function(){var e=this.grid,i=this,a=t.partial,o=function(e,t){if("row"===e&&(i._isUsingRowSelector=!0),i.selectEnabled()&&i._config[e]&&2!=t.button){(i._keyboardSelect.col||i._keyboardSelect.row||i._keyboardSelect.cell)&&(i._endSelect("all"),i._keyboardSelect.col=i._keyboardSelect.row=i._keyboardSelect.cell=0),i._usingKeyboard&&(i._usingKeyboard=!1);var a=b(e,t.rowIndex,t.cell&&t.cell.index);i._startSelect(e,a,t.ctrlKey,t.shiftKey)}},n=t.hitch(this,"_endSelect");this.connect(e,"onHeaderCellMouseDown",a(o,"col")),this.connect(e,"onHeaderCellMouseUp",a(n,"col")),this.connect(e,"onRowSelectorMouseDown",a(o,"row")),this.connect(e,"onRowSelectorMouseUp",a(n,"row")),this.connect(e,"onCellMouseDown",function(t){t.cell&&t.cell.isRowSelector||(e.singleClickEdit&&(i._singleClickEdit=!0,e.singleClickEdit=!1),o(i._config.cell==m?"row":"cell",t))}),this.connect(e,"onCellMouseUp",function(t){i._singleClickEdit&&(delete i._singleClickEdit,e.singleClickEdit=!0),n("all",t)}),this.connect(e,"onCellMouseOver",function(e){"row"!=i._curType&&i._selecting[i._curType]&&i._config[i._curType]==p&&(i._highlight("col",b("col",e.cell.index),i._toSelect),i._keyboardSelect.cell||i._highlight("cell",b("cell",e.rowIndex,e.cell.index),i._toSelect))}),this.connect(e,"onHeaderCellMouseOver",function(e){i._selecting.col&&i._config.col==p&&i._highlight("col",b("col",e.cell.index),i._toSelect)}),this.connect(e,"onRowMouseOver",function(e){i._selecting.row&&i._config.row==p&&i._highlight("row",b("row",e.rowIndex),i._toSelect)}),this.connect(e,"onSelectedById","_onSelectedById"),this.connect(e,"_onFetchComplete",function(){e._notRefreshSelection||this._refreshSelected(!0)}),this.connect(e.scroller,"buildPage",function(){e._notRefreshSelection||this._refreshSelected(!0)}),this.connect(l.doc,"onmouseup",a(n,"all")),this.connect(e,"onEndAutoScroll",function(e,t,a,o){var n,r,s=i._selecting.cell,l=t?1:-1;e&&(s||i._selecting.row)?(n=s?"cell":"row",r=i._currentPoint[n],i._highlight(n,b(n,r.row+l,r.col),i._toSelect)):e||!s&&!i._selecting.col||(n=s?"cell":"col",r=i._currentPoint[n],i._highlight(n,b(n,r.row,o),i._toSelect))}),this.subscribe("dojox/grid/rearrange/move/"+e.id,"_onInternalRearrange"),this.subscribe("dojox/grid/rearrange/copy/"+e.id,"_onInternalRearrange"),this.subscribe("dojox/grid/rearrange/change/"+e.id,"_onExternalChange"),this.subscribe("dojox/grid/rearrange/insert/"+e.id,"_onExternalChange"),this.subscribe("dojox/grid/rearrange/remove/"+e.id,"clear"),this.connect(e,"onSelected",function(e){this._selectedRowModified&&this._isUsingRowSelector?delete this._selectedRowModified:this.grid._selectingRange||this.select("row",e)}),this.connect(e,"onDeselected",function(e){this._selectedRowModified&&this._isUsingRowSelector?delete this._selectedRowModified:this.grid._selectingRange||this.deselect("row",e)})},_onSelectedById:function(e,t,i){if(!this.grid._noInternalMapping){var o=[this._lastAnchorPoint.row,this._lastEndPoint.row,this._lastSelectedAnchorPoint.row,this._lastSelectedEndPoint.row];o=o.concat(this._selected.row);var n=!1;a.forEach(o,function(i){i&&(i.id===e?(n=!0,i.row=t):i.row===t&&i.id&&(i.row=-1))}),!n&&i&&a.some(this._selected.row,function(i){return!(!i||i.id||i.except.length)&&(i.id=e,i.row=t,!0)}),n=!1,o=[this._lastAnchorPoint.cell,this._lastEndPoint.cell,this._lastSelectedAnchorPoint.cell,this._lastSelectedEndPoint.cell],o=o.concat(this._selected.cell),a.forEach(o,function(i){i&&(i.id===e?(n=!0,i.row=t):i.row===t&&i.id&&(i.row=-1))})}},onSetStore:function(){this._clearSelection("all")},_onInternalRearrange:function(e,t){try{this._refresh("col",!1),a.forEach(this._selected.row,function(e){a.forEach(this.grid.layout.cells,function(t){this._highlightNode(t.getNode(e.row),!1)},this)},this),r(".dojoxGridRowSelectorSelected").forEach(function(e){s.removeClass(e,"dojoxGridRowSelectorSelected"),s.removeClass(e,"dojoxGridRowSelectorSelectedUp"),s.removeClass(e,"dojoxGridRowSelectorSelectedDown")});var i=function(e){e&&delete e.converted},o=[this._lastAnchorPoint[e],this._lastEndPoint[e],this._lastSelectedAnchorPoint[e],this._lastSelectedEndPoint[e]];if("cell"===e){this.selectRange("cell",t.to.min,t.to.max);var n=this.grid.layout.cells;a.forEach(o,function(e){if(!e.converted)for(var i=t.from.min.row,a=t.to.min.row;i<=t.from.max.row;++i,++a)for(var o=t.from.min.col,r=t.to.min.col;o<=t.from.max.col;++o,++r){for(;n[o].hidden;)++o;for(;n[r].hidden;)++r;if(e.row==i&&e.col==o)return e.row=a,e.col=r,void(e.converted=!0)}})}else o=this._selected.cell.concat(this._selected[e]).concat(o).concat([this._lastAnchorPoint.cell,this._lastEndPoint.cell,this._lastSelectedAnchorPoint.cell,this._lastSelectedEndPoint.cell]),a.forEach(o,function(i){if(i&&!i.converted){var a=i[e];a in t&&(i[e]=t[a]),i.converted=!0}}),a.forEach(this._selected[g[e]],function(e){for(var i=0,a=e.except.length;i<a;++i){var o=e.except[i];o in t&&(e.except[i]=t[o])}});a.forEach(o,i),this._refreshSelected(!0),this._focusPoint(e,this._lastEndPoint)}catch(e){}},_onExternalChange:function(e,t){var i="cell"==e?t.min:t[0],a="cell"==e?t.max:t[t.length-1];this.selectRange(e,i,a)},_refresh:function(e,t){this._keyboardSelect[e]||a.forEach(this._selected[e],function(i){this._highlightSingle(e,t,i,void 0,!0)},this)},_refreshSelected:function(){this._refresh("col",!0),this._refresh("row",!0),this._refresh("cell",!0)},_initAreas:function(){var e=this.grid,i=e.focus,a=this,o=1,r=2,l=function(t,n,s,l,d){var u=a._keyboardSelect;if(d.shiftKey&&u[t]){if(u[t]===o){if("cell"===t){var h=a._lastEndPoint[t];if(i.cell!=e.layout.cells[h.col+l]||i.rowIndex!=h.row+s)return void(u[t]=0)}a._startSelect(t,a._lastAnchorPoint[t],!0,!1,!0),a._highlight(t,a._lastEndPoint[t],a._toSelect),u[t]=r}var c=n(t,s,l,d);a._isValid(t,c,e)&&a._highlight(t,c,a._toSelect),k(d)}},h=function(t,i,r,s){if(s&&a.selectEnabled()&&a._config[t]!=m)switch(r.keyCode){case n.SPACE:a._startSelect(t,i(),r.ctrlKey,r.shiftKey),a._endSelect(t);break;case n.SHIFT:a._config[t]==p&&a._isValid(t,a._lastAnchorPoint[t],e)&&(a._endSelect(t),a._keyboardSelect[t]=o,a._usingKeyboard=!0)}},c=function(e,t,i){i&&t.keyCode==n.SHIFT&&a._keyboardSelect[e]&&(a._endSelect(e),a._keyboardSelect[e]=0)};e.views.views[0]instanceof u&&(this._lastFocusedRowBarIdx=0,i.addArea({name:"rowHeader",onFocus:function(t,o){var n=e.views.views[0];if(n instanceof u){var r=n.getCellNode(a._lastFocusedRowBarIdx,0);return r&&s.toggleClass(r,i.focusClass,!1),t&&"rowIndex"in t&&(t.rowIndex>=0?a._lastFocusedRowBarIdx=t.rowIndex:a._lastFocusedRowBarIdx||(a._lastFocusedRowBarIdx=0)),r=n.getCellNode(a._lastFocusedRowBarIdx,0),r&&(d.focus(r),s.toggleClass(r,i.focusClass,!0)),i.rowIndex=a._lastFocusedRowBarIdx,k(t),!0}return!1},onBlur:function(t,o){var n=e.views.views[0];if(n instanceof u){var r=n.getCellNode(a._lastFocusedRowBarIdx,0);r&&s.toggleClass(r,i.focusClass,!1),k(t)}return!0},onMove:function(t,o,n){var r=e.views.views[0];if(t&&r instanceof u){var l=a._lastFocusedRowBarIdx+t;if(l>=0&&l<e.rowCount){k(n);var h=r.getCellNode(a._lastFocusedRowBarIdx,0);s.toggleClass(h,i.focusClass,!1);var c=e.scroller,m=c.getLastPageRow(c.page),f=e.rowCount-1,p=Math.min(f,l);l>m&&e.setScrollTop(e.scrollTop+c.findScrollTop(p)-c.findScrollTop(a._lastFocusedRowBarIdx)),h=r.getCellNode(l,0),d.focus(h),s.toggleClass(h,i.focusClass,!0),a._lastFocusedRowBarIdx=l,i.cell=h,i.cell.view=r,i.cell.getNode=function(e){return i.cell},i.rowIndex=a._lastFocusedRowBarIdx,i.scrollIntoView(),i.cell=null}}}}),i.placeArea("rowHeader","before","content")),i.addArea({name:"cellselect",onMove:t.partial(l,"cell",function(e,t,i,o){var n=a._currentPoint[e];return b("cell",n.row+t,n.col+i)}),onKeyDown:t.partial(h,"cell",function(){return b("cell",i.rowIndex,i.cell.index)}),onKeyUp:t.partial(c,"cell")}),i.placeArea("cellselect","below","content"),i.addArea({name:"colselect",onMove:t.partial(l,"col",function(e,t,i,o){var n=a._currentPoint[e];return b("col",n.col+i)}),onKeyDown:t.partial(h,"col",function(){return b("col",i.getHeaderIndex())}),onKeyUp:t.partial(c,"col")}),i.placeArea("colselect","below","header"),i.addArea({name:"rowselect",onMove:t.partial(l,"row",function(e,t,a,o){return b("row",i.rowIndex)}),onKeyDown:t.partial(h,"row",function(){return b("row",i.rowIndex)}),onKeyUp:t.partial(c,"row")}),i.placeArea("rowselect","below","rowHeader")},_clearSelection:function(e,t){if("all"==e)return this._clearSelection("cell",t),this._clearSelection("col",t),void this._clearSelection("row",t);this._isUsingRowSelector=!0,a.forEach(this._selected[e],function(i){v(e,t,i)||this._highlightSingle(e,!1,i)},this),this._blurPoint(e,this._currentPoint),this._selecting[e]=!1,this._startPoint[e]=this._currentPoint[e]=null,this._selected[e]=[],"row"!=e||this.grid._selectingRange||(this._oldDeselectAll.call(this.grid.selection),this.grid.selection._selectedById={}),this.grid.onEndDeselect(e,null,null,this._selected),this.grid.onSelectCleared(e)},_startSelect:function(e,t,i,a,o,n){if(this._isValid(e,t)){var r=this._isSelected(e,this._lastEndPoint[e]),s=this._isSelected(e,t);this.noClear&&!i?this._toSelect=void 0===n||n:this._toSelect=o?s:!s,i&&(s||this._config[e]!=f)||(this._clearSelection("col",t),this._clearSelection("cell",t),(!this.noClear||"row"===e&&this._config[e]==f)&&this._clearSelection("row",t),this._toSelect=void 0===n||n),this._selecting[e]=!0,this._currentPoint[e]=null,a&&this._lastType==e&&r==this._toSelect&&this._config[e]==p?("row"===e&&(this._isUsingRowSelector=!0),this._startPoint[e]=this._lastAnchorPoint[e],this._highlight(e,this._startPoint[e]),this._isUsingRowSelector=!1):this._startPoint[e]=t,this._curType=e,this._fireEvent("start",e),this._isStartFocus=!0,this._isUsingRowSelector=!0,this._highlight(e,t,this._toSelect),this._isStartFocus=!1}},_endSelect:function(e){"row"===e&&delete this._isUsingRowSelector,"all"==e?(this._endSelect("col"),this._endSelect("row"),this._endSelect("cell")):this._selecting[e]&&(this._addToSelected(e),this._lastAnchorPoint[e]=this._startPoint[e],this._lastEndPoint[e]=this._currentPoint[e],this._toSelect&&(this._lastSelectedAnchorPoint[e]=this._lastAnchorPoint[e],this._lastSelectedEndPoint[e]=this._lastEndPoint[e]),this._startPoint[e]=this._currentPoint[e]=null,this._selecting[e]=!1,this._lastType=e,this._fireEvent("end",e))},_fireEvent:function(e,t){switch(e){case"start":this.grid[this._toSelect?"onStartSelect":"onStartDeselect"](t,this._startPoint[t],this._selected);break;case"end":this.grid[this._toSelect?"onEndSelect":"onEndDeselect"](t,this._lastAnchorPoint[t],this._lastEndPoint[t],this._selected)}},_calcToHighlight:function(e,t,i,a){if(void 0!==a){var o;if(this._usingKeyboard&&!i){if(this._isInLastRange(this._lastType,t)){if(o=this._isSelected(e,t),a&&o)return!1;if(!a&&!o&&this._isInLastRange(this._lastType,t,!0))return!0}}return i?a:o||this._isSelected(e,t)}return i},_highlightNode:function(e,t){if(e){s.toggleClass(e,"dojoxGridRowSelected",t),s.toggleClass(e,"dojoxGridCellSelected",t)}},_highlightHeader:function(e,t){var i=this.grid.layout.cells,a=i[e].getHeaderNode();s.toggleClass(a,"dojoxGridHeaderSelected",t)},_highlightRowSelector:function(e,t){var i=this.grid.views.views[0];if(i instanceof u){var a=i.getRowNode(e);if(a){s.toggleClass(a,"dojoxGridRowSelectorSelected",t)}}},_highlightSingle:function(e,t,i,o,n){var s,l=this,d=l.grid,u=d.layout.cells;switch(e){case"cell":s=this._calcToHighlight(e,i,t,o);var h=u[i.col];h.hidden||h.notselectable||this._highlightNode(i.node||h.getNode(i.row),s);break;case"col":s=this._calcToHighlight(e,i,t,o),this._highlightHeader(i.col,s),r("td[idx='"+i.col+"']",d.domNode).forEach(function(e){var t=u[i.col].view.content.findRowTarget(e);if(t){var a=t[dojox.grid.util.rowIndexTag];l._highlightSingle("cell",s,{row:a,col:i.col,node:e})}});break;case"row":s=this._calcToHighlight(e,i,t,o),this._highlightRowSelector(i.row,s),this._config.cell&&a.forEach(u,function(e){l._highlightSingle("cell",s,{row:i.row,col:e.index,node:e.getNode(i.row)})}),this._selectedRowModified=!0,n||d.selection.setSelected(i.row,s)}},_highlight:function(e,t,i){if(this._selecting[e]&&null!==t){var a=this._startPoint[e],o=this._currentPoint[e],n=this,r=function(t,a,o){n._forEach(e,t,a,function(t){n._highlightSingle(e,o,t,i)},!0)};switch(e){case"col":case"row":null!==o?y(e,t,a,o,!0)?r(o,t,!1):(y(e,a,t,o,!0)&&(r(o,a,!1),o=a),r(t,o,!0)):this._highlightSingle(e,!0,t,i);break;case"cell":null!==o&&(y("row",t,a,o,!0)||y("col",t,a,o,!0)||y("row",a,t,o,!0)||y("col",a,t,o,!0))&&r(a,o,!1),r(a,t,!0)}this._currentPoint[e]=t,this._focusPoint(e,this._currentPoint)}},_focusPoint:function(e,t){if(!this._isStartFocus){var i=t[e],a=this.grid.focus;"col"==e?(a._colHeadFocusIdx=i.col,a.focusArea("header")):"row"==e?a.focusArea("rowHeader",{rowIndex:i.row}):"cell"==e&&a.setFocusIndex(i.row,i.col)}},_blurPoint:function(e,t){var i=this.grid.focus;"cell"==e&&i._blurContent()},_addToSelected:function(e){var t=this._toSelect,i=this,o=[],n=[],r=this._startPoint[e],s=this._currentPoint[e];this._usingKeyboard&&this._forEach(e,this._lastAnchorPoint[e],this._lastEndPoint[e],function(i){y(e,i,r,s)||(t?n:o).push(i)}),this._forEach(e,r,s,function(a){var r=i._isSelected(e,a);t&&!r?o.push(a):t||n.push(a)}),this._add(e,o),this._remove(e,n),a.forEach(this._selected.row,function(e){e.except.length>0&&(this._selectedRowModified=!0,this.grid.selection.setSelected(e.row,!1))},this)},_forEach:function(e,t,i,a,o){if(this._isValid(e,t,!0)&&this._isValid(e,i,!0))switch(e){case"col":case"row":t=t[e],i=i[e];var n=i>t?1:-1;for(o||(i+=n);t!=i;t+=n)a(b(e,t));break;case"cell":for(var r=i.col>t.col?1:-1,s=i.row>t.row?1:-1,l=t.row,d=i.row+s;l!=d;l+=s)for(var u=t.col,h=i.col+r;u!=h;u+=r)a(b(e,l,u))}},_makeupForExceptions:function(e,t){var i=[];return a.forEach(this._selected[e],function(o){a.forEach(t,function(t){if(o[e]==t[e]){var n=a.indexOf(o.except,t[g[e]]);n>=0&&o.except.splice(n,1),i.push(t)}})}),i},_makeupForCells:function(e,t){var i=[];a.forEach(this._selected.cell,function(o){a.some(t,function(t){return o[e]==t[e]&&(i.push(o),!0)})}),this._remove("cell",i),a.forEach(this._selected[g[e]],function(i){a.forEach(t,function(t){var o=a.indexOf(i.except,t[e]);o>=0&&i.except.splice(o,1)})})},_addException:function(e,t){a.forEach(this._selected[e],function(i){a.forEach(t,function(t){i.except.push(t[g[e]])})})},_addCellException:function(e,t){a.forEach(this._selected[e],function(i){a.forEach(t,function(t){i[e]==t[e]&&i.except.push(t[g[e]])})})},_add:function(e,t){var i=this.grid.layout.cells;if("cell"==e){var o=this._makeupForExceptions("col",t),n=this._makeupForExceptions("row",t);t=a.filter(t,function(e){return a.indexOf(o,e)<0&&a.indexOf(n,e)<0&&!i[e.col].hidden&&!i[e.col].notselectable})}else"col"==e&&(t=a.filter(t,function(e){return!i[e.col].hidden&&!i[e.col].notselectable})),this._makeupForCells(e,t),this._selected[e]=a.filter(this._selected[e],function(i){return a.every(t,function(t){return i[e]!==t[e]})});"col"!=e&&this.grid._hasIdentity&&a.forEach(t,function(e){var t=this.grid._by_idx[e.row];t&&(e.id=t.idty)},this),this._selected[e]=this._selected[e].concat(t)},_remove:function(e,i){var o=t.partial(v,e);this._selected[e]=a.filter(this._selected[e],function(e){return!a.some(i,function(t){return o(e,t)})}),"cell"==e?(this._addCellException("col",i),this._addCellException("row",i)):this._config.cell&&this._addException(g[e],i)},_isCellNotInExcept:function(e,t){var i=t[e],o=t[g[e]];return a.some(this._selected[e],function(t){return t[e]==i&&a.indexOf(t.except,o)<0})},_isSelected:function(e,t){if(!t)return!1;var i=a.some(this._selected[e],function(i){var a=v(e,t,i);return a&&"cell"!==e?0===i.except.length:a});return i||"cell"!==e||(i=this._isCellNotInExcept("col",t)||this._isCellNotInExcept("row",t),"cell"===e&&(i=i&&!this.grid.layout.cells[t.col].notselectable)),i},_isInLastRange:function(e,t,i){var a=this[i?"_lastSelectedAnchorPoint":"_lastAnchorPoint"][e],o=this[i?"_lastSelectedEndPoint":"_lastEndPoint"][e];return!!(t&&a&&o)&&y(e,t,a,o)},_isValid:function(e,i,a){if(!i)return!1;try{var o=this.grid,n=i[e];switch(e){case"col":return n>=0&&n<o.layout.cells.length&&t.isArray(i.except)&&(a||!o.layout.cells[n].notselectable);case"row":return n>=0&&n<o.rowCount&&t.isArray(i.except);case"cell":return i.col>=0&&i.col<o.layout.cells.length&&i.row>=0&&i.row<o.rowCount&&(a||!o.layout.cells[i.col].notselectable)}}catch(e){}return!1}});return c.registerPlugin(M,{dependency:["autoScroll"]}),M});//# sourceMappingURL=Selector.js.map