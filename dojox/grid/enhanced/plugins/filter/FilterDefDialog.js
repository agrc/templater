//>>built
require({cache:{"url:dojox/grid/enhanced/templates/FilterDefPane.html":'<div class="dojoxGridFDPane">\n	<div class="dojoxGridFDPaneRelation">${_relMsgFront}\n	<span class="dojoxGridFDPaneModes" dojoAttachPoint="criteriaModeNode">\n		<select dojoAttachPoint="_relSelect" dojoType="dijit.form.Select" dojoAttachEvent="onChange: _onRelSelectChange">\n			<option value="0">${_relAll}</option>\n			<option value="1">${_relAny}</option>\n		</select>\n	</span>\n	${_relMsgTail}\n	</div>\n	<div dojoAttachPoint="criteriaPane" class="dojoxGridFDPaneRulePane"></div>\n	<div dojoAttachPoint="_addCBoxBtn" dojoType="dijit.form.Button" \n		class="dojoxGridFDPaneAddCBoxBtn" iconClass="dojoxGridFDPaneAddCBoxBtnIcon"\n		dojoAttachEvent="onClick:_onAddCBox" label="${_addRuleBtnLabel}" showLabel="false">\n	</div>\n	<div class="dojoxGridFDPaneBtns" dojoAttachPoint="buttonsPane">\n		<span dojoAttachPoint="_cancelBtn" dojoType="dijit.form.Button" \n			dojoAttachEvent="onClick:_onCancel" label="${_cancelBtnLabel}">\n		</span>\n		<span dojoAttachPoint="_clearFilterBtn" dojoType="dijit.form.Button" \n			dojoAttachEvent="onClick:_onClearFilter" label="${_clearBtnLabel}" disabled="true">\n		</span>\n		<span dojoAttachPoint="_filterBtn" dojoType="dijit.form.Button" \n			dojoAttachEvent="onClick:_onFilter" label="${_filterBtnLabel}" disabled="true">\n		</span>\n	</div>\n</div>\n',"url:dojox/grid/enhanced/templates/CriteriaBox.html":'<div class="dojoxGridFCBox">\n	<div class="dojoxGridFCBoxSelCol" dojoAttachPoint="selColNode">\n		<span class="dojoxGridFCBoxField">${_colSelectLabel}</span>\n		<select dojoAttachPoint="_colSelect" dojoType="dijit.form.Select" \n			class="dojoxGridFCBoxColSelect"\n			dojoAttachEvent="onChange:_onChangeColumn">\n		</select>\n	</div>\n	<div class="dojoxGridFCBoxCondition" dojoAttachPoint="condNode">\n		<span class="dojoxGridFCBoxField">${_condSelectLabel}</span>\n		<select dojoAttachPoint="_condSelect" dojoType="dijit.form.Select" \n			class="dojoxGridFCBoxCondSelect"\n			dojoAttachEvent="onChange:_onChangeCondition">\n		</select>\n		<div class="dojoxGridFCBoxCondSelectAlt" dojoAttachPoint="_condSelectAlt" style="display:none;"></div>\n	</div>\n	<div class="dojoxGridFCBoxValue" dojoAttachPoint="valueNode">\n		<span class="dojoxGridFCBoxField">${_valueBoxLabel}</span>\n	</div>\n</div>\n',"url:dojox/grid/enhanced/templates/FilterBoolValueBox.html":'<div class="dojoxGridBoolValueBox">\n	<div class="dojoxGridTrueBox">\n		<input dojoType="dijit.form.RadioButton" type=\'radio\' name=\'a1\' id=\'${_baseId}_rbTrue\' checked="true" \n			dojoAttachPoint="rbTrue" dojoAttachEvent="onChange: onChange"/>\n		<div class="dojoxGridTrueLabel" for=\'${_baseId}_rbTrue\'>${_lblTrue}</div>\n	</div>\n	<div class="dojoxGridFalseBox">\n		<input dojoType="dijit.form.RadioButton" dojoAttachPoint="rbFalse" type=\'radio\' name=\'a1\' id=\'${_baseId}_rbFalse\'/>\n		<div class="dojoxGridTrueLabel" for=\'${_baseId}_rbFalse\'>${_lblFalse}</div>\n	</div>\n</div>\n'}}),define("dojox/grid/enhanced/plugins/filter/FilterDefDialog",["dojo/_base/declare","dojo/_base/array","dojo/_base/connect","dojo/_base/lang","dojo/_base/event","dojo/_base/html","dojo/_base/sniff","dojo/keys","dojo/on","dojo/string","dojo/window","dojo/date/locale","./FilterBuilder","../Dialog","dijit/form/ComboBox","dijit/form/TextBox","dijit/form/NumberTextBox","dijit/form/DateTextBox","dijit/form/TimeTextBox","dijit/form/Button","dijit/layout/AccordionContainer","dijit/layout/ContentPane","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/focus","dojox/html/metrics","dijit/a11y","dojo/text!../../templates/FilterDefPane.html","dojo/text!../../templates/CriteriaBox.html","dojo/text!../../templates/FilterBoolValueBox.html","dijit/Tooltip","dijit/form/Select","dijit/form/RadioButton","dojox/html/ellipsis","../../../cells/dijit"],function(e,t,i,a,n,o,r,s,l,d,u,c,h,m,f,p,g,v,y,b,k,_,w,M,x,j,I,C,E,S,A){var T={relSelect:60,accordionTitle:70,removeCBoxBtn:-1,colSelect:90,condSelect:95,valueBox:10,addCBoxBtn:20,filterBtn:30,clearBtn:40,cancelBtn:50},F=e("dojox.grid.enhanced.plugins.filter.AccordionContainer",k,{nls:null,addChild:function(e,t){var i=arguments[0]=e._pane=new _({content:e});this.inherited(arguments),this._modifyChild(i)},removeChild:function(e){var t=e,i=!1;if(e._pane&&(i=!0,t=arguments[0]=e._pane),this.inherited(arguments),i){this._hackHeight(!1,this._titleHeight);var a=this.getChildren();1===a.length&&o.style(a[0]._removeCBoxBtn.domNode,"display","none")}t.destroyRecursive()},selectChild:function(e){e._pane&&(arguments[0]=e._pane),this.inherited(arguments)},resize:function(){this.inherited(arguments),t.forEach(this.getChildren(),this._setupTitleDom)},startup:function(){this._started||(this.inherited(arguments),7==parseInt(r("ie"),10)&&t.some(this._connects,function(e){return"onresize"==(e[0]||{})[1]?(this.disconnect(e),!0):void 0},this),t.forEach(this.getChildren(),function(e){this._modifyChild(e,!0)},this))},_onKeyPress:function(e,t){if(!this.disabled&&!e.altKey&&(t||e.ctrlKey)){var i=s,a=e.charOrCode,l=o._isBodyLtr(),d=null;if(t&&a==i.UP_ARROW||e.ctrlKey&&a==i.PAGE_UP)d=!1;else if(t&&a==i.DOWN_ARROW||e.ctrlKey&&(a==i.PAGE_DOWN||a==i.TAB))d=!0;else if(a==(l?i.LEFT_ARROW:i.RIGHT_ARROW))d=this._focusOnRemoveBtn?null:!1,this._focusOnRemoveBtn=!this._focusOnRemoveBtn;else{if(a!=(l?i.RIGHT_ARROW:i.LEFT_ARROW))return;d=this._focusOnRemoveBtn?!0:null,this._focusOnRemoveBtn=!this._focusOnRemoveBtn}null!==d&&this._adjacent(d)._buttonWidget._onTitleClick(),n.stop(e),u.scrollIntoView(this.selectedChildWidget._buttonWidget.domNode.parentNode),r("ie")&&this.selectedChildWidget._removeCBoxBtn.focusNode.setAttribute("tabIndex",this._focusOnRemoveBtn?T.accordionTitle:-1),j.focus(this.selectedChildWidget[this._focusOnRemoveBtn?"_removeCBoxBtn":"_buttonWidget"].focusNode)}},_modifyChild:function(e,t){if(e&&this._started){o.style(e.domNode,"overflow","hidden"),e._buttonWidget.connect(e._buttonWidget,"_setSelectedAttr",function(){this.focusNode.setAttribute("tabIndex",this.selected?T.accordionTitle:"-1")});var i=this;e._buttonWidget.connect(e._buttonWidget.domNode,"onclick",function(){i._focusOnRemoveBtn=!1}),(e._removeCBoxBtn=new b({label:this.nls.removeRuleButton,showLabel:!1,iconClass:"dojoxGridFCBoxRemoveCBoxBtnIcon",tabIndex:T.removeCBoxBtn,onClick:a.hitch(e.content,"onRemove"),onKeyPress:function(t){i._onKeyPress(t,e._buttonWidget.contentWidget)}})).placeAt(e._buttonWidget.domNode);var n,r=this.getChildren();if(1===r.length)e._buttonWidget.set("selected",!0),o.style(e._removeCBoxBtn.domNode,"display","none");else for(n=0;n<r.length;++n)r[n]._removeCBoxBtn&&o.style(r[n]._removeCBoxBtn.domNode,"display","");if(this._setupTitleDom(e),!this._titleHeight)for(n=0;n<r.length;++n)if(r[n]!=this.selectedChildWidget){this._titleHeight=o.marginBox(r[n]._buttonWidget.domNode.parentNode).h;break}t||this._hackHeight(!0,this._titleHeight)}},_hackHeight:function(e,t){var i=this.getChildren(),a=this.domNode,n=o.style(a,"height");if(e){if(!(i.length>1))return;a.style.height=n+t+"px"}else a.style.height=n-t+"px";this.resize()},_setupTitleDom:function(e){var t=o.contentBox(e._buttonWidget.titleNode).w;r("ie")<8&&(t-=8),o.style(e._buttonWidget.titleTextNode,"width",t+"px")}}),N=e("dojox.grid.enhanced.plugins.filter.FilterDefPane",[w,M,x],{templateString:E,widgetsInTemplate:!0,dlg:null,postMixInProperties:function(){this.plugin=this.dlg.plugin;var e=this.plugin.nls;this._addRuleBtnLabel=e.addRuleButton,this._cancelBtnLabel=e.cancelButton,this._clearBtnLabel=e.clearButton,this._filterBtnLabel=e.filterButton,this._relAll=e.relationAll,this._relAny=e.relationAny,this._relMsgFront=e.relationMsgFront,this._relMsgTail=e.relationMsgTail},postCreate:function(){this.inherited(arguments),l(this.domNode,"keydown",a.hitch(this,"_onKey")),(this.cboxContainer=new F({nls:this.plugin.nls})).placeAt(this.criteriaPane),this._relSelect.set("tabIndex",T.relSelect),this._addCBoxBtn.set("tabIndex",T.addCBoxBtn),this._cancelBtn.set("tabIndex",T.cancelBtn),this._clearFilterBtn.set("tabIndex",T.clearBtn),this._filterBtn.set("tabIndex",T.filterBtn);var e=this.plugin.nls;this._relSelect.domNode.setAttribute("aria-label",e.waiRelAll),this._addCBoxBtn.domNode.setAttribute("aria-label",e.waiAddRuleButton),this._cancelBtn.domNode.setAttribute("aria-label",e.waiCancelButton),this._clearFilterBtn.domNode.setAttribute("aria-label",e.waiClearButton),this._filterBtn.domNode.setAttribute("aria-label",e.waiFilterButton),this._relSelect.set("value","logicall"===this.dlg._relOpCls?"0":"1")},uninitialize:function(){this.cboxContainer.destroyRecursive(),this.plugin=null,this.dlg=null},_onRelSelectChange:function(e){this.dlg._relOpCls="0"==e?"logicall":"logicany",this._relSelect.domNode.setAttribute("aria-label",this.plugin.nls["0"==e?"waiRelAll":"waiRelAny"])},_onAddCBox:function(){this.dlg.addCriteriaBoxes(1)},_onCancel:function(){this.dlg.onCancel()},_onClearFilter:function(){this.dlg.onClearFilter()},_onFilter:function(){this.dlg.onFilter()},_onKey:function(e){e.keyCode==s.ENTER&&this.dlg.onFilter()}}),z=e("dojox.grid.enhanced.plugins.filter.CriteriaBox",[w,M,x],{templateString:S,widgetsInTemplate:!0,dlg:null,postMixInProperties:function(){this.plugin=this.dlg.plugin,this._curValueBox=null;var e=this.plugin.nls;this._colSelectLabel=e.columnSelectLabel,this._condSelectLabel=e.conditionSelectLabel,this._valueBoxLabel=e.valueBoxLabel,this._anyColumnOption=e.anyColumnOption},postCreate:function(){var e=this.dlg,t=this.plugin.grid;this._colSelect.set("tabIndex",T.colSelect),this._colOptions=this._getColumnOptions(),this._colSelect.addOption([{label:this.plugin.nls.anyColumnOption,value:"anycolumn",selected:e.curColIdx<0},{value:""}].concat(this._colOptions)),this._condSelect.set("tabIndex",T.condSelect),this._condSelect.addOption(this._getUsableConditions(e.getColumnType(e.curColIdx))),this._showSelectOrLabel(this._condSelect,this._condSelectAlt),this.connect(t.layout,"moveColumn","onMoveColumn");var i=this;setTimeout(function(){var t=e.getColumnType(e.curColIdx);i._setValueBoxByType(t)},0)},_getColumnOptions:function(){var e=this.dlg.curColIdx>=0?String(this.dlg.curColIdx):"anycolumn";return t.map(t.filter(this.plugin.grid.layout.cells,function(e){return!(e.filterable===!1||e.hidden)}),function(t){return{label:t.name||t.field,value:String(t.index),selected:e==String(t.index)}})},onMoveColumn:function(){var e=this._onChangeColumn;this._onChangeColumn=function(){};var t=this._colSelect.get("selectedOptions");this._colSelect.removeOption(this._colOptions),this._colOptions=this._getColumnOptions(),this._colSelect.addOption(this._colOptions);for(var i=0;i<this._colOptions.length&&this._colOptions[i].label!=t.label;++i);i<this._colOptions.length&&this._colSelect.set("value",this._colOptions[i].value);var a=this;setTimeout(function(){a._onChangeColumn=e},0)},onRemove:function(){this.dlg.removeCriteriaBoxes(this)},uninitialize:function(){this._curValueBox&&(this._curValueBox.destroyRecursive(),this._curValueBox=null),this.plugin=null,this.dlg=null},_showSelectOrLabel:function(e,t){var i=e.getOptions();1==i.length?(t.innerHTML=i[0].label,o.style(e.domNode,"display","none"),o.style(t,"display","")):(o.style(e.domNode,"display",""),o.style(t,"display","none"))},_onChangeColumn:function(e){this._checkValidCriteria();var t=this.dlg.getColumnType(e);this._setConditionsByType(t),this._setValueBoxByType(t),this._updateValueBox()},_onChangeCondition:function(e){this._checkValidCriteria();var t="range"==e;t^this._isRange&&(this._isRange=t,this._setValueBoxByType(this.dlg.getColumnType(this._colSelect.get("value")))),this._updateValueBox()},_updateValueBox:function(e){this._curValueBox.set("disabled","isempty"==this._condSelect.get("value"))},_checkValidCriteria:function(){setTimeout(a.hitch(this,function(){this.updateRuleTitle(),this.dlg._updatePane()}),0)},_createValueBox:function(e,t){var i=a.hitch(t.cbox,"_checkValidCriteria");return new e(a.mixin(t,{tabIndex:T.valueBox,onKeyPress:i,onChange:i,"class":"dojoxGridFCBoxValueBox"}))},_createRangeBox:function(e,t){var i=a.hitch(t.cbox,"_checkValidCriteria");a.mixin(t,{tabIndex:T.valueBox,onKeyPress:i,onChange:i});var n=o.create("div",{"class":"dojoxGridFCBoxValueBox"}),r=new e(t),s=o.create("span",{"class":"dojoxGridFCBoxRangeValueTxt",innerHTML:this.plugin.nls.rangeTo}),l=new e(t);return o.addClass(r.domNode,"dojoxGridFCBoxStartValue"),o.addClass(l.domNode,"dojoxGridFCBoxEndValue"),n.appendChild(r.domNode),n.appendChild(s),n.appendChild(l.domNode),n.domNode=n,n.set=function(e,t){a.isObject(t)&&(r.set("value",t.start),l.set("value",t.end))},n.get=function(){var e=r.get("value"),t=l.get("value");return e&&t?{start:e,end:t}:""},n},changeCurrentColumn:function(e){var t=this.dlg.curColIdx;this._colSelect.removeOption(this._colOptions),this._colOptions=this._getColumnOptions(),this._colSelect.addOption(this._colOptions),this._colSelect.set("value",t>=0?String(t):"anycolumn"),this.updateRuleTitle(!0)},curColumn:function(){return this._colSelect.getOptions(this._colSelect.get("value")).label},curCondition:function(){return this._condSelect.getOptions(this._condSelect.get("value")).label},curValue:function(){var e=this._condSelect.get("value");return"isempty"==e?"":this._curValueBox?this._curValueBox.get("value"):""},save:function(){if(this.isEmpty())return null;var e=this._colSelect.get("value"),t=this.dlg.getColumnType(e),i=this.curValue(),a=this._condSelect.get("value");return{column:e,condition:a,value:i,formattedVal:this.formatValue(t,a,i),type:t,colTxt:this.curColumn(),condTxt:this.curCondition()}},load:function(e){var t=[this._onChangeColumn,this._onChangeCondition];this._onChangeColumn=this._onChangeCondition=function(){},e.column&&this._colSelect.set("value",e.column),e.type?(this._setConditionsByType(e.type),this._setValueBoxByType(e.type)):e.type=this.dlg.getColumnType(this._colSelect.get("value")),e.condition&&this._condSelect.set("value",e.condition);var i=e.value||"";(i||"date"!=e.type&&"time"!=e.type)&&this._curValueBox.set("value",i),this._updateValueBox(),setTimeout(a.hitch(this,function(){this._onChangeColumn=t[0],this._onChangeCondition=t[1]}),0)},getExpr:function(){if(this.isEmpty())return null;var e=this._colSelect.get("value");return this.dlg.getExprForCriteria({type:this.dlg.getColumnType(e),column:e,condition:this._condSelect.get("value"),value:this.curValue()})},isEmpty:function(){var e=this._condSelect.get("value");if("isempty"==e)return!1;var t=this.curValue();return""===t||null===t||"undefined"==typeof t||"number"==typeof t&&isNaN(t)},updateRuleTitle:function(e){var t=this._pane._buttonWidget.titleTextNode,i=["<div class='dojoxEllipsis'>"];if(e||this.isEmpty())t.title=d.substitute(this.plugin.nls.ruleTitleTemplate,[this._ruleIndex||1]),i.push(t.title);else{var a=this.dlg.getColumnType(this._colSelect.get("value")),n=this.curColumn(),s=this.curCondition(),l=this.formatValue(a,this._condSelect.get("value"),this.curValue());i.push(n,"&nbsp;<span class='dojoxGridRuleTitleCondition'>",s,"</span>&nbsp;",l),t.title=[n," ",s," ",l].join("")}if(t.innerHTML=i.join(""),r("mozilla")){var u=o.create("div",{style:"width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 9999;"},t);u.title=t.title}},updateRuleIndex:function(e){this._ruleIndex!=e&&(this._ruleIndex=e,this.isEmpty()&&this.updateRuleTitle())},setAriaInfo:function(e){var t=d.substitute,i=this.plugin.nls;this._colSelect.domNode.setAttribute("aria-label",t(i.waiColumnSelectTemplate,[e])),this._condSelect.domNode.setAttribute("aria-label",t(i.waiConditionSelectTemplate,[e])),this._pane._removeCBoxBtn.domNode.setAttribute("aria-label",t(i.waiRemoveRuleButtonTemplate,[e])),this._index=e},_getUsableConditions:function(e){var i=a.clone(this.dlg._dataTypeMap[e].conditions),n=(this.plugin.args.disabledConditions||{})[e],o=parseInt(this._colSelect.get("value"),10),r=isNaN(o)?(this.plugin.args.disabledConditions||{}).anycolumn:this.plugin.grid.layout.cells[o].disabledConditions;a.isArray(n)||(n=[]),a.isArray(r)||(r=[]);var s=n.concat(r);if(s.length){var l={};return t.forEach(s,function(e){a.isString(e)&&(l[e.toLowerCase()]=!0)}),t.filter(i,function(e){return!(e.value in l)})}return i},_setConditionsByType:function(e){var t=this._condSelect;t.removeOption(t.options),t.addOption(this._getUsableConditions(e)),this._showSelectOrLabel(this._condSelect,this._condSelectAlt)},_setValueBoxByType:function(e){if(this._curValueBox){this.valueNode.removeChild(this._curValueBox.domNode);try{this._curValueBox.destroyRecursive()}catch(t){}delete this._curValueBox}var i=this.dlg._dataTypeMap[e].valueBoxCls[this._getValueBoxClsInfo(this._colSelect.get("value"),e)],a=this._getValueBoxArgByType(e);this._curValueBox=this[this._isRange?"_createRangeBox":"_createValueBox"](i,a),this.valueNode.appendChild(this._curValueBox.domNode),this._curValueBox.focusNode.setAttribute("aria-label",d.substitute(this.plugin.nls.waiValueBoxTemplate,[this._index])),this.dlg.onRendered(this)},_getValueBoxArgByType:function(e){var t=this.plugin.grid,i=t.layout.cells[parseInt(this._colSelect.get("value"),10)],n={cbox:this};return"string"==e?i&&(i.suggestion||i.autoComplete)&&a.mixin(n,{store:t.store,searchAttr:i.field||i.name,query:t.query||{},fetchProperties:{sort:[{attribute:i.field||i.name}],queryOptions:a.mixin({ignoreCase:!0,deep:!0},t.queryOptions||{})}}):"boolean"==e&&a.mixin(n,this.dlg.builder.defaultArgs["boolean"]),i&&i.dataTypeArgs&&a.mixin(n,i.dataTypeArgs),n},formatValue:function(e,t,i){if("isempty"==t)return"";if("date"==e||"time"==e){var a={selector:e},n=c.format;return"range"==t?d.substitute(this.plugin.nls.rangeTemplate,[n(i.start,a),n(i.end,a)]):n(i,a)}return"boolean"==e?i?this._curValueBox._lblTrue:this._curValueBox._lblFalse:i},_getValueBoxClsInfo:function(e,t){var i=this.plugin.grid.layout.cells[parseInt(e,10)];return"string"==t&&i&&(i.suggestion||i.autoComplete)?"ac":"dft"}}),P=e("dojox.grid.enhanced.plugins.filter.UniqueComboBox",f,{_openResultList:function(e){var i={},a=this.store,n=this.searchAttr;arguments[0]=t.filter(e,function(e){var t=a.getValue(e,n),o=i[t];return i[t]=!0,!o}),this.inherited(arguments)},_onKey:function(e){e.charOrCode===s.ENTER&&this._opened&&n.stop(e),this.inherited(arguments)}}),G=e("dojox.grid.enhanced.plugins.filter.BooleanValueBox",[w,M,x],{templateString:A,widgetsInTemplate:!0,constructor:function(e){var t=e.cbox.plugin.nls;this._baseId=e.cbox.id,this._lblTrue=e.trueLabel||t.trueLabel||"true",this._lblFalse=e.falseLabel||t.falseLabel||"false",this.args=e},postCreate:function(){this.onChange()},onChange:function(){},get:function(e){return this.rbTrue.get("checked")},set:function(e,t){this.inherited(arguments),"value"==e&&(this.rbTrue.set("checked",!!t),this.rbFalse.set("checked",!t))}}),B=e("dojox.grid.enhanced.plugins.filter.FilterDefDialog",null,{curColIdx:-1,_relOpCls:"logicall",_savedCriterias:null,plugin:null,constructor:function(e){var t=this.plugin=e.plugin;this.builder=new h,this._setupData(),this._cboxes=[],this.defaultType=t.args.defaultType||"string",(this.filterDefPane=new N({dlg:this})).startup(),(this._defPane=new m({refNode:this.plugin.grid.domNode,title:t.nls.filterDefDialogTitle,"class":"dojoxGridFDTitlePane",iconClass:"dojoxGridFDPaneIcon",content:this.filterDefPane})).startup(),this._defPane.connect(t.grid.layer("filter"),"filterDef",a.hitch(this,"_onSetFilter")),t.grid.setFilter=a.hitch(this,"setFilter"),t.grid.getFilter=a.hitch(this,"getFilter"),t.grid.getFilterRelation=a.hitch(this,function(){return this._relOpCls}),t.connect(t.grid.layout,"moveColumn",a.hitch(this,"onMoveColumn"))},onMoveColumn:function(e,i,a,n,o){if(this._savedCriterias&&a!=n){o&&--n;var r=n>a?a:n,s=n>a?n:a,l=n>r?1:-1;t.forEach(this._savedCriterias,function(e){var t=parseInt(e.column,10);!isNaN(t)&&t>=r&&s>=t&&(e.column=String(t==a?t+(s-r)*l:t-l))})}},destroy:function(){this._defPane.destroyRecursive(),this._defPane=null,this.filterDefPane=null,this.builder=null,this._dataTypeMap=null,this._cboxes=null;var e=this.plugin.grid;e.setFilter=null,e.getFilter=null,e.getFilterRelation=null,this.plugin=null},_setupData:function(){var e=this.plugin.nls;this._dataTypeMap={number:{valueBoxCls:{dft:g},conditions:[{label:e.conditionEqual,value:"equalto",selected:!0},{label:e.conditionNotEqual,value:"notequalto"},{label:e.conditionLess,value:"lessthan"},{label:e.conditionLessEqual,value:"lessthanorequalto"},{label:e.conditionLarger,value:"largerthan"},{label:e.conditionLargerEqual,value:"largerthanorequalto"},{label:e.conditionIsEmpty,value:"isempty"}]},string:{valueBoxCls:{dft:p,ac:P},conditions:[{label:e.conditionContains,value:"contains",selected:!0},{label:e.conditionIs,value:"equalto"},{label:e.conditionStartsWith,value:"startswith"},{label:e.conditionEndWith,value:"endswith"},{label:e.conditionNotContain,value:"notcontains"},{label:e.conditionIsNot,value:"notequalto"},{label:e.conditionNotStartWith,value:"notstartswith"},{label:e.conditionNotEndWith,value:"notendswith"},{label:e.conditionIsEmpty,value:"isempty"}]},date:{valueBoxCls:{dft:v},conditions:[{label:e.conditionIs,value:"equalto",selected:!0},{label:e.conditionBefore,value:"lessthan"},{label:e.conditionAfter,value:"largerthan"},{label:e.conditionRange,value:"range"},{label:e.conditionIsEmpty,value:"isempty"}]},time:{valueBoxCls:{dft:y},conditions:[{label:e.conditionIs,value:"equalto",selected:!0},{label:e.conditionBefore,value:"lessthan"},{label:e.conditionAfter,value:"largerthan"},{label:e.conditionRange,value:"range"},{label:e.conditionIsEmpty,value:"isempty"}]},"boolean":{valueBoxCls:{dft:G},conditions:[{label:e.conditionIs,value:"equalto",selected:!0},{label:e.conditionIsEmpty,value:"isempty"}]}}},setFilter:function(e,n){e=e||[],a.isArray(e)||(e=[e]);var o=function(){if(e.length){this._savedCriterias=t.map(e,function(e){var t=e.type||this.defaultType;return{type:t,column:String(e.column),condition:e.condition,value:e.value,colTxt:this.getColumnLabelByValue(String(e.column)),condTxt:this.getConditionLabelByValue(t,e.condition),formattedVal:e.formattedVal||e.value}},this),this._criteriasChanged=!0,"logicall"!==n&&"logicany"!==n||(this._relOpCls=n);var i=t.map(e,this.getExprForCriteria,this);i=this.builder.buildExpression(1==i.length?i[0]:{op:this._relOpCls,data:i}),this.plugin.grid.layer("filter").filterDef(i),this.plugin.filterBar.toggleClearFilterBtn(!1)}this._closeDlgAndUpdateGrid()};if(this._savedCriterias){this._clearWithoutRefresh=!0;var r=i.connect(this,"clearFilter",this,function(){i.disconnect(r),this._clearWithoutRefresh=!1,o.apply(this)});this.onClearFilter()}else o.apply(this)},getFilter:function(){return a.clone(this._savedCriterias)||[]},getColumnLabelByValue:function(e){var t=this.plugin.nls;if("anycolumn"==e.toLowerCase())return t.anyColumnOption;var i=this.plugin.grid.layout.cells[parseInt(e,10)];return i?i.name||i.field:""},getConditionLabelByValue:function(e,t){for(var i=this._dataTypeMap[e].conditions,a=i.length-1;a>=0;--a){var n=i[a];if(n.value==t.toLowerCase())return n.label}return""},addCriteriaBoxes:function(e){if(!("number"!=typeof e||0>=e)){var t,i=this._cboxes,a=this.filterDefPane.cboxContainer,n=this.plugin.args.ruleCount,s=i.length;for(n>0&&s+e>n&&(e=n-s);e>0;--e)t=new z({dlg:this}),i.push(t),a.addChild(t);if(a.startup(),this._updatePane(),this._updateCBoxTitles(),a.selectChild(i[i.length-1]),this.filterDefPane.criteriaPane.scrollTop=1e6,4===i.length)if(r("ie")<=6&&!this.__alreadyResizedForIE6){var l=o.position(a.domNode);l.w-=I.getScrollbar().w,a.resize(l),this.__alreadyResizedForIE6=!0}else a.resize()}},removeCriteriaBoxes:function(e,i){var n,o=this._cboxes,r=this.filterDefPane.cboxContainer,s=o.length,l=s-e,d=s-1,u=t.indexOf(o,r.selectedChildWidget.content);if(a.isArray(e)){var c,h=e;for(h.sort(),e=h.length,c=s-1;c>=0&&t.indexOf(h,c)>=0;--c);if(c>=0)for(c!=u&&r.selectChild(o[c]),c=e-1;c>=0;--c)h[c]>=0&&h[c]<s&&(r.removeChild(o[h[c]]),o.splice(h[c],1));l=o.length}else{if(i===!0){if(!(e>=0&&s>e))return;l=d=e,e=1}else if(e instanceof z)n=e,e=1,l=d=t.indexOf(o,n);else{if("number"!=typeof e||0>=e)return;e>=s&&(e=d,l=1)}if(l>d)return;for(u>=l&&d>=u&&r.selectChild(o[l?l-1:d+1]);d>=l;--d)r.removeChild(o[d]);o.splice(l,e)}this._updatePane(),this._updateCBoxTitles(),3===o.length&&r.resize()},getCriteria:function(e){return"number"!=typeof e?this._savedCriterias?this._savedCriterias.length:0:this._savedCriterias&&this._savedCriterias[e]?a.mixin({relation:"logicall"==this._relOpCls?this.plugin.nls.and:this.plugin.nls.or},this._savedCriterias[e]):null},getExprForCriteria:function(e){if("anycolumn"==e.column){var i=t.filter(this.plugin.grid.layout.cells,function(e){return!(e.filterable===!1||e.hidden)});return{op:"logicany",data:t.map(i,function(t){return this.getExprForColumn(e.value,t.index,e.type,e.condition)},this)}}return this.getExprForColumn(e.value,e.column,e.type,e.condition)},getExprForColumn:function(e,t,i,n){t=parseInt(t,10);var o=this.plugin.grid.layout.cells[t],r=o.field||o.name,s={datatype:i||this.getColumnType(t),args:o.dataTypeArgs,isColumn:!0},l=[a.mixin({data:this.plugin.args.isServerSide?r:o},s)];return s.isColumn=!1,"range"==n?l.push(a.mixin({data:e.start},s),a.mixin({data:e.end},s)):"isempty"!=n&&l.push(a.mixin({data:e},s)),{op:n,data:l}},getColumnType:function(e){var t=this.plugin.grid.layout.cells[parseInt(e,10)];if(!t||!t.datatype)return this.defaultType;var i=String(t.datatype).toLowerCase();return this._dataTypeMap[i]?i:this.defaultType},clearFilter:function(e){if(this._savedCriterias){this._savedCriterias=null,this.plugin.grid.layer("filter").filterDef(null);try{this.plugin.filterBar.toggleClearFilterBtn(!0),this.filterDefPane._clearFilterBtn.set("disabled",!0),this.removeCriteriaBoxes(this._cboxes.length-1),this._cboxes[0].load({})}catch(t){}e?this.closeDialog():this._closeDlgAndUpdateGrid()}},showDialog:function(e){this._defPane.show(),this.plugin.filterStatusTip.closeDialog(),this._prepareDialog(e)},closeDialog:function(){this._defPane.open&&this._defPane.hide()},onFilter:function(e){this.canFilter()&&(this._defineFilter(),this._closeDlgAndUpdateGrid(),this.plugin.filterBar.toggleClearFilterBtn(!1))},onClearFilter:function(e){this._savedCriterias&&(this._savedCriterias.length>=this.plugin.ruleCountToConfirmClearFilter?this.plugin.clearFilterDialog.show():this.clearFilter(this._clearWithoutRefresh))},onCancel:function(e){var i=this._savedCriterias,a=this._cboxes;i?(this.addCriteriaBoxes(i.length-a.length),this.removeCriteriaBoxes(a.length-i.length),t.forEach(i,function(e,t){a[t].load(e)})):(this.removeCriteriaBoxes(a.length-1),a[0].load({})),this.closeDialog()},onRendered:function(e){if(r("ff")){var t=this._defPane;t._getFocusItems(t.domNode),j.focus(t._firstFocusItem)}else{var i=C._getTabNavigable(o.byId(e.domNode));j.focus(i.lowest||i.first)}},_onSetFilter:function(e){null===e&&this._savedCriterias&&this.clearFilter()},_prepareDialog:function(e){var a,n,o=this._savedCriterias,r=this._cboxes;if(this.curColIdx=e,o){if(this._criteriasChanged){this.filterDefPane._relSelect.set("value","logicall"===this._relOpCls?"0":"1"),this._criteriasChanged=!1;var s=o.length>r.length?o.length-r.length:0;for(this.addCriteriaBoxes(s),this.removeCriteriaBoxes(r.length-o.length),this.filterDefPane._clearFilterBtn.set("disabled",!1),a=0;a<r.length-s;++a)r[a].load(o[a]);if(s>0)var l=[],d=i.connect(this,"onRendered",function(e){var a=t.indexOf(r,e);l[a]||(l[a]=!0,0===--s&&i.disconnect(d),e.load(o[a]))})}}else if(0===r.length)this.addCriteriaBoxes(1);else for(a=0;n=r[a];++a)n.changeCurrentColumn();this.filterDefPane.cboxContainer.resize()},_defineFilter:function(){var e=this._cboxes,i=function(i){return t.filter(t.map(e,function(e){return e[i]()}),function(e){return!!e})},a=i("getExpr");this._savedCriterias=i("save"),a=1==a.length?a[0]:{op:this._relOpCls,data:a},a=this.builder.buildExpression(a),this.plugin.grid.layer("filter").filterDef(a),this.filterDefPane._clearFilterBtn.set("disabled",!1)},_updateCBoxTitles:function(){for(var e=this._cboxes,t=e.length;t>0;--t)e[t-1].updateRuleIndex(t),e[t-1].setAriaInfo(t)},_updatePane:function(){var e=this._cboxes,t=this.filterDefPane;t._addCBoxBtn.set("disabled",e.length==this.plugin.args.ruleCount),t._filterBtn.set("disabled",!this.canFilter())},canFilter:function(){return t.filter(this._cboxes,function(e){return!e.isEmpty()}).length>0},_closeDlgAndUpdateGrid:function(){this.closeDialog();var e=this.plugin.grid;e.showMessage(e.loadingMessage),setTimeout(a.hitch(e,e._refresh),this._defPane.duration+10)}});return B});//# sourceMappingURL=FilterDefDialog.js.map