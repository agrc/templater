//>>built
define("dojox/grid/enhanced/plugins/Exporter",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","../_Plugin","../../_RowSelector","../../EnhancedGrid","../../cells/_base"],function(e,t,a,i,r,n){var o=a.getObject("dojox.grid.cells"),s=e("dojox.grid.enhanced.plugins.Exporter",i,{name:"exporter",constructor:function(e,t){this.grid=e,this.formatter=t&&a.isObject(t)&&t.exportFormatter,this._mixinGrid()},_mixinGrid:function(){var e=this.grid;e.exportTo=a.hitch(this,this.exportTo),e.exportGrid=a.hitch(this,this.exportGrid),e.exportSelected=a.hitch(this,this.exportSelected),e.setExportFormatter=a.hitch(this,this.setExportFormatter)},setExportFormatter:function(e){this.formatter=e},exportGrid:function(e,t,i){if(a.isFunction(t)&&(i=t,t={}),a.isString(e)&&a.isFunction(i)){t=t||{};var r=this.grid,n=this,o=this._getExportWriter(e,t.writerArgs),s=t.fetchArgs&&a.isObject(t.fetchArgs)?t.fetchArgs:{},l=s.onComplete;if(r.store)s.onComplete=function(e,t){l&&l(e,t),i(n._goThroughGridData(e,o))},s.sort=s.sort||r.getSortProps(),r._storeLayerFetch(s);else{for(var d=s.start||0,u=s.count||-1,c=[],m=d;m!=d+u&&m<r.rowCount;++m)c.push(r.getItem(m));i(this._goThroughGridData(c,o))}}},exportSelected:function(e,t,i){if(!a.isString(e))return"";var r=this._getExportWriter(e,t);return i(this._goThroughGridData(this.grid.selection.getSelected(),r))},_buildRow:function(e,a){var i=this;t.forEach(e._views,function(r,n){e.view=r,e.viewIdx=n,a.beforeView(e)&&(t.forEach(r.structure.cells,function(r,n){e.subrow=r,e.subrowIdx=n,a.beforeSubrow(e)&&(t.forEach(r,function(t,r){e.isHeader&&i._isSpecialCol(t)&&e.spCols.push(t.index),e.cell=t,e.cellIdx=r,a.handleCell(e)}),a.afterSubrow(e))}),a.afterView(e))})},_goThroughGridData:function(e,a){var i=this.grid,n=t.filter(i.views.views,function(e){return!(e instanceof r)}),o={grid:i,isHeader:!0,spCols:[],_views:n,colOffset:n.length<i.views.views.length?-1:0};return a.beforeHeader(i)&&(this._buildRow(o,a),a.afterHeader()),o.isHeader=!1,a.beforeContent(e)&&(t.forEach(e,function(e,t){o.row=e,o.rowIdx=t,a.beforeContentRow(o)&&(this._buildRow(o,a),a.afterContentRow(o))},this),a.afterContent()),a.toString()},_isSpecialCol:function(e){return e.isRowSelector||e instanceof o.RowIndex},_getExportWriter:function(e,t){var i,r,n=s;if(n.writerNames){if(i=n.writerNames[e.toLowerCase()],r=a.getObject(i)){var o=new r(t);return o.formatter=this.formatter,o}throw new Error('Please make sure class "'+i+'" is required.')}throw new Error('The writer for "'+e+'" has not been registered.')}});return s.registerWriter=function(e,t){s.writerNames=s.writerNames||{},s.writerNames[e]=t},n.registerPlugin(s),s});//# sourceMappingURL=Exporter.js.map