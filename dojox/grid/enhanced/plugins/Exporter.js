//>>built
define("dojox/grid/enhanced/plugins/Exporter",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","../_Plugin","../../_RowSelector","../../EnhancedGrid","../../cells/_base"],function(e,t,i,r,a,n){var o=i.getObject("dojox.grid.cells"),s=e("dojox.grid.enhanced.plugins.Exporter",r,{name:"exporter",constructor:function(e,t){this.grid=e,this.formatter=t&&i.isObject(t)&&t.exportFormatter,this._mixinGrid()},_mixinGrid:function(){var e=this.grid;e.exportTo=i.hitch(this,this.exportTo),e.exportGrid=i.hitch(this,this.exportGrid),e.exportSelected=i.hitch(this,this.exportSelected),e.setExportFormatter=i.hitch(this,this.setExportFormatter)},setExportFormatter:function(e){this.formatter=e},exportGrid:function(e,t,r){if(i.isFunction(t)&&(r=t,t={}),i.isString(e)&&i.isFunction(r)){t=t||{};var a=this.grid,n=this,o=this._getExportWriter(e,t.writerArgs),s=t.fetchArgs&&i.isObject(t.fetchArgs)?t.fetchArgs:{},l=s.onComplete;if(a.store)s.onComplete=function(e,t){l&&l(e,t),r(n._goThroughGridData(e,o))},s.sort=s.sort||a.getSortProps(),a._storeLayerFetch(s);else{for(var d=s.start||0,u=s.count||-1,c=[],h=d;h!=d+u&&h<a.rowCount;++h)c.push(a.getItem(h));r(this._goThroughGridData(c,o))}}},exportSelected:function(e,t,r){if(!i.isString(e))return"";var a=this._getExportWriter(e,t);return r(this._goThroughGridData(this.grid.selection.getSelected(),a))},_buildRow:function(e,i){var r=this;t.forEach(e._views,function(a,n){e.view=a,e.viewIdx=n,i.beforeView(e)&&(t.forEach(a.structure.cells,function(a,n){e.subrow=a,e.subrowIdx=n,i.beforeSubrow(e)&&(t.forEach(a,function(t,a){e.isHeader&&r._isSpecialCol(t)&&e.spCols.push(t.index),e.cell=t,e.cellIdx=a,i.handleCell(e)}),i.afterSubrow(e))}),i.afterView(e))})},_goThroughGridData:function(e,i){var r=this.grid,n=t.filter(r.views.views,function(e){return!(e instanceof a)}),o={grid:r,isHeader:!0,spCols:[],_views:n,colOffset:n.length<r.views.views.length?-1:0};return i.beforeHeader(r)&&(this._buildRow(o,i),i.afterHeader()),o.isHeader=!1,i.beforeContent(e)&&(t.forEach(e,function(e,t){o.row=e,o.rowIdx=t,i.beforeContentRow(o)&&(this._buildRow(o,i),i.afterContentRow(o))},this),i.afterContent()),i.toString()},_isSpecialCol:function(e){return e.isRowSelector||e instanceof o.RowIndex},_getExportWriter:function(e,t){var r,a,n=s;if(n.writerNames){if(r=n.writerNames[e.toLowerCase()],a=i.getObject(r)){var o=new a(t);return o.formatter=this.formatter,o}throw new Error('Please make sure class "'+r+'" is required.')}throw new Error('The writer for "'+e+'" has not been registered.')}});return s.registerWriter=function(e,t){s.writerNames=s.writerNames||{},s.writerNames[e]=t},n.registerPlugin(s),s});//# sourceMappingURL=Exporter.js.map