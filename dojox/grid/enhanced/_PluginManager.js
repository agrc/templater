//>>built
define("dojox/grid/enhanced/_PluginManager",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/_base/connect","./_Events","./_FocusManager","../util"],function(e,t,i,r,a,n,o,s){var l=i("dojox.grid.enhanced._PluginManager",null,{_options:null,_plugins:null,_connects:null,constructor:function(e){this.grid=e,this._store=e.store,this._options={},this._plugins=[],this._connects=[],this._parseProps(this.grid.plugins),e.connect(e,"_setStore",t.hitch(this,function(e){this._store!==e&&(this.forEach("onSetStore",[e,this._store]),this._store=e)}))},startup:function(){this.forEach("onStartUp")},preInit:function(){this.grid.focus.destroy(),this.grid.focus=new o(this.grid),new n(this.grid),this._init(!0),this.forEach("onPreInit")},postInit:function(){if(this._init(!1),r.forEach(this.grid.views.views,this._initView,this),this._connects.push(a.connect(this.grid.views,"addView",t.hitch(this,this._initView))),this._plugins.length>0){var e=this.grid.edit;e&&(e.styleRow=function(e){})}this.forEach("onPostInit")},forEach:function(e,t){r.forEach(this._plugins,function(i){i&&i[e]&&i[e].apply(i,t||[])})},_parseProps:function(e){if(e){var i,r={},a=this._options,n=this.grid,o=l.registry;for(i in e)e[i]&&this._normalize(i,e,o,r);a.dnd&&(a.columnReordering=!1),t.mixin(n,a)}},_normalize:function(e,i,a,n){if(!a[e])throw new Error("Plugin "+e+" is required.");if(n[e])throw new Error("Recursive cycle dependency is not supported.");var o=this._options;if(o[e])return o[e];n[e]=!0,o[e]=t.mixin({},a[e],t.isObject(i[e])?i[e]:{});var s=o[e].dependency;return s&&(t.isArray(s)||(s=o[e].dependency=[s]),r.forEach(s,function(e){if(!this._normalize(e,i,a,n))throw new Error("Plugin "+e+" is required.")},this)),delete n[e],o[e]},_init:function(e){var t,i,r=this._options;for(t in r)i=r[t].preInit,(e?i:!i)&&r[t].class&&!this.pluginExisted(t)&&this.loadPlugin(t)},loadPlugin:function(e){var t=this._options[e];if(!t)return null;var i=this.getPlugin(e);if(i)return i;var a=t.dependency;r.forEach(a,function(e){if(!this.loadPlugin(e))throw new Error("Plugin "+e+" is required.")},this);var n=t.class;return delete t.class,i=new this.getPluginClazz(n)(this.grid,t),this._plugins.push(i),i},_initView:function(e){e&&(s.funnelEvents(e.contentNode,e,"doContentEvent",["mouseup","mousemove"]),s.funnelEvents(e.headerNode,e,"doHeaderEvent",["mouseup"]))},pluginExisted:function(e){return!!this.getPlugin(e)},getPlugin:function(e){var t=this._plugins;e=e.toLowerCase();for(var i=0,r=t.length;i<r;i++)if(e==t[i].name.toLowerCase())return t[i];return null},getPluginClazz:function(e){if(t.isFunction(e))return e;var i='Please make sure Plugin "'+e+'" is existed.';try{var r=t.getObject(e);if(!r)throw new Error(i);return r}catch(e){throw new Error(i)}},isFixedCell:function(e){return e&&(e.isRowSelector||e.fixedPos)},destroy:function(){r.forEach(this._connects,a.disconnect),this.forEach("destroy"),this.grid.unwrap&&this.grid.unwrap(),delete this._connects,delete this._plugins,delete this._options}});return l.registerPlugin=function(e,i){if(e){var r=l;r.registry=r.registry||{},r.registry[e.prototype.name]=t.mixin({class:e},i||{})}},l});//# sourceMappingURL=_PluginManager.js.map