//>>built
define("dojox/grid/_Scroller",["dijit/registry","dojo/_base/declare","dojo/_base/lang","./util","dojo/_base/html"],function(e,t,a,i,r){var n=function(e){for(var t,a=0,i=e.parentNode;t=i.childNodes[a++];)if(t==e)return a-1;return-1},o=function(t){t&&dojo.forEach(e.toArray(),function(e){e.domNode&&r.isDescendant(e.domNode,t,!0)&&e.destroy()})},s=function(e){var t=r.byId(e);return t&&t.tagName?t.tagName.toLowerCase():""},l=function(e,t){for(var a,i=[],r=0;a=e.childNodes[r];)r++,s(a)==t&&i.push(a);return i},d=function(e){return l(e,"div")};return t("dojox.grid._Scroller",null,{constructor:function(e){this.setContentNodes(e),this.pageHeights=[],this.pageNodes=[],this.stack=[]},rowCount:0,defaultRowHeight:32,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,lastVisibleRow:0,averageRowHeight:0,page:0,pageTop:0,init:function(e,t,i){switch(arguments.length){case 3:this.rowsPerPage=i;case 2:this.keepRows=t;case 1:this.rowCount=e}this.defaultPageHeight=(this.grid.rowHeight>0?this.grid.rowHeight:this.defaultRowHeight)*this.rowsPerPage,this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage),this.setKeepInfo(this.keepRows),this.invalidate(),this.scrollboxNode&&(this.scrollboxNode.scrollTop=0,this.scroll(0),this.scrollboxNode.onscroll=a.hitch(this,"onscroll"))},_getPageCount:function(e,t){return e?Math.ceil(e/t)||1:0},destroy:function(){this.invalidateNodes(),delete this.contentNodes,delete this.contentNode,delete this.scrollboxNode},setKeepInfo:function(e){this.keepRows=e,this.keepPages=this.keepRows?Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2):this.keepPages},setContentNodes:function(e){this.contentNodes=e,this.colCount=this.contentNodes?this.contentNodes.length:0,this.pageNodes=[];for(var t=0;t<this.colCount;t++)this.pageNodes[t]=[]},getDefaultNodes:function(){return this.pageNodes[0]||[]},invalidate:function(){this._invalidating=!0,this.invalidateNodes(),this.pageHeights=[],this.height=this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0,this.resize(),this._invalidating=!1},updateRowCount:function(e){this.invalidateNodes(),this.rowCount=e;var t=this.pageCount;if(0===t&&(this.height=1),this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage),this.pageCount<t)for(var a=t-1;a>=this.pageCount;a--)this.height-=this.getPageHeight(a),delete this.pageHeights[a];else this.pageCount>t&&(this.height+=this.defaultPageHeight*(this.pageCount-t-1)+this.calcLastPageHeight());this.resize()},pageExists:function(e){return Boolean(this.getDefaultPageNode(e))},measurePage:function(e){if(this.grid.rowHeight)return((e+1)*this.rowsPerPage>this.rowCount?this.rowCount-e*this.rowsPerPage:this.rowsPerPage)*this.grid.rowHeight;var t=this.getDefaultPageNode(e);return t&&t.innerHTML?t.offsetHeight:void 0},positionPage:function(e,t){for(var a=0;a<this.colCount;a++)this.pageNodes[a][e].style.top=t+"px"},repositionPages:function(e){for(var t=this.getDefaultNodes(),a=0,i=0;i<this.stack.length;i++)a=Math.max(this.stack[i],a);for(var r=t[e],n=r?this.getPageNodePosition(r)+this.getPageHeight(e):0,o=e+1;a>=o;o++){if(r=t[o]){if(this.getPageNodePosition(r)==n)return;this.positionPage(o,n)}n+=this.getPageHeight(o)}},installPage:function(e){for(var t=0;t<this.colCount;t++)this.contentNodes[t].appendChild(this.pageNodes[t][e])},preparePage:function(e,t){for(var a=t?this.popPage():null,i=0;i<this.colCount;i++){var r=this.pageNodes[i],n=null===a?this.createPageNode():this.invalidatePageNode(a,r);n.pageIndex=e,r[e]=n}},renderPage:function(e){var t,a,i=[];for(t=0;t<this.colCount;t++)i[t]=this.pageNodes[t][e];for(t=0,a=e*this.rowsPerPage;t<this.rowsPerPage&&a<this.rowCount;t++,a++)this.renderRow(a,i)},removePage:function(e){for(var t=0,a=e*this.rowsPerPage;t<this.rowsPerPage;t++,a++)this.removeRow(a)},destroyPage:function(e){for(var t=0;t<this.colCount;t++){var a=this.invalidatePageNode(e,this.pageNodes[t]);a&&r.destroy(a)}},pacify:function(e){},pacifying:!1,pacifyTicks:200,setPacifying:function(e){this.pacifying!=e&&(this.pacifying=e,this.pacify(this.pacifying))},startPacify:function(){this.startPacifyTicks=(new Date).getTime()},doPacify:function(){var e=(new Date).getTime()-this.startPacifyTicks>this.pacifyTicks;return this.setPacifying(!0),this.startPacify(),e},endPacify:function(){this.setPacifying(!1)},resize:function(){this.scrollboxNode&&(this.windowHeight=this.scrollboxNode.clientHeight);for(var e=0;e<this.colCount;e++)i.setStyleHeightPx(this.contentNodes[e],Math.max(1,this.height));var t=!this._invalidating;if(!t){var a=this.grid.get("autoHeight");"number"==typeof a&&a<=Math.min(this.rowsPerPage,this.rowCount)&&(t=!0)}t&&this.needPage(this.page,this.pageTop);var r=this.page<this.pageCount-1?this.rowsPerPage:this.rowCount%this.rowsPerPage||this.rowsPerPage,n=this.getPageHeight(this.page);this.averageRowHeight=n>0&&r>0?n/r:0},calcLastPageHeight:function(){if(!this.pageCount)return 0;var e=this.pageCount-1,t=(this.rowCount%this.rowsPerPage||this.rowsPerPage)*this.defaultRowHeight;return this.pageHeights[e]=t,t},updateContentHeight:function(e){this.height+=e,this.resize()},updatePageHeight:function(e,t,a){if(this.pageExists(e)){var i=this.getPageHeight(e),r=this.measurePage(e);if(void 0===r&&(r=i),this.pageHeights[e]=r,i!=r){this.updateContentHeight(r-i);var n=this.grid.get("autoHeight");if("number"==typeof n&&n>this.rowCount||n===!0&&!t)if(a){var o=this.grid.viewsNode.style;o.height=parseInt(o.height)+r-i+"px",this.repositionPages(e)}else this.grid.sizeChange();else this.repositionPages(e)}return r}return 0},rowHeightChanged:function(e,t){this.updatePageHeight(Math.floor(e/this.rowsPerPage),!1,t)},invalidateNodes:function(){for(;this.stack.length;)this.destroyPage(this.popPage())},createPageNode:function(){var e=document.createElement("div");return r.attr(e,"role","presentation"),e.style.position="absolute",e.style[this.grid.isLeftToRight()?"left":"right"]="0",e},getPageHeight:function(e){var t=this.pageHeights[e];return void 0!==t?t:this.defaultPageHeight},pushPage:function(e){return this.stack.push(e)},popPage:function(){return this.stack.shift()},findPage:function(e){for(var t=0,a=0,i=0;t<this.pageCount&&(i=this.getPageHeight(t),!(a+i>=e));t++,a+=i);this.page=t,this.pageTop=a},buildPage:function(e,t,a){this.preparePage(e,t),this.positionPage(e,a),this.installPage(e),this.renderPage(e),this.pushPage(e)},needPage:function(e,t){var a=this.getPageHeight(e);return this.pageExists(e)?this.positionPage(e,t):(this.buildPage(e,!this.grid._autoHeight&&this.keepPages&&this.stack.length>=this.keepPages,t),a=this.updatePageHeight(e,!0)),a},onscroll:function(){this.scroll(this.scrollboxNode.scrollTop)},scroll:function(e){if(this.grid.scrollTop=e,this.colCount){this.startPacify(),this.findPage(e);for(var t=this.height,a=this.getScrollBottom(e),i=this.page,r=this.pageTop;i<this.pageCount&&(0>a||a>r);i++)r+=this.needPage(i,r);this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,e),this.lastVisibleRow=this.getLastVisibleRow(i-1,r,a),t!=this.height&&this.repositionPages(i-1),this.endPacify()}},getScrollBottom:function(e){return this.windowHeight>=0?e+this.windowHeight:-1},processNodeEvent:function(e,t){for(var a=e.target;a&&a!=t&&a.parentNode&&a.parentNode.parentNode!=t;)a=a.parentNode;if(!a||!a.parentNode||a.parentNode.parentNode!=t)return!1;var i=a.parentNode;return e.topRowIndex=i.pageIndex*this.rowsPerPage,e.rowIndex=e.topRowIndex+n(a),e.rowTarget=a,!0},processEvent:function(e){return this.processNodeEvent(e,this.contentNode)},renderRow:function(e,t){},removeRow:function(e){},getDefaultPageNode:function(e){return this.getDefaultNodes()[e]},positionPageNode:function(e,t){},getPageNodePosition:function(e){return e.offsetTop},invalidatePageNode:function(e,t){var a=t[e];return a&&(delete t[e],this.removePage(e,a),o(a),a.innerHTML=""),a},getPageRow:function(e){return e*this.rowsPerPage},getLastPageRow:function(e){return Math.min(this.rowCount,this.getPageRow(e+1))-1},getFirstVisibleRow:function(e,t,a){if(!this.pageExists(e))return 0;for(var i=this.getPageRow(e),r=this.getDefaultNodes(),n=d(r[e]),o=0,s=n.length;s>o&&a>t;o++,i++)t+=n[o].offsetHeight;return i?i-1:i},getLastVisibleRow:function(e,t,a){if(!this.pageExists(e))return 0;for(var i=this.getDefaultNodes(),r=this.getLastPageRow(e),n=d(i[e]),o=n.length-1;o>=0&&t>a;o--,r--)t-=n[o].offsetHeight;return r+1},findTopRow:function(e){for(var t,a=this.getDefaultNodes(),i=d(a[this.page]),r=0,n=i.length,o=this.pageTop;n>r;r++)if(t=i[r].offsetHeight,o+=t,o>=e)return this.offset=t-(o-e),r+this.page*this.rowsPerPage;return-1},findScrollTop:function(e){var t,a,i=Math.floor(e/this.rowsPerPage),r=0;for(t=0;i>t;t++)r+=this.getPageHeight(t);this.pageTop=r,this.page=i,this.needPage(i,this.pageTop);var n=this.getDefaultNodes(),o=d(n[i]),s=e-this.rowsPerPage*i;for(t=0,a=o.length;a>t&&s>t;t++)r+=o[t].offsetHeight;return r},dummy:0})});//# sourceMappingURL=_Scroller.js.map