//>>built
define("dojox/grid/_Scroller",["dijit/registry","dojo/_base/declare","dojo/_base/lang","./util","dojo/_base/html"],function(e,t,i,a,r){var o=function(e){for(var t,i=0,a=e.parentNode;t=a.childNodes[i++];)if(t==e)return i-1;return-1},n=function(t){t&&dojo.forEach(e.toArray(),function(e){e.domNode&&r.isDescendant(e.domNode,t,!0)&&e.destroy()})},s=function(e){var t=r.byId(e);return t&&t.tagName?t.tagName.toLowerCase():""},d=function(e,t){for(var i,a=[],r=0;i=e.childNodes[r];)r++,s(i)==t&&a.push(i);return a},l=function(e){return d(e,"div")};return t("dojox.grid._Scroller",null,{constructor:function(e){this.setContentNodes(e),this.pageHeights=[],this.pageNodes=[],this.stack=[]},rowCount:0,defaultRowHeight:32,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,lastVisibleRow:0,averageRowHeight:0,page:0,pageTop:0,init:function(e,t,a){switch(arguments.length){case 3:this.rowsPerPage=a;case 2:this.keepRows=t;case 1:this.rowCount=e}this.defaultPageHeight=(this.grid.rowHeight>0?this.grid.rowHeight:this.defaultRowHeight)*this.rowsPerPage,this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage),this.setKeepInfo(this.keepRows),this.invalidate(),this.scrollboxNode&&(this.scrollboxNode.scrollTop=0,this.scroll(0),this.scrollboxNode.onscroll=i.hitch(this,"onscroll"))},_getPageCount:function(e,t){return e?Math.ceil(e/t)||1:0},destroy:function(){this.invalidateNodes(),delete this.contentNodes,delete this.contentNode,delete this.scrollboxNode},setKeepInfo:function(e){this.keepRows=e,this.keepPages=this.keepRows?Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2):this.keepPages},setContentNodes:function(e){this.contentNodes=e,this.colCount=this.contentNodes?this.contentNodes.length:0,this.pageNodes=[];for(var t=0;t<this.colCount;t++)this.pageNodes[t]=[]},getDefaultNodes:function(){return this.pageNodes[0]||[]},invalidate:function(){this._invalidating=!0,this.invalidateNodes(),this.pageHeights=[],this.height=this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0,this.resize(),this._invalidating=!1},updateRowCount:function(e){this.invalidateNodes(),this.rowCount=e;var t=this.pageCount;if(0===t&&(this.height=1),this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage),this.pageCount<t)for(var i=t-1;i>=this.pageCount;i--)this.height-=this.getPageHeight(i),delete this.pageHeights[i];else this.pageCount>t&&(this.height+=this.defaultPageHeight*(this.pageCount-t-1)+this.calcLastPageHeight());this.resize()},pageExists:function(e){return Boolean(this.getDefaultPageNode(e))},measurePage:function(e){if(this.grid.rowHeight)return((e+1)*this.rowsPerPage>this.rowCount?this.rowCount-e*this.rowsPerPage:this.rowsPerPage)*this.grid.rowHeight;var t=this.getDefaultPageNode(e);return t&&t.innerHTML?t.offsetHeight:void 0},positionPage:function(e,t){for(var i=0;i<this.colCount;i++)this.pageNodes[i][e].style.top=t+"px"},repositionPages:function(e){for(var t=this.getDefaultNodes(),i=0,a=0;a<this.stack.length;a++)i=Math.max(this.stack[a],i);for(var r=t[e],o=r?this.getPageNodePosition(r)+this.getPageHeight(e):0,n=e+1;i>=n;n++){if(r=t[n]){if(this.getPageNodePosition(r)==o)return;this.positionPage(n,o)}o+=this.getPageHeight(n)}},installPage:function(e){for(var t=0;t<this.colCount;t++)this.contentNodes[t].appendChild(this.pageNodes[t][e])},preparePage:function(e,t){for(var i=t?this.popPage():null,a=0;a<this.colCount;a++){var r=this.pageNodes[a],o=null===i?this.createPageNode():this.invalidatePageNode(i,r);o.pageIndex=e,r[e]=o}},renderPage:function(e){var t,i,a=[];for(t=0;t<this.colCount;t++)a[t]=this.pageNodes[t][e];for(t=0,i=e*this.rowsPerPage;t<this.rowsPerPage&&i<this.rowCount;t++,i++)this.renderRow(i,a)},removePage:function(e){for(var t=0,i=e*this.rowsPerPage;t<this.rowsPerPage;t++,i++)this.removeRow(i)},destroyPage:function(e){for(var t=0;t<this.colCount;t++){var i=this.invalidatePageNode(e,this.pageNodes[t]);i&&r.destroy(i)}},pacify:function(e){},pacifying:!1,pacifyTicks:200,setPacifying:function(e){this.pacifying!=e&&(this.pacifying=e,this.pacify(this.pacifying))},startPacify:function(){this.startPacifyTicks=(new Date).getTime()},doPacify:function(){var e=(new Date).getTime()-this.startPacifyTicks>this.pacifyTicks;return this.setPacifying(!0),this.startPacify(),e},endPacify:function(){this.setPacifying(!1)},resize:function(){this.scrollboxNode&&(this.windowHeight=this.scrollboxNode.clientHeight);for(var e=0;e<this.colCount;e++)a.setStyleHeightPx(this.contentNodes[e],Math.max(1,this.height));var t=!this._invalidating;if(!t){var i=this.grid.get("autoHeight");"number"==typeof i&&i<=Math.min(this.rowsPerPage,this.rowCount)&&(t=!0)}t&&this.needPage(this.page,this.pageTop);var r=this.page<this.pageCount-1?this.rowsPerPage:this.rowCount%this.rowsPerPage||this.rowsPerPage,o=this.getPageHeight(this.page);this.averageRowHeight=o>0&&r>0?o/r:0},calcLastPageHeight:function(){if(!this.pageCount)return 0;var e=this.pageCount-1,t=(this.rowCount%this.rowsPerPage||this.rowsPerPage)*this.defaultRowHeight;return this.pageHeights[e]=t,t},updateContentHeight:function(e){this.height+=e,this.resize()},updatePageHeight:function(e,t,i){if(this.pageExists(e)){var a=this.getPageHeight(e),r=this.measurePage(e);if(void 0===r&&(r=a),this.pageHeights[e]=r,a!=r){this.updateContentHeight(r-a);var o=this.grid.get("autoHeight");if("number"==typeof o&&o>this.rowCount||o===!0&&!t)if(i){var n=this.grid.viewsNode.style;n.height=parseInt(n.height)+r-a+"px",this.repositionPages(e)}else this.grid.sizeChange();else this.repositionPages(e)}return r}return 0},rowHeightChanged:function(e,t){this.updatePageHeight(Math.floor(e/this.rowsPerPage),!1,t)},invalidateNodes:function(){for(;this.stack.length;)this.destroyPage(this.popPage())},createPageNode:function(){var e=document.createElement("div");return r.attr(e,"role","presentation"),e.style.position="absolute",e.style[this.grid.isLeftToRight()?"left":"right"]="0",e},getPageHeight:function(e){var t=this.pageHeights[e];return void 0!==t?t:this.defaultPageHeight},pushPage:function(e){return this.stack.push(e)},popPage:function(){return this.stack.shift()},findPage:function(e){for(var t=0,i=0,a=0;t<this.pageCount&&(a=this.getPageHeight(t),!(i+a>=e));t++,i+=a);this.page=t,this.pageTop=i},buildPage:function(e,t,i){this.preparePage(e,t),this.positionPage(e,i),this.installPage(e),this.renderPage(e),this.pushPage(e)},needPage:function(e,t){var i=this.getPageHeight(e);return this.pageExists(e)?this.positionPage(e,t):(this.buildPage(e,!this.grid._autoHeight&&this.keepPages&&this.stack.length>=this.keepPages,t),i=this.updatePageHeight(e,!0)),i},onscroll:function(){this.scroll(this.scrollboxNode.scrollTop)},scroll:function(e){if(this.grid.scrollTop=e,this.colCount){this.startPacify(),this.findPage(e);for(var t=this.height,i=this.getScrollBottom(e),a=this.page,r=this.pageTop;a<this.pageCount&&(0>i||i>r);a++)r+=this.needPage(a,r);this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,e),this.lastVisibleRow=this.getLastVisibleRow(a-1,r,i),t!=this.height&&this.repositionPages(a-1),this.endPacify()}},getScrollBottom:function(e){return this.windowHeight>=0?e+this.windowHeight:-1},processNodeEvent:function(e,t){for(var i=e.target;i&&i!=t&&i.parentNode&&i.parentNode.parentNode!=t;)i=i.parentNode;if(!i||!i.parentNode||i.parentNode.parentNode!=t)return!1;var a=i.parentNode;return e.topRowIndex=a.pageIndex*this.rowsPerPage,e.rowIndex=e.topRowIndex+o(i),e.rowTarget=i,!0},processEvent:function(e){return this.processNodeEvent(e,this.contentNode)},renderRow:function(e,t){},removeRow:function(e){},getDefaultPageNode:function(e){return this.getDefaultNodes()[e]},positionPageNode:function(e,t){},getPageNodePosition:function(e){return e.offsetTop},invalidatePageNode:function(e,t){var i=t[e];return i&&(delete t[e],this.removePage(e,i),n(i),i.innerHTML=""),i},getPageRow:function(e){return e*this.rowsPerPage},getLastPageRow:function(e){return Math.min(this.rowCount,this.getPageRow(e+1))-1},getFirstVisibleRow:function(e,t,i){if(!this.pageExists(e))return 0;for(var a=this.getPageRow(e),r=this.getDefaultNodes(),o=l(r[e]),n=0,s=o.length;s>n&&i>t;n++,a++)t+=o[n].offsetHeight;return a?a-1:a},getLastVisibleRow:function(e,t,i){if(!this.pageExists(e))return 0;for(var a=this.getDefaultNodes(),r=this.getLastPageRow(e),o=l(a[e]),n=o.length-1;n>=0&&t>i;n--,r--)t-=o[n].offsetHeight;return r+1},findTopRow:function(e){for(var t,i=this.getDefaultNodes(),a=l(i[this.page]),r=0,o=a.length,n=this.pageTop;o>r;r++)if(t=a[r].offsetHeight,n+=t,n>=e)return this.offset=t-(n-e),r+this.page*this.rowsPerPage;return-1},findScrollTop:function(e){var t,i,a=Math.floor(e/this.rowsPerPage),r=0;for(t=0;a>t;t++)r+=this.getPageHeight(t);this.pageTop=r,this.page=a,this.needPage(a,this.pageTop);var o=this.getDefaultNodes(),n=l(o[a]),s=e-this.rowsPerPage*a;for(t=0,i=n.length;i>t&&s>t;t++)r+=n[t].offsetHeight;return r},dummy:0})});//# sourceMappingURL=_Scroller.js.map