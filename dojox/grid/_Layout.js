//>>built
define("dojox/grid/_Layout",["dojo/_base/kernel","../main","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-geometry","./cells","./_RowSelector"],function(e,t,a,i,r,n){return a("dojox.grid._Layout",null,{constructor:function(e){this.grid=e},cells:[],structure:null,defaultWidth:"6em",moveColumn:function(e,t,a,r,n){for(var o,s=this.structure[e].cells[0],l=this.structure[t].cells[0],d=null,u=0,m=0,h=0;o=s[h];h++)if(o.index==a){u=h;break}for(d=s.splice(u,1)[0],d.view=this.grid.views.views[t],h=0,o=null;o=l[h];h++)if(o.index==r){m=h;break}n||(m+=1),l.splice(m,0,d);var c=this.grid.getCell(this.grid.getSortIndex());c&&(c._currentlySorted=this.grid.getSortAsc()),this.cells=[],a=0;var f;for(h=0;f=this.structure[h];h++)for(var g,p=0;g=f.cells[p];p++)for(var y=0;o=g[y];y++){if(o.index=a,this.cells.push(o),"_currentlySorted"in o){var v=a+1;v*=o._currentlySorted?1:-1,this.grid.sortInfo=v,delete o._currentlySorted}a++}i.forEach(this.cells,function(e){var t=e.markup[2].split(" ");parseInt(t[1].substring(5))!=e.index&&(t[1]='idx="'+e.index+'"',e.markup[2]=t.join(" "))}),this.grid.setupHeaderMenu()},setColumnVisibility:function(e,t){var a=this.cells[e];if(a.hidden==t){a.hidden=!t;var i=a.view,r=i.viewWidth;return r&&"auto"!=r&&(i._togglingColumn=n.getMarginBox(a.getHeaderNode()).w||0),i.update(),!0}return!1},addCellDef:function(e,a,i){var n=this,o=function(e){var t=0;return e.colSpan>1?t=0:(t=e.width||n._defaultCellProps.width||n.defaultWidth,isNaN(t)||(t+="em")),t},s={grid:this.grid,subrow:e,layoutIndex:a,index:this.cells.length};if(i&&i instanceof t.grid.cells._Base){var l=r.clone(i);return s.unitWidth=o(l._props),l=r.mixin(l,this._defaultCellProps,i._props,s)}var d=i.type||i.cellType||this._defaultCellProps.type||this._defaultCellProps.cellType||t.grid.cells.Cell;return r.isString(d)&&(d=r.getObject(d)),s.unitWidth=o(i),new d(r.mixin({},this._defaultCellProps,i,s))},addRowDef:function(e,t){for(var a,r,n=[],o=0,s=0,l=!0,d=0;a=t[d];d++)if(r=this.addCellDef(e,d,a),n.push(r),this.cells.push(r),l&&r.relWidth)o+=r.relWidth;else if(r.width){var u=r.width;"string"==typeof u&&"%"==u.slice(-1)?s+=window.parseInt(u,10):"auto"==u&&(l=!1)}return o&&l&&i.forEach(n,function(e){e.relWidth&&(e.width=e.unitWidth=e.relWidth/o*(100-s)+"%")}),n},addRowsDef:function(e){var t=[];if(r.isArray(e))if(r.isArrayLike(e[0]))for(var a,i=0;e&&(a=e[i]);i++)t.push(this.addRowDef(i,a));else t.push(this.addRowDef(0,e));return t},addViewDef:function(e){return this._defaultCellProps=e.defaultCell||{},e.width&&"auto"==e.width&&delete e.width,r.mixin({},e,{cells:this.addRowsDef(e.rows||e.cells)})},setStructure:function(e){this.fieldIndex=0,this.cells=[];var a=this.structure=[];if(this.grid.rowSelector){var i={type:t._scopeName+".grid._RowSelector"};if(r.isString(this.grid.rowSelector)){var n=this.grid.rowSelector;"false"==n?i=null:"true"!=n&&(i.width=n)}else this.grid.rowSelector||(i=null);i&&a.push(this.addViewDef(i))}var o=function(e){return"name"in e||"field"in e||"get"in e},s=function(e){return!(!r.isArray(e)||!r.isArray(e[0])&&!o(e[0]))},l=function(e){return null!==e&&r.isObject(e)&&("cells"in e||"rows"in e||"type"in e&&!o(e))};if(r.isArrayLike(e)){for(var d,u=!1,m=0;d=e[m];m++)if(l(d)){u=!0;break}if(u)for(m=0;d=e[m];m++)s(d)?a.push(this.addViewDef({cells:d})):l(d)&&a.push(this.addViewDef(d));else a.push(this.addViewDef({cells:e}))}else l(e)&&a.push(this.addViewDef(e));this.cellCount=this.cells.length,this.grid.setupHeaderMenu()}})});//# sourceMappingURL=_Layout.js.map