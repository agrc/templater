//>>built
define("dojox/grid/_Layout",["dojo/_base/kernel","../main","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-geometry","./cells","./_RowSelector"],function(e,t,i,a,n,o){return i("dojox.grid._Layout",null,{constructor:function(e){this.grid=e},cells:[],structure:null,defaultWidth:"6em",moveColumn:function(e,t,i,n,o){for(var r,s=this.structure[e].cells[0],l=this.structure[t].cells[0],d=null,u=0,c=0,m=0;r=s[m];m++)if(r.index==i){u=m;break}for(d=s.splice(u,1)[0],d.view=this.grid.views.views[t],m=0,r=null;r=l[m];m++)if(r.index==n){c=m;break}o||(c+=1),l.splice(c,0,d);var h=this.grid.getCell(this.grid.getSortIndex());h&&(h._currentlySorted=this.grid.getSortAsc()),this.cells=[],i=0;var f;for(m=0;f=this.structure[m];m++)for(var p,g=0;p=f.cells[g];g++)for(var v=0;r=p[v];v++){if(r.index=i,this.cells.push(r),"_currentlySorted"in r){var y=i+1;y*=r._currentlySorted?1:-1,this.grid.sortInfo=y,delete r._currentlySorted}i++}a.forEach(this.cells,function(e){var t=e.markup[2].split(" "),i=parseInt(t[1].substring(5));i!=e.index&&(t[1]='idx="'+e.index+'"',e.markup[2]=t.join(" "))}),this.grid.setupHeaderMenu()},setColumnVisibility:function(e,t){var i=this.cells[e];if(i.hidden==t){i.hidden=!t;var a=i.view,n=a.viewWidth;return n&&"auto"!=n&&(a._togglingColumn=o.getMarginBox(i.getHeaderNode()).w||0),a.update(),!0}return!1},addCellDef:function(e,i,a){var o=this,r=function(e){var t=0;return e.colSpan>1?t=0:(t=e.width||o._defaultCellProps.width||o.defaultWidth,isNaN(t)||(t+="em")),t},s={grid:this.grid,subrow:e,layoutIndex:i,index:this.cells.length};if(a&&a instanceof t.grid.cells._Base){var l=n.clone(a);return s.unitWidth=r(l._props),l=n.mixin(l,this._defaultCellProps,a._props,s)}var d=a.type||a.cellType||this._defaultCellProps.type||this._defaultCellProps.cellType||t.grid.cells.Cell;return n.isString(d)&&(d=n.getObject(d)),s.unitWidth=r(a),new d(n.mixin({},this._defaultCellProps,a,s))},addRowDef:function(e,t){for(var i,n,o=[],r=0,s=0,l=!0,d=0;i=t[d];d++)if(n=this.addCellDef(e,d,i),o.push(n),this.cells.push(n),l&&n.relWidth)r+=n.relWidth;else if(n.width){var u=n.width;"string"==typeof u&&"%"==u.slice(-1)?s+=window.parseInt(u,10):"auto"==u&&(l=!1)}return r&&l&&a.forEach(o,function(e){e.relWidth&&(e.width=e.unitWidth=e.relWidth/r*(100-s)+"%")}),o},addRowsDef:function(e){var t=[];if(n.isArray(e))if(n.isArray(e[0]))for(var i,a=0;e&&(i=e[a]);a++)t.push(this.addRowDef(a,i));else t.push(this.addRowDef(0,e));return t},addViewDef:function(e){return this._defaultCellProps=e.defaultCell||{},e.width&&"auto"==e.width&&delete e.width,n.mixin({},e,{cells:this.addRowsDef(e.rows||e.cells)})},setStructure:function(e){this.fieldIndex=0,this.cells=[];var i=this.structure=[];if(this.grid.rowSelector){var a={type:t._scopeName+".grid._RowSelector"};if(n.isString(this.grid.rowSelector)){var o=this.grid.rowSelector;"false"==o?a=null:"true"!=o&&(a.width=o)}else this.grid.rowSelector||(a=null);a&&i.push(this.addViewDef(a))}var r=function(e){return"name"in e||"field"in e||"get"in e},s=function(e){return!(!n.isArray(e)||!n.isArray(e[0])&&!r(e[0]))},l=function(e){return null!==e&&n.isObject(e)&&("cells"in e||"rows"in e||"type"in e&&!r(e))};if(n.isArray(e)){for(var d,u=!1,c=0;d=e[c];c++)if(l(d)){u=!0;break}if(u)for(c=0;d=e[c];c++)s(d)?i.push(this.addViewDef({cells:d})):l(d)&&i.push(this.addViewDef(d));else i.push(this.addViewDef({cells:e}))}else l(e)&&i.push(this.addViewDef(e));this.cellCount=this.cells.length,this.grid.setupHeaderMenu()}})});//# sourceMappingURL=_Layout.js.map