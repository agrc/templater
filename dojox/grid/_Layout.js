//>>built
define("dojox/grid/_Layout",["dojo/_base/kernel","../main","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-geometry","./cells","./_RowSelector"],function(e,t,a,i,r,o){return a("dojox.grid._Layout",null,{constructor:function(e){this.grid=e},cells:[],structure:null,defaultWidth:"6em",moveColumn:function(e,t,a,r,o){for(var n,s=this.structure[e].cells[0],l=this.structure[t].cells[0],d=null,u=0,h=0,m=0;n=s[m];m++)if(n.index==a){u=m;break}for(d=s.splice(u,1)[0],d.view=this.grid.views.views[t],m=0,n=null;n=l[m];m++)if(n.index==r){h=m;break}o||(h+=1),l.splice(h,0,d);var c=this.grid.getCell(this.grid.getSortIndex());c&&(c._currentlySorted=this.grid.getSortAsc()),this.cells=[],a=0;var f;for(m=0;f=this.structure[m];m++)for(var g,p=0;g=f.cells[p];p++)for(var y=0;n=g[y];y++){if(n.index=a,this.cells.push(n),"_currentlySorted"in n){var v=a+1;v*=n._currentlySorted?1:-1,this.grid.sortInfo=v,delete n._currentlySorted}a++}i.forEach(this.cells,function(e){var t=e.markup[2].split(" "),a=parseInt(t[1].substring(5));a!=e.index&&(t[1]='idx="'+e.index+'"',e.markup[2]=t.join(" "))}),this.grid.setupHeaderMenu()},setColumnVisibility:function(e,t){var a=this.cells[e];if(a.hidden==t){a.hidden=!t;var i=a.view,r=i.viewWidth;return r&&"auto"!=r&&(i._togglingColumn=o.getMarginBox(a.getHeaderNode()).w||0),i.update(),!0}return!1},addCellDef:function(e,a,i){var o=this,n=function(e){var t=0;return e.colSpan>1?t=0:(t=e.width||o._defaultCellProps.width||o.defaultWidth,isNaN(t)||(t+="em")),t},s={grid:this.grid,subrow:e,layoutIndex:a,index:this.cells.length};if(i&&i instanceof t.grid.cells._Base){var l=r.clone(i);return s.unitWidth=n(l._props),l=r.mixin(l,this._defaultCellProps,i._props,s)}var d=i.type||i.cellType||this._defaultCellProps.type||this._defaultCellProps.cellType||t.grid.cells.Cell;return r.isString(d)&&(d=r.getObject(d)),s.unitWidth=n(i),new d(r.mixin({},this._defaultCellProps,i,s))},addRowDef:function(e,t){for(var a,r,o=[],n=0,s=0,l=!0,d=0;a=t[d];d++)if(r=this.addCellDef(e,d,a),o.push(r),this.cells.push(r),l&&r.relWidth)n+=r.relWidth;else if(r.width){var u=r.width;"string"==typeof u&&"%"==u.slice(-1)?s+=window.parseInt(u,10):"auto"==u&&(l=!1)}return n&&l&&i.forEach(o,function(e){e.relWidth&&(e.width=e.unitWidth=e.relWidth/n*(100-s)+"%")}),o},addRowsDef:function(e){var t=[];if(r.isArray(e))if(r.isArray(e[0]))for(var a,i=0;e&&(a=e[i]);i++)t.push(this.addRowDef(i,a));else t.push(this.addRowDef(0,e));return t},addViewDef:function(e){return this._defaultCellProps=e.defaultCell||{},e.width&&"auto"==e.width&&delete e.width,r.mixin({},e,{cells:this.addRowsDef(e.rows||e.cells)})},setStructure:function(e){this.fieldIndex=0,this.cells=[];var a=this.structure=[];if(this.grid.rowSelector){var i={type:t._scopeName+".grid._RowSelector"};if(r.isString(this.grid.rowSelector)){var o=this.grid.rowSelector;"false"==o?i=null:"true"!=o&&(i.width=o)}else this.grid.rowSelector||(i=null);i&&a.push(this.addViewDef(i))}var n=function(e){return"name"in e||"field"in e||"get"in e},s=function(e){return!(!r.isArray(e)||!r.isArray(e[0])&&!n(e[0]))},l=function(e){return null!==e&&r.isObject(e)&&("cells"in e||"rows"in e||"type"in e&&!n(e))};if(r.isArray(e)){for(var d,u=!1,h=0;d=e[h];h++)if(l(d)){u=!0;break}if(u)for(h=0;d=e[h];h++)s(d)?a.push(this.addViewDef({cells:d})):l(d)&&a.push(this.addViewDef(d));else a.push(this.addViewDef({cells:e}))}else l(e)&&a.push(this.addViewDef(e));this.cellCount=this.cells.length,this.grid.setupHeaderMenu()}})});//# sourceMappingURL=_Layout.js.map