//>>built
define("dojox/grid/_Layout",["dojo/_base/kernel","../main","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-geometry","./cells","./_RowSelector"],function(e,t,i,a,r,o){return i("dojox.grid._Layout",null,{constructor:function(e){this.grid=e},cells:[],structure:null,defaultWidth:"6em",moveColumn:function(e,t,i,r,o){for(var n,s=this.structure[e].cells[0],d=this.structure[t].cells[0],l=null,u=0,h=0,m=0;n=s[m];m++)if(n.index==i){u=m;break}for(l=s.splice(u,1)[0],l.view=this.grid.views.views[t],m=0,n=null;n=d[m];m++)if(n.index==r){h=m;break}o||(h+=1),d.splice(h,0,l);var c=this.grid.getCell(this.grid.getSortIndex());c&&(c._currentlySorted=this.grid.getSortAsc()),this.cells=[],i=0;var f;for(m=0;f=this.structure[m];m++)for(var g,p=0;g=f.cells[p];p++)for(var y=0;n=g[y];y++){if(n.index=i,this.cells.push(n),"_currentlySorted"in n){var v=i+1;v*=n._currentlySorted?1:-1,this.grid.sortInfo=v,delete n._currentlySorted}i++}a.forEach(this.cells,function(e){var t=e.markup[2].split(" "),i=parseInt(t[1].substring(5));i!=e.index&&(t[1]='idx="'+e.index+'"',e.markup[2]=t.join(" "))}),this.grid.setupHeaderMenu()},setColumnVisibility:function(e,t){var i=this.cells[e];if(i.hidden==t){i.hidden=!t;var a=i.view,r=a.viewWidth;return r&&"auto"!=r&&(a._togglingColumn=o.getMarginBox(i.getHeaderNode()).w||0),a.update(),!0}return!1},addCellDef:function(e,i,a){var o=this,n=function(e){var t=0;return e.colSpan>1?t=0:(t=e.width||o._defaultCellProps.width||o.defaultWidth,isNaN(t)||(t+="em")),t},s={grid:this.grid,subrow:e,layoutIndex:i,index:this.cells.length};if(a&&a instanceof t.grid.cells._Base){var d=r.clone(a);return s.unitWidth=n(d._props),d=r.mixin(d,this._defaultCellProps,a._props,s)}var l=a.type||a.cellType||this._defaultCellProps.type||this._defaultCellProps.cellType||t.grid.cells.Cell;return r.isString(l)&&(l=r.getObject(l)),s.unitWidth=n(a),new l(r.mixin({},this._defaultCellProps,a,s))},addRowDef:function(e,t){for(var i,r,o=[],n=0,s=0,d=!0,l=0;i=t[l];l++)if(r=this.addCellDef(e,l,i),o.push(r),this.cells.push(r),d&&r.relWidth)n+=r.relWidth;else if(r.width){var u=r.width;"string"==typeof u&&"%"==u.slice(-1)?s+=window.parseInt(u,10):"auto"==u&&(d=!1)}return n&&d&&a.forEach(o,function(e){e.relWidth&&(e.width=e.unitWidth=e.relWidth/n*(100-s)+"%")}),o},addRowsDef:function(e){var t=[];if(r.isArray(e))if(r.isArray(e[0]))for(var i,a=0;e&&(i=e[a]);a++)t.push(this.addRowDef(a,i));else t.push(this.addRowDef(0,e));return t},addViewDef:function(e){return this._defaultCellProps=e.defaultCell||{},e.width&&"auto"==e.width&&delete e.width,r.mixin({},e,{cells:this.addRowsDef(e.rows||e.cells)})},setStructure:function(e){this.fieldIndex=0,this.cells=[];var i=this.structure=[];if(this.grid.rowSelector){var a={type:t._scopeName+".grid._RowSelector"};if(r.isString(this.grid.rowSelector)){var o=this.grid.rowSelector;"false"==o?a=null:"true"!=o&&(a.width=o)}else this.grid.rowSelector||(a=null);a&&i.push(this.addViewDef(a))}var n=function(e){return"name"in e||"field"in e||"get"in e},s=function(e){return!(!r.isArray(e)||!r.isArray(e[0])&&!n(e[0]))},d=function(e){return null!==e&&r.isObject(e)&&("cells"in e||"rows"in e||"type"in e&&!n(e))};if(r.isArray(e)){for(var l,u=!1,h=0;l=e[h];h++)if(d(l)){u=!0;break}if(u)for(h=0;l=e[h];h++)s(l)?i.push(this.addViewDef({cells:l})):d(l)&&i.push(this.addViewDef(l));else i.push(this.addViewDef({cells:e}))}else d(e)&&i.push(this.addViewDef(e));this.cellCount=this.cells.length,this.grid.setupHeaderMenu()}})});//# sourceMappingURL=_Layout.js.map