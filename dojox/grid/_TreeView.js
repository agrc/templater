//>>built
require({cache:{"url:dojox/grid/resources/Expando.html":'<div class="dojoxGridExpando"\n	><div class="dojoxGridExpandoNode" dojoAttachEvent="onclick:onToggle"\n		><div class="dojoxGridExpandoNodeInner" dojoAttachPoint="expandoInner"></div\n	></div\n></div>\n'}}),define("dojox/grid/_TreeView",["dijit/registry","../main","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/event","dojo/dom-attr","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/query","dojo/parser","dojo/text!./resources/Expando.html","dijit/_Widget","dijit/_TemplatedMixin","./_View","./_Builder","./util"],function(e,t,i,r,a,o,n,s,d,l,u,c,h,f,m,p,y,g){i("dojox.grid._Expando",[f,m],{open:!1,toggleClass:"",itemId:"",cellIdx:-1,view:null,rowNode:null,rowIdx:-1,expandoCell:null,level:0,templateString:h,_toggleRows:function(t,i){if(t&&this.rowNode){if(u("table.dojoxGridRowTableNeedsRowUpdate").length)return void(this._initialized&&this.view.grid.updateRow(this.rowIdx));var r=this,a=this.view.grid;if(a.treeModel){var o=this._tableRow?n.get(this._tableRow,"dojoxTreeGridPath"):"";o&&u('tr[dojoxTreeGridPath^="'+o+'/"]',this.rowNode).forEach(function(r){var a=u(".dojoxGridExpando",r)[0];if(a&&a.parentNode&&a.parentNode.parentNode&&!s.contains(a.parentNode.parentNode,"dojoxGridNoChildren")){var o=e.byNode(a);o&&o._toggleRows(t,o.open&&i)}r.style.display=i?"":"none"})}else u("tr."+t,this.rowNode).forEach(function(t){if(s.contains(t,"dojoxGridExpandoRow")){var a=u(".dojoxGridExpando",t)[0];if(a){var o=e.byNode(a),n=o?o.toggleClass:a.getAttribute("toggleClass"),d=o?o.open:r.expandoCell.getOpenState(a.getAttribute("itemId"));r._toggleRows(n,d&&i)}}t.style.display=i?"":"none"})}},setOpen:function(e){e&&s.contains(this.domNode,"dojoxGridExpandoLoading")&&(e=!1);var t=this.view,i=t.grid,r=i.store,o=i.treeModel,d=this,l=this.rowIdx,u=i._by_idx[l];if(u)if(o&&!this._loadedChildren)if(e){var c=i.getItem(n.get(this._tableRow,"dojoxTreeGridPath"));c?(this.expandoInner.innerHTML="o",s.add(this.domNode,"dojoxGridExpandoLoading"),o.getChildren(c,function(t){d._loadedChildren=!0,d._setOpen(e)})):this._setOpen(e)}else this._setOpen(e);else if(!o&&r)if(e){var h=i._by_idx[this.rowIdx];h&&!r.isItemLoaded(h.item)?(this.expandoInner.innerHTML="o",s.add(this.domNode,"dojoxGridExpandoLoading"),r.loadItem({item:h.item,onItem:a.hitch(this,function(t){var a=r.getIdentity(t);i._by_idty[a]=i._by_idx[this.rowIdx]={idty:a,item:t},this._setOpen(e)})})):this._setOpen(e)}else this._setOpen(e);else this._setOpen(e)},_setOpen:function(e){if(e&&this._tableRow&&s.contains(this._tableRow,"dojoxGridNoChildren"))return void this._setOpen(!1);if(this.expandoInner.innerHTML=e?"-":"+",s.remove(this.domNode,"dojoxGridExpandoLoading"),s.toggle(this.domNode,"dojoxGridExpandoOpened",e),this._tableRow){s.toggle(this._tableRow,"dojoxGridRowCollapsed",!e);var t=n.get(this._tableRow,"dojoxTreeGridBaseClasses"),i="";i=e?a.trim((" "+t+" ").replace(" dojoxGridRowCollapsed "," ")):(" "+t+" ").indexOf(" dojoxGridRowCollapsed ")<0?t+(t?" ":"")+"dojoxGridRowCollapsed":t,n.set(this._tableRow,"dojoxTreeGridBaseClasses",i)}var r=this.open!==e;this.open=e,this.expandoCell&&this.itemId&&(this.expandoCell.openStates[this.itemId]=e);var o=this.view,d=o.grid;this.toggleClass&&r&&(this._tableRow&&this._tableRow.style.display||this._toggleRows(this.toggleClass,e)),o&&this._initialized&&this.rowIdx>=0&&(d.rowHeightChanged(this.rowIdx),d.postresize(),o.hasVScrollbar(!0)),this._initialized=!0},onToggle:function(e){this.setOpen(!this.open),o.stop(e)},setRowNode:function(e,t,i){if(this.cellIdx<0||!this.itemId)return!1;this._initialized=!1,this.view=i,this.rowNode=t,this.rowIdx=e,this.expandoCell=i.structure.cells[0][this.cellIdx];var r=this.domNode;return r&&r.parentNode&&r.parentNode.parentNode&&(this._tableRow=r.parentNode.parentNode),this.open=this.expandoCell.getOpenState(this.itemId),i.grid.treeModel&&(d.set(this.domNode,"marginLeft",18*this.level+"px"),this.domNode.parentNode&&d.set(this.domNode.parentNode,"backgroundPosition",18*this.level+3+"px")),this.setOpen(this.open),!0}});var v=i("dojox.grid._TreeContentBuilder",y._ContentBuilder,{generateHtml:function(e,i){var a=this.getTableArray(),o=this.view,n=o.structure.cells[0],s=this.grid.getItem(i),d=this.grid,l=this.grid.store;g.fire(this.view,"onBeforeRow",[i,[n]]);var u=function(e,i,s,c,h,f){if(!f)return void(-1==a[0].indexOf("dojoxGridRowTableNeedsRowUpdate")&&(a[0]=a[0].replace("dojoxGridRowTable","dojoxGridRowTable dojoxGridRowTableNeedsRowUpdate")));var m=a.length;c=c||[];var p=c.join("|"),y=c[c.length-1],g=y+(s?" dojoxGridSummaryRow":""),v="";d.treeModel&&i&&!d.treeModel.mayHaveChildren(i)&&(g+=" dojoxGridNoChildren"),a.push('<tr style="'+v+'" class="'+g+'" dojoxTreeGridPath="'+h.join("/")+'" dojoxTreeGridBaseClasses="'+g+'">');for(var b,M=e+1,_=null,k=0;b=n[k];k++){var x=b.markup,w=b.customClasses=[],j=b.customStyles=[];x[5]=b.formatAtLevel(h,i,e,s,y,w),x[1]=w.join(" "),x[3]=j.join(";"),a.push.apply(a,x),!_&&b.level===M&&b.parentCell&&(_=b.parentCell)}if(a.push("</tr>"),i&&l&&l.isItem(i)){var I=l.getIdentity(i);"undefined"==typeof d._by_idty_paths[I]&&(d._by_idty_paths[I]=h.join("/"))}var S,F,E,A,C=h.concat([]);if(d.treeModel&&i)d.treeModel.mayHaveChildren(i)&&(S=o.structure.cells[0][d.expandoCell||0],F=S.getOpenState(i)&&f,E=new t.grid.TreePath(h.join("/"),d),A=E.children(!0)||[],r.forEach(A,function(e,t){var i=p.split("|");i.push(i[i.length-1]+"-"+t),C.push(t),u(M,e,!1,i,C,F),C.pop()}));else if(i&&_&&!s)if(S=o.structure.cells[0][_.level],F=S.getOpenState(i)&&f,l.hasAttribute(i,_.field)){var T=p.split("|");T.pop(),E=new t.grid.TreePath(h.join("/"),d),A=E.children(!0)||[],A.length?(a[m]='<tr class="'+T.join(" ")+' dojoxGridExpandoRow" dojoxTreeGridPath="'+h.join("/")+'">',r.forEach(A,function(e,t){var i=p.split("|");i.push(i[i.length-1]+"-"+t),C.push(t),u(M,e,!1,i,C,F),C.pop()}),C.push(A.length),u(e,i,!0,c,C,F)):a[m]='<tr class="'+y+' dojoxGridNoChildren" dojoxTreeGridPath="'+h.join("/")+'">'}else l.isItemLoaded(i)?a[m]='<tr class="'+y+' dojoxGridNoChildren" dojoxTreeGridPath="'+h.join("/")+'">':a[0]=a[0].replace("dojoxGridRowTable","dojoxGridRowTable dojoxGridRowTableNeedsRowUpdate");else i&&!s&&c.length>1&&(a[m]='<tr class="'+c[c.length-2]+'" dojoxTreeGridPath="'+h.join("/")+'">')};return u(0,s,!1,["dojoxGridRowToggle-"+i],[i],!0),a.push("</table>"),a.join("")},findTarget:function(e,t){for(var i=e;i&&i!=this.domNode&&(!i.tagName||"tr"!=i.tagName.toLowerCase());)i=i.parentNode;return i!=this.domNode?i:null},getCellNode:function(e,t){var i=u("td[idx='"+t+"']",e)[0];return i&&i.parentNode&&!s.contains(i.parentNode,"dojoxGridSummaryRow")?i:void 0},decorateEvent:function(e){return e.rowNode=this.findRowTarget(e.target),e.rowNode?(e.rowIndex=n.get(e.rowNode,"dojoxTreeGridPath"),this.baseDecorateEvent(e),e.cell=this.grid.getCell(e.cellIndex),!0):!1}});return i("dojox.grid._TreeView",p,{_contentBuilderClass:v,_onDndDrop:function(e,t,i){this.grid&&this.grid.aggregator&&this.grid.aggregator.clearSubtotalCache(),this.inherited(arguments)},postCreate:function(){this.inherited(arguments),this.connect(this.grid,"_cleanupExpandoCache","_cleanupExpandoCache")},_cleanupExpandoCache:function(e,i,a){if(-1!=e)if(r.forEach(this.grid.layout.cells,function(e){"undefined"!=typeof e.openStates&&i in e.openStates&&delete e.openStates[i]}),"string"==typeof e&&e.indexOf("/")>-1){for(var o=new t.grid.TreePath(e,this.grid),n=o.parent();n;)o=n,n=o.parent();var s=o.item();if(!s)return;var d=this.grid.store.getIdentity(s);if("undefined"!=typeof this._expandos[d]){for(var l in this._expandos[d]){var u=this._expandos[d][l];u&&u.destroy(),delete this._expandos[d][l]}delete this._expandos[d]}}else{for(var l in this._expandos)if("undefined"!=typeof this._expandos[l])for(var c in this._expandos[l]){var u=this._expandos[l][c];u&&u.destroy()}this._expandos={}}},postMixInProperties:function(){this.inherited(arguments),this._expandos={}},onBeforeRow:function(e,t){var i=this.grid;if(i._by_idx&&i._by_idx[e]&&i._by_idx[e].idty){var r=i._by_idx[e].idty;this._expandos[r]=this._expandos[r]||{}}this.inherited(arguments)},onAfterRow:function(e,t,i){r.forEach(u("span.dojoxGridExpando",i),function(t){if(t&&t.parentNode){var r,a,o=t.getAttribute("toggleClass"),n=this.grid;n._by_idx&&n._by_idx[e]&&n._by_idx[e].idty&&(r=n._by_idx[e].idty,a=this._expandos[r][o]),a?(l.place(a.domNode,t,"replace"),a.itemId=t.getAttribute("itemId"),a.cellIdx=parseInt(t.getAttribute("cellIdx"),10),isNaN(a.cellIdx)&&(a.cellIdx=-1)):r&&(a=c.parse(t.parentNode)[0],this._expandos[r][o]=a),a&&!a.setRowNode(e,i,this)&&a.domNode.parentNode.removeChild(a.domNode)}},this);var a=!1,o=this;u("tr[dojoxTreeGridPath]",i).forEach(function(e){s.toggle(e,"dojoxGridSubRowAlt",a),n.set(e,"dojoxTreeGridBaseClasses",e.className),a=!a,o.grid.rows.styleRowNode(n.get(e,"dojoxTreeGridPath"),e)}),this.inherited(arguments)},updateRowStyles:function(e){var t=u("tr[dojoxTreeGridPath='"+e+"']",this.domNode);t.length&&this.styleRowNode(e,t[0])},getCellNode:function(e,t){var i=u("tr[dojoxTreeGridPath='"+e+"']",this.domNode)[0];return i?this.content.getCellNode(i,t):void 0},destroy:function(){this._cleanupExpandoCache(),this.inherited(arguments)}})});//# sourceMappingURL=_TreeView.js.map