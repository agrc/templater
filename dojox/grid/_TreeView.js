//>>built
require({cache:{"url:dojox/grid/resources/Expando.html":'<div class="dojoxGridExpando"\n	><div class="dojoxGridExpandoNode" dojoAttachEvent="onclick:onToggle"\n		><div class="dojoxGridExpandoNodeInner" dojoAttachPoint="expandoInner"></div\n	></div\n></div>\n'}}),define("dojox/grid/_TreeView",["dijit/registry","../main","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/event","dojo/dom-attr","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/query","dojo/parser","dojo/text!./resources/Expando.html","dijit/_Widget","dijit/_TemplatedMixin","./_View","./_Builder","./util"],function(e,t,i,a,n,r,o,s,l,d,c,u,m,h,f,p,g,v){i("dojox.grid._Expando",[h,f],{open:!1,toggleClass:"",itemId:"",cellIdx:-1,view:null,rowNode:null,rowIdx:-1,expandoCell:null,level:0,templateString:m,_toggleRows:function(t,i){if(t&&this.rowNode){if(c("table.dojoxGridRowTableNeedsRowUpdate").length)return void(this._initialized&&this.view.grid.updateRow(this.rowIdx));var a=this,n=this.view.grid;if(n.treeModel){var r=this._tableRow?o.get(this._tableRow,"dojoxTreeGridPath"):"";r&&c('tr[dojoxTreeGridPath^="'+r+'/"]',this.rowNode).forEach(function(a){var n=c(".dojoxGridExpando",a)[0];if(n&&n.parentNode&&n.parentNode.parentNode&&!s.contains(n.parentNode.parentNode,"dojoxGridNoChildren")){var r=e.byNode(n);r&&r._toggleRows(t,r.open&&i)}a.style.display=i?"":"none"})}else c("tr."+t,this.rowNode).forEach(function(t){if(s.contains(t,"dojoxGridExpandoRow")){var n=c(".dojoxGridExpando",t)[0];if(n){var r=e.byNode(n),o=r?r.toggleClass:n.getAttribute("toggleClass"),l=r?r.open:a.expandoCell.getOpenState(n.getAttribute("itemId"));a._toggleRows(o,l&&i)}}t.style.display=i?"":"none"})}},setOpen:function(e){e&&s.contains(this.domNode,"dojoxGridExpandoLoading")&&(e=!1);var t=this.view,i=t.grid,a=i.store,r=i.treeModel,l=this,d=this.rowIdx,c=i._by_idx[d];if(c)if(r&&!this._loadedChildren)if(e){var u=i.getItem(o.get(this._tableRow,"dojoxTreeGridPath"));u?(this.expandoInner.innerHTML="o",s.add(this.domNode,"dojoxGridExpandoLoading"),r.getChildren(u,function(t){l._loadedChildren=!0,l._setOpen(e)})):this._setOpen(e)}else this._setOpen(e);else if(!r&&a)if(e){var m=i._by_idx[this.rowIdx];m&&!a.isItemLoaded(m.item)?(this.expandoInner.innerHTML="o",s.add(this.domNode,"dojoxGridExpandoLoading"),a.loadItem({item:m.item,onItem:n.hitch(this,function(t){var n=a.getIdentity(t);i._by_idty[n]=i._by_idx[this.rowIdx]={idty:n,item:t},this._setOpen(e)})})):this._setOpen(e)}else this._setOpen(e);else this._setOpen(e)},_setOpen:function(e){if(e&&this._tableRow&&s.contains(this._tableRow,"dojoxGridNoChildren"))return void this._setOpen(!1);if(this.expandoInner.innerHTML=e?"-":"+",s.remove(this.domNode,"dojoxGridExpandoLoading"),s.toggle(this.domNode,"dojoxGridExpandoOpened",e),this._tableRow){s.toggle(this._tableRow,"dojoxGridRowCollapsed",!e);var t=o.get(this._tableRow,"dojoxTreeGridBaseClasses"),i="";i=e?n.trim((" "+t+" ").replace(" dojoxGridRowCollapsed "," ")):(" "+t+" ").indexOf(" dojoxGridRowCollapsed ")<0?t+(t?" ":"")+"dojoxGridRowCollapsed":t,o.set(this._tableRow,"dojoxTreeGridBaseClasses",i)}var a=this.open!==e;this.open=e,this.expandoCell&&this.itemId&&(this.expandoCell.openStates[this.itemId]=e);var r=this.view,l=r.grid;this.toggleClass&&a&&(this._tableRow&&this._tableRow.style.display||this._toggleRows(this.toggleClass,e)),r&&this._initialized&&this.rowIdx>=0&&(l.rowHeightChanged(this.rowIdx),l.postresize(),r.hasVScrollbar(!0)),this._initialized=!0},onToggle:function(e){this.setOpen(!this.open),r.stop(e)},setRowNode:function(e,t,i){if(this.cellIdx<0||!this.itemId)return!1;this._initialized=!1,this.view=i,this.rowNode=t,this.rowIdx=e,this.expandoCell=i.structure.cells[0][this.cellIdx];var a=this.domNode;return a&&a.parentNode&&a.parentNode.parentNode&&(this._tableRow=a.parentNode.parentNode),this.open=this.expandoCell.getOpenState(this.itemId),i.grid.treeModel&&(l.set(this.domNode,"marginLeft",18*this.level+"px"),this.domNode.parentNode&&l.set(this.domNode.parentNode,"backgroundPosition",18*this.level+3+"px")),this.setOpen(this.open),!0}});var y=i("dojox.grid._TreeContentBuilder",g._ContentBuilder,{generateHtml:function(e,i){var n=this.getTableArray(),r=this.view,o=r.structure.cells[0],s=this.grid.getItem(i),l=this.grid,d=this.grid.store;v.fire(this.view,"onBeforeRow",[i,[o]]);var c=function(e,i,s,u,m,h){if(!h)return void(-1==n[0].indexOf("dojoxGridRowTableNeedsRowUpdate")&&(n[0]=n[0].replace("dojoxGridRowTable","dojoxGridRowTable dojoxGridRowTableNeedsRowUpdate")));var f=n.length;u=u||[];var p=u.join("|"),g=u[u.length-1],v=g+(s?" dojoxGridSummaryRow":""),y="";l.treeModel&&i&&!l.treeModel.mayHaveChildren(i)&&(v+=" dojoxGridNoChildren"),n.push('<tr style="'+y+'" class="'+v+'" dojoxTreeGridPath="'+m.join("/")+'" dojoxTreeGridBaseClasses="'+v+'">');for(var k,b=e+1,M=null,w=0;k=o[w];w++){var _=k.markup,j=k.customClasses=[],x=k.customStyles=[];_[5]=k.formatAtLevel(m,i,e,s,g,j),_[1]=j.join(" "),_[3]=x.join(";"),n.push.apply(n,_),!M&&k.level===b&&k.parentCell&&(M=k.parentCell)}if(n.push("</tr>"),i&&d&&d.isItem(i)){var I=d.getIdentity(i);"undefined"==typeof l._by_idty_paths[I]&&(l._by_idty_paths[I]=m.join("/"))}var E,T,z,A,C=m.concat([]);if(l.treeModel&&i)l.treeModel.mayHaveChildren(i)&&(E=r.structure.cells[0][l.expandoCell||0],T=E.getOpenState(i)&&h,z=new t.grid.TreePath(m.join("/"),l),A=z.children(!0)||[],a.forEach(A,function(e,t){var i=p.split("|");i.push(i[i.length-1]+"-"+t),C.push(t),c(b,e,!1,i,C,T),C.pop()}));else if(i&&M&&!s)if(E=r.structure.cells[0][M.level],T=E.getOpenState(i)&&h,d.hasAttribute(i,M.field)){var S=p.split("|");S.pop(),z=new t.grid.TreePath(m.join("/"),l),A=z.children(!0)||[],A.length?(n[f]='<tr class="'+S.join(" ")+' dojoxGridExpandoRow" dojoxTreeGridPath="'+m.join("/")+'">',a.forEach(A,function(e,t){var i=p.split("|");i.push(i[i.length-1]+"-"+t),C.push(t),c(b,e,!1,i,C,T),C.pop()}),C.push(A.length),c(e,i,!0,u,C,T)):n[f]='<tr class="'+g+' dojoxGridNoChildren" dojoxTreeGridPath="'+m.join("/")+'">'}else d.isItemLoaded(i)?n[f]='<tr class="'+g+' dojoxGridNoChildren" dojoxTreeGridPath="'+m.join("/")+'">':n[0]=n[0].replace("dojoxGridRowTable","dojoxGridRowTable dojoxGridRowTableNeedsRowUpdate");else i&&!s&&u.length>1&&(n[f]='<tr class="'+u[u.length-2]+'" dojoxTreeGridPath="'+m.join("/")+'">')};return c(0,s,!1,["dojoxGridRowToggle-"+i],[i],!0),n.push("</table>"),n.join("")},findTarget:function(e,t){for(var i=e;i&&i!=this.domNode&&(!i.tagName||"tr"!=i.tagName.toLowerCase());)i=i.parentNode;return i!=this.domNode?i:null},getCellNode:function(e,t){var i=c("td[idx='"+t+"']",e)[0];return i&&i.parentNode&&!s.contains(i.parentNode,"dojoxGridSummaryRow")?i:void 0},decorateEvent:function(e){return e.rowNode=this.findRowTarget(e.target),e.rowNode?(e.rowIndex=o.get(e.rowNode,"dojoxTreeGridPath"),this.baseDecorateEvent(e),e.cell=this.grid.getCell(e.cellIndex),!0):!1}});return i("dojox.grid._TreeView",p,{_contentBuilderClass:y,_onDndDrop:function(e,t,i){this.grid&&this.grid.aggregator&&this.grid.aggregator.clearSubtotalCache(),this.inherited(arguments)},postCreate:function(){this.inherited(arguments),this.connect(this.grid,"_cleanupExpandoCache","_cleanupExpandoCache")},_cleanupExpandoCache:function(e,i,n){if(-1!=e)if(a.forEach(this.grid.layout.cells,function(e){"undefined"!=typeof e.openStates&&i in e.openStates&&delete e.openStates[i]}),"string"==typeof e&&e.indexOf("/")>-1){for(var r=new t.grid.TreePath(e,this.grid),o=r.parent();o;)r=o,o=r.parent();var s=r.item();if(!s)return;var l=this.grid.store.getIdentity(s);if("undefined"!=typeof this._expandos[l]){for(var d in this._expandos[l]){var c=this._expandos[l][d];c&&c.destroy(),delete this._expandos[l][d]}delete this._expandos[l]}}else{for(var d in this._expandos)if("undefined"!=typeof this._expandos[d])for(var u in this._expandos[d]){var c=this._expandos[d][u];c&&c.destroy()}this._expandos={}}},postMixInProperties:function(){this.inherited(arguments),this._expandos={}},onBeforeRow:function(e,t){var i=this.grid;if(i._by_idx&&i._by_idx[e]&&i._by_idx[e].idty){var a=i._by_idx[e].idty;this._expandos[a]=this._expandos[a]||{}}this.inherited(arguments)},onAfterRow:function(e,t,i){a.forEach(c("span.dojoxGridExpando",i),function(t){if(t&&t.parentNode){var a,n,r=t.getAttribute("toggleClass"),o=this.grid;o._by_idx&&o._by_idx[e]&&o._by_idx[e].idty&&(a=o._by_idx[e].idty,n=this._expandos[a][r]),n?(d.place(n.domNode,t,"replace"),n.itemId=t.getAttribute("itemId"),n.cellIdx=parseInt(t.getAttribute("cellIdx"),10),isNaN(n.cellIdx)&&(n.cellIdx=-1)):a&&(n=u.parse(t.parentNode)[0],this._expandos[a][r]=n),n&&!n.setRowNode(e,i,this)&&n.domNode.parentNode.removeChild(n.domNode)}},this);var n=!1,r=this;c("tr[dojoxTreeGridPath]",i).forEach(function(e){s.toggle(e,"dojoxGridSubRowAlt",n),o.set(e,"dojoxTreeGridBaseClasses",e.className),n=!n,r.grid.rows.styleRowNode(o.get(e,"dojoxTreeGridPath"),e)}),this.inherited(arguments)},updateRowStyles:function(e){var t=c("tr[dojoxTreeGridPath='"+e+"']",this.domNode);t.length&&this.styleRowNode(e,t[0])},getCellNode:function(e,t){var i=c("tr[dojoxTreeGridPath='"+e+"']",this.domNode)[0];return i?this.content.getCellNode(i,t):void 0},destroy:function(){this._cleanupExpandoCache(),this.inherited(arguments)}})});//# sourceMappingURL=_TreeView.js.map