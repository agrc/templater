//>>built
define("dojox/rpc/Rest",["dojo","dojox"],function(e,t){function i(e,t,i,o){return e.addCallback(function(t){return e.ioArgs.xhr&&i&&(i=e.ioArgs.xhr.getResponseHeader("Content-Range"),e.fullLength=i&&(i=i.match(/\/(.*)/))&&parseInt(i[1])),t}),e}e.getObject("rpc.Rest",!0,t),t.rpc&&t.rpc.transportRegistry&&t.rpc.transportRegistry.register("REST",function(e){return"REST"==e},{getExecutor:function(e,i,o){return new t.rpc.Rest(i.name,(i.contentType||o._smd.contentType||"").match(/json|javascript/),null,function(e,t){var n=o._getRequest(i,[e]);return n.url=n.target+(n.data?"?"+n.data:""),t&&(t.start>=0||t.count>=0)&&(n.headers=n.headers||{},n.headers.Range="items="+(t.start||"0")+"-"+("count"in t&&t.count!=1/0?t.count+(t.start||0)-1:"")),n})}});var o;return o=t.rpc.Rest=function(i,n,r,a){function s(e){d[e]=function(t,i){return o._change(e,d,t,i)}}var d;return d=function(e,t){return o._get(d,e,t)},d.isJson=n,d._schema=r,d.cache={serialize:n?(t.json&&t.json.ref||e).toJson:function(e){return e}},d._getRequest=a||function(o,r){if(e.isObject(o)&&(o=e.objectToQuery(o),o=o?"?"+o:""),r&&r.sort&&!r.queryStr){o+=(o?"&":"?")+"sort(";for(var a=0;a<r.sort.length;a++){var s=r.sort[a];o+=(a>0?",":"")+(s.descending?"-":"+")+encodeURIComponent(s.attribute)}o+=")"}var d={url:i+(null==o?"":o),handleAs:n?"json":"text",contentType:n?"application/json":"text/plain",sync:t.rpc._sync,headers:{Accept:n?"application/json,application/javascript":"*/*"}};return r&&(r.start>=0||r.count>=0)&&(d.headers.Range="items="+(r.start||"0")+"-"+("count"in r&&r.count!=1/0?r.count+(r.start||0)-1:"")),t.rpc._sync=!1,d},s("put"),s("post"),s("delete"),d.servicePath=i,d},o._index={},o._timeStamps={},o._change=function(t,o,n,r){var a=o._getRequest(n);return a[t+"Data"]=r,i(e.xhr(t.toUpperCase(),a,!0),o)},o._get=function(t,o,n){return n=n||{},i(e.xhrGet(t._getRequest(o,n)),t,n.start>=0||n.count>=0,o)},o});//# sourceMappingURL=Rest.js.map