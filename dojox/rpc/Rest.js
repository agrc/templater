//>>built
define("dojox/rpc/Rest",["dojo","dojox"],function(e,t){function i(e,t,i,r){return e.addCallback(function(t){return e.ioArgs.xhr&&i&&(i=e.ioArgs.xhr.getResponseHeader("Content-Range"),e.fullLength=i&&(i=i.match(/\/(.*)/))&&parseInt(i[1])),t}),e}e.getObject("rpc.Rest",!0,t),t.rpc&&t.rpc.transportRegistry&&t.rpc.transportRegistry.register("REST",function(e){return"REST"==e},{getExecutor:function(e,i,r){return new t.rpc.Rest(i.name,(i.contentType||r._smd.contentType||"").match(/json|javascript/),null,function(e,t){var a=r._getRequest(i,[e]);return a.url=a.target+(a.data?"?"+a.data:""),t&&(t.start>=0||t.count>=0)&&(a.headers=a.headers||{},a.headers.Range="items="+(t.start||"0")+"-"+("count"in t&&t.count!=1/0?t.count+(t.start||0)-1:"")),a})}});var r;return r=t.rpc.Rest=function(i,a,o,n){function s(e){l[e]=function(t,i){return r._change(e,l,t,i)}}var l;return l=function(e,t){return r._get(l,e,t)},l.isJson=a,l._schema=o,l.cache={serialize:a?(t.json&&t.json.ref||e).toJson:function(e){return e}},l._getRequest=n||function(r,o){if(e.isObject(r)&&(r=e.objectToQuery(r),r=r?"?"+r:""),o&&o.sort&&!o.queryStr){r+=(r?"&":"?")+"sort(";for(var n=0;n<o.sort.length;n++){var s=o.sort[n];r+=(n>0?",":"")+(s.descending?"-":"+")+encodeURIComponent(s.attribute)}r+=")"}var l={url:i+(null==r?"":r),handleAs:a?"json":"text",contentType:a?"application/json":"text/plain",sync:t.rpc._sync,headers:{Accept:a?"application/json,application/javascript":"*/*"}};return o&&(o.start>=0||o.count>=0)&&(l.headers.Range="items="+(o.start||"0")+"-"+("count"in o&&o.count!=1/0?o.count+(o.start||0)-1:"")),t.rpc._sync=!1,l},s("put"),s("post"),s("delete"),l.servicePath=i,l},r._index={},r._timeStamps={},r._change=function(t,r,a,o){var n=r._getRequest(a);return n[t+"Data"]=o,i(e.xhr(t.toUpperCase(),n,!0),r)},r._get=function(t,r,a){return a=a||{},i(e.xhrGet(t._getRequest(r,a)),t,a.start>=0||a.count>=0,r)},r});//# sourceMappingURL=Rest.js.map