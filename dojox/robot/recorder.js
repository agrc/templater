//>>built
define("dojox/robot/recorder",["dojo","dijit","dojox"],function(dojo,dijit,dojox){dojo.provide("dojox.robot.recorder"),dojo.experimental("dojox.robot.recorder"),function(){var KEYPRESS_MAXIMUM_DELAY=1e3,MOUSEMOVE_MAXIMUM_DELAY=500,MAXIMUM_DELAY=1e4,commands=[],testNumber=0,startTime=null,prevTime=null,start=function(){alert("Started recording."),commands=[],startTime=new Date,prevTime=new Date},addCommand=function(name,args){if(!(null==startTime||"doh.robot.keyPress"==name&&args[0]==dojo.keys.ENTER&&eval("("+args[2]+")").ctrl&&eval("("+args[2]+")").alt)){var dt=Math.max(Math.min(Math.round((new Date).getTime()-prevTime.getTime()),MAXIMUM_DELAY),1);"doh.robot.mouseMove"==name?args[2]=dt:args[1]=dt,commands.push({name:name,args:args}),prevTime=new Date}},_optimize=function(){var c=commands;"doh.robot.keyPress"!=c[0].name||c[0].args[0]!=dojo.keys.ENTER&&77!=c[0].args[0]||c.splice(0,1);for(var i=c.length-1;i>=c.length-2&&i>=0;i--)("doh.robot.keyPress"==c[i].name&&c[i].args[0]==dojo.keys.ALT||c[i].args[0]==dojo.keys.CTRL)&&c.splice(i,1);for(i=0;i<c.length;i++){var next,nextdt;if(c[i+1]&&"doh.robot.mouseMove"==c[i].name&&c[i+1].name==c[i].name&&c[i+1].args[2]<MOUSEMOVE_MAXIMUM_DELAY){for(next=c[i+1],nextdt=0;next&&next.name==c[i].name&&next.args[2]<MOUSEMOVE_MAXIMUM_DELAY;)c.splice(i+1,1),nextdt+=next.args[2],c[i].args[0]=next.args[0],c[i].args[1]=next.args[1],next=c[i+1];c[i].args[3]=nextdt}else if(c[i+1]&&"doh.robot.mouseWheel"==c[i].name&&c[i+1].name==c[i].name&&c[i+1].args[1]<MOUSEMOVE_MAXIMUM_DELAY){for(next=c[i+1],nextdt=0;next&&next.name==c[i].name&&next.args[1]<MOUSEMOVE_MAXIMUM_DELAY;)c.splice(i+1,1),nextdt+=next.args[1],c[i].args[0]+=next.args[0],next=c[i+1];c[i].args[2]=nextdt}else if(c[i+2]&&"doh.robot.mouseMoveAt"==c[i].name&&"doh.robot.scrollIntoView"==c[i+2].name){var temp=c.splice(i+2,1)[0];c.splice(i,0,temp)}else if(c[i+1]&&"doh.robot.mousePress"==c[i].name&&"doh.robot.mouseRelease"==c[i+1].name&&c[i].args[0]==c[i+1].args[0])c[i].name="doh.robot.mouseClick",c.splice(i+1,1),c[i+1]&&"doh.robot.mouseClick"==c[i+1].name&&c[i].args[0]==c[i+1].args[0]&&c.splice(i+1,1);else if(c[i+1]&&c[i-1]&&"doh.robot.mouseMoveAt"==c[i-1].name&&"doh.robot.mousePress"==c[i].name&&"doh.robot.mouseMove"==c[i+1].name){var cmd={name:"doh.robot.mouseMoveAt",args:[c[i-1].args[0],1,100,c[i-1].args[3]+1,c[i-1].args[4]]};c.splice(i+1,0,cmd)}else if(!(c[i+1]&&("doh.robot.keyPress"==c[i].name&&"string"==typeof c[i].args[0]||"doh.robot.typeKeys"==c[i].name)&&"doh.robot.keyPress"==c[i+1].name&&"string"==typeof c[i+1].args[0]&&c[i+1].args[1]<=KEYPRESS_MAXIMUM_DELAY)||eval("("+c[i].args[2]+")").ctrl||eval("("+c[i].args[2]+")").alt||eval("("+c[i+1].args[2]+")").ctrl||eval("("+c[i+1].args[2]+")").alt){if("doh.robot.keyPress"==c[i].name)if("string"==typeof c[i].args[0])c[i].args[0]="'"+c[i].args[0]+"'";else if(0==c[i].args[0])c.splice(i,1);else for(var j in dojo.keys)if(dojo.keys[j]==c[i].args[0]){c[i].args[0]="dojo.keys."+j;break}}else{c[i].name="doh.robot.typeKeys",c[i].args.splice(3,1),next=c[i+1];for(var typeTime=0;next&&"doh.robot.keyPress"==next.name&&"string"==typeof next.args[0]&&next.args[1]<=KEYPRESS_MAXIMUM_DELAY&&!eval("("+next.args[2]+")").ctrl&&!eval("("+next.args[2]+")").alt;)c.splice(i+1,1),c[i].args[0]+=next.args[0],typeTime+=next.args[1],next=c[i+1];c[i].args[2]=typeTime,c[i].args[0]="'"+c[i].args[0]+"'"}}},toggle=function(){startTime?stop():start()},stop=function(){var e=Math.round((new Date).getTime()-startTime.getTime());startTime=null,_optimize();var t=commands;if(t.length){var i="doh.register('dojox.robot.AutoGeneratedTestGroup',{\n";i+="     name: 'autotest"+testNumber+++"',\n",i+="     timeout: "+(e+2e3)+",\n",i+="     runTest: function(){\n",i+="          var d = new doh.Deferred();\n";for(var a=0;a<t.length;a++){i+="          "+t[a].name+"(";for(var o=0;o<t[a].args.length;o++){i+=t[a].args[o],o!=t[a].args.length-1&&(i+=", ")}i+=");\n"}i+="          doh.robot.sequence(function(){\n",i+="               if(/*Your condition here*/){\n",i+="                    d.callback(true);\n",i+="               }else{\n",i+="                    d.errback(new Error('We got a failure'));\n",i+="               }\n",i+="          }, 1000);\n",i+="          return d;\n",i+="     }\n",i+="});\n";var n=document.createElement("div");n.id="dojox.robot.recorder",n.style.backgroundColor="white",n.style.position="absolute";var r={y:window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,x:window.pageXOffset||(window.dojo?dojo._fixIeBiDiScrollLeft(document.documentElement.scrollLeft):void 0)||document.body.scrollLeft||0};n.style.left=r.x+"px",n.style.top=r.y+"px";var s=document.createElement("h1");s.innerHTML="Your code:",n.appendChild(s);var d=document.createElement("pre");void 0!==d.innerText?d.innerText=i:d.textContent=i,n.appendChild(d);var l=document.createElement("button");l.innerHTML="Close";var h=dojo.connect(l,"onmouseup",function(e){dojo.stopEvent(e),document.body.removeChild(n),dojo.disconnect(h)});n.appendChild(l),document.body.appendChild(n),commands=[]}},getSelector=function(e){if("string"==typeof e)return"'"+e+"'";if(e.id)return"'"+e.id+"'";var t,i=document.getElementsByTagName(e.nodeName);for(t=0;t<i.length&&i[t]!=e;t++);return"function(){ return document.getElementsByTagName('"+e.nodeName+"')["+t+"]; }"},getMouseButtonObject=function(e){return"{left:"+(0==e)+", middle:"+(1==e)+", right:"+(2==e)+"}"},getModifierObject=function(e){return"{'shift':"+e.shiftKey+", 'ctrl':"+e.ctrlKey+", 'alt':"+e.altKey+"}"};dojo.connect(document,"onkeydown",function(e){(e.keyCode==dojo.keys.ENTER||77==e.keyCode)&&e.ctrlKey&&e.altKey&&(dojo.stopEvent(e),toggle())});var lastEvent={type:""},onmousedown=function(e){if(e&&(lastEvent.type!=e.type||lastEvent.button!=e.button)){lastEvent={type:e.type,button:e.button};var t=getSelector(e.target),i=dojo.coords(e.target);addCommand("doh.robot.mouseMoveAt",[t,0,100,e.clientX-i.x,e.clientY-i.y]),addCommand("doh.robot.mousePress",[getMouseButtonObject(e.button-(dojo.isIE?1:0)),0])}},onclick=function(e){if(e&&(lastEvent.type!=e.type||lastEvent.button!=e.button)){lastEvent={type:e.type,button:e.button};getSelector(e.target),dojo.coords(e.target);addCommand("doh.robot.mouseClick",[getMouseButtonObject(e.button-(dojo.isIE?1:0)),0])}},onmouseup=function(e){if(e&&(lastEvent.type!=e.type||lastEvent.button!=e.button)){lastEvent={type:e.type,button:e.button};getSelector(e.target),dojo.coords(e.target);addCommand("doh.robot.mouseRelease",[getMouseButtonObject(e.button-(dojo.isIE?1:0)),0])}},onmousemove=function(e){!e||lastEvent.type==e.type&&lastEvent.pageX==e.pageX&&lastEvent.pageY==e.pageY||(lastEvent={type:e.type,pageX:e.pageX,pageY:e.pageY},addCommand("doh.robot.mouseMove",[e.pageX,e.pageY,0,100,!0]))},onmousewheel=function(e){!e||lastEvent.type==e.type&&lastEvent.pageX==e.pageX&&lastEvent.pageY==e.pageY||(lastEvent={type:e.type,detail:e.detail?e.detail:-e.wheelDelta/120},addCommand("doh.robot.mouseWheel",[lastEvent.detail]))},onkeypress=function(e){!e||lastEvent.type==e.type&&lastEvent.charCode==e.charCode&&lastEvent.keyCode==e.keyCode||(lastEvent={type:e.type,charCode:e.charCode,keyCode:e.keyCode},addCommand("doh.robot.keyPress",[e.charOrCode==dojo.keys.SPACE?" ":e.charOrCode,0,getModifierObject(e)]))},onkeyup=function(e){!e||lastEvent.type==e.type&&lastEvent.charCode==e.charCode&&lastEvent.keyCode==e.keyCode||(lastEvent={type:e.type,charCode:e.charCode,keyCode:e.keyCode})};dojo.connect(document,"onmousedown",onmousedown),dojo.connect(document,"onmouseup",onmouseup),dojo.connect(document,"onclick",onclick),dojo.connect(document,"onkeypress",onkeypress),dojo.connect(document,"onkeyup",onkeyup),dojo.connect(document,"onmousemove",onmousemove),dojo.connect(document,dojo.isMozilla?"DOMMouseScroll":"onmousewheel",onmousewheel),dojo.addOnLoad(function(){dojo.window&&dojo.connect(dojo.window,"scrollIntoView",function(e){addCommand("doh.robot.scrollIntoView",[getSelector(e)])})}),dojo.connect(dojo,"connect",function(e,t,i){if(e&&(!i||!i._mine)){var a=null;if("onmousedown"==t.toLowerCase()?a=dojo.hitch(this,onmousedown):t.toLowerCase()==(dojo.isMozilla?"dommousescroll":"onmousewheel")?a=dojo.hitch(this,onmousewheel):"onclick"==t.toLowerCase()?a=dojo.hitch(this,onclick):"onmouseup"==t.toLowerCase()?a=dojo.hitch(this,onmouseup):"onkeypress"==t.toLowerCase()?a=dojo.hitch(this,onkeypress):"onkeyup"==t.toLowerCase()&&(a=dojo.hitch(this,onkeyup)),null==a)return;a._mine=!0,dojo.connect(e,t,a)}})}()});//# sourceMappingURL=recorder.js.map