//>>built
define("dojox/xmpp/sasl",["dojo","dijit","dojox","dojo/require!dojox/xmpp/util,dojo/AdapterRegistry,dojox/encoding/digests/MD5"],function(e,t,i){e.provide("dojox.xmpp.sasl"),e.require("dojox.xmpp.util"),e.require("dojo.AdapterRegistry"),e.require("dojox.encoding.digests.MD5"),i.xmpp.sasl.saslNS="urn:ietf:params:xml:ns:xmpp-sasl",e.declare("dojox.xmpp.sasl._Base",null,{mechanism:null,closeAuthTag:!0,constructor:function(e){this.session=e,this.startAuth()},startAuth:function(){var e=new i.string.Builder(i.xmpp.util.createElement("auth",{xmlns:i.xmpp.sasl.saslNS,mechanism:this.mechanism},this.closeAuthTag));this.appendToAuth(e),this.session.dispatchPacket(e.toString())},appendToAuth:function(e){},onChallenge:function(e){this.first_challenge?this.onSecondChallenge(e):(this.first_challenge=!0,this.onFirstChallenge(e))},onFirstChallenge:function(){},onSecondChallenge:function(){},onSuccess:function(){this.session.sendRestart()}}),e.declare("dojox.xmpp.sasl.SunWebClientAuth",i.xmpp.sasl._Base,{mechanism:"SUN-COMMS-CLIENT-PROXY-AUTH"}),e.declare("dojox.xmpp.sasl.Plain",i.xmpp.sasl._Base,{mechanism:"PLAIN",closeAuthTag:!1,appendToAuth:function(e){var t=this.session.jid,r=this.session.jid.indexOf("@");-1!=r&&(t=this.session.jid.substring(0,r));var o=this.session.jid+"\0"+t+"\0"+this.session.password;o=i.xmpp.util.Base64.encode(o),e.append(o),e.append("</auth>"),delete this.session.password}}),e.declare("dojox.xmpp.sasl.DigestMD5",i.xmpp.sasl._Base,{mechanism:"DIGEST-MD5",onFirstChallenge:function(e){var t=i.encoding.digests,r=i.encoding.digests.outputTypes,o=function(e){return t.MD5(e,r.Hex)},n=function(e){return t.MD5(e,r.String)},a=i.xmpp.util.Base64.decode(e.firstChild.nodeValue),s={realm:"",nonce:"",qop:"auth",maxbuf:65536};a.replace(/([a-z]+)=([^,]+)/g,function(e,t,i){i=i.replace(/^"(.+)"$/,"$1"),s[t]=i});var d="";switch(s.qop){case"auth-int":case"auth-conf":d=":00000000000000000000000000000000";case"auth":break;default:return!1}var l=t.MD5(1234567890*Math.random(),r.Hex),c="xmpp/"+this.session.domain,h=this.session.jid,u=this.session.jid.indexOf("@");-1!=u&&(h=this.session.jid.substring(0,u)),h=i.xmpp.util.encodeJid(h);var f=new i.string.Builder;f.append(n(h+":"+s.realm+":"+this.session.password),":",s.nonce+":"+l),delete this.session.password;var m=":"+c+d,p="AUTHENTICATE"+m,g=new i.string.Builder;g.append(o(f.toString()),":",s.nonce,":00000001:",l,":",s.qop,":");var y=new i.string.Builder;y.append('username="',h,'",','realm="',s.realm,'",',"nonce=",s.nonce,",",'cnonce="',l,'",','nc="00000001",qop="',s.qop,'",digest-uri="',c,'",','response="',o(g.toString()+o(p)),'",charset="utf-8"');var v=new i.string.Builder(i.xmpp.util.createElement("response",{xmlns:i.xmpp.xmpp.SASL_NS},!1));v.append(i.xmpp.util.Base64.encode(y.toString())),v.append("</response>"),this.rspauth=o(g.toString()+o(m)),this.session.dispatchPacket(v.toString())},onSecondChallenge:function(e){var t=i.xmpp.util.Base64.decode(e.firstChild.nodeValue);if(this.rspauth==t.substring(8)){var r=new i.string.Builder(i.xmpp.util.createElement("response",{xmlns:i.xmpp.xmpp.SASL_NS},!0));this.session.dispatchPacket(r.toString())}}}),i.xmpp.sasl.registry=new e.AdapterRegistry,i.xmpp.sasl.registry.register("SUN-COMMS-CLIENT-PROXY-AUTH",function(e){return"SUN-COMMS-CLIENT-PROXY-AUTH"==e},function(e,t){return new i.xmpp.sasl.SunWebClientAuth(t)}),i.xmpp.sasl.registry.register("DIGEST-MD5",function(e){return"DIGEST-MD5"==e},function(e,t){return new i.xmpp.sasl.DigestMD5(t)}),i.xmpp.sasl.registry.register("PLAIN",function(e){return"PLAIN"==e},function(e,t){return new i.xmpp.sasl.Plain(t)})});//# sourceMappingURL=sasl.js.map