//>>built
define("dojox/xmpp/ChatService",["dojo","dijit","dojox"],function(e,t,i){e.provide("dojox.xmpp.ChatService"),i.xmpp.chat={CHAT_STATE_NS:"http://jabber.org/protocol/chatstates",ACTIVE_STATE:"active",COMPOSING_STATE:"composing",INACTIVE_STATE:"inactive",PAUSED_STATE:"paused",GONE_STATE:"gone"},e.declare("dojox.xmpp.ChatService",null,{state:"",constructor:function(){this.state="",this.chatid=Math.round(1e15*Math.random())},receiveMessage:function(e,t){e&&!t&&this.onNewMessage(e)},setSession:function(e){this.session=e},setState:function(e){this.state!=e&&(this.state=e)},invite:function(e){if(!this.uid){if(!e||""==e)throw new Error("ChatService::invite() contact is NULL");this.uid=e;var t={xmlns:"jabber:client",to:this.uid,from:this.session.jid+"/"+this.session.resource,type:"chat"},a=new i.string.Builder(i.xmpp.util.createElement("message",t,!1));a.append(i.xmpp.util.createElement("thread",{},!1)),a.append(this.chatid),a.append("</thread>"),a.append(i.xmpp.util.createElement("active",{xmlns:i.xmpp.chat.CHAT_STATE_NS},!0)),a.append("</message>"),this.session.dispatchPacket(a.toString()),this.onInvite(e),this.setState(i.xmpp.chat.CHAT_STATE_NS)}},sendMessage:function(e){if(this.uid&&(e.body&&""!=e.body||e.xhtml)){var t={xmlns:"jabber:client",to:this.uid,from:this.session.jid+"/"+this.session.resource,type:"chat"},a=new i.string.Builder(i.xmpp.util.createElement("message",t,!1)),r=i.xmpp.util.createElement("html",{xmlns:i.xmpp.xmpp.XHTML_IM_NS},!1),o=i.xmpp.util.createElement("body",{"xml:lang":this.session.lang,xmlns:i.xmpp.xmpp.XHTML_BODY_NS},!1)+e.body+"</body>",n=i.xmpp.util.createElement("body",{},!1)+i.xmpp.util.stripHtml(e.body)+"</body>";a.subject&&""!=a.subject&&(a.append(i.xmpp.util.createElement("subject",{},!1)),a.append(a.subject),a.append("</subject>")),a.append(n),a.append(r),a.append(o),a.append("</html>"),a.append(i.xmpp.util.createElement("thread",{},!1)),a.append(this.chatid),a.append("</thread>"),this.useChatStates&&a.append(i.xmpp.util.createElement("active",{xmlns:i.xmpp.chat.CHAT_STATE_NS},!0)),a.append("</message>"),this.session.dispatchPacket(a.toString())}},sendChatState:function(e){if(this.useChatState&&!this.firstMessage&&e!=this._currentState){var t={xmlns:"jabber:client",to:this.uid,from:this.session.jid+"/"+this.session.resource,type:"chat"},a=new i.string.Builder(i.xmpp.util.createElement("message",t,!1));a.append(i.xmpp.util.createElement(e,{xmlns:i.xmpp.chat.CHAT_STATE_NS},!0)),this._currentState=e,a.append("<thread>"),a.append(this.chatid),a.append("</thread></message>"),this.session.dispatchPacket(a.toString())}},onNewMessage:function(e){},onInvite:function(e){}})});//# sourceMappingURL=ChatService.js.map