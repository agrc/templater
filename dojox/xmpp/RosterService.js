//>>built
define("dojox/xmpp/RosterService",["dojo","dijit","dojox"],function(e,t,i){e.provide("dojox.xmpp.RosterService"),i.xmpp.roster={ADDED:101,CHANGED:102,REMOVED:103},e.declare("dojox.xmpp.RosterService",null,{constructor:function(e){this.session=e},addRosterItem:function(e,t,a){if(!e)throw new Error("Roster::addRosterItem() - User ID is null");var r=this.session.getNextIqId(),o={id:r,from:this.session.jid+"/"+this.session.resource,type:"set"},n=new i.string.Builder(i.xmpp.util.createElement("iq",o,!1));if(n.append(i.xmpp.util.createElement("query",{xmlns:"jabber:iq:roster"},!1)),e=i.xmpp.util.encodeJid(e),-1==e.indexOf("@")&&(e=e+"@"+this.session.domain),n.append(i.xmpp.util.createElement("item",{jid:e,name:i.xmpp.util.xmlEncode(t)},!1)),a)for(var s=0;s<a.length;s++)n.append("<group>"),n.append(a[s]),n.append("</group>");n.append("</item></query></iq>");var l=this.session.dispatchPacket(n.toString(),"iq",o.id);return l.addCallback(this,"verifyRoster"),l},updateRosterItem:function(e,t,a){-1==e.indexOf("@")&&(e+=e+"@"+this.session.domain);var r={id:this.session.getNextIqId(),from:this.session.jid+"/"+this.session.resource,type:"set"},o=new i.string.Builder(i.xmpp.util.createElement("iq",r,!1));o.append(i.xmpp.util.createElement("query",{xmlns:"jabber:iq:roster"},!1));var n=this.session.getRosterIndex(e);if(-1!=n){var s={jid:e};t?s.name=t:this.session.roster[n].name&&(s.name=this.session.roster[n].name),s.name&&(s.name=i.xmpp.util.xmlEncode(s.name)),o.append(i.xmpp.util.createElement("item",s,!1));var l=a||this.session.roster[n].groups;if(l)for(var d=0;d<l.length;d++)o.append("<group>"),o.append(l[d]),o.append("</group>");o.append("</item></query></iq>");var h=this.session.dispatchPacket(o.toString(),"iq",r.id);return h.addCallback(this,"verifyRoster"),h}},verifyRoster:function(e){if("result"==e.getAttribute("type"));else{var t=this.session.processXmppError(e);this.onAddRosterItemFailed(t)}return e},addRosterItemToGroup:function(e,t){if(!e)throw new Error("Roster::addRosterItemToGroup() JID is null or undefined");if(!t)throw new Error("Roster::addRosterItemToGroup() group is null or undefined");var a=this.session.getRosterIndex(e);if(-1!=a){for(var r=this.session.roster[a],o=!1,n=0;r<r.groups.length&&!o;n++)r.groups[n]==t&&(o=!0);return o?i.xmpp.xmpp.INVALID_ID:this.updateRosterItem(e,r.name,r.groups.concat(t),a)}},removeRosterGroup:function(e){for(var t=this.session.roster,i=0;i<t.length;i++){var a=t[i];if(a.groups.length>0)for(var r=0;r<a.groups.length;r++)a.groups[r]==e&&(a.groups.splice(r,1),this.updateRosterItem(a.jid,a.name,a.groups))}},renameRosterGroup:function(e,t){for(var i=this.session.roster,a=0;a<i.length;a++){var r=i[a];if(r.groups.length>0)for(var o=0;o<r.groups.length;o++)r.groups[o]==e&&(r.groups[o]=t,this.updateRosterItem(r.jid,r.name,r.groups))}},removeRosterItemFromGroup:function(e,t){if(!e)throw new Error("Roster::addRosterItemToGroup() JID is null or undefined");if(!t)throw new Error("Roster::addRosterItemToGroup() group is null or undefined");var a=this.session.getRosterIndex(e);if(-1!=a){for(var r=this.session.roster[a],o=!1,n=0;n<r.groups.length&&!o;n++)r.groups[n]==t&&(o=!0,a=n);return 1==o?(r.groups.splice(a,1),this.updateRosterItem(e,r.name,r.groups)):i.xmpp.xmpp.INVALID_ID}},rosterItemRenameGroup:function(e,t,a){if(!e)throw new Error("Roster::rosterItemRenameGroup() JID is null or undefined");if(!a)throw new Error("Roster::rosterItemRenameGroup() group is null or undefined");var r=this.session.getRosterIndex(e);if(-1!=r){for(var o=this.session.roster[r],n=!1,s=0;s<o.groups.length&&!n;s++)o.groups[s]==t&&(o.groups[s]=a,n=!0);return 1==n?this.updateRosterItem(e,o.name,o.groups):i.xmpp.xmpp.INVALID_ID}},renameRosterItem:function(e,t){if(!e)throw new Error("Roster::addRosterItemToGroup() JID is null or undefined");if(!t)throw new Error("Roster::addRosterItemToGroup() New Name is null or undefined");var i=this.session.getRosterIndex(e);if(-1!=i)return this.updateRosterItem(e,t,this.session.roster.groups,i)},removeRosterItem:function(e){if(!e)throw new Error("Roster::addRosterItemToGroup() JID is null or undefined");var t={id:this.session.getNextIqId(),from:this.session.jid+"/"+this.session.resource,type:"set"},a=new i.string.Builder(i.xmpp.util.createElement("iq",t,!1));a.append(i.xmpp.util.createElement("query",{xmlns:"jabber:iq:roster"},!1)),-1==e.indexOf("@")&&(e+=e+"@"+this.session.domain),a.append(i.xmpp.util.createElement("item",{jid:e,subscription:"remove"},!0)),a.append("</query></iq>");var r=this.session.dispatchPacket(a.toString(),"iq",t.id);return r.addCallback(this,"verifyRoster"),r},getAvatar:function(e){},publishAvatar:function(e,t){},onVerifyRoster:function(e){},onVerifyRosterFailed:function(e){}})});//# sourceMappingURL=RosterService.js.map