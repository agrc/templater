//>>built
define("dojox/xmpp/RosterService",["dojo","dijit","dojox"],function(e,t,i){e.provide("dojox.xmpp.RosterService"),i.xmpp.roster={ADDED:101,CHANGED:102,REMOVED:103},e.declare("dojox.xmpp.RosterService",null,{constructor:function(e){this.session=e},addRosterItem:function(e,t,o){if(!e)throw new Error("Roster::addRosterItem() - User ID is null");var r=this.session.getNextIqId(),a={id:r,from:this.session.jid+"/"+this.session.resource,type:"set"},n=new i.string.Builder(i.xmpp.util.createElement("iq",a,!1));if(n.append(i.xmpp.util.createElement("query",{xmlns:"jabber:iq:roster"},!1)),e=i.xmpp.util.encodeJid(e),-1==e.indexOf("@")&&(e=e+"@"+this.session.domain),n.append(i.xmpp.util.createElement("item",{jid:e,name:i.xmpp.util.xmlEncode(t)},!1)),o)for(var s=0;s<o.length;s++)n.append("<group>"),n.append(o[s]),n.append("</group>");n.append("</item></query></iq>");var d=this.session.dispatchPacket(n.toString(),"iq",a.id);return d.addCallback(this,"verifyRoster"),d},updateRosterItem:function(e,t,o){-1==e.indexOf("@")&&(e+=e+"@"+this.session.domain);var r={id:this.session.getNextIqId(),from:this.session.jid+"/"+this.session.resource,type:"set"},a=new i.string.Builder(i.xmpp.util.createElement("iq",r,!1));a.append(i.xmpp.util.createElement("query",{xmlns:"jabber:iq:roster"},!1));var n=this.session.getRosterIndex(e);if(-1!=n){var s={jid:e};t?s.name=t:this.session.roster[n].name&&(s.name=this.session.roster[n].name),s.name&&(s.name=i.xmpp.util.xmlEncode(s.name)),a.append(i.xmpp.util.createElement("item",s,!1));var d=o?o:this.session.roster[n].groups;if(d)for(var l=0;l<d.length;l++)a.append("<group>"),a.append(d[l]),a.append("</group>");a.append("</item></query></iq>");var h=this.session.dispatchPacket(a.toString(),"iq",r.id);return h.addCallback(this,"verifyRoster"),h}},verifyRoster:function(e){if("result"==e.getAttribute("type"));else{var t=this.session.processXmppError(e);this.onAddRosterItemFailed(t)}return e},addRosterItemToGroup:function(e,t){if(!e)throw new Error("Roster::addRosterItemToGroup() JID is null or undefined");if(!t)throw new Error("Roster::addRosterItemToGroup() group is null or undefined");var o=this.session.getRosterIndex(e);if(-1!=o){for(var r=this.session.roster[o],a=!1,n=0;r<r.groups.length&&!a;n++)r.groups[n]==t&&(a=!0);return a?i.xmpp.xmpp.INVALID_ID:this.updateRosterItem(e,r.name,r.groups.concat(t),o)}},removeRosterGroup:function(e){for(var t=this.session.roster,i=0;i<t.length;i++){var o=t[i];if(o.groups.length>0)for(var r=0;r<o.groups.length;r++)o.groups[r]==e&&(o.groups.splice(r,1),this.updateRosterItem(o.jid,o.name,o.groups))}},renameRosterGroup:function(e,t){for(var i=this.session.roster,o=0;o<i.length;o++){var r=i[o];if(r.groups.length>0)for(var a=0;a<r.groups.length;a++)r.groups[a]==e&&(r.groups[a]=t,this.updateRosterItem(r.jid,r.name,r.groups))}},removeRosterItemFromGroup:function(e,t){if(!e)throw new Error("Roster::addRosterItemToGroup() JID is null or undefined");if(!t)throw new Error("Roster::addRosterItemToGroup() group is null or undefined");var o=this.session.getRosterIndex(e);if(-1!=o){for(var r=this.session.roster[o],a=!1,n=0;n<r.groups.length&&!a;n++)r.groups[n]==t&&(a=!0,o=n);return 1==a?(r.groups.splice(o,1),this.updateRosterItem(e,r.name,r.groups)):i.xmpp.xmpp.INVALID_ID}},rosterItemRenameGroup:function(e,t,o){if(!e)throw new Error("Roster::rosterItemRenameGroup() JID is null or undefined");if(!o)throw new Error("Roster::rosterItemRenameGroup() group is null or undefined");var r=this.session.getRosterIndex(e);if(-1!=r){for(var a=this.session.roster[r],n=!1,s=0;s<a.groups.length&&!n;s++)a.groups[s]==t&&(a.groups[s]=o,n=!0);return 1==n?this.updateRosterItem(e,a.name,a.groups):i.xmpp.xmpp.INVALID_ID}},renameRosterItem:function(e,t){if(!e)throw new Error("Roster::addRosterItemToGroup() JID is null or undefined");if(!t)throw new Error("Roster::addRosterItemToGroup() New Name is null or undefined");var i=this.session.getRosterIndex(e);if(-1!=i)return this.updateRosterItem(e,t,this.session.roster.groups,i)},removeRosterItem:function(e){if(!e)throw new Error("Roster::addRosterItemToGroup() JID is null or undefined");var t={id:this.session.getNextIqId(),from:this.session.jid+"/"+this.session.resource,type:"set"},o=new i.string.Builder(i.xmpp.util.createElement("iq",t,!1));o.append(i.xmpp.util.createElement("query",{xmlns:"jabber:iq:roster"},!1)),-1==e.indexOf("@")&&(e+=e+"@"+this.session.domain),o.append(i.xmpp.util.createElement("item",{jid:e,subscription:"remove"},!0)),o.append("</query></iq>");var r=this.session.dispatchPacket(o.toString(),"iq",t.id);return r.addCallback(this,"verifyRoster"),r},getAvatar:function(e){},publishAvatar:function(e,t){},onVerifyRoster:function(e){},onVerifyRosterFailed:function(e){}})});//# sourceMappingURL=RosterService.js.map