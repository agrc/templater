//>>built
define("dojox/storage/WhatWGStorageProvider",["dojo","dijit","dojox","dojo/require!dojox/storage/Provider,dojox/storage/manager"],function(e,t,i){e.provide("dojox.storage.WhatWGStorageProvider"),e.require("dojox.storage.Provider"),e.require("dojox.storage.manager"),e.declare("dojox.storage.WhatWGStorageProvider",[i.storage.Provider],{initialized:!1,_domain:null,_available:null,_statusHandler:null,_allNamespaces:null,_storageEventListener:null,initialize:function(){1!=e.config.disableWhatWGStorage&&(this._domain=location.hostname,this.initialized=!0,i.storage.manager.loaded())},isAvailable:function(){try{globalStorage[location.hostname]}catch(e){return this._available=!1,this._available}return this._available=!0,this._available},put:function(t,i,a,o){if(0==this.isValidKey(t))throw new Error("Invalid key given: "+t);o=o||this.DEFAULT_NAMESPACE,t=this.getFullKey(t,o),this._statusHandler=a,i=e.isString(i)?"string:"+i:e.toJson(i);var n=e.hitch(this,function(e){window.removeEventListener("storage",n,!1),a&&a.call(null,this.SUCCESS,t,null,o)});window.addEventListener("storage",n,!1);try{globalStorage[this._domain].setItem(t,i)}catch(e){this._statusHandler.call(null,this.FAILED,t,e.toString(),o)}},get:function(t,i){if(0==this.isValidKey(t))throw new Error("Invalid key given: "+t);i=i||this.DEFAULT_NAMESPACE,t=this.getFullKey(t,i);var a=globalStorage[this._domain],o=a.getItem(t);return null==o||""==o?null:(o=o.value,o=e.isString(o)&&/^string:/.test(o)?o.substring("string:".length):e.fromJson(o))},getNamespaces:function(){for(var e=[this.DEFAULT_NAMESPACE],t={},i=globalStorage[this._domain],a=/^__([^_]*)_/,o=0;o<i.length;o++){var n=i.key(o);if(1==a.test(n)){var r=n.match(a)[1];void 0===t[r]&&(t[r]=!0,e.push(r))}}return e},getKeys:function(e){if(e=e||this.DEFAULT_NAMESPACE,0==this.isValidKey(e))throw new Error("Invalid namespace given: "+e);var t;t=e==this.DEFAULT_NAMESPACE?new RegExp("^([^_]{2}.*)$"):new RegExp("^__"+e+"_(.*)$");for(var i=globalStorage[this._domain],a=[],o=0;o<i.length;o++){var n=i.key(o);1==t.test(n)&&(n=n.match(t)[1],a.push(n))}return a},clear:function(t){if(t=t||this.DEFAULT_NAMESPACE,0==this.isValidKey(t))throw new Error("Invalid namespace given: "+t);var i;i=t==this.DEFAULT_NAMESPACE?new RegExp("^[^_]{2}"):new RegExp("^__"+t+"_");for(var a=globalStorage[this._domain],o=[],n=0;n<a.length;n++)1==i.test(a.key(n))&&(o[o.length]=a.key(n));e.forEach(o,e.hitch(a,"removeItem"))},remove:function(e,t){e=this.getFullKey(e,t),globalStorage[this._domain].removeItem(e)},isPermanent:function(){return!0},getMaximumSize:function(){return this.SIZE_NO_LIMIT},hasSettingsUI:function(){return!1},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface")},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface")},getFullKey:function(e,t){if(t=t||this.DEFAULT_NAMESPACE,0==this.isValidKey(t))throw new Error("Invalid namespace given: "+t);return t==this.DEFAULT_NAMESPACE?e:"__"+t+"_"+e}}),i.storage.manager.register("dojox.storage.WhatWGStorageProvider",new i.storage.WhatWGStorageProvider)});//# sourceMappingURL=WhatWGStorageProvider.js.map