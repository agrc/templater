//>>built
define("dojox/dtl/tag/misc",["dojo/_base/lang","dojo/_base/array","dojo/_base/connect","../_base"],function(e,t,a,i){var r=e.getObject("tag.misc",!0,i);return r.DebugNode=e.extend(function(e){this.text=e},{render:function(e,t){for(var a,i=e.getKeys(),r=[],o={},n=0;a=i[n];n++)o[a]=e[a],r+="["+a+": "+typeof e[a]+"]\n";return this.text.set(r).render(e,t,this)},unrender:function(e,t){return t},clone:function(e){return new this.constructor(this.text.clone(e))},toString:function(){return"ddtm.DebugNode"}}),r.FilterNode=e.extend(function(e,t){this._varnode=e,this._nodelist=t},{render:function(e,t){var a=this._nodelist.render(e,new dojox.string.Builder);e=e.update({"var":a.toString()});this._varnode.render(e,t);return e=e.pop(),t},unrender:function(e,t){return t},clone:function(e){return new this.constructor(this._expression,this._nodelist.clone(e))}}),r.FirstOfNode=e.extend(function(e,a){this._vars=e,this.vars=t.map(e,function(e){return new dojox.dtl._Filter(e)}),this.contents=a},{render:function(e,t){for(var a,i=0;a=this.vars[i];i++){var r=a.resolve(e);if("undefined"!=typeof r)return null===r&&(r="null"),this.contents.set(r),this.contents.render(e,t)}return this.contents.unrender(e,t)},unrender:function(e,t){return this.contents.unrender(e,t)},clone:function(e){return new this.constructor(this._vars,this.contents.clone(e))}}),r.SpacelessNode=e.extend(function(e,t){this.nodelist=e,this.contents=t},{render:function(e,t){if(t.getParent){var i=[a.connect(t,"onAddNodeComplete",this,"_watch"),a.connect(t,"onSetParent",this,"_watchParent")];t=this.nodelist.render(e,t),a.disconnect(i[0]),a.disconnect(i[1])}else{var r=this.nodelist.dummyRender(e);this.contents.set(r.replace(/>\s+</g,"><")),t=this.contents.render(e,t)}return t},unrender:function(e,t){return this.nodelist.unrender(e,t)},clone:function(e){return new this.constructor(this.nodelist.clone(e),this.contents.clone(e))},_isEmpty:function(e){return 3==e.nodeType&&!e.data.match(/[^\s\n]/)},_watch:function(e){if(this._isEmpty(e)){e.parentNode.firstChild==e&&e.parentNode.removeChild(e)}else{var t=e.parentNode.childNodes;if(1==e.nodeType&&t.length>2)for(var a,i=2;a=t[i];i++)if(1==t[i-2].nodeType&&this._isEmpty(t[i-1]))return void e.parentNode.removeChild(t[i-1])}},_watchParent:function(e){var t=e.childNodes;if(t.length)for(;e.childNodes.length;){var a=e.childNodes[e.childNodes.length-1];if(!this._isEmpty(a))return;e.removeChild(a)}}}),r.TemplateTagNode=e.extend(function(e,t){this.tag=e,this.contents=t},{mapping:{openblock:"{%",closeblock:"%}",openvariable:"{{",closevariable:"}}",openbrace:"{",closebrace:"}",opencomment:"{#",closecomment:"#}"},render:function(e,t){return this.contents.set(this.mapping[this.tag]),this.contents.render(e,t)},unrender:function(e,t){return this.contents.unrender(e,t)},clone:function(e){return new this.constructor(this.tag,this.contents.clone(e))}}),r.WidthRatioNode=e.extend(function(e,t,a,r){this.current=new i._Filter(e),this.max=new i._Filter(t),this.width=a,this.contents=r},{render:function(e,t){var a=+this.current.resolve(e),i=+this.max.resolve(e);return"number"==typeof a&&"number"==typeof i&&i?this.contents.set(""+Math.round(a/i*this.width)):this.contents.set(""),this.contents.render(e,t)},unrender:function(e,t){return this.contents.unrender(e,t)},clone:function(e){return new this.constructor(this.current.getExpression(),this.max.getExpression(),this.width,this.contents.clone(e))}}),r.WithNode=e.extend(function(e,t,a){this.target=new i._Filter(e),this.alias=t,this.nodelist=a},{render:function(e,t){var a=this.target.resolve(e);return e=e.push(),e[this.alias]=a,t=this.nodelist.render(e,t),e=e.pop(),t},unrender:function(e,t){return t},clone:function(e){return new this.constructor(this.target.getExpression(),this.alias,this.nodelist.clone(e))}}),e.mixin(r,{comment:function(e,t){return e.skip_past("endcomment"),i._noOpNode},debug:function(e,t){return new r.DebugNode(e.create_text_node())},filter:function(e,t){var a=t.contents.split(null,1)[1],i=e.create_variable_node("var|"+a),o=e.parse(["endfilter"]);return e.next_token(),new r.FilterNode(i,o)},firstof:function(e,t){var a=t.split_contents().slice(1);if(!a.length)throw new Error("'firstof' statement requires at least one argument");return new r.FirstOfNode(a,e.create_text_node())},spaceless:function(e,t){var a=e.parse(["endspaceless"]);return e.delete_first_token(),new r.SpacelessNode(a,e.create_text_node())},templatetag:function(e,t){var a=t.contents.split();if(2!=a.length)throw new Error("'templatetag' statement takes one argument");var i=a[1],o=r.TemplateTagNode.prototype.mapping;if(!o[i]){var n=[];for(var d in o)n.push(d);throw new Error("Invalid templatetag argument: '"+i+"'. Must be one of: "+n.join(", "))}return new r.TemplateTagNode(i,e.create_text_node())},widthratio:function(e,t){var a=t.contents.split();if(4!=a.length)throw new Error("widthratio takes three arguments");var i=+a[3];if("number"!=typeof i)throw new Error("widthratio final argument must be an integer");return new r.WidthRatioNode(a[1],a[2],i,e.create_text_node())},with_:function(e,t){var a=t.split_contents();if(4!=a.length||"as"!=a[2])throw new Error("do_width expected format as 'with value as name'");var i=e.parse(["endwith"]);return e.next_token(),new r.WithNode(a[1],a[3],i)}}),r});//# sourceMappingURL=misc.js.map