//>>built
define("dojox/dtl/tag/misc",["dojo/_base/lang","dojo/_base/array","dojo/_base/connect","../_base"],function(e,t,i,a){var r=e.getObject("tag.misc",!0,a);return r.DebugNode=e.extend(function(e){this.text=e},{render:function(e,t){for(var i,a=e.getKeys(),r=[],n={},o=0;i=a[o];o++)n[i]=e[i],r+="["+i+": "+typeof e[i]+"]\n";return this.text.set(r).render(e,t,this)},unrender:function(e,t){return t},clone:function(e){return new this.constructor(this.text.clone(e))},toString:function(){return"ddtm.DebugNode"}}),r.FilterNode=e.extend(function(e,t){this._varnode=e,this._nodelist=t},{render:function(e,t){var i=this._nodelist.render(e,new dojox.string.Builder);e=e.update({"var":i.toString()});this._varnode.render(e,t);return e=e.pop(),t},unrender:function(e,t){return t},clone:function(e){return new this.constructor(this._expression,this._nodelist.clone(e))}}),r.FirstOfNode=e.extend(function(e,i){this._vars=e,this.vars=t.map(e,function(e){return new dojox.dtl._Filter(e)}),this.contents=i},{render:function(e,t){for(var i,a=0;i=this.vars[a];a++){var r=i.resolve(e);if("undefined"!=typeof r)return null===r&&(r="null"),this.contents.set(r),this.contents.render(e,t)}return this.contents.unrender(e,t)},unrender:function(e,t){return this.contents.unrender(e,t)},clone:function(e){return new this.constructor(this._vars,this.contents.clone(e))}}),r.SpacelessNode=e.extend(function(e,t){this.nodelist=e,this.contents=t},{render:function(e,t){if(t.getParent){var a=[i.connect(t,"onAddNodeComplete",this,"_watch"),i.connect(t,"onSetParent",this,"_watchParent")];t=this.nodelist.render(e,t),i.disconnect(a[0]),i.disconnect(a[1])}else{var r=this.nodelist.dummyRender(e);this.contents.set(r.replace(/>\s+</g,"><")),t=this.contents.render(e,t)}return t},unrender:function(e,t){return this.nodelist.unrender(e,t)},clone:function(e){return new this.constructor(this.nodelist.clone(e),this.contents.clone(e))},_isEmpty:function(e){return 3==e.nodeType&&!e.data.match(/[^\s\n]/)},_watch:function(e){if(this._isEmpty(e)){e.parentNode.firstChild==e&&e.parentNode.removeChild(e)}else{var t=e.parentNode.childNodes;if(1==e.nodeType&&t.length>2)for(var i,a=2;i=t[a];a++)if(1==t[a-2].nodeType&&this._isEmpty(t[a-1]))return void e.parentNode.removeChild(t[a-1])}},_watchParent:function(e){var t=e.childNodes;if(t.length)for(;e.childNodes.length;){var i=e.childNodes[e.childNodes.length-1];if(!this._isEmpty(i))return;e.removeChild(i)}}}),r.TemplateTagNode=e.extend(function(e,t){this.tag=e,this.contents=t},{mapping:{openblock:"{%",closeblock:"%}",openvariable:"{{",closevariable:"}}",openbrace:"{",closebrace:"}",opencomment:"{#",closecomment:"#}"},render:function(e,t){return this.contents.set(this.mapping[this.tag]),this.contents.render(e,t)},unrender:function(e,t){return this.contents.unrender(e,t)},clone:function(e){return new this.constructor(this.tag,this.contents.clone(e))}}),r.WidthRatioNode=e.extend(function(e,t,i,r){this.current=new a._Filter(e),this.max=new a._Filter(t),this.width=i,this.contents=r},{render:function(e,t){var i=+this.current.resolve(e),a=+this.max.resolve(e);return"number"==typeof i&&"number"==typeof a&&a?this.contents.set(""+Math.round(i/a*this.width)):this.contents.set(""),this.contents.render(e,t)},unrender:function(e,t){return this.contents.unrender(e,t)},clone:function(e){return new this.constructor(this.current.getExpression(),this.max.getExpression(),this.width,this.contents.clone(e))}}),r.WithNode=e.extend(function(e,t,i){this.target=new a._Filter(e),this.alias=t,this.nodelist=i},{render:function(e,t){var i=this.target.resolve(e);return e=e.push(),e[this.alias]=i,t=this.nodelist.render(e,t),e=e.pop(),t},unrender:function(e,t){return t},clone:function(e){return new this.constructor(this.target.getExpression(),this.alias,this.nodelist.clone(e))}}),e.mixin(r,{comment:function(e,t){return e.skip_past("endcomment"),a._noOpNode},debug:function(e,t){return new r.DebugNode(e.create_text_node())},filter:function(e,t){var i=t.contents.split(null,1)[1],a=e.create_variable_node("var|"+i),n=e.parse(["endfilter"]);return e.next_token(),new r.FilterNode(a,n)},firstof:function(e,t){var i=t.split_contents().slice(1);if(!i.length)throw new Error("'firstof' statement requires at least one argument");return new r.FirstOfNode(i,e.create_text_node())},spaceless:function(e,t){var i=e.parse(["endspaceless"]);return e.delete_first_token(),new r.SpacelessNode(i,e.create_text_node())},templatetag:function(e,t){var i=t.contents.split();if(2!=i.length)throw new Error("'templatetag' statement takes one argument");var a=i[1],n=r.TemplateTagNode.prototype.mapping;if(!n[a]){var o=[];for(var d in n)o.push(d);throw new Error("Invalid templatetag argument: '"+a+"'. Must be one of: "+o.join(", "))}return new r.TemplateTagNode(a,e.create_text_node())},widthratio:function(e,t){var i=t.contents.split();if(4!=i.length)throw new Error("widthratio takes three arguments");var a=+i[3];if("number"!=typeof a)throw new Error("widthratio final argument must be an integer");return new r.WidthRatioNode(i[1],i[2],a,e.create_text_node())},with_:function(e,t){var i=t.split_contents();if(4!=i.length||"as"!=i[2])throw new Error("do_width expected format as 'with value as name'");var a=e.parse(["endwith"]);return e.next_token(),new r.WithNode(i[1],i[3],a)}}),r});//# sourceMappingURL=misc.js.map