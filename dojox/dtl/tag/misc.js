//>>built
define("dojox/dtl/tag/misc",["dojo/_base/lang","dojo/_base/array","dojo/_base/connect","../_base"],function(e,t,i,r){var a=e.getObject("tag.misc",!0,r);return a.DebugNode=e.extend(function(e){this.text=e},{render:function(e,t){for(var i,r=e.getKeys(),a=[],n={},o=0;i=r[o];o++)n[i]=e[i],a+="["+i+": "+typeof e[i]+"]\n";return this.text.set(a).render(e,t,this)},unrender:function(e,t){return t},clone:function(e){return new this.constructor(this.text.clone(e))},toString:function(){return"ddtm.DebugNode"}}),a.FilterNode=e.extend(function(e,t){this._varnode=e,this._nodelist=t},{render:function(e,t){var i=this._nodelist.render(e,new dojox.string.Builder);e=e.update({"var":i.toString()});this._varnode.render(e,t);return e=e.pop(),t},unrender:function(e,t){return t},clone:function(e){return new this.constructor(this._expression,this._nodelist.clone(e))}}),a.FirstOfNode=e.extend(function(e,i){this._vars=e,this.vars=t.map(e,function(e){return new dojox.dtl._Filter(e)}),this.contents=i},{render:function(e,t){for(var i,r=0;i=this.vars[r];r++){var a=i.resolve(e);if("undefined"!=typeof a)return null===a&&(a="null"),this.contents.set(a),this.contents.render(e,t)}return this.contents.unrender(e,t)},unrender:function(e,t){return this.contents.unrender(e,t)},clone:function(e){return new this.constructor(this._vars,this.contents.clone(e))}}),a.SpacelessNode=e.extend(function(e,t){this.nodelist=e,this.contents=t},{render:function(e,t){if(t.getParent){var r=[i.connect(t,"onAddNodeComplete",this,"_watch"),i.connect(t,"onSetParent",this,"_watchParent")];t=this.nodelist.render(e,t),i.disconnect(r[0]),i.disconnect(r[1])}else{var a=this.nodelist.dummyRender(e);this.contents.set(a.replace(/>\s+</g,"><")),t=this.contents.render(e,t)}return t},unrender:function(e,t){return this.nodelist.unrender(e,t)},clone:function(e){return new this.constructor(this.nodelist.clone(e),this.contents.clone(e))},_isEmpty:function(e){return 3==e.nodeType&&!e.data.match(/[^\s\n]/)},_watch:function(e){if(this._isEmpty(e)){e.parentNode.firstChild==e&&e.parentNode.removeChild(e)}else{var t=e.parentNode.childNodes;if(1==e.nodeType&&t.length>2)for(var i,r=2;i=t[r];r++)if(1==t[r-2].nodeType&&this._isEmpty(t[r-1]))return void e.parentNode.removeChild(t[r-1])}},_watchParent:function(e){var t=e.childNodes;if(t.length)for(;e.childNodes.length;){var i=e.childNodes[e.childNodes.length-1];if(!this._isEmpty(i))return;e.removeChild(i)}}}),a.TemplateTagNode=e.extend(function(e,t){this.tag=e,this.contents=t},{mapping:{openblock:"{%",closeblock:"%}",openvariable:"{{",closevariable:"}}",openbrace:"{",closebrace:"}",opencomment:"{#",closecomment:"#}"},render:function(e,t){return this.contents.set(this.mapping[this.tag]),this.contents.render(e,t)},unrender:function(e,t){return this.contents.unrender(e,t)},clone:function(e){return new this.constructor(this.tag,this.contents.clone(e))}}),a.WidthRatioNode=e.extend(function(e,t,i,a){this.current=new r._Filter(e),this.max=new r._Filter(t),this.width=i,this.contents=a},{render:function(e,t){var i=+this.current.resolve(e),r=+this.max.resolve(e);return"number"==typeof i&&"number"==typeof r&&r?this.contents.set(""+Math.round(i/r*this.width)):this.contents.set(""),this.contents.render(e,t)},unrender:function(e,t){return this.contents.unrender(e,t)},clone:function(e){return new this.constructor(this.current.getExpression(),this.max.getExpression(),this.width,this.contents.clone(e))}}),a.WithNode=e.extend(function(e,t,i){this.target=new r._Filter(e),this.alias=t,this.nodelist=i},{render:function(e,t){var i=this.target.resolve(e);return e=e.push(),e[this.alias]=i,t=this.nodelist.render(e,t),e=e.pop(),t},unrender:function(e,t){return t},clone:function(e){return new this.constructor(this.target.getExpression(),this.alias,this.nodelist.clone(e))}}),e.mixin(a,{comment:function(e,t){return e.skip_past("endcomment"),r._noOpNode},debug:function(e,t){return new a.DebugNode(e.create_text_node())},filter:function(e,t){var i=t.contents.split(null,1)[1],r=e.create_variable_node("var|"+i),n=e.parse(["endfilter"]);return e.next_token(),new a.FilterNode(r,n)},firstof:function(e,t){var i=t.split_contents().slice(1);if(!i.length)throw new Error("'firstof' statement requires at least one argument");return new a.FirstOfNode(i,e.create_text_node())},spaceless:function(e,t){var i=e.parse(["endspaceless"]);return e.delete_first_token(),new a.SpacelessNode(i,e.create_text_node())},templatetag:function(e,t){var i=t.contents.split();if(2!=i.length)throw new Error("'templatetag' statement takes one argument");var r=i[1],n=a.TemplateTagNode.prototype.mapping;if(!n[r]){var o=[];for(var s in n)o.push(s);throw new Error("Invalid templatetag argument: '"+r+"'. Must be one of: "+o.join(", "))}return new a.TemplateTagNode(r,e.create_text_node())},widthratio:function(e,t){var i=t.contents.split();if(4!=i.length)throw new Error("widthratio takes three arguments");var r=+i[3];if("number"!=typeof r)throw new Error("widthratio final argument must be an integer");return new a.WidthRatioNode(i[1],i[2],r,e.create_text_node())},with_:function(e,t){var i=t.split_contents();if(4!=i.length||"as"!=i[2])throw new Error("do_width expected format as 'with value as name'");var r=e.parse(["endwith"]);return e.next_token(),new a.WithNode(i[1],i[3],r)}}),a});//# sourceMappingURL=misc.js.map