//>>built
define("dojox/dtl/tag/loop",["dojo/_base/lang","dojo/_base/array","dojo/_base/json","../_base","dojox/string/tokenize"],function(e,t,a,i,r){var o=e.getObject("tag.loop",!0,i);return o.CycleNode=e.extend(function(e,t,a,i){this.cyclevars=e,this.name=t,this.contents=a,this.shared=i||{counter:-1,map:{}}},{render:function(e,t){e.forloop&&!e.forloop.counter0&&(this.shared.counter=-1),++this.shared.counter;var a=this.cyclevars[this.shared.counter%this.cyclevars.length],r=this.shared.map;return r[a]||(r[a]=new i._Filter(a)),a=r[a].resolve(e,t),this.name&&(e[this.name]=a),this.contents.set(a),this.contents.render(e,t)},unrender:function(e,t){return this.contents.unrender(e,t)},clone:function(e){return new this.constructor(this.cyclevars,this.name,this.contents.clone(e),this.shared)}}),o.IfChangedNode=e.extend(function(e,a,i){this.nodes=e,this._vars=a,this.shared=i||{last:null,counter:0},this.vars=t.map(a,function(e){return new dojox.dtl._Filter(e)})},{render:function(e,i){e.forloop&&(e.forloop.counter<=this.shared.counter&&(this.shared.last=null),this.shared.counter=e.forloop.counter);var r;if((r=this.vars.length?a.toJson(t.map(this.vars,function(t){return t.resolve(e)})):this.nodes.dummyRender(e,i))!=this.shared.last){var o=null===this.shared.last;this.shared.last=r,e=e.push(),e.ifchanged={firstloop:o},i=this.nodes.render(e,i),e=e.pop()}else i=this.nodes.unrender(e,i);return i},unrender:function(e,t){return this.nodes.unrender(e,t)},clone:function(e){return new this.constructor(this.nodes.clone(e),this._vars,this.shared)}}),o.RegroupNode=e.extend(function(e,t,a){this._expression=e,this.expression=new i._Filter(e),this.key=t,this.alias=a},{_push:function(e,t,a){a.length&&e.push({grouper:t,list:a})},render:function(e,t){e[this.alias]=[];var a=this.expression.resolve(e);if(a){for(var i=null,r=[],o=0;o<a.length;o++){var n=a[o][this.key];i!==n?(this._push(e[this.alias],i,r),i=n,r=[a[o]]):r.push(a[o])}this._push(e[this.alias],i,r)}return t},unrender:function(e,t){return t},clone:function(e,t){return this}}),e.mixin(o,{cycle:function(e,t){var a=t.split_contents();if(a.length<2)throw new Error("'cycle' tag requires at least two arguments");if(-1!=a[1].indexOf(",")){var i=a[1].split(",");a=[a[0]];for(var r=0;r<i.length;r++)a.push('"'+i[r]+'"')}if(2==a.length){var n=a[a.length-1];if(!e._namedCycleNodes)throw new Error("No named cycles in template: '"+n+"' is not defined");if(!e._namedCycleNodes[n])throw new Error("Named cycle '"+n+"' does not exist");return e._namedCycleNodes[n]}if(a.length>4&&"as"==a[a.length-2]){var n=a[a.length-1],d=new o.CycleNode(a.slice(1,a.length-2),n,e.create_text_node());e._namedCycleNodes||(e._namedCycleNodes={}),e._namedCycleNodes[n]=d}else d=new o.CycleNode(a.slice(1),null,e.create_text_node());return d},ifchanged:function(e,t){var a=t.contents.split(),i=e.parse(["endifchanged"]);return e.delete_first_token(),new o.IfChangedNode(i,a.slice(1))},regroup:function(e,t){var a=r(t.contents,/(\s+)/g,function(e){return e});if(a.length<11||"as"!=a[a.length-3]||"by"!=a[a.length-7])throw new Error("Expected the format: regroup list by key as newList");var i=a.slice(2,-8).join(""),n=a[a.length-5],d=a[a.length-1];return new o.RegroupNode(i,n,d)}}),o});//# sourceMappingURL=loop.js.map