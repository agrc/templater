//>>built
define("dojox/dtl/tag/loop",["dojo/_base/lang","dojo/_base/array","dojo/_base/json","../_base","dojox/string/tokenize"],function(e,t,i,a,r){var n=e.getObject("tag.loop",!0,a);return n.CycleNode=e.extend(function(e,t,i,a){this.cyclevars=e,this.name=t,this.contents=i,this.shared=a||{counter:-1,map:{}}},{render:function(e,t){e.forloop&&!e.forloop.counter0&&(this.shared.counter=-1),++this.shared.counter;var i=this.cyclevars[this.shared.counter%this.cyclevars.length],r=this.shared.map;return r[i]||(r[i]=new a._Filter(i)),i=r[i].resolve(e,t),this.name&&(e[this.name]=i),this.contents.set(i),this.contents.render(e,t)},unrender:function(e,t){return this.contents.unrender(e,t)},clone:function(e){return new this.constructor(this.cyclevars,this.name,this.contents.clone(e),this.shared)}}),n.IfChangedNode=e.extend(function(e,i,a){this.nodes=e,this._vars=i,this.shared=a||{last:null,counter:0},this.vars=t.map(i,function(e){return new dojox.dtl._Filter(e)})},{render:function(e,a){e.forloop&&(e.forloop.counter<=this.shared.counter&&(this.shared.last=null),this.shared.counter=e.forloop.counter);var r;if(r=this.vars.length?i.toJson(t.map(this.vars,function(t){return t.resolve(e)})):this.nodes.dummyRender(e,a),r!=this.shared.last){var n=null===this.shared.last;this.shared.last=r,e=e.push(),e.ifchanged={firstloop:n},a=this.nodes.render(e,a),e=e.pop()}else a=this.nodes.unrender(e,a);return a},unrender:function(e,t){return this.nodes.unrender(e,t)},clone:function(e){return new this.constructor(this.nodes.clone(e),this._vars,this.shared)}}),n.RegroupNode=e.extend(function(e,t,i){this._expression=e,this.expression=new a._Filter(e),this.key=t,this.alias=i},{_push:function(e,t,i){i.length&&e.push({grouper:t,list:i})},render:function(e,t){e[this.alias]=[];var i=this.expression.resolve(e);if(i){for(var a=null,r=[],n=0;n<i.length;n++){var o=i[n][this.key];a!==o?(this._push(e[this.alias],a,r),a=o,r=[i[n]]):r.push(i[n])}this._push(e[this.alias],a,r)}return t},unrender:function(e,t){return t},clone:function(e,t){return this}}),e.mixin(n,{cycle:function(e,t){var i=t.split_contents();if(i.length<2)throw new Error("'cycle' tag requires at least two arguments");if(-1!=i[1].indexOf(",")){var a=i[1].split(",");i=[i[0]];for(var r=0;r<a.length;r++)i.push('"'+a[r]+'"')}if(2==i.length){var o=i[i.length-1];if(!e._namedCycleNodes)throw new Error("No named cycles in template: '"+o+"' is not defined");if(!e._namedCycleNodes[o])throw new Error("Named cycle '"+o+"' does not exist");return e._namedCycleNodes[o]}if(i.length>4&&"as"==i[i.length-2]){var o=i[i.length-1],s=new n.CycleNode(i.slice(1,i.length-2),o,e.create_text_node());e._namedCycleNodes||(e._namedCycleNodes={}),e._namedCycleNodes[o]=s}else s=new n.CycleNode(i.slice(1),null,e.create_text_node());return s},ifchanged:function(e,t){var i=t.contents.split(),a=e.parse(["endifchanged"]);return e.delete_first_token(),new n.IfChangedNode(a,i.slice(1))},regroup:function(e,t){var i=r(t.contents,/(\s+)/g,function(e){return e});if(i.length<11||"as"!=i[i.length-3]||"by"!=i[i.length-7])throw new Error("Expected the format: regroup list by key as newList");var a=i.slice(2,-8).join(""),o=i[i.length-5],s=i[i.length-1];return new n.RegroupNode(a,o,s)}}),n});//# sourceMappingURL=loop.js.map