//>>built
define("dojox/dtl/tag/loader",["dojo/_base/lang","../_base","dojo/_base/array","dojo/_base/connect"],function(e,t,a,i){var r=e.getObject("tag.loader",!0,t);return r.BlockNode=e.extend(function(e,t){this.name=e,this.nodelist=t},{"super":function(){if(this.parent){var e=this.parent.nodelist.dummyRender(this.context,null,!0);return"string"==typeof e&&(e=new String(e)),e.safe=!0,e}return""},render:function(e,t){var a,r=this.name,o=this.nodelist;if(t.blocks){var n=t.blocks[r];n&&(a=n.parent,o=n.nodelist,n.used=!0)}if(this.rendered=o,e=e.push(),this.context=e,this.parent=null,o!=this.nodelist&&(this.parent=this),e.block=this,t.getParent)var d=t.getParent(),s=i.connect(t,"onSetParent",function(e,a,i){a&&i&&t.setParent(d)});return t=o.render(e,t,this),s&&i.disconnect(s),e=e.pop(),t},unrender:function(e,t){return this.rendered.unrender(e,t)},clone:function(e){return new this.constructor(this.name,this.nodelist.clone(e))},toString:function(){return"dojox.dtl.tag.loader.BlockNode"}}),r.ExtendsNode=e.extend(function(e,t,a,i,r){this.getTemplate=e,this.nodelist=t,this.shared=a,this.parent=i,this.key=r},{parents:{},getParent:function(e){var t=this.parent;if(!t){var a;if(t=this.parent=e.get(this.key,!1),!t)throw new Error("extends tag used a variable that did not resolve");if("object"==typeof t){var i=t.url||t.templatePath;t.shared&&(this.shared=!0),i?t=this.parent=i.toString():t.templateString?(a=t.templateString,t=this.parent=" "):t=this.parent=this.parent.toString()}t&&0===t.indexOf("shared:")&&(this.shared=!0,t=this.parent=t.substring(7,t.length))}if(!t)throw new Error("Invalid template name in 'extends' tag.");return t.render?t:this.parents[t]?this.parents[t]:(this.parent=this.getTemplate(a||dojox.dtl.text.getTemplateString(t)),this.shared&&(this.parents[t]=this.parent),this.parent)},render:function(e,t){var a=this.getParent(e);a.blocks=a.blocks||{},t.blocks=t.blocks||{};for(var i,r=0;i=this.nodelist.contents[r];r++)if(i instanceof dojox.dtl.tag.loader.BlockNode){var o=a.blocks[i.name];o&&o.nodelist!=i.nodelist&&(t=o.nodelist.unrender(e,t)),a.blocks[i.name]=t.blocks[i.name]={shared:this.shared,nodelist:i.nodelist,used:!1}}return this.rendered=a,a.nodelist.render(e,t,this)},unrender:function(e,t){return this.rendered.unrender(e,t,this)},toString:function(){return"dojox.dtl.block.ExtendsNode"}}),r.IncludeNode=e.extend(function(e,a,i,r,o){this._path=e,this.constant=a,this.path=a?e:new t._Filter(e),this.getTemplate=i,this.text=r,this.parsed=5==arguments.length?o:!0},{_cache:[{},{}],render:function(e,a){var i=(this.constant?this.path:this.path.resolve(e)).toString(),r=Number(this.parsed),o=!1;i!=this.last&&(o=!0,this.last&&(a=this.unrender(e,a)),this.last=i);var n=this._cache[r];if(r){if(n[i]||(n[i]=t.text._resolveTemplateArg(i,!0)),o){var d=this.getTemplate(n[i]);this.rendered=d.nodelist}return this.rendered.render(e,a,this)}if(this.text instanceof t._TextNode)return o&&(this.rendered=this.text,this.rendered.set(t.text._resolveTemplateArg(i,!0))),this.rendered.render(e,a);if(!n[i]){var s=[],l=document.createElement("div");l.innerHTML=t.text._resolveTemplateArg(i,!0);for(var m=l.childNodes;m.length;){var u=l.removeChild(m[0]);s.push(u)}n[i]=s}if(o){this.nodelist=[];for(var h,c=0;h=n[i][c];c++)this.nodelist.push(h.cloneNode(!0))}for(var f,c=0;f=this.nodelist[c];c++)a=a.concat(f);return a},unrender:function(e,t){if(this.rendered&&(t=this.rendered.unrender(e,t)),this.nodelist)for(var a,i=0;a=this.nodelist[i];i++)t=t.remove(a);return t},clone:function(e){return new this.constructor(this._path,this.constant,this.getTemplate,this.text.clone(e),this.parsed)}}),e.mixin(r,{block:function(e,t){var a=t.contents.split(),i=a[1];e._blocks=e._blocks||{},e._blocks[i]=e._blocks[i]||[],e._blocks[i].push(i);var r=e.parse(["endblock","endblock "+i]).rtrim();return e.next_token(),new dojox.dtl.tag.loader.BlockNode(i,r)},extends_:function(e,t){var a=t.contents.split(),i=!1,r=null,o=null;'"'==a[1].charAt(0)||"'"==a[1].charAt(0)?r=a[1].substring(1,a[1].length-1):o=a[1],r&&0==r.indexOf("shared:")&&(i=!0,r=r.substring(7,r.length));var n=e.parse();return new dojox.dtl.tag.loader.ExtendsNode(e.getTemplate,n,i,r,o)},include:function(e,t){var a=t.contents.split();if(2!=a.length)throw new Error(a[0]+" tag takes one argument: the name of the template to be included");var i=a[1],o=!1;return'"'!=i.charAt(0)&&"'"!=i.slice(-1)||i.charAt(0)!=i.slice(-1)||(i=i.slice(1,-1),o=!0),new r.IncludeNode(i,o,e.getTemplate,e.create_text_node())},ssi:function(e,a){var i=a.contents.split(),o=!1;if(3==i.length&&(o="parsed"==i.pop(),!o))throw new Error("Second (optional) argument to ssi tag must be 'parsed'");var n=r.include(e,new t.Token(a.token_type,i.join(" ")));return n.parsed=o,n}}),r});//# sourceMappingURL=loader.js.map