//>>built
define("dojox/image/ThumbnailPicker",["dojo","dijit","dojox","dojo/require!dojox/fx/scroll,dojo/fx/easing,dojo/fx,dijit/_Widget,dijit/_Templated"],function(e,t,i){e.provide("dojox.image.ThumbnailPicker"),e.experimental("dojox.image.ThumbnailPicker"),e.require("dojox.fx.scroll"),e.require("dojo.fx.easing"),e.require("dojo.fx"),e.require("dijit._Widget"),e.require("dijit._Templated"),e.declare("dojox.image.ThumbnailPicker",[t._Widget,t._Templated],{imageStore:null,request:null,size:500,thumbHeight:75,thumbWidth:100,useLoadNotifier:!1,useHyperlink:!1,hyperlinkTarget:"new",isClickable:!0,isScrollable:!0,isHorizontal:!0,autoLoad:!0,linkAttr:"link",imageThumbAttr:"imageUrlThumb",imageLargeAttr:"imageUrl",pageSize:20,titleAttr:"title",templateString:e.cache("dojox.image","resources/ThumbnailPicker.html",'<div dojoAttachPoint="outerNode" class="thumbOuter">\n	<div dojoAttachPoint="navPrev" class="thumbNav thumbClickable">\n	  <img src="" dojoAttachPoint="navPrevImg"/>    \n	</div>\n	<div dojoAttachPoint="thumbScroller" class="thumbScroller">\n	  <div dojoAttachPoint="thumbsNode" class="thumbWrapper"></div>\n	</div>\n	<div dojoAttachPoint="navNext" class="thumbNav thumbClickable">\n	  <img src="" dojoAttachPoint="navNextImg"/>  \n	</div>\n</div>'),_thumbs:[],_thumbIndex:0,_maxPhotos:0,_loadedImages:{},baseClass:"ThumbnailPicker",cellClass:"Thumbnail",postCreate:function(){this.inherited(arguments),this.pageSize=Number(this.pageSize),this._scrollerSize=this.size-102;var t=this._sizeProperty=this.isHorizontal?"width":"height";e.style(this.outerNode,"textAlign","center"),e.style(this.outerNode,t,this.size+"px"),e.style(this.thumbScroller,t,this._scrollerSize+"px"),this.useHyperlink&&e.subscribe(this.getClickTopicName(),this,function(e){var t=(e.index,this.imageStore.getValue(e.data,this.linkAttr));t&&("new"==this.hyperlinkTarget?window.open(t):window.location=t)}),this.isClickable&&e.addClass(this.thumbsNode,"thumbClickable"),this._totalSize=0;var i=this.isHorizontal?"Horiz":"Vert";e.addClass(this.navPrev,"prev"+i),e.addClass(this.navNext,"next"+i),e.addClass(this.thumbsNode,"thumb"+i),e.addClass(this.outerNode,"thumb"+i),e.attr(this.navNextImg,"src",this._blankGif),e.attr(this.navPrevImg,"src",this._blankGif),this.connect(this.navPrev,"onclick","_prev"),this.connect(this.navNext,"onclick","_next"),this.isHorizontal?(this._sizeAttr="offsetWidth",this._scrollAttr="scrollLeft"):(this._sizeAttr="offsetHeight",this._scrollAttr="scrollTop"),this._updateNavControls(),this.init()},init:function(){return this.isInitialized?!1:(this.isInitialized=!0,this.imageStore&&this.request&&this._loadNextPage(),!0)},getClickTopicName:function(){return this.id+"/select"},getShowTopicName:function(){return this.id+"/show"},setDataStore:function(t,i,r){this.reset(),this.request={query:{},start:i.start||0,count:i.count||10,onBegin:e.hitch(this,function(e){this._maxPhotos=e})},i.query&&e.mixin(this.request.query,i.query),r&&e.forEach(["imageThumbAttr","imageLargeAttr","linkAttr","titleAttr"],function(e){r[e]&&(this[e]=r[e])},this),this.request.start=0,this.request.count=this.pageSize,this.imageStore=t,this._loadInProgress=!1,this.init()||this._loadNextPage()},reset:function(){this._loadedImages={},e.forEach(this._thumbs,function(t){t&&t.parentNode&&e.destroy(t)}),this._thumbs=[],this.isInitialized=!1,this._noImages=!0},isVisible:function(e){var t=this._thumbs[e];if(!t)return!1;var i=this.isHorizontal?"offsetLeft":"offsetTop",r=this.isHorizontal?"offsetWidth":"offsetHeight",a=this.isHorizontal?"scrollLeft":"scrollTop",o=t[i]-this.thumbsNode[i];return o>=this.thumbScroller[a]&&o+t[r]<=this.thumbScroller[a]+this._scrollerSize},resize:function(t){var i=this.isHorizontal?"w":"h",r=0;this._thumbs.length>0&&0==e.marginBox(this._thumbs[0]).w||(e.forEach(this._thumbs,e.hitch(this,function(t){var a=e.marginBox(t.firstChild),o=a[i];r+=Number(o)+10,this.useLoadNotifier&&a.w>0&&e.style(t.lastChild,"width",a.w-4+"px"),e.style(t,"width",a.w+"px")})),e.style(this.thumbsNode,this._sizeProperty,r+"px"),this._updateNavControls())},_next:function(){for(var e,t=this.isHorizontal?"offsetLeft":"offsetTop",i=this.isHorizontal?"offsetWidth":"offsetHeight",r=this.thumbsNode[t],a=this._thumbs[this._thumbIndex],o=a[t]-r,n=this._thumbIndex+1;n<this._thumbs.length;n++)if(e=this._thumbs[n],e[t]-r+e[i]-o>this._scrollerSize)return void this._showThumbs(n)},_prev:function(){if(0!=this.thumbScroller[this.isHorizontal?"scrollLeft":"scrollTop"]){for(var e,t=this.isHorizontal?"offsetLeft":"offsetTop",i=(this.isHorizontal?"offsetWidth":"offsetHeight",this._thumbs[this._thumbIndex]),r=i[t]-this.thumbsNode[t],a=this._thumbIndex-1;a>-1;a--)if(e=this._thumbs[a],r-e[t]>this._scrollerSize)return void this._showThumbs(a+1);this._showThumbs(0)}},_checkLoad:function(t,i){e.publish(this.getShowTopicName(),[{index:i}]),this._updateNavControls(),this._loadingImages={},this._thumbIndex=i,this.thumbsNode.offsetWidth-t.offsetLeft<2*this._scrollerSize&&this._loadNextPage()},_showThumbs:function(t){if(t=Math.min(Math.max(t,0),this._maxPhotos),!(t>=this._maxPhotos)){var r=this._thumbs[t];if(r){var a=r.offsetLeft-this.thumbsNode.offsetLeft,o=r.offsetTop-this.thumbsNode.offsetTop,n=this.isHorizontal?a:o;if(!(n>=this.thumbScroller[this._scrollAttr]&&n+r[this._sizeAttr]<=this.thumbScroller[this._scrollAttr]+this._scrollerSize))if(this.isScrollable){var s=this.isHorizontal?{x:a,y:0}:{x:0,y:o};i.fx.smoothScroll({target:s,win:this.thumbScroller,duration:300,easing:e.fx.easing.easeOut,onEnd:e.hitch(this,"_checkLoad",r,t)}).play(10)}else this.isHorizontal?this.thumbScroller.scrollLeft=a:this.thumbScroller.scrollTop=o,this._checkLoad(r,t)}}},markImageLoaded:function(t){var i=e.byId("loadingDiv_"+this.id+"_"+t);i&&this._setThumbClass(i,"thumbLoaded"),this._loadedImages[t]=!0},_setThumbClass:function(t,i){this.autoLoad&&e.addClass(t,i)},_loadNextPage:function(){if(!this._loadInProgress){this._loadInProgress=!0;for(var t=this.request.start+(this._noImages?0:this.pageSize),i=t;i<this._thumbs.length&&this._thumbs[i];)i++;var r=this.imageStore,a=function(t,a){if(r==this.imageStore)if(t&&t.length){var o=0,n=e.hitch(this,function(){if(o>=t.length)return void(this._loadInProgress=!1);var e=o++;this._loadImage(t[e],i+e,n)});n(),this._updateNavControls()}else this._loadInProgress=!1},o=function(){this._loadInProgress=!1};this.request.onComplete=e.hitch(this,a),this.request.onError=e.hitch(this,o),this.request.start=t,this._noImages=!1,this.imageStore.fetch(this.request)}},_loadImage:function(t,i,r){var a=this.imageStore,o=a.getValue(t,this.imageThumbAttr),n=e.create("div",{id:"img_"+this.id+"_"+i,"class":this.cellClass}),s=e.create("img",{},n);s._index=i,s._data=t,this._thumbs[i]=n;var l;this.useLoadNotifier&&(l=e.create("div",{id:"loadingDiv_"+this.id+"_"+i},n),this._setThumbClass(l,this._loadedImages[i]?"thumbLoaded":"thumbNotifier"));var d,u,c=e.marginBox(this.thumbsNode);this.isHorizontal?(d=this.thumbWidth,u="w"):(d=this.thumbHeight,u="h"),c=c[u];var h=this.thumbScroller.scrollLeft,f=this.thumbScroller.scrollTop;e.style(this.thumbsNode,this._sizeProperty,c+d+20+"px"),this.thumbScroller.scrollLeft=h,this.thumbScroller.scrollTop=f,this.thumbsNode.appendChild(n),e.connect(s,"onload",this,e.hitch(this,function(){return a!=this.imageStore?!1:(this.resize(),setTimeout(r,0),!1)})),e.connect(s,"onclick",this,function(i){return e.publish(this.getClickTopicName(),[{index:i.target._index,data:i.target._data,url:s.getAttribute("src"),largeUrl:this.imageStore.getValue(t,this.imageLargeAttr),title:this.imageStore.getValue(t,this.titleAttr),link:this.imageStore.getValue(t,this.linkAttr)}]),e.query("."+this.cellClass,this.thumbsNode).removeClass(this.cellClass+"Selected"),e.addClass(i.target.parentNode,this.cellClass+"Selected"),!1}),e.addClass(s,"imageGalleryThumb"),s.setAttribute("src",o);var m=this.imageStore.getValue(t,this.titleAttr);m&&s.setAttribute("title",m),this._updateNavControls()},_updateNavControls:function(){var t=function(t,i){var r=i?"addClass":"removeClass";e[r](t,"enabled"),e[r](t,"thumbClickable")},i=this.isHorizontal?"scrollLeft":"scrollTop",r=this.isHorizontal?"offsetWidth":"offsetHeight";t(this.navPrev,this.thumbScroller[i]>0);var a=this.thumbScroller[i]+this._scrollerSize<this.thumbsNode[r];t(this.navNext,a)}})});//# sourceMappingURL=ThumbnailPicker.js.map