//>>built
define("dojox/image/LightboxNano",["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/_base/fx","dojo/dom","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/dom-class","dojo/on","dojo/query","dojo/fx"],function(e,t,a,i,r,o,n,s,l,d,c,h){var u="absolute",m="visibility";return getViewport=function(){var e="BackCompat"==document.compatMode?document.body:document.documentElement,t=n.docScroll();return{w:e.clientWidth,h:e.clientHeight,l:t.x,t:t.y}},t("dojox.image.LightboxNano",null,{href:"",duration:500,preloadDelay:5e3,constructor:function(t,a){var i,n=this;e.mixin(n,t),a=n._node=r.byId(a),a&&(/a/i.test(a.tagName)||(i=o.create("a",{href:n.href,"class":a.className},a,"after"),a.className="",i.appendChild(a),a=i),s.set(a,"position","relative"),o.create("div",{"class":"nano-enlarge",style:{position:"absolute",display:"none"}},a),r.setSelectable(a,!1),n._onClickEvt=d(a,"click",e.hitch(n,"_load"))),n.href&&setTimeout(function(){(new Image).src=n.href,n._hideLoading()},n.preloadDelay)},destroy:function(){var e=this._connects||[];e.push(this._onClickEvt),a.forEach(e,function(e){e.remove()}),o.destroy(this._node)},_load:function(t){var a=this;if(t&&t.preventDefault(),!a._loading){a._loading=!0,a._reset();var i,r=a._img=o.create("img",{"class":"nano-image nano-image-hidden"},document.body),l=a._loadingNode,h=c("img",a._node)[0]||a._node,u=n.position(h,!0),m=n.getContentBox(h),f=n.getBorderExtents(h);null==l&&(a._loadingNode=l=o.create("div",{"class":"nano-loading",style:{position:"absolute",display:""}},a._node,"after"),i=n.getMarginBox(l),s.set(l,{left:parseInt((m.w-i.w)/2)+"px",top:parseInt((m.h-i.h)/2)+"px"})),m.x=u.x-10+f.l,m.y=u.y-10+f.t,a._start=m,a._connects=[d(r,"load",e.hitch(a,"_show"))],r.src=a.href}},_hideLoading:function(){this._loadingNode&&s.set(this._loadingNode,"display","none"),this._loadingNode=!1},_show:function(){var t=this,a=getViewport(),i=t._img.width,r=t._img.height,n=parseInt(.9*(a.w-20)),c=parseInt(.9*(a.h-20)),u=t._bg=o.create("div",{"class":"nano-background",style:{opacity:0}},document.body);t._loadingNode&&t._hideLoading(),l.remove(t._img,"nano-image-hidden"),s.set(t._node,m,"hidden"),t._loading=!1,t._connects=t._connects.concat([d(document,"mousedown",e.hitch(t,"_hide")),d(document,"keypress",e.hitch(t,"_key")),d(window,"resize",e.hitch(t,"_sizeBg"))]),i>n&&(r=r*n/i,i=n),r>c&&(i=i*c/r,r=c),t._end={x:(a.w-20-i)/2+a.l,y:(a.h-20-r)/2+a.t,w:i,h:r},t._sizeBg(),h.combine([t._anim(t._img,t._coords(t._start,t._end)),t._anim(u,{opacity:.5})]).play()},_sizeBg:function(){var e=document.documentElement;s.set(this._bg,{top:0,left:0,width:e.scrollWidth+"px",height:e.scrollHeight+"px"})},_key:function(e){e.preventDefault(),this._hide()},_coords:function(e,t){return{left:{start:e.x,end:t.x},top:{start:e.y,end:t.y},width:{start:e.w,end:t.w},height:{start:e.h,end:t.h}}},_hide:function(){var e=this;a.forEach(e._connects,function(e){e.remove()}),e._connects=[],h.combine([e._anim(e._img,e._coords(e._end,e._start),"_reset"),e._anim(e._bg,{opacity:0})]).play()},_reset:function(){s.set(this._node,m,"visible"),o.destroy(this._img),o.destroy(this._bg),this._img=this._bg=null,this._node.focus()},_anim:function(t,a,r){return i.animateProperty({node:t,duration:this.duration,properties:a,onEnd:r?e.hitch(this,r):null})},show:function(e){e=e||{},this.href=e.href||this.href;var t=r.byId(e.origin),a=getViewport();this._node=t||o.create("div",{style:{position:u,width:0,hieght:0,left:a.l+a.w/2+"px",top:a.t+a.h/2+"px"}},document.body),this._load(),t||o.destroy(this._node)}})});//# sourceMappingURL=LightboxNano.js.map