//>>built
define("dojox/image/LightboxNano",["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/_base/fx","dojo/dom","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/dom-class","dojo/on","dojo/query","dojo/fx"],function(e,t,i,a,o,r,n,s,d,l,h,c){var u="absolute",m="visibility";return getViewport=function(){var e="BackCompat"==document.compatMode?document.body:document.documentElement,t=n.docScroll();return{w:e.clientWidth,h:e.clientHeight,l:t.x,t:t.y}},t("dojox.image.LightboxNano",null,{href:"",duration:500,preloadDelay:5e3,constructor:function(t,i){var a,n=this;e.mixin(n,t),i=n._node=o.byId(i),i&&(/a/i.test(i.tagName)||(a=r.create("a",{href:n.href,"class":i.className},i,"after"),i.className="",a.appendChild(i),i=a),s.set(i,"position","relative"),r.create("div",{"class":"nano-enlarge",style:{position:"absolute",display:"none"}},i),o.setSelectable(i,!1),n._onClickEvt=l(i,"click",e.hitch(n,"_load"))),n.href&&setTimeout(function(){(new Image).src=n.href,n._hideLoading()},n.preloadDelay)},destroy:function(){var e=this._connects||[];e.push(this._onClickEvt),i.forEach(e,function(e){e.remove()}),r.destroy(this._node)},_load:function(t){var i=this;if(t&&t.preventDefault(),!i._loading){i._loading=!0,i._reset();var a,o=i._img=r.create("img",{"class":"nano-image nano-image-hidden"},document.body),d=i._loadingNode,c=h("img",i._node)[0]||i._node,u=n.position(c,!0),m=n.getContentBox(c),f=n.getBorderExtents(c);null==d&&(i._loadingNode=d=r.create("div",{"class":"nano-loading",style:{position:"absolute",display:""}},i._node,"after"),a=n.getMarginBox(d),s.set(d,{left:parseInt((m.w-a.w)/2)+"px",top:parseInt((m.h-a.h)/2)+"px"})),m.x=u.x-10+f.l,m.y=u.y-10+f.t,i._start=m,i._connects=[l(o,"load",e.hitch(i,"_show"))],o.src=i.href}},_hideLoading:function(){this._loadingNode&&s.set(this._loadingNode,"display","none"),this._loadingNode=!1},_show:function(){var t=this,i=getViewport(),a=t._img.width,o=t._img.height,n=parseInt(.9*(i.w-20)),h=parseInt(.9*(i.h-20)),u=t._bg=r.create("div",{"class":"nano-background",style:{opacity:0}},document.body);t._loadingNode&&t._hideLoading(),d.remove(t._img,"nano-image-hidden"),s.set(t._node,m,"hidden"),t._loading=!1,t._connects=t._connects.concat([l(document,"mousedown",e.hitch(t,"_hide")),l(document,"keypress",e.hitch(t,"_key")),l(window,"resize",e.hitch(t,"_sizeBg"))]),a>n&&(o=o*n/a,a=n),o>h&&(a=a*h/o,o=h),t._end={x:(i.w-20-a)/2+i.l,y:(i.h-20-o)/2+i.t,w:a,h:o},t._sizeBg(),c.combine([t._anim(t._img,t._coords(t._start,t._end)),t._anim(u,{opacity:.5})]).play()},_sizeBg:function(){var e=document.documentElement;s.set(this._bg,{top:0,left:0,width:e.scrollWidth+"px",height:e.scrollHeight+"px"})},_key:function(e){e.preventDefault(),this._hide()},_coords:function(e,t){return{left:{start:e.x,end:t.x},top:{start:e.y,end:t.y},width:{start:e.w,end:t.w},height:{start:e.h,end:t.h}}},_hide:function(){var e=this;i.forEach(e._connects,function(e){e.remove()}),e._connects=[],c.combine([e._anim(e._img,e._coords(e._end,e._start),"_reset"),e._anim(e._bg,{opacity:0})]).play()},_reset:function(){s.set(this._node,m,"visible"),r.destroy(this._img),r.destroy(this._bg),this._img=this._bg=null,this._node.focus()},_anim:function(t,i,o){return a.animateProperty({node:t,duration:this.duration,properties:i,onEnd:o?e.hitch(this,o):null})},show:function(e){e=e||{},this.href=e.href||this.href;var t=o.byId(e.origin),i=getViewport();this._node=t||r.create("div",{style:{position:u,width:0,hieght:0,left:i.l+i.w/2+"px",top:i.t+i.h/2+"px"}},document.body),this._load(),t||r.destroy(this._node)}})});//# sourceMappingURL=LightboxNano.js.map