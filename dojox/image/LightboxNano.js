//>>built
define("dojox/image/LightboxNano",["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/_base/fx","dojo/dom","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/dom-class","dojo/on","dojo/query","dojo/fx"],function(e,t,i,a,r,o,n,s,l,d,h,u){var c="visibility";return getViewport=function(){var e="BackCompat"==document.compatMode?document.body:document.documentElement,t=n.docScroll();return{w:e.clientWidth,h:e.clientHeight,l:t.x,t:t.y}},t("dojox.image.LightboxNano",null,{href:"",duration:500,preloadDelay:5e3,constructor:function(t,i){var a,n=this;e.mixin(n,t),i=n._node=r.byId(i),i&&(/a/i.test(i.tagName)||(a=o.create("a",{href:n.href,class:i.className},i,"after"),i.className="",a.appendChild(i),i=a),s.set(i,"position","relative"),o.create("div",{class:"nano-enlarge",style:{position:"absolute",display:"none"}},i),r.setSelectable(i,!1),n._onClickEvt=d(i,"click",e.hitch(n,"_load"))),n.href&&setTimeout(function(){(new Image).src=n.href,n._hideLoading()},n.preloadDelay)},destroy:function(){var e=this._connects||[];e.push(this._onClickEvt),i.forEach(e,function(e){e.remove()}),o.destroy(this._node)},_load:function(t){var i=this;if(t&&t.preventDefault(),!i._loading){i._loading=!0,i._reset();var a,r=i._img=o.create("img",{class:"nano-image nano-image-hidden"},document.body),l=i._loadingNode,u=h("img",i._node)[0]||i._node,c=n.position(u,!0),m=n.getContentBox(u),f=n.getBorderExtents(u);null==l&&(i._loadingNode=l=o.create("div",{class:"nano-loading",style:{position:"absolute",display:""}},i._node,"after"),a=n.getMarginBox(l),s.set(l,{left:parseInt((m.w-a.w)/2)+"px",top:parseInt((m.h-a.h)/2)+"px"})),m.x=c.x-10+f.l,m.y=c.y-10+f.t,i._start=m,i._connects=[d(r,"load",e.hitch(i,"_show"))],r.src=i.href}},_hideLoading:function(){this._loadingNode&&s.set(this._loadingNode,"display","none"),this._loadingNode=!1},_show:function(){var t=this,i=getViewport(),a=t._img.width,r=t._img.height,n=parseInt(.9*(i.w-20)),h=parseInt(.9*(i.h-20)),m=t._bg=o.create("div",{class:"nano-background",style:{opacity:0}},document.body);t._loadingNode&&t._hideLoading(),l.remove(t._img,"nano-image-hidden"),s.set(t._node,c,"hidden"),t._loading=!1,t._connects=t._connects.concat([d(document,"mousedown",e.hitch(t,"_hide")),d(document,"keypress",e.hitch(t,"_key")),d(window,"resize",e.hitch(t,"_sizeBg"))]),a>n&&(r=r*n/a,a=n),r>h&&(a=a*h/r,r=h),t._end={x:(i.w-20-a)/2+i.l,y:(i.h-20-r)/2+i.t,w:a,h:r},t._sizeBg(),u.combine([t._anim(t._img,t._coords(t._start,t._end)),t._anim(m,{opacity:.5})]).play()},_sizeBg:function(){var e=document.documentElement;s.set(this._bg,{top:0,left:0,width:e.scrollWidth+"px",height:e.scrollHeight+"px"})},_key:function(e){e.preventDefault(),this._hide()},_coords:function(e,t){return{left:{start:e.x,end:t.x},top:{start:e.y,end:t.y},width:{start:e.w,end:t.w},height:{start:e.h,end:t.h}}},_hide:function(){var e=this;i.forEach(e._connects,function(e){e.remove()}),e._connects=[],u.combine([e._anim(e._img,e._coords(e._end,e._start),"_reset"),e._anim(e._bg,{opacity:0})]).play()},_reset:function(){s.set(this._node,c,"visible"),o.destroy(this._img),o.destroy(this._bg),this._img=this._bg=null,this._node.focus()},_anim:function(t,i,r){return a.animateProperty({node:t,duration:this.duration,properties:i,onEnd:r?e.hitch(this,r):null})},show:function(e){e=e||{},this.href=e.href||this.href;var t=r.byId(e.origin),i=getViewport();this._node=t||o.create("div",{style:{position:"absolute",width:0,hieght:0,left:i.l+i.w/2+"px",top:i.t+i.h/2+"px"}},document.body),this._load(),t||o.destroy(this._node)}})});//# sourceMappingURL=LightboxNano.js.map