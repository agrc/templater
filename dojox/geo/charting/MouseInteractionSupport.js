//>>built
define("dojox/geo/charting/MouseInteractionSupport",["dojo/_base/lang","dojo/_base/declare","dojo/_base/event","dojo/_base/connect","dojo/_base/window","dojo/_base/html","dojo/dom","dojo/_base/sniff"],function(e,t,i,a,r,o,n,s){return t("dojox.geo.charting.MouseInteractionSupport",null,{_map:null,_mapClickLocation:null,_screenClickLocation:null,_mouseDragListener:null,_mouseUpListener:null,_mouseUpClickListener:null,_mouseDownListener:null,_mouseMoveListener:null,_mouseWheelListener:null,_currentFeature:null,_cancelMouseClick:null,_zoomEnabled:!1,_panEnabled:!1,_onDragStartListener:null,_onSelectStartListener:null,mouseClickThreshold:2,constructor:function(e,t){this._map=e,this._mapClickLocation={x:0,y:0},this._screenClickLocation={x:0,y:0},this._cancelMouseClick=!1,t&&(this._zoomEnabled=t.enableZoom,this._panEnabled=t.enablePan,t.mouseClickThreshold&&t.mouseClickThreshold>0&&(this.mouseClickThreshold=t.mouseClickThreshold))},setEnableZoom:function(e){if(e&&!this._mouseWheelListener){var t=s("mozilla")?"DOMMouseScroll":"onmousewheel";this._mouseWheelListener=this._map.surface.connect(t,this,this._mouseWheelHandler)}else!e&&this._mouseWheelListener&&(a.disconnect(this._mouseWheelListener),this._mouseWheelListener=null);this._zoomEnabled=e},setEnablePan:function(e){this._panEnabled=e},connect:function(){this._mouseMoveListener=this._map.surface.connect("onmousemove",this,this._mouseMoveHandler),this._mouseDownListener=this._map.surface.connect("onmousedown",this,this._mouseDownHandler),s("ie")&&(_onDragStartListener=a.connect(r.doc,"ondragstart",this,i.stop),_onSelectStartListener=a.connect(r.doc,"onselectstart",this,i.stop)),this.setEnableZoom(this._zoomEnabled),this.setEnablePan(this._panEnabled)},disconnect:function(){var e=this._zoomEnabled;this.setEnableZoom(!1),this._zoomEnabled=e,this._mouseMoveListener&&(a.disconnect(this._mouseMoveListener),this._mouseMoveListener=null,a.disconnect(this._mouseDownListener),this._mouseDownListener=null),this._onDragStartListener&&(a.disconnect(this._onDragStartListener),this._onDragStartListener=null,a.disconnect(this._onSelectStartListener),this._onSelectStartListener=null)},_mouseClickHandler:function(e){var t=this._getFeatureFromMouseEvent(e);if(t)t._onclickHandler(e);else{for(var i in this._map.mapObj.features)this._map.mapObj.features[i].select(!1);this._map.onFeatureClick(null)}},_mouseDownHandler:function(e){i.stop(e),this._map.focused=!0,this._cancelMouseClick=!1,this._screenClickLocation.x=e.pageX,this._screenClickLocation.y=e.pageY;var t=this._map._getContainerBounds(),o=e.pageX-t.x,l=e.pageY-t.y,d=this._map.screenCoordsToMapCoords(o,l);if(this._mapClickLocation.x=d.x,this._mapClickLocation.y=d.y,s("ie")){var h=n.byId(this._map.container);this._mouseDragListener=a.connect(h,"onmousemove",this,this._mouseDragHandler),this._mouseUpClickListener=this._map.surface.connect("onmouseup",this,this._mouseUpClickHandler),this._mouseUpListener=this._map.surface.connect("onmouseup",this,this._mouseUpHandler),this._map.surface.rawNode.setCapture()}else this._mouseDragListener=a.connect(r.doc,"onmousemove",this,this._mouseDragHandler),this._mouseUpClickListener=this._map.surface.connect("onmouseup",this,this._mouseUpClickHandler),this._mouseUpListener=a.connect(r.doc,"onmouseup",this,this._mouseUpHandler)},_mouseUpClickHandler:function(e){this._cancelMouseClick||this._mouseClickHandler(e),this._cancelMouseClick=!1},_mouseUpHandler:function(e){i.stop(e),this._map.mapObj.marker._needTooltipRefresh=!0,this._mouseDragListener&&(a.disconnect(this._mouseDragListener),this._mouseDragListener=null),this._mouseUpClickListener&&(a.disconnect(this._mouseUpClickListener),this._mouseUpClickListener=null),this._mouseUpListener&&(a.disconnect(this._mouseUpListener),this._mouseUpListener=null),s("ie")&&this._map.surface.rawNode.releaseCapture()},_getFeatureFromMouseEvent:function(e){var t=null;return e.gfxTarget&&e.gfxTarget.getParent&&(t=this._map.mapObj.features[e.gfxTarget.getParent().id]),t},_mouseMoveHandler:function(e){if(!this._mouseDragListener||!this._panEnabled){var t=this._getFeatureFromMouseEvent(e);t!=this._currentFeature&&(this._currentFeature&&this._currentFeature._onmouseoutHandler(),this._currentFeature=t,t&&t._onmouseoverHandler()),t&&t._onmousemoveHandler(e)}},_mouseDragHandler:function(e){i.stop(e);var t=Math.abs(e.pageX-this._screenClickLocation.x),a=Math.abs(e.pageY-this._screenClickLocation.y);if(!this._cancelMouseClick&&(t>this.mouseClickThreshold||a>this.mouseClickThreshold)&&(this._cancelMouseClick=!0,this._panEnabled&&this._map.mapObj.marker.hide()),this._panEnabled){var r=this._map._getContainerBounds(),o=e.pageX-r.x,n=e.pageY-r.y,s=this._map.screenCoordsToMapCoords(o,n),l=s.x-this._mapClickLocation.x,d=s.y-this._mapClickLocation.y,h=this._map.getMapCenter();this._map.setMapCenter(h.x-l,h.y-d)}},_mouseWheelHandler:function(e){i.stop(e),this._map.mapObj.marker.hide();var t=this._map._getContainerBounds(),a=e.pageX-t.x,r=e.pageY-t.y,o=this._map.screenCoordsToMapCoords(a,r),n=e[s("mozilla")?"detail":"wheelDelta"]/(s("mozilla")?-3:120),l=Math.pow(1.2,n);this._map.setMapScaleAt(this._map.getMapScale()*l,o.x,o.y,!1),this._map.mapObj.marker._needTooltipRefresh=!0}})});//# sourceMappingURL=MouseInteractionSupport.js.map