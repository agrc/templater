//>>built
define("dojox/geo/charting/Feature",["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/_base/html","dojo/dom","dojo/_base/event","dojox/gfx/fx","dojox/color"],function(e,t,i,a,r,n,o,s){return t("dojox.geo.charting.Feature",null,{_isZoomIn:!1,isSelected:!1,markerText:null,constructor:function(t,a,r){this.id=a,this.shape=t.mapObj.createGroup(),this.parent=t,this.mapObj=t.mapObj,this._bbox=r.bbox,this._center=r.center,this._defaultFill=t.defaultColor,this._highlightFill=t.highlightColor,this._defaultStroke={width:this._normalizeStrokeWeight(.5),color:"white"};var n=e.isArray(r.shape[0])?r.shape:[r.shape];i.forEach(n,function(e){this.shape.createPolyline(e).setStroke(this._defaultStroke)},this),this.unsetValue()},unsetValue:function(){this.value=null,this.unsetColor()},unsetColor:function(){this._defaultFill=this.parent.defaultColor;var e=new s.Color(this.parent.defaultColor).toHsl();e.l=1.2*e.l,this._highlightFill=s.fromHsl(e),this._setFillWith(this._defaultFill)},setValue:function(e){if(this.value=e,null==e)this.unsetValue();else if(0!=this.parent.series.length){for(var t=0;t<this.parent.series.length;t++){var i=this.parent.series[t];if(e>=i.min&&e<i.max){this._setFillWith(i.color),this._defaultFill=i.color;var a=new s.Color(i.color).toHsv();return a.v=a.v+20,void(this._highlightFill=s.fromHsv(a))}}this.unsetColor()}},_setFillWith:function(t){var a=e.isArray(this.shape.children)?this.shape.children:[this.shape.children];i.forEach(a,e.hitch(this,function(e){if(this.parent.colorAnimationDuration>0){var i=o.animateFill({shape:e,color:{start:e.getFill(),end:t},duration:this.parent.colorAnimationDuration});i.play()}else e.setFill(t)}))},_setStrokeWith:function(t){var a=e.isArray(this.shape.children)?this.shape.children:[this.shape.children];i.forEach(a,function(e){e.setStroke({color:t.color,width:t.width,join:"round"})})},_normalizeStrokeWeight:function(e){this.shape._getRealMatrix();return"vml"!=dojox.gfx.renderer?e/(this.shape._getRealMatrix()||{xx:1}).xx:e},_onmouseoverHandler:function(e){this.parent.onFeatureOver(this),this._setFillWith(this._highlightFill),this.mapObj.marker.show(this.id,e)},_onmouseoutHandler:function(){this._setFillWith(this._defaultFill),this.mapObj.marker.hide(),a.style("mapZoomCursor","display","none")},_onmousemoveHandler:function(e){this.mapObj.marker._needTooltipRefresh&&this.mapObj.marker.show(this.id,e),this.isSelected&&e&&(this.parent.enableFeatureZoom?(e=n.fix(e||window.event),a.style("mapZoomCursor","left",e.pageX+12+"px"),a.style("mapZoomCursor","top",e.pageY+"px"),a.byId("mapZoomCursor").className=this._isZoomIn?"mapZoomOut":"mapZoomIn",a.style("mapZoomCursor","display","block")):a.style("mapZoomCursor","display","none"))},_onclickHandler:function(e){this.parent.onFeatureClick(this),this.isSelected?this.parent.enableFeatureZoom&&(this._isZoomIn?this._zoomOut():this._zoomIn()):(this.parent.deselectAll(),this.select(!0),this._onmousemoveHandler(e))},select:function(e){e?(this.shape.moveToFront(),this._setStrokeWith({color:"black",width:this._normalizeStrokeWeight(2)}),this._setFillWith(this._highlightFill),this.isSelected=!0,this.parent.selectedFeature=this):(this._setStrokeWith(this._defaultStroke),this._setFillWith(this._defaultFill),this.isSelected=!1,this._isZoomIn=!1)},_zoomIn:function(){var t=this.mapObj.marker;t.hide(),this.parent.fitToMapArea(this._bbox,15,!0,e.hitch(this,function(){this._setStrokeWith({color:"black",width:this._normalizeStrokeWeight(2)}),t._needTooltipRefresh=!0,this.parent.onZoomEnd(this)})),this._isZoomIn=!0,r.byId("mapZoomCursor").className=""},_zoomOut:function(){var t=this.mapObj.marker;t.hide(),this.parent.fitToMapContents(3,!0,e.hitch(this,function(){this._setStrokeWith({color:"black",width:this._normalizeStrokeWeight(2)}),t._needTooltipRefresh=!0,this.parent.onZoomEnd(this)})),this._isZoomIn=!1,r.byId("mapZoomCursor").className=""},init:function(){this.shape.id=this.id,this.tooltip=null}})});//# sourceMappingURL=Feature.js.map