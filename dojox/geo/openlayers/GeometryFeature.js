//>>built
define("dojox/geo/openlayers/GeometryFeature",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojox/gfx/matrix","./Point","./LineString","./Collection","./Feature"],function(e,t,a,i,r,o,n,d){return e("dojox.geo.openlayers.GeometryFeature",d,{constructor:function(e){this._geometry=e,this._shapeProperties={},this._fill=null,this._stroke=null},_createCollection:function(e){var t=this.getLayer(),a=t.getSurface(),i=this.createShape(a,e),r=t.getViewport();return r.add(i),i},_getCollectionShape:function(e){var t=e.shape;return null==t&&(t=this._createCollection(e),e.shape=t),t},renderCollection:function(e){void 0==e&&(e=this._geometry),s=this._getCollectionShape(e);var a=this.getShapeProperties();s.setShape(a),t.forEach(e.coordinates,function(e){if(e instanceof r)this.renderPoint(e);else if(e instanceof o)this.renderLineString(e);else{if(!(e instanceof n))throw new Error;this.renderCollection(e)}},this),this._applyStyle(e)},render:function(e){if(void 0==e&&(e=this._geometry),e instanceof r)this.renderPoint(e);else if(e instanceof o)this.renderLineString(e);else{if(!(e instanceof n))throw new Error;this.renderCollection(e)}},getShapeProperties:function(){return this._shapeProperties},setShapeProperties:function(e){return this._shapeProperties=e,this},createShape:function(e,a){a||(a=this._geometry);var i=null;if(a instanceof r)i=e.createCircle();else if(a instanceof o)i=e.createPolyline();else{if(!(a instanceof n))throw new Error;var s=e.createGroup();t.forEach(a.coordinates,function(t){var a=this.createShape(e,t);s.add(a)},this),i=s}return i},getShape:function(){var e=this._geometry;return e?e.shape?e.shape:(this.render(),e.shape):null},_createPoint:function(e){var t=this.getLayer(),a=t.getSurface(),i=this.createShape(a,e),r=t.getViewport();return r.add(i),i},_getPointShape:function(e){var t=e.shape;return null==t&&(t=this._createPoint(e),e.shape=t),t},renderPoint:function(e){void 0==e&&(e=this._geometry);var t=this.getLayer(),r=t.getDojoMap();s=this._getPointShape(e);var o=a.mixin({},this._defaults.pointShape);o=a.mixin(o,this.getShapeProperties()),s.setShape(o);var n=this.getCoordinateSystem(),d=r.transform(e.coordinates,n),l=this._getLocalXY(d),u=l[0],h=l[1],c=t.getViewport().getTransform();c&&s.setTransform(i.translate(u-c.dx,h-c.dy)),this._applyStyle(e)},_createLineString:function(e){var t=this.getLayer(),a=t._surface,i=this.createShape(a,e),r=t.getViewport();return r.add(i),e.shape=i,i},_getLineStringShape:function(e){var t=e.shape;return null==t&&(t=this._createLineString(e),e.shape=t),t},renderLineString:function(e){void 0==e&&(e=this._geometry);var i=this.getLayer(),r=i.getDojoMap(),o=this._getLineStringShape(e),n=this.getCoordinateSystem(),s=new Array(e.coordinates.length),d=i.getViewport().getTransform();t.forEach(e.coordinates,function(e,t,a){var i=r.transform(e,n),o=this._getLocalXY(i);d&&(o[0]-=d.dx,o[1]-=d.dy),s[t]={x:o[0],y:o[1]}},this);var l=a.mixin({},this._defaults.lineStringShape);l=a.mixin(l,this.getShapeProperties()),l=a.mixin(l,{points:s}),o.setShape(l),this._applyStyle(e)},_applyStyle:function(e){if(e&&e.shape){var t,i=this.getFill();!i||a.isString(i)||a.isArray(i)?t=i:(t=a.mixin({},this._defaults.fill),t=a.mixin(t,i));var r,o=this.getStroke();!o||a.isString(o)||a.isArray(o)?r=o:(r=a.mixin({},this._defaults.stroke),r=a.mixin(r,o)),this._applyRecusiveStyle(e,r,t)}},_applyRecusiveStyle:function(e,a,i){var r=e.shape;r.setFill&&r.setFill(i),r.setStroke&&r.setStroke(a),e instanceof n&&t.forEach(e.coordinates,function(e){this._applyRecusiveStyle(e,a,i)},this)},setStroke:function(e){return this._stroke=e,this},getStroke:function(){return this._stroke},setFill:function(e){return this._fill=e,this},getFill:function(){return this._fill},remove:function(){var e=this._geometry,a=e.shape;e.shape=null,a&&a.removeShape(),e instanceof n&&t.forEach(e.coordinates,function(e){this.remove(e)},this)},_defaults:{fill:null,stroke:null,pointShape:{r:30},lineStringShape:null}})});//# sourceMappingURL=GeometryFeature.js.map