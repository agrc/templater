//>>built
define("dojox/geo/openlayers/GeometryFeature",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojox/gfx/matrix","./Point","./LineString","./Collection","./Feature"],function(e,t,i,r,a,n,o,l){return e("dojox.geo.openlayers.GeometryFeature",l,{constructor:function(e){this._geometry=e,this._shapeProperties={},this._fill=null,this._stroke=null},_createCollection:function(e){var t=this.getLayer(),i=t.getSurface(),r=this.createShape(i,e);return t.getViewport().add(r),r},_getCollectionShape:function(e){var t=e.shape;return null==t&&(t=this._createCollection(e),e.shape=t),t},renderCollection:function(e){void 0==e&&(e=this._geometry),s=this._getCollectionShape(e);var i=this.getShapeProperties();s.setShape(i),t.forEach(e.coordinates,function(e){if(e instanceof a)this.renderPoint(e);else if(e instanceof n)this.renderLineString(e);else{if(!(e instanceof o))throw new Error;this.renderCollection(e)}},this),this._applyStyle(e)},render:function(e){if(void 0==e&&(e=this._geometry),e instanceof a)this.renderPoint(e);else if(e instanceof n)this.renderLineString(e);else{if(!(e instanceof o))throw new Error;this.renderCollection(e)}},getShapeProperties:function(){return this._shapeProperties},setShapeProperties:function(e){return this._shapeProperties=e,this},createShape:function(e,i){i||(i=this._geometry);var r=null;if(i instanceof a)r=e.createCircle();else if(i instanceof n)r=e.createPolyline();else{if(!(i instanceof o))throw new Error;var s=e.createGroup();t.forEach(i.coordinates,function(t){var i=this.createShape(e,t);s.add(i)},this),r=s}return r},getShape:function(){var e=this._geometry;return e?e.shape?e.shape:(this.render(),e.shape):null},_createPoint:function(e){var t=this.getLayer(),i=t.getSurface(),r=this.createShape(i,e);return t.getViewport().add(r),r},_getPointShape:function(e){var t=e.shape;return null==t&&(t=this._createPoint(e),e.shape=t),t},renderPoint:function(e){void 0==e&&(e=this._geometry);var t=this.getLayer(),a=t.getDojoMap();s=this._getPointShape(e);var n=i.mixin({},this._defaults.pointShape);n=i.mixin(n,this.getShapeProperties()),s.setShape(n);var o=this.getCoordinateSystem(),l=a.transform(e.coordinates,o),d=this._getLocalXY(l),u=d[0],c=d[1],h=t.getViewport().getTransform();h&&s.setTransform(r.translate(u-h.dx,c-h.dy)),this._applyStyle(e)},_createLineString:function(e){var t=this.getLayer(),i=t._surface,r=this.createShape(i,e);return t.getViewport().add(r),e.shape=r,r},_getLineStringShape:function(e){var t=e.shape;return null==t&&(t=this._createLineString(e),e.shape=t),t},renderLineString:function(e){void 0==e&&(e=this._geometry);var r=this.getLayer(),a=r.getDojoMap(),n=this._getLineStringShape(e),o=this.getCoordinateSystem(),s=new Array(e.coordinates.length),l=r.getViewport().getTransform();t.forEach(e.coordinates,function(e,t,i){var r=a.transform(e,o),n=this._getLocalXY(r);l&&(n[0]-=l.dx,n[1]-=l.dy),s[t]={x:n[0],y:n[1]}},this);var d=i.mixin({},this._defaults.lineStringShape);d=i.mixin(d,this.getShapeProperties()),d=i.mixin(d,{points:s}),n.setShape(d),this._applyStyle(e)},_applyStyle:function(e){if(e&&e.shape){var t,r=this.getFill();!r||i.isString(r)||i.isArray(r)?t=r:(t=i.mixin({},this._defaults.fill),t=i.mixin(t,r));var a,n=this.getStroke();!n||i.isString(n)||i.isArray(n)?a=n:(a=i.mixin({},this._defaults.stroke),a=i.mixin(a,n)),this._applyRecusiveStyle(e,a,t)}},_applyRecusiveStyle:function(e,i,r){var a=e.shape;a.setFill&&a.setFill(r),a.setStroke&&a.setStroke(i),e instanceof o&&t.forEach(e.coordinates,function(e){this._applyRecusiveStyle(e,i,r)},this)},setStroke:function(e){return this._stroke=e,this},getStroke:function(){return this._stroke},setFill:function(e){return this._fill=e,this},getFill:function(){return this._fill},remove:function(){var e=this._geometry,i=e.shape;e.shape=null,i&&i.removeShape(),e instanceof o&&t.forEach(e.coordinates,function(e){this.remove(e)},this)},_defaults:{fill:null,stroke:null,pointShape:{r:30},lineStringShape:null}})});//# sourceMappingURL=GeometryFeature.js.map