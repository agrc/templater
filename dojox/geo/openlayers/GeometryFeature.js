//>>built
define("dojox/geo/openlayers/GeometryFeature",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojox/gfx/matrix","./Point","./LineString","./Collection","./Feature"],function(e,t,i,a,o,r,n,d){return e("dojox.geo.openlayers.GeometryFeature",d,{constructor:function(e){this._geometry=e,this._shapeProperties={},this._fill=null,this._stroke=null},_createCollection:function(e){var t=this.getLayer(),i=t.getSurface(),a=this.createShape(i,e),o=t.getViewport();return o.add(a),a},_getCollectionShape:function(e){var t=e.shape;return null==t&&(t=this._createCollection(e),e.shape=t),t},renderCollection:function(e){void 0==e&&(e=this._geometry),s=this._getCollectionShape(e);var i=this.getShapeProperties();s.setShape(i),t.forEach(e.coordinates,function(e){if(e instanceof o)this.renderPoint(e);else if(e instanceof r)this.renderLineString(e);else{if(!(e instanceof n))throw new Error;this.renderCollection(e)}},this),this._applyStyle(e)},render:function(e){if(void 0==e&&(e=this._geometry),e instanceof o)this.renderPoint(e);else if(e instanceof r)this.renderLineString(e);else{if(!(e instanceof n))throw new Error;this.renderCollection(e)}},getShapeProperties:function(){return this._shapeProperties},setShapeProperties:function(e){return this._shapeProperties=e,this},createShape:function(e,i){i||(i=this._geometry);var a=null;if(i instanceof o)a=e.createCircle();else if(i instanceof r)a=e.createPolyline();else{if(!(i instanceof n))throw new Error;var s=e.createGroup();t.forEach(i.coordinates,function(t){var i=this.createShape(e,t);s.add(i)},this),a=s}return a},getShape:function(){var e=this._geometry;return e?e.shape?e.shape:(this.render(),e.shape):null},_createPoint:function(e){var t=this.getLayer(),i=t.getSurface(),a=this.createShape(i,e),o=t.getViewport();return o.add(a),a},_getPointShape:function(e){var t=e.shape;return null==t&&(t=this._createPoint(e),e.shape=t),t},renderPoint:function(e){void 0==e&&(e=this._geometry);var t=this.getLayer(),o=t.getDojoMap();s=this._getPointShape(e);var r=i.mixin({},this._defaults.pointShape);r=i.mixin(r,this.getShapeProperties()),s.setShape(r);var n=this.getCoordinateSystem(),d=o.transform(e.coordinates,n),l=this._getLocalXY(d),h=l[0],u=l[1],c=t.getViewport().getTransform();c&&s.setTransform(a.translate(h-c.dx,u-c.dy)),this._applyStyle(e)},_createLineString:function(e){var t=this.getLayer(),i=t._surface,a=this.createShape(i,e),o=t.getViewport();return o.add(a),e.shape=a,a},_getLineStringShape:function(e){var t=e.shape;return null==t&&(t=this._createLineString(e),e.shape=t),t},renderLineString:function(e){void 0==e&&(e=this._geometry);var a=this.getLayer(),o=a.getDojoMap(),r=this._getLineStringShape(e),n=this.getCoordinateSystem(),s=new Array(e.coordinates.length),d=a.getViewport().getTransform();t.forEach(e.coordinates,function(e,t,i){var a=o.transform(e,n),r=this._getLocalXY(a);d&&(r[0]-=d.dx,r[1]-=d.dy),s[t]={x:r[0],y:r[1]}},this);var l=i.mixin({},this._defaults.lineStringShape);l=i.mixin(l,this.getShapeProperties()),l=i.mixin(l,{points:s}),r.setShape(l),this._applyStyle(e)},_applyStyle:function(e){if(e&&e.shape){var t,a=this.getFill();!a||i.isString(a)||i.isArray(a)?t=a:(t=i.mixin({},this._defaults.fill),t=i.mixin(t,a));var o,r=this.getStroke();!r||i.isString(r)||i.isArray(r)?o=r:(o=i.mixin({},this._defaults.stroke),o=i.mixin(o,r)),this._applyRecusiveStyle(e,o,t)}},_applyRecusiveStyle:function(e,i,a){var o=e.shape;o.setFill&&o.setFill(a),o.setStroke&&o.setStroke(i),e instanceof n&&t.forEach(e.coordinates,function(e){this._applyRecusiveStyle(e,i,a)},this)},setStroke:function(e){return this._stroke=e,this},getStroke:function(){return this._stroke},setFill:function(e){return this._fill=e,this},getFill:function(){return this._fill},remove:function(){var e=this._geometry,i=e.shape;e.shape=null,i&&i.removeShape(),e instanceof n&&t.forEach(e.coordinates,function(e){this.remove(e)},this)},_defaults:{fill:null,stroke:null,pointShape:{r:30},lineStringShape:null}})});//# sourceMappingURL=GeometryFeature.js.map