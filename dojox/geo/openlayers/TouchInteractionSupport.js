//>>built
define("dojox/geo/openlayers/TouchInteractionSupport",["dojo/_base/declare","dojo/_base/connect","dojo/_base/html","dojo/_base/lang","dojo/_base/event","dojo/_base/window"],function(e,t,a,i,r,n){return e("dojox.geo.openlayers.TouchInteractionSupport",null,{_map:null,_centerTouchLocation:null,_touchMoveListener:null,_touchEndListener:null,_initialFingerSpacing:null,_initialScale:null,_tapCount:null,_tapThreshold:null,_lastTap:null,constructor:function(e){this._map=e,this._centerTouchLocation=new OpenLayers.LonLat(0,0);var a=this._map.div;t.connect(a,"touchstart",this,this._touchStartHandler),t.connect(a,"touchmove",this,this._touchMoveHandler),t.connect(a,"touchend",this,this._touchEndHandler),this._tapCount=0,this._lastTap={x:0,y:0},this._tapThreshold=100},_getTouchBarycenter:function(e){var t=e.touches,i=t[0],r=null;r=t.length>1?t[1]:t[0];var n=a.marginBox(this._map.div),o=(i.pageX+r.pageX)/2-n.l,s=(i.pageY+r.pageY)/2-n.t;return{x:o,y:s}},_getFingerSpacing:function(e){var t=e.touches,a=-1;if(t.length>=2){var i=t[1].pageX-t[0].pageX,r=t[1].pageY-t[0].pageY;a=Math.sqrt(i*i+r*r)}return a},_isDoubleTap:function(e){var t=!1,a=e.touches;if(this._tapCount>0&&1==a.length){var r=a[0].pageX-this._lastTap.x,n=a[0].pageY-this._lastTap.y,o=r*r+n*n;o<this._tapThreshold?t=!0:this._tapCount=0}return this._tapCount++,this._lastTap.x=a[0].pageX,this._lastTap.y=a[0].pageY,setTimeout(i.hitch(this,function(){this._tapCount=0}),300),t},_doubleTapHandler:function(e){var t=e.touches,i=a.marginBox(this._map.div),r=t[0].pageX-i.l,n=t[0].pageY-i.t,o=this._map.getLonLatFromPixel(new OpenLayers.Pixel(r,n));this._map.setCenter(new OpenLayers.LonLat(o.lon,o.lat),this._map.getZoom()+1)},_touchStartHandler:function(e){if(r.stop(e),this._isDoubleTap(e))return void this._doubleTapHandler(e);var a=this._getTouchBarycenter(e);this._centerTouchLocation=this._map.getLonLatFromPixel(new OpenLayers.Pixel(a.x,a.y)),this._initialFingerSpacing=this._getFingerSpacing(e),this._initialScale=this._map.getScale(),this._touchMoveListener||(this._touchMoveListener=t.connect(n.global,"touchmove",this,this._touchMoveHandler)),this._touchEndListener||(this._touchEndListener=t.connect(n.global,"touchend",this,this._touchEndHandler))},_touchEndHandler:function(e){r.stop(e);var a=e.touches;if(0==a.length)this._touchMoveListener&&(t.disconnect(this._touchMoveListener),this._touchMoveListener=null),this._touchEndListener&&(t.disconnect(this._touchEndListener),this._touchEndListener=null);else{var i=this._getTouchBarycenter(e);this._centerTouchLocation=this._map.getLonLatFromPixel(new OpenLayers.Pixel(i.x,i.y))}},_touchMoveHandler:function(e){r.stop(e);var t=this._getTouchBarycenter(e),a=this._map.getLonLatFromPixel(new OpenLayers.Pixel(t.x,t.y)),i=a.lon-this._centerTouchLocation.lon,n=a.lat-this._centerTouchLocation.lat,o=1,s=e.touches;if(s.length>=2){var l=this._getFingerSpacing(e);o=l/this._initialFingerSpacing,this._map.zoomToScale(this._initialScale/o)}var d=this._map.getCenter();this._map.setCenter(new OpenLayers.LonLat(d.lon-i,d.lat-n))}})});//# sourceMappingURL=TouchInteractionSupport.js.map