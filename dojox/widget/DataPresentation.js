//>>built
define("dojox/widget/DataPresentation",["dojo","dijit","dojox","dojo/require!dojox/grid/DataGrid,dojox/charting/Chart2D,dojox/charting/widget/Legend,dojox/charting/action2d/Tooltip,dojox/charting/action2d/Highlight,dojo/colors,dojo/data/ItemFileWriteStore"],function(e,t,i){e.provide("dojox.widget.DataPresentation"),e.experimental("dojox.widget.DataPresentation"),e.require("dojox.grid.DataGrid"),e.require("dojox.charting.Chart2D"),e.require("dojox.charting.widget.Legend"),e.require("dojox.charting.action2d.Tooltip"),e.require("dojox.charting.action2d.Highlight"),e.require("dojo.colors"),e.require("dojo.data.ItemFileWriteStore"),function(){var t=function(e,t,i,o){var n=[];n[0]={value:0,text:""};var a=e.length;if("ClusteredBars"!==i&&"StackedBars"!==i){var r=o.offsetWidth,s=(""+e[0]).length*e.length*7;if(1==t)for(var d=1;500>d&&!(r>s/d);++d)++t}for(var l=0;a>l;l++)n.push({value:l+1,text:!t||l%t?"":e[l]});return n.push({value:a+1,text:""}),n},o=function(e,t){var i={vertical:!1,labels:t,min:0,max:t.length-1,majorTickStep:1,minorTickStep:1};return"ClusteredBars"!==e&&"StackedBars"!==e||(i.vertical=!0),"Lines"!==e&&"Areas"!==e&&"StackedAreas"!==e||(i.min++,i.max--),i},n=function(e,t,i,o){var n={vertical:!0,fixLower:"major",fixUpper:"major",natural:!0};return"secondary"===t&&(n.leftBottom=!1),"ClusteredBars"!==e&&"StackedBars"!==e||(n.vertical=!1),i==o&&(n.min=i-1,n.max=o+1),n},a=function(e,t,i){var o={type:e,hAxis:"independent",vAxis:"dependent-"+t,gap:4,lines:!1,areas:!1,markers:!1};return"ClusteredBars"!==e&&"StackedBars"!==e||(o.hAxis=o.vAxis,o.vAxis="independent"),"Lines"!==e&&"Hybrid-Lines"!==e&&"Areas"!==e&&"StackedAreas"!==e||(o.lines=!0),"Areas"!==e&&"StackedAreas"!==e||(o.areas=!0),"Lines"===e&&(o.markers=!0),"Hybrid-Lines"===e&&(o.shadows={dx:2,dy:2,dw:2},o.type="Lines"),"Hybrid-ClusteredColumns"===e&&(o.type="ClusteredColumns"),i&&(o.animate=i),o},r=function(r,s,d,l,u,c,h,f,m,p,g){var v=s;v||(r.innerHTML="",v=new i.charting.Chart2D(r)),h&&(h._clone=function(){var t=new i.charting.Theme({chart:this.chart,plotarea:this.plotarea,axis:this.axis,series:this.series,marker:this.marker,antiAlias:this.antiAlias,assignColors:this.assignColors,assignMarkers:this.assigneMarkers,colors:e.delegate(this.colors)});return t.markers=this.markers,t._buildMarkerArray(),t},v.setTheme(h));var y=m.series_data[0].slice(0);l&&y.reverse();var b=t(y,c,d,r),_={},k=null,x=null,M={};for(var j in v.runs)M[j]=!0;for(var w=m.series_name.length,C=0;w>C;C++)if(m.series_chart[C]&&m.series_data[C].length>0){var I=d,T=m.series_axis[C];if("Hybrid"==I&&(I="line"==m.series_charttype[C]?"Hybrid-Lines":"Hybrid-ClusteredColumns"),_[T]||(_[T]={}),!_[T][I]){var S=T+"-"+I;v.addPlot(S,a(I,T,u));var N={};"string"==typeof f?N.text=function(t){var i=[t.element,t.run.name,y[t.index],"ClusteredBars"===I||"StackedBars"===I?t.x:t.y];return e.replace(f,i)}:"function"==typeof f&&(N.text=f),new i.charting.action2d.Tooltip(v,S,N),"Lines"!==I&&"Hybrid-Lines"!==I&&new i.charting.action2d.Highlight(v,S),_[T][I]=!0}for(var A=[],F=m.series_data[C].length,E=0;F>E;E++){var D=m.series_data[C][E];A.push(D),(null===k||D>k)&&(k=D),(null===x||x>D)&&(x=D)}l&&A.reverse();var P={plot:T+"-"+I};m.series_linestyle[C]&&(P.stroke={style:m.series_linestyle[C]}),v.addSeries(m.series_name[C],A,P),delete M[m.series_name[C]]}for(j in M)v.removeSeries(j);return v.addAxis("independent",o(d,b)),v.addAxis("dependent-primary",n(d,"primary",x,k)),v.addAxis("dependent-secondary",n(d,"secondary",x,k)),v},s=function(e,t,o,n){var a=t;return a?a.refresh():a=new i.charting.widget.Legend({chart:o,horizontal:n},e),a},d=function(e,t,o,n,a){var r=t||new i.grid.DataGrid({},e);r.startup(),r.setStore(o,n,a);for(var s=[],d=0;d<o.series_name.length;d++)o.series_grid[d]&&o.series_data[d].length>0&&s.push({field:"data."+d,name:o.series_name[d],width:"auto",formatter:o.series_gridformatter[d]});return r.setStructure(s),r},l=function(e,t){t.title&&(e.innerHTML=t.title)},u=function(e,t){t.footer&&(e.innerHTML=t.footer)},c=function(e,t){var i=e;if(t)for(var o=t.split(/[.\[\]]+/),n=0,a=o.length;a>n;n++)i&&(i=i[o[n]]);return i};e.declare("dojox.widget.DataPresentation",null,{type:"chart",chartType:"clusteredBars",reverse:!1,animate:null,labelMod:1,legendHorizontal:!0,constructor:function(t,i){e.mixin(this,i),this.domNode=e.byId(t),this[this.type+"Node"]=this.domNode,"string"==typeof this.theme&&(this.theme=e.getObject(this.theme)),this.chartNode=e.byId(this.chartNode),this.legendNode=e.byId(this.legendNode),this.gridNode=e.byId(this.gridNode),this.titleNode=e.byId(this.titleNode),this.footerNode=e.byId(this.footerNode),this.legendVertical&&(this.legendHorizontal=!this.legendVertical),this.url?this.setURL(null,null,this.refreshInterval):this.data?this.setData(null,this.refreshInterval):this.setStore()},setURL:function(t,i,o){o&&this.cancelRefresh(),this.url=t||this.url,this.urlContent=i||this.urlContent,this.refreshInterval=o||this.refreshInterval;var n=this;e.xhrGet({url:this.url,content:this.urlContent,handleAs:"json-comment-optional",load:function(e,t){n.setData(e)},error:function(e,t){n.urlError&&"function"==typeof n.urlError&&n.urlError(e,t)}}),o&&this.refreshInterval>0&&(this.refreshIntervalPending=setInterval(function(){n.setURL()},this.refreshInterval))},setData:function(t,i){i&&this.cancelRefresh(),this.data=t||this.data,this.refreshInterval=i||this.refreshInterval;for(var o="function"==typeof this.series?this.series(this.data):this.series,n=[],a=[],r=[],s=[],d=[],l=[],u=[],h=[],f=[],m=0,p=0;p<o.length;p++)n[p]=c(this.data,o[p].datapoints),n[p]&&n[p].length>m&&(m=n[p].length),a[p]=[],r[p]=o[p].name||(o[p].namefield?c(this.data,o[p].namefield):null)||"series "+p,s[p]=o[p].chart!==!1,d[p]=o[p].charttype||"bar",l[p]=o[p].linestyle,u[p]=o[p].axis||"primary",h[p]=o[p].grid!==!1,f[p]=o[p].gridformatter;var g,v,y,b,_=[];for(g=0;m>g;g++){for(v={index:g},p=0;p<o.length;p++)n[p]&&n[p].length>g&&(y=c(n[p][g],o[p].field),s[p]&&(b=parseFloat(y),isNaN(b)||(y=b)),v["data."+p]=y,a[p].push(y));_.push(v)}0>=m&&_.push({index:0});var k=new e.data.ItemFileWriteStore({data:{identifier:"index",items:_}});if(this.data.title&&(k.title=this.data.title),this.data.footer&&(k.footer=this.data.footer),k.series_data=a,k.series_name=r,k.series_chart=s,k.series_charttype=d,k.series_linestyle=l,k.series_axis=u,k.series_grid=h,k.series_gridformatter=f,this.setPreparedStore(k),i&&this.refreshInterval>0){var x=this;this.refreshIntervalPending=setInterval(function(){x.setData()},this.refreshInterval)}},refresh:function(){this.url?this.setURL(this.url,this.urlContent,this.refreshInterval):this.data&&this.setData(this.data,this.refreshInterval)},cancelRefresh:function(){this.refreshIntervalPending&&(clearInterval(this.refreshIntervalPending),this.refreshIntervalPending=void 0)},setStore:function(e,t,i){this.setPreparedStore(e,t,i)},setPreparedStore:function(e,t,i){this.preparedstore=e||this.store,this.query=t||this.query,this.queryOptions=i||this.queryOptions,this.preparedstore&&(this.chartNode&&(this.chartWidget=r(this.chartNode,this.chartWidget,this.chartType,this.reverse,this.animate,this.labelMod,this.theme,this.tooltip,this.preparedstore,this.query,this.queryOptions),this.renderChartWidget()),this.legendNode&&(this.legendWidget=s(this.legendNode,this.legendWidget,this.chartWidget,this.legendHorizontal)),this.gridNode&&(this.gridWidget=d(this.gridNode,this.gridWidget,this.preparedstore,this.query,this.queryOptions),this.renderGridWidget()),this.titleNode&&l(this.titleNode,this.preparedstore),this.footerNode&&u(this.footerNode,this.preparedstore))},renderChartWidget:function(){this.chartWidget&&this.chartWidget.render()},renderGridWidget:function(){this.gridWidget&&this.gridWidget.render()},getChartWidget:function(){return this.chartWidget},getGridWidget:function(){return this.gridWidget},destroy:function(){this.cancelRefresh(),this.chartWidget&&(this.chartWidget.destroy(),delete this.chartWidget),this.legendWidget&&delete this.legendWidget,this.gridWidget&&delete this.gridWidget,this.chartNode&&(this.chartNode.innerHTML=""),this.legendNode&&(this.legendNode.innerHTML=""),this.gridNode&&(this.gridNode.innerHTML=""),this.titleNode&&(this.titleNode.innerHTML=""),this.footerNode&&(this.footerNode.innerHTML="")}})}()});//# sourceMappingURL=DataPresentation.js.map