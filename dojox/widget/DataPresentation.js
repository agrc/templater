//>>built
define("dojox/widget/DataPresentation",["dojo","dijit","dojox","dojo/require!dojox/grid/DataGrid,dojox/charting/Chart2D,dojox/charting/widget/Legend,dojox/charting/action2d/Tooltip,dojox/charting/action2d/Highlight,dojo/colors,dojo/data/ItemFileWriteStore"],function(e,t,i){e.provide("dojox.widget.DataPresentation"),e.experimental("dojox.widget.DataPresentation"),e.require("dojox.grid.DataGrid"),e.require("dojox.charting.Chart2D"),e.require("dojox.charting.widget.Legend"),e.require("dojox.charting.action2d.Tooltip"),e.require("dojox.charting.action2d.Highlight"),e.require("dojo.colors"),e.require("dojo.data.ItemFileWriteStore"),function(){var t=function(e,t,i,a){var r=[];r[0]={value:0,text:""};var o=e.length;if("ClusteredBars"!==i&&"StackedBars"!==i){var n=a.offsetWidth,s=(""+e[0]).length*e.length*7;if(1==t)for(var l=1;l<500&&!(s/l<n);++l)++t}for(var d=0;d<o;d++)r.push({value:d+1,text:!t||d%t?"":e[d]});return r.push({value:o+1,text:""}),r},a=function(e,t){var i={vertical:!1,labels:t,min:0,max:t.length-1,majorTickStep:1,minorTickStep:1};return"ClusteredBars"!==e&&"StackedBars"!==e||(i.vertical=!0),"Lines"!==e&&"Areas"!==e&&"StackedAreas"!==e||(i.min++,i.max--),i},r=function(e,t,i,a){var r={vertical:!0,fixLower:"major",fixUpper:"major",natural:!0};return"secondary"===t&&(r.leftBottom=!1),"ClusteredBars"!==e&&"StackedBars"!==e||(r.vertical=!1),i==a&&(r.min=i-1,r.max=a+1),r},o=function(e,t,i){var a={type:e,hAxis:"independent",vAxis:"dependent-"+t,gap:4,lines:!1,areas:!1,markers:!1};return"ClusteredBars"!==e&&"StackedBars"!==e||(a.hAxis=a.vAxis,a.vAxis="independent"),"Lines"!==e&&"Hybrid-Lines"!==e&&"Areas"!==e&&"StackedAreas"!==e||(a.lines=!0),"Areas"!==e&&"StackedAreas"!==e||(a.areas=!0),"Lines"===e&&(a.markers=!0),"Hybrid-Lines"===e&&(a.shadows={dx:2,dy:2,dw:2},a.type="Lines"),"Hybrid-ClusteredColumns"===e&&(a.type="ClusteredColumns"),i&&(a.animate=i),a},n=function(n,s,l,d,h,c,u,m,f,g,p){var y=s;y||(n.innerHTML="",y=new i.charting.Chart2D(n)),u&&(u._clone=function(){var t=new i.charting.Theme({chart:this.chart,plotarea:this.plotarea,axis:this.axis,series:this.series,marker:this.marker,antiAlias:this.antiAlias,assignColors:this.assignColors,assignMarkers:this.assigneMarkers,colors:e.delegate(this.colors)});return t.markers=this.markers,t._buildMarkerArray(),t},y.setTheme(u));var v=f.series_data[0].slice(0);d&&v.reverse();var b=t(v,c,l,n),_={},k=null,M=null,w={};for(var x in y.runs)w[x]=!0;for(var j=f.series_name.length,T=0;T<j;T++)if(f.series_chart[T]&&f.series_data[T].length>0){var C=l,I=f.series_axis[T];if("Hybrid"==C&&(C="line"==f.series_charttype[T]?"Hybrid-Lines":"Hybrid-ClusteredColumns"),_[I]||(_[I]={}),!_[I][C]){var S=I+"-"+C;y.addPlot(S,o(C,I,h));var F={};"string"==typeof m?F.text=function(t){var i=[t.element,t.run.name,v[t.index],"ClusteredBars"===C||"StackedBars"===C?t.x:t.y];return e.replace(m,i)}:"function"==typeof m&&(F.text=m),new i.charting.action2d.Tooltip(y,S,F),"Lines"!==C&&"Hybrid-Lines"!==C&&new i.charting.action2d.Highlight(y,S),_[I][C]=!0}for(var A=[],E=f.series_data[T].length,z=0;z<E;z++){var P=f.series_data[T][z];A.push(P),(null===k||P>k)&&(k=P),(null===M||P<M)&&(M=P)}d&&A.reverse();var N={plot:I+"-"+C};f.series_linestyle[T]&&(N.stroke={style:f.series_linestyle[T]}),y.addSeries(f.series_name[T],A,N),delete w[f.series_name[T]]}for(x in w)y.removeSeries(x);return y.addAxis("independent",a(l,b)),y.addAxis("dependent-primary",r(l,"primary",M,k)),y.addAxis("dependent-secondary",r(l,"secondary",M,k)),y},s=function(e,t,a,r){var o=t;return o?o.refresh():o=new i.charting.widget.Legend({chart:a,horizontal:r},e),o},l=function(e,t,a,r,o){var n=t||new i.grid.DataGrid({},e);n.startup(),n.setStore(a,r,o);for(var s=[],l=0;l<a.series_name.length;l++)a.series_grid[l]&&a.series_data[l].length>0&&s.push({field:"data."+l,name:a.series_name[l],width:"auto",formatter:a.series_gridformatter[l]});return n.setStructure(s),n},d=function(e,t){t.title&&(e.innerHTML=t.title)},h=function(e,t){t.footer&&(e.innerHTML=t.footer)},c=function(e,t){var i=e;if(t)for(var a=t.split(/[.\[\]]+/),r=0,o=a.length;r<o;r++)i&&(i=i[a[r]]);return i};e.declare("dojox.widget.DataPresentation",null,{type:"chart",chartType:"clusteredBars",reverse:!1,animate:null,labelMod:1,legendHorizontal:!0,constructor:function(t,i){e.mixin(this,i),this.domNode=e.byId(t),this[this.type+"Node"]=this.domNode,"string"==typeof this.theme&&(this.theme=e.getObject(this.theme)),this.chartNode=e.byId(this.chartNode),this.legendNode=e.byId(this.legendNode),this.gridNode=e.byId(this.gridNode),this.titleNode=e.byId(this.titleNode),this.footerNode=e.byId(this.footerNode),this.legendVertical&&(this.legendHorizontal=!this.legendVertical),this.url?this.setURL(null,null,this.refreshInterval):this.data?this.setData(null,this.refreshInterval):this.setStore()},setURL:function(t,i,a){a&&this.cancelRefresh(),this.url=t||this.url,this.urlContent=i||this.urlContent,this.refreshInterval=a||this.refreshInterval;var r=this;e.xhrGet({url:this.url,content:this.urlContent,handleAs:"json-comment-optional",load:function(e,t){r.setData(e)},error:function(e,t){r.urlError&&"function"==typeof r.urlError&&r.urlError(e,t)}}),a&&this.refreshInterval>0&&(this.refreshIntervalPending=setInterval(function(){r.setURL()},this.refreshInterval))},setData:function(t,i){i&&this.cancelRefresh(),this.data=t||this.data,this.refreshInterval=i||this.refreshInterval;for(var a="function"==typeof this.series?this.series(this.data):this.series,r=[],o=[],n=[],s=[],l=[],d=[],h=[],u=[],m=[],f=0,g=0;g<a.length;g++)r[g]=c(this.data,a[g].datapoints),r[g]&&r[g].length>f&&(f=r[g].length),o[g]=[],n[g]=a[g].name||(a[g].namefield?c(this.data,a[g].namefield):null)||"series "+g,s[g]=!1!==a[g].chart,l[g]=a[g].charttype||"bar",d[g]=a[g].linestyle,h[g]=a[g].axis||"primary",u[g]=!1!==a[g].grid,m[g]=a[g].gridformatter;var p,y,v,b,_=[];for(p=0;p<f;p++){for(y={index:p},g=0;g<a.length;g++)r[g]&&r[g].length>p&&(v=c(r[g][p],a[g].field),s[g]&&(b=parseFloat(v),isNaN(b)||(v=b)),y["data."+g]=v,o[g].push(v));_.push(y)}f<=0&&_.push({index:0});var k=new e.data.ItemFileWriteStore({data:{identifier:"index",items:_}});if(this.data.title&&(k.title=this.data.title),this.data.footer&&(k.footer=this.data.footer),k.series_data=o,k.series_name=n,k.series_chart=s,k.series_charttype=l,k.series_linestyle=d,k.series_axis=h,k.series_grid=u,k.series_gridformatter=m,this.setPreparedStore(k),i&&this.refreshInterval>0){var M=this;this.refreshIntervalPending=setInterval(function(){M.setData()},this.refreshInterval)}},refresh:function(){this.url?this.setURL(this.url,this.urlContent,this.refreshInterval):this.data&&this.setData(this.data,this.refreshInterval)},cancelRefresh:function(){this.refreshIntervalPending&&(clearInterval(this.refreshIntervalPending),this.refreshIntervalPending=void 0)},setStore:function(e,t,i){this.setPreparedStore(e,t,i)},setPreparedStore:function(e,t,i){this.preparedstore=e||this.store,this.query=t||this.query,this.queryOptions=i||this.queryOptions,this.preparedstore&&(this.chartNode&&(this.chartWidget=n(this.chartNode,this.chartWidget,this.chartType,this.reverse,this.animate,this.labelMod,this.theme,this.tooltip,this.preparedstore,this.query,this.queryOptions),this.renderChartWidget()),this.legendNode&&(this.legendWidget=s(this.legendNode,this.legendWidget,this.chartWidget,this.legendHorizontal)),this.gridNode&&(this.gridWidget=l(this.gridNode,this.gridWidget,this.preparedstore,this.query,this.queryOptions),this.renderGridWidget()),this.titleNode&&d(this.titleNode,this.preparedstore),this.footerNode&&h(this.footerNode,this.preparedstore))},renderChartWidget:function(){this.chartWidget&&this.chartWidget.render()},renderGridWidget:function(){this.gridWidget&&this.gridWidget.render()},getChartWidget:function(){return this.chartWidget},getGridWidget:function(){return this.gridWidget},destroy:function(){this.cancelRefresh(),this.chartWidget&&(this.chartWidget.destroy(),delete this.chartWidget),this.legendWidget&&delete this.legendWidget,this.gridWidget&&delete this.gridWidget,this.chartNode&&(this.chartNode.innerHTML=""),this.legendNode&&(this.legendNode.innerHTML=""),this.gridNode&&(this.gridNode.innerHTML=""),this.titleNode&&(this.titleNode.innerHTML=""),this.footerNode&&(this.footerNode.innerHTML="")}})}()});//# sourceMappingURL=DataPresentation.js.map