//>>built
define("dojox/widget/Portlet",["dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/event","dojo/_base/connect","dojo/dom-style","dojo/dom-class","dojo/dom-construct","dojo/fx","dijit/registry","dijit/TitlePane","dijit/_Container","./PortletSettings","./PortletDialogSettings"],function(e,t,i,r,o,n,a,s,d,l,u,c,h,f,m){return t.experimental("dojox.widget.Portlet"),e("dojox.widget.Portlet",[c,h],{resizeChildren:!0,closable:!0,_parents:null,_size:null,dragRestriction:!1,buildRendering:function(){this.inherited(arguments),a.set(this.domNode,"visibility","hidden")},postCreate:function(){this.inherited(arguments),s.add(this.domNode,"dojoxPortlet"),s.remove(this.arrowNode,"dijitArrowNode"),s.add(this.arrowNode,"dojoxPortletIcon dojoxArrowDown"),s.add(this.titleBarNode,"dojoxPortletTitle"),s.add(this.hideNode,"dojoxPortletContentOuter"),s.add(this.domNode,"dojoxPortlet-"+(this.dragRestriction?"nonmovable":"movable"));var e=this;if(this.resizeChildren){this.subscribe("/dnd/drop",function(){e._updateSize()}),this.subscribe("/Portlet/sizechange",function(t){e.onSizeChange(t)}),this.connect(window,"onresize",function(){e._updateSize()});var t,r=i.hitch(this,function(t,i){var r=u.byId(t);if(r.selectChild){var o=this.subscribe(t+"-selectChild",function(t){for(var i=e.domNode.parentNode;i;){if(i==t.domNode){e.unsubscribe(o),e._updateSize();break}i=i.parentNode}}),n=u.byId(i);r&&n&&e._parents.push({parent:r,child:n})}});this._parents=[];for(var n=this.domNode.parentNode;null!=n;n=n.parentNode){var d=n.getAttribute?n.getAttribute("widgetId"):null;d&&(r(d,t),t=d)}}this.connect(this.titleBarNode,"onmousedown",function(e){return!s.contains(e.target,"dojoxPortletIcon")||(o.stop(e),!1)}),this.connect(this._wipeOut,"onEnd",function(){e._publish()}),this.connect(this._wipeIn,"onEnd",function(){e._publish()}),this.closable&&(this.closeIcon=this._createIcon("dojoxCloseNode","dojoxCloseNodeHover",i.hitch(this,"onClose")),a.set(this.closeIcon,"display",""))},startup:function(){if(!this._started){var e=this.getChildren();this._placeSettingsWidgets(),r.forEach(e,function(e){try{e.started||e._started||e.startup()}catch(e){}}),this.inherited(arguments),a.set(this.domNode,"visibility","visible")}},_placeSettingsWidgets:function(){r.forEach(this.getChildren(),i.hitch(this,function(e){e.portletIconClass&&e.toggle&&!e.get("portlet")&&(this._createIcon(e.portletIconClass,e.portletIconHoverClass,i.hitch(e,"toggle")),d.place(e.domNode,this.containerNode,"before"),e.set("portlet",this),this._settingsWidget=e)}))},_createIcon:function(e,t,i){var r=d.create("div",{class:"dojoxPortletIcon "+e,waiRole:"presentation"});return d.place(r,this.arrowNode,"before"),this.connect(r,"onclick",i),t&&(this.connect(r,"onmouseover",function(){s.add(r,t)}),this.connect(r,"onmouseout",function(){s.remove(r,t)})),r},onClose:function(e){a.set(this.domNode,"display","none")},onSizeChange:function(e){e!=this&&this._updateSize()},_updateSize:function(){this.open&&this._started&&this.resizeChildren&&(this._timer&&clearTimeout(this._timer),this._timer=setTimeout(i.hitch(this,function(){for(var e={w:a.get(this.domNode,"width"),h:a.get(this.domNode,"height")},t=0;t<this._parents.length;t++){var o=this._parents[t],n=o.parent.selectedChildWidget;if(n&&n!=o.child)return}if(!this._size||this._size.w!=e.w||this._size.h!=e.h){this._size=e;var s=["resize","layout"];this._timer=null;var d=this.getChildren();r.forEach(d,function(e){for(var t=0;t<s.length;t++)if(i.isFunction(e[s[t]])){try{e[s[t]]()}catch(e){}break}}),this.onUpdateSize()}}),100))},onUpdateSize:function(){},_publish:function(){n.publish("/Portlet/sizechange",[this])},_onTitleClick:function(e){e.target==this.arrowNode&&this.inherited(arguments)},addChild:function(e){this._size=null,this.inherited(arguments),this._started&&(this._placeSettingsWidgets(),this._updateSize()),!this._started||e.started||e._started||e.startup()},destroyDescendants:function(e){this.inherited(arguments),this._settingsWidget&&this._settingsWidget.destroyRecursive(e)},destroy:function(){this._timer&&clearTimeout(this._timer),this.inherited(arguments)},_setCss:function(){this.inherited(arguments),a.set(this.arrowNode,"display",this.toggleable?"":"none")}})});//# sourceMappingURL=Portlet.js.map