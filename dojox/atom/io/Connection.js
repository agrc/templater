//>>built
define("dojox/atom/io/Connection",["dojo/_base/declare","dojo/_base/kernel","dojo/_base/xhr","./model"],function(e,t,r,a){return e("dojox.atom.io.Connection",null,{constructor:function(e,t){this.sync=e,this.preventCache=t},preventCache:!1,alertsEnabled:!1,getFeed:function(e,t,r,i){this._getXmlDoc(e,"feed",new a.Feed,a._Constants.ATOM_NS,t,r,i)},getService:function(e,t,r,i){this._getXmlDoc(e,"service",new a.Service(e),a._Constants.APP_NS,t,r,i)},getEntry:function(e,t,r,i){this._getXmlDoc(e,"entry",new a.Entry,a._Constants.ATOM_NS,t,r,i)},_getXmlDoc:function(e,a,i,n,o,d,s){s||(s=t.global);var l=this.alertsEnabled,u={url:e,handleAs:"xml",sync:this.sync,preventCache:this.preventCache,load:function(e,t){var r,d=null,u=e;if(u){if(void 0!==u.getElementsByTagNameNS)r=u.getElementsByTagNameNS(n,a),r&&r.length>0?d=r.item(0):u.lastChild&&(d=u.lastChild);else if(void 0!==u.getElementsByTagName)if((r=u.getElementsByTagName(a))&&r.length>0){for(var c=0;c<r.length;c++)if(r[c].namespaceURI==n){d=r[c];break}}else u.lastChild&&(d=u.lastChild);else{if(!u.lastChild)return void o.call(s,null,null,t);d=u.lastChild}if(i.buildFromDom(d),o)o.call(s,i,u,t);else if(l)throw new Error("The callback value does not exist.")}else o.call(s,null,null,t)}};this.user&&null!==this.user&&(u.user=this.user),this.password&&null!==this.password&&(u.password=this.password),u.error=d?function(e,t){d.call(s,e,t)}:function(){throw new Error("The URL requested cannot be accessed")},r.get(u)},updateEntry:function(e,a,i,n,o,d){d||(d=t.global),e.updated=new Date;var s=e.getEditHref();if(!s)throw new Error("A URL has not been specified for editing this entry.");var l=this,u=this.alertsEnabled,c={url:s,handleAs:"text",contentType:"text/xml",sync:this.sync,preventCache:this.preventCache,load:function(t,r){var i=null;if(n){i=r.xhr.getResponseHeader("Location"),i||(i=s);var o=function(e,t,r){if(a)a.call(d,e,i,r);else if(u)throw new Error("The callback value does not exist.")};l.getEntry(i,o)}else if(a)a.call(d,e,r.xhr.getResponseHeader("Location"),r);else if(u)throw new Error("The callback value does not exist.");return t}};if(this.user&&null!==this.user&&(c.user=this.user),this.password&&null!==this.password&&(c.password=this.password),c.error=i?function(e,t){i.call(d,e,t)}:function(){throw new Error("The URL requested cannot be accessed")},o)c.postData=e.toString(!0),c.headers={"X-Method-Override":"PUT"},r.post(c);else{c.putData=e.toString(!0);r.put(c)}},addEntry:function(e,a,i,n,o,d){d||(d=t.global),e.published=new Date,e.updated=new Date;var s=e.feedUrl,l=this.alertsEnabled;if(!a&&s&&(a=s),a){var u=this,c={url:a,handleAs:"text",contentType:"text/xml",sync:this.sync,preventCache:this.preventCache,postData:e.toString(!0),load:function(t,r){var n=r.xhr.getResponseHeader("Location");if(n||(n=a),r.retrieveEntry){var o=function(e,t,r){if(i)i.call(d,e,n,r);else if(l)throw new Error("The callback value does not exist.")};u.getEntry(n,o)}else if(i)i.call(d,e,n,r);else if(l)throw new Error("The callback value does not exist.");return t}};this.user&&null!==this.user&&(c.user=this.user),this.password&&null!==this.password&&(c.password=this.password),c.error=n?function(e,t){n.call(d,e,t)}:function(){throw new Error("The URL requested cannot be accessed")},r.post(c)}else if(l)throw new Error("The request cannot be processed because the URL parameter is missing.")},deleteEntry:function(e,a,i,n,o){o||(o=t.global);var d=null;if(!(d="string"==typeof e?e:e.getEditHref()))throw a.call(o,!1,null),new Error("The request cannot be processed because the URL parameter is missing.");var s={url:d,handleAs:"text",sync:this.sync,preventCache:this.preventCache,load:function(e,t){return a.call(o,t),e}};this.user&&null!==this.user&&(s.user=this.user),this.password&&null!==this.password&&(s.password=this.password),s.error=i?function(e,t){i.call(o,e,t)}:function(){throw new Error("The URL requested cannot be accessed")},n?(s.headers={"X-Method-Override":"DELETE"},dhxr.post(s)):r.del(s)}})});//# sourceMappingURL=Connection.js.map