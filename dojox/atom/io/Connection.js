//>>built
define("dojox/atom/io/Connection",["dojo/_base/declare","dojo/_base/kernel","dojo/_base/xhr","./model"],function(e,t,a,i){return e("dojox.atom.io.Connection",null,{constructor:function(e,t){this.sync=e,this.preventCache=t},preventCache:!1,alertsEnabled:!1,getFeed:function(e,t,a,r){this._getXmlDoc(e,"feed",new i.Feed,i._Constants.ATOM_NS,t,a,r)},getService:function(e,t,a,r){this._getXmlDoc(e,"service",new i.Service(e),i._Constants.APP_NS,t,a,r)},getEntry:function(e,t,a,r){this._getXmlDoc(e,"entry",new i.Entry,i._Constants.ATOM_NS,t,a,r)},_getXmlDoc:function(e,i,r,d,o,n,l){l||(l=t.global);var s=this.alertsEnabled,m={url:e,handleAs:"xml",sync:this.sync,preventCache:this.preventCache,load:function(e,t){var a,n=null,m=e;if(m){if("undefined"!=typeof m.getElementsByTagNameNS)a=m.getElementsByTagNameNS(d,i),a&&a.length>0?n=a.item(0):m.lastChild&&(n=m.lastChild);else if("undefined"!=typeof m.getElementsByTagName)if(a=m.getElementsByTagName(i),a&&a.length>0){for(var f=0;f<a.length;f++)if(a[f].namespaceURI==d){n=a[f];break}}else m.lastChild&&(n=m.lastChild);else{if(!m.lastChild)return void o.call(l,null,null,t);n=m.lastChild}if(r.buildFromDom(n),o)o.call(l,r,m,t);else if(s)throw new Error("The callback value does not exist.")}else o.call(l,null,null,t)}};this.user&&null!==this.user&&(m.user=this.user),this.password&&null!==this.password&&(m.password=this.password),n?m.error=function(e,t){n.call(l,e,t)}:m.error=function(){throw new Error("The URL requested cannot be accessed")},a.get(m)},updateEntry:function(e,i,r,d,o,n){n||(n=t.global),e.updated=new Date;var l=e.getEditHref();if(!l)throw new Error("A URL has not been specified for editing this entry.");var s=this,m=this.alertsEnabled,f={url:l,handleAs:"text",contentType:"text/xml",sync:this.sync,preventCache:this.preventCache,load:function(t,a){var r=null;if(d){r=a.xhr.getResponseHeader("Location"),r||(r=l);var o=function(e,t,a){if(i)i.call(n,e,r,a);else if(m)throw new Error("The callback value does not exist.")};s.getEntry(r,o)}else if(i)i.call(n,e,a.xhr.getResponseHeader("Location"),a);else if(m)throw new Error("The callback value does not exist.");return t}};if(this.user&&null!==this.user&&(f.user=this.user),this.password&&null!==this.password&&(f.password=this.password),r?f.error=function(e,t){r.call(n,e,t)}:f.error=function(){throw new Error("The URL requested cannot be accessed")},o)f.postData=e.toString(!0),f.headers={"X-Method-Override":"PUT"},a.post(f);else{f.putData=e.toString(!0);a.put(f)}},addEntry:function(e,i,r,d,o,n){n||(n=t.global),e.published=new Date,e.updated=new Date;var l=e.feedUrl,s=this.alertsEnabled;if(!i&&l&&(i=l),i){var m=this,f={url:i,handleAs:"text",contentType:"text/xml",sync:this.sync,preventCache:this.preventCache,postData:e.toString(!0),load:function(t,a){var d=a.xhr.getResponseHeader("Location");if(d||(d=i),a.retrieveEntry){var o=function(e,t,a){if(r)r.call(n,e,d,a);else if(s)throw new Error("The callback value does not exist.")};m.getEntry(d,o)}else if(r)r.call(n,e,d,a);else if(s)throw new Error("The callback value does not exist.");return t}};this.user&&null!==this.user&&(f.user=this.user),this.password&&null!==this.password&&(f.password=this.password),d?f.error=function(e,t){d.call(n,e,t)}:f.error=function(){throw new Error("The URL requested cannot be accessed")},a.post(f)}else if(s)throw new Error("The request cannot be processed because the URL parameter is missing.")},deleteEntry:function(e,i,r,d,o){o||(o=t.global);var n=null;if(n="string"==typeof e?e:e.getEditHref(),!n)throw i.call(o,!1,null),new Error("The request cannot be processed because the URL parameter is missing.");var l={url:n,handleAs:"text",sync:this.sync,preventCache:this.preventCache,load:function(e,t){return i.call(o,t),e}};this.user&&null!==this.user&&(l.user=this.user),this.password&&null!==this.password&&(l.password=this.password),r?l.error=function(e,t){r.call(o,e,t)}:l.error=function(){throw new Error("The URL requested cannot be accessed")},d?(l.headers={"X-Method-Override":"DELETE"},dhxr.post(l)):a.del(l)}})});//# sourceMappingURL=Connection.js.map