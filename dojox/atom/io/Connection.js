//>>built
define("dojox/atom/io/Connection",["dojo/_base/declare","dojo/_base/kernel","dojo/_base/xhr","./model"],function(e,t,i,r){return e("dojox.atom.io.Connection",null,{constructor:function(e,t){this.sync=e,this.preventCache=t},preventCache:!1,alertsEnabled:!1,getFeed:function(e,t,i,a){this._getXmlDoc(e,"feed",new r.Feed,r._Constants.ATOM_NS,t,i,a)},getService:function(e,t,i,a){this._getXmlDoc(e,"service",new r.Service(e),r._Constants.APP_NS,t,i,a)},getEntry:function(e,t,i,a){this._getXmlDoc(e,"entry",new r.Entry,r._Constants.ATOM_NS,t,i,a)},_getXmlDoc:function(e,r,a,n,o,d,l){l||(l=t.global);var s=this.alertsEnabled,u={url:e,handleAs:"xml",sync:this.sync,preventCache:this.preventCache,load:function(e,t){var i,d=null,u=e;if(u){if("undefined"!=typeof u.getElementsByTagNameNS)i=u.getElementsByTagNameNS(n,r),i&&i.length>0?d=i.item(0):u.lastChild&&(d=u.lastChild);else if("undefined"!=typeof u.getElementsByTagName)if(i=u.getElementsByTagName(r),i&&i.length>0){for(var c=0;c<i.length;c++)if(i[c].namespaceURI==n){d=i[c];break}}else u.lastChild&&(d=u.lastChild);else{if(!u.lastChild)return void o.call(l,null,null,t);d=u.lastChild}if(a.buildFromDom(d),o)o.call(l,a,u,t);else if(s)throw new Error("The callback value does not exist.")}else o.call(l,null,null,t)}};this.user&&null!==this.user&&(u.user=this.user),this.password&&null!==this.password&&(u.password=this.password),d?u.error=function(e,t){d.call(l,e,t)}:u.error=function(){throw new Error("The URL requested cannot be accessed")},i.get(u)},updateEntry:function(e,r,a,n,o,d){d||(d=t.global),e.updated=new Date;var l=e.getEditHref();if(!l)throw new Error("A URL has not been specified for editing this entry.");var s=this,u=this.alertsEnabled,c={url:l,handleAs:"text",contentType:"text/xml",sync:this.sync,preventCache:this.preventCache,load:function(t,i){var a=null;if(n){a=i.xhr.getResponseHeader("Location"),a||(a=l);var o=function(e,t,i){if(r)r.call(d,e,a,i);else if(u)throw new Error("The callback value does not exist.")};s.getEntry(a,o)}else if(r)r.call(d,e,i.xhr.getResponseHeader("Location"),i);else if(u)throw new Error("The callback value does not exist.");return t}};if(this.user&&null!==this.user&&(c.user=this.user),this.password&&null!==this.password&&(c.password=this.password),a?c.error=function(e,t){a.call(d,e,t)}:c.error=function(){throw new Error("The URL requested cannot be accessed")},o)c.postData=e.toString(!0),c.headers={"X-Method-Override":"PUT"},i.post(c);else{c.putData=e.toString(!0);i.put(c)}},addEntry:function(e,r,a,n,o,d){d||(d=t.global),e.published=new Date,e.updated=new Date;var l=e.feedUrl,s=this.alertsEnabled;if(!r&&l&&(r=l),r){var u=this,c={url:r,handleAs:"text",contentType:"text/xml",sync:this.sync,preventCache:this.preventCache,postData:e.toString(!0),load:function(t,i){var n=i.xhr.getResponseHeader("Location");if(n||(n=r),i.retrieveEntry){var o=function(e,t,i){if(a)a.call(d,e,n,i);else if(s)throw new Error("The callback value does not exist.")};u.getEntry(n,o)}else if(a)a.call(d,e,n,i);else if(s)throw new Error("The callback value does not exist.");return t}};this.user&&null!==this.user&&(c.user=this.user),this.password&&null!==this.password&&(c.password=this.password),n?c.error=function(e,t){n.call(d,e,t)}:c.error=function(){throw new Error("The URL requested cannot be accessed")},i.post(c)}else if(s)throw new Error("The request cannot be processed because the URL parameter is missing.")},deleteEntry:function(e,r,a,n,o){o||(o=t.global);var d=null;if(d="string"==typeof e?e:e.getEditHref(),!d)throw r.call(o,!1,null),new Error("The request cannot be processed because the URL parameter is missing.");var l={url:d,handleAs:"text",sync:this.sync,preventCache:this.preventCache,load:function(e,t){return r.call(o,t),e}};this.user&&null!==this.user&&(l.user=this.user),this.password&&null!==this.password&&(l.password=this.password),a?l.error=function(e,t){a.call(o,e,t)}:l.error=function(){throw new Error("The URL requested cannot be accessed")},n?(l.headers={"X-Method-Override":"DELETE"},dhxr.post(l)):i.del(l)}})});//# sourceMappingURL=Connection.js.map