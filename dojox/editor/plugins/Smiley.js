//>>built
define("dojox/editor/plugins/Smiley",["dojo","dijit","dojox","dijit/_editor/_Plugin","dijit/form/DropDownButton","dojo/_base/connect","dojo/_base/declare","dojo/i18n","dojox/editor/plugins/_SmileyPalette","dojox/html/format","dojo/i18n!dojox/editor/plugins/nls/Smiley"],function(e,t,i,r){e.experimental("dojox.editor.plugins.Smiley");var a=e.declare("dojox.editor.plugins.Smiley",r,{iconClassPrefix:"dijitAdditionalEditorIcon",emoticonMarker:"[]",emoticonImageClass:"dojoEditorEmoticon",_initButton:function(){this.dropDown=new i.editor.plugins._SmileyPalette,this.connect(this.dropDown,"onChange",function(e){this.button.closeDropDown(),this.editor.focus(),e=this.emoticonMarker.charAt(0)+e+this.emoticonMarker.charAt(1),this.editor.execCommand("inserthtml",e)}),this.i18n=e.i18n.getLocalization("dojox.editor.plugins","Smiley"),this.button=new t.form.DropDownButton({label:this.i18n.smiley,showLabel:!1,iconClass:this.iconClassPrefix+" "+this.iconClassPrefix+"Smiley",tabIndex:"-1",dropDown:this.dropDown}),this.emoticonImageRegexp=new RegExp("class=(\"|')"+this.emoticonImageClass+"(\"|')")},updateState:function(){this.button.set("disabled",this.get("disabled"))},setEditor:function(t){if(this.editor=t,this._initButton(),this.editor.contentPreFilters.push(e.hitch(this,this._preFilterEntities)),this.editor.contentPostFilters.push(e.hitch(this,this._postFilterEntities)),e.isFF){var i=e.hitch(this,function(){var t=this.editor;return setTimeout(function(){t.editNode&&(e.style(t.editNode,"opacity","0.99"),setTimeout(function(){t.editNode&&e.style(t.editNode,"opacity","")},0))},0),!0});this.editor.onLoadDeferred.addCallback(e.hitch(this,function(){this.editor.addKeyHandler(e.keys.DELETE,!1,!1,i),this.editor.addKeyHandler(e.keys.BACKSPACE,!1,!1,i)}))}},_preFilterEntities:function(t){return t.replace(/\[([^\]]*)\]/g,e.hitch(this,this._decode))},_postFilterEntities:function(t){return t.replace(/<img [^>]*>/gi,e.hitch(this,this._encode))},_decode:function(e,t){var r=i.editor.plugins.Emoticon.fromAscii(t);return r?r.imgHtml(this.emoticonImageClass):e},_encode:function(e){return e.search(this.emoticonImageRegexp)>-1?this.emoticonMarker.charAt(0)+e.replace(/(<img [^>]*)alt="([^"]*)"([^>]*>)/,"$2")+this.emoticonMarker.charAt(1):e}});return e.subscribe(t._scopeName+".Editor.getPlugin",null,function(e){e.plugin||"smiley"===e.args.name&&(e.plugin=new a)}),a});//# sourceMappingURL=Smiley.js.map