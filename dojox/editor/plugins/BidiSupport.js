//>>built
define("dojox/editor/plugins/BidiSupport",["dojo/_base/declare","dojo/_base/array","dojo/aspect","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/i18n","dojo/NodeList-dom","dojo/NodeList-traverse","dojo/dom-style","dojo/sniff","dojo/query","dijit","dojox","dijit/_editor/_Plugin","dijit/_editor/range","dijit/_editor/plugins/EnterKeyHandling","dijit/_editor/plugins/FontChoice","./NormalizeIndentOutdent","dijit/form/ToggleButton","dojo/i18n!./nls/BidiSupport"],function(e,t,a,i,r,o,n,d,s,l,m,h,u,f,c,y,v,g,M,p,b){var w=e("dojox.editor.plugins.BidiSupport",y,{useDefaultCommand:!1,buttonClass:null,iconClassPrefix:"dijitAdditionalEditorIcon",command:"bidiSupport",blockMode:"DIV",shortcutonly:!1,bogusHtmlContent:"&nbsp;",buttonLtr:null,buttonRtl:null,_indentBy:40,_lineTextArray:["DIV","P","LI","H1","H2","H3","H4","H5","H6","ADDRESS","PRE","DT","DE","TD"],_lineStyledTextArray:["H1","H2","H3","H4","H5","H6","ADDRESS","PRE","P"],_tableContainers:["TABLE","THEAD","TBODY","TR"],_blockContainers:["TABLE","OL","UL","BLOCKQUOTE"],_initButton:function(){this.shortcutonly||(this.buttonLtr||(this.buttonLtr=this._createButton("ltr")),this.buttonRtl||(this.buttonRtl=this._createButton("rtl")))},_createButton:function(e){return b(i.mixin({label:d.getLocalization("dojox.editor.plugins","BidiSupport")[e],dir:this.editor.dir,lang:this.editor.lang,showLabel:!1,iconClass:this.iconClassPrefix+" "+this.iconClassPrefix+("ltr"==e?"ParaLeftToRight":"ParaRightToLeft"),onClick:i.hitch(this,"_changeState",[e])},this.params||{}))},setToolbar:function(e){this.shortcutonly||(this.editor.isLeftToRight()?(e.addChild(this.buttonLtr),e.addChild(this.buttonRtl)):(e.addChild(this.buttonRtl),e.addChild(this.buttonLtr)))},updateState:function(){if(this.editor&&this.editor.isLoaded&&!this.shortcutonly&&(this.buttonLtr.set("disabled",!!this.disabled),this.buttonRtl.set("disabled",!!this.disabled),!this.disabled)){var e=v.getSelection(this.editor.window);if(e&&0!=e.rangeCount){var t,a=e.getRangeAt(0);if(a.startContainer!==this.editor.editNode||a.startContainer.hasChildNodes()){var i=a.startContainer,r=a.startOffset;if(this._isBlockElement(i))for(;i.hasChildNodes();)r==i.childNodes.length&&r--,i=i.childNodes[r],r=0;t=this._getBlockAncestor(i)}else t=a.startContainer;var o=m.get(t,"direction");this.buttonLtr.set("checked","ltr"==o),this.buttonRtl.set("checked","rtl"==o)}}},setEditor:function(e){this.editor=e,"P"!=this.blockMode&&"DIV"!=this.blockMode&&(this.blockMode="DIV"),this._initButton();this.editor.dir;this.editor.contentPreFilters.push(this._preFilterNewLines);var t=i.hitch(this,function(e){return this.disabled||!e.hasChildNodes()?e:(this._changeStateOfBlocks(this.editor.editNode,this.editor.editNode,this.editor.editNode,"explicitdir",null),this.editor.editNode)});this.editor.contentDomPostFilters.push(t),this.editor._justifyleftImpl=i.hitch(this,function(){return this._changeState("left"),!0}),this.editor._justifyrightImpl=i.hitch(this,function(){return this._changeState("right"),!0}),this.editor._justifycenterImpl=i.hitch(this,function(){return this._changeState("center"),!0}),this.editor._insertorderedlistImpl=i.hitch(this,"_insertLists","insertorderedlist"),this.editor._insertunorderedlistImpl=i.hitch(this,"_insertLists","insertunorderedlist"),this.editor._indentImpl=i.hitch(this,"_indentAndOutdent","indent"),this.editor._outdentImpl=i.hitch(this,"_indentAndOutdent","outdent"),this.editor._formatblockImpl=i.hitch(this,"_formatBlocks"),this.editor.onLoadDeferred.addCallback(i.hitch(this,function(){var e,t,r=this.editor._plugins,o=r.length,n=i.hitch(this,"_changeState","mirror"),d=i.hitch(this,"_changeState","ltr"),s=i.hitch(this,"_changeState","rtl");for(this.editor.addKeyHandler("9",1,0,n),this.editor.addKeyHandler("8",1,0,d),this.editor.addKeyHandler("0",1,0,s),e=0;e<r.length;e++)(t=r[e])&&(t.constructor===g?(t.destroy(),t=null,o=e):t.constructor===p?(this.editor._normalizeIndentOutdent=!0,this.editor._indentImpl=i.hitch(this,"_indentAndOutdent","indent"),this.editor._outdentImpl=i.hitch(this,"_indentAndOutdent","outdent")):t.constructor===M&&"formatBlock"===t.command&&this.own(a.before(t.button,"_execCommand",i.hitch(this,"_handleNoFormat"))));this.editor.addPlugin({ctor:g,blockNodeForEnter:this.blockMode,blockNodes:/^(?:P|H1|H2|H3|H4|H5|H6|LI|DIV)$/},o),t=this.editor._plugins[o],this.own(a.after(t,"handleEnterKey",i.hitch(this,"_checkNewLine"),!0))})),this.own(a.after(this.editor,"onNormalizedDisplayChanged",i.hitch(this,"updateState"),!0))},_checkNewLine:function(){var e=v.getSelection(this.editor.window).getRangeAt(0),t=v.getBlockAncestor(e.startContainer,null,this.editor.editNode).blockNode;t.innerHTML===this.bogusHtmlContent&&t.previousSibling?t.style.cssText=t.previousSibling.style.cssText:t.innerHTML!==this.bogusHtmlContent&&t.previousSibling&&t.previousSibling.innerHTML===this.bogusHtmlContent&&(t.previousSibling.style.cssText=t.style.cssText)},_handleNoFormat:function(e,t,a){return"noFormat"===a?[e,t,"DIV"]:arguments},_execNativeCmd:function(e,t,a){if(this._isSimpleInfo(a)){var i=this.editor.document.execCommand(e,!1,t);return h("webkit")&&u("table",this.editor.editNode).prev().forEach(function(e,t,a){this._hasTag(e,"BR")&&e.parentNode.removeChild(e)},this),i}var r=v.getSelection(this.editor.window);if(!r||0==r.rangeCount)return!1;for(var o=r.getRangeAt(0),n=o.cloneRange(),d=o.startContainer,s=o.startOffset,l=o.endContainer,m=o.endOffset,f=0;f<a.groups.length;f++){var c=a.groups[f],y=c[c.length-1].childNodes.length;n.setStart(c[0],0),n.setEnd(c[c.length-1],y),r.removeAllRanges(),r.addRange(n);var g=this.editor.selection.getParentOfType(c[0],["TABLE"]),M=this.editor.document.execCommand(e,!1,t);if(h("webkit")){g&&this._hasTag(g.previousSibling,"BR")&&g.parentNode.removeChild(g.previousSibling),this.editor.focus(),r=v.getSelection(this.editor.window);var p=r.getRangeAt(0);0==f?(d=p.endContainer,s=p.endOffset):f==a.groups.length-1&&(l=p.endContainer,m=p.endOffset)}if(!M)break;h("webkit")&&this._changeState(e)}r.removeAllRanges();try{n.setStart(d,s),n.setEnd(l,m),r.addRange(n)}catch(e){}return!0},_insertLists:function(e){var t=this._changeState("preparelists",e);return!!this._execNativeCmd(e,null,t)&&(h("webkit")&&!this._isSimpleInfo(t)||this._changeState(e),this._cleanLists(),this._mergeLists(),!0)},_indentAndOutdent:function(e){if(this.editor._normalizeIndentOutdent)return this._changeState("normalize"+e),!0;var t=this._changeState("prepare"+e);if(h("mozilla")){var a;try{a=this.editor.document.queryCommandValue("styleWithCSS")}catch(e){a=!1}this.editor.document.execCommand("styleWithCSS",!1,!0)}var i=this._execNativeCmd(e,null,t);return h("mozilla")&&this.editor.document.execCommand("styleWithCSS",!1,a),!!i&&(this._changeState(e),this._mergeLists(),!0)},_formatBlocks:function(e){var t;return(h("mozilla")||h("webkit"))&&(t=this._changeState("prepareformat",e)),h("ie")&&e&&"<"!=e.charAt(0)&&(e="<"+e+">"),!!this._execNativeCmd("formatblock",e,t)&&(h("webkit")&&!this._isSimpleInfo(t)||this._changeState("formatblock",e),this._mergeLists(),!0)},_changeState:function(e,t){if(this.editor.window){this.editor.focus();var a=v.getSelection(this.editor.window);if(a&&0!=a.rangeCount){var i,r,o,n,d=a.getRangeAt(0),s=d.cloneRange();i=d.startContainer,o=d.startOffset,r=d.endContainer,n=d.endOffset;var l=i===r&&o==n;if(this._isBlockElement(i)||this._hasTagFrom(i,this._tableContainers))for(;i.hasChildNodes();)o==i.childNodes.length&&o--,i=i.childNodes[o],o=0;s.setStart(i,o),i=this._getClosestBlock(i,"start",s);var m=v.getBlockAncestor(i,/li/i,this.editor.editNode).blockNode;if(m&&m!==i&&(i=m),r=s.endContainer,n=s.endOffset,this._isBlockElement(r)||this._hasTagFrom(r,this._tableContainers))for(;r.hasChildNodes();)n==r.childNodes.length&&n--,r=r.childNodes[n],n=r.hasChildNodes()?r.childNodes.length:3==r.nodeType&&r.nodeValue?r.nodeValue.length:0;s.setEnd(r,n),r=this._getClosestBlock(r,"end",s),m=v.getBlockAncestor(r,/li/i,this.editor.editNode).blockNode,m&&m!==r&&(r=m),a=v.getSelection(this.editor.window,!0),a.removeAllRanges(),a.addRange(s);var h=v.getCommonAncestor(i,r),u=this._changeStateOfBlocks(i,r,h,e,t,s);return l&&(r=s.startContainer,n=s.startOffset,s.setEnd(r,n),a=v.getSelection(this.editor.window,!0),a.removeAllRanges(),a.addRange(s)),u}}},_isBlockElement:function(e){if(!e||1!=e.nodeType)return!1;var t=m.get(e,"display");return"block"==t||"list-item"==t||"table-cell"==t},_isInlineOrTextElement:function(e){return!this._isBlockElement(e)&&(1==e.nodeType||3==e.nodeType||8==e.nodeType)},_isElement:function(e){return e&&(1==e.nodeType||3==e.nodeType)},_isBlockWithText:function(e){return e!==this.editor.editNode&&this._hasTagFrom(e,this._lineTextArray)},_getBlockAncestor:function(e){for(;e.parentNode&&!this._isBlockElement(e);)e=e.parentNode;return e},_getClosestBlock:function(e,t,a){if(this._isBlockElement(e))return e;var i,r,o=e.parentNode,n=!1;for(removeOffset=!1;;){var d=e;for(n=!1;;){if(this._isInlineOrTextElement(d)&&(i=d,r||(r=d)),!(d=d.previousSibling))break;if(this._isBlockElement(d)||this._hasTagFrom(d,this._blockContainers)||this._hasTag(d,"BR")){n=!0;break}if(3==d.nodeType&&3==d.nextSibling.nodeType&&(d.nextSibling.nodeValue=d.nodeValue+d.nextSibling.nodeValue,!0,"start"==t&&d===a.startContainer?a.setStart(d.nextSibling,0):"end"!=t||d!==a.endContainer&&d.nextSibling!==a.endContainer||a.setEnd(d.nextSibling,d.nextSibling.nodeValue.length),d=d.nextSibling,d.parentNode.removeChild(d.previousSibling),!d.previousSibling))break}for(d=e;;){if(this._isInlineOrTextElement(d)&&(i||(i=d),r=d),!(d=d.nextSibling))break;if(this._isBlockElement(d)||this._hasTagFrom(d,this._blockContainers)){n=!0;break}if(this._hasTag(d,"BR")&&d.nextSibling&&!this._isBlockElement(d.nextSibling)&&!this._hasTagFrom(d.nextSibling,this._blockContainers)){r=d,n=!0;break}if(3==d.nodeType&&3==d.previousSibling.nodeType&&(d.previousSibling.nodeValue+=d.nodeValue,!0,"start"==t&&d===a.startContainer?a.setStart(d.previousSibling,0):"end"!=t||d!==a.endContainer&&d.previousSibling!==a.endContainer||a.setEnd(d.previousSibling,d.previousSibling.nodeValue.length),d=d.previousSibling,d.parentNode.removeChild(d.nextSibling),!d.nextSibling))break}if(n||this._isBlockElement(o)&&!this._isBlockWithText(o)&&i){var s=a?a.startOffset:0,l=a?a.endOffset:0,m=a?a.startContainer:null,h=a?a.endContainer:null,u=this._repackInlineElements(i,r,o),f=u["start"==t?0:u.length-1];return a&&f&&i===m&&this._hasTag(i,"BR")&&(m=f,s=0,r===i&&(h=m,l=0)),a&&(a.setStart(m,s),a.setEnd(h,l)),f}if(this._isBlockElement(o))return o;e=o,removeOffset=!0,o=o.parentNode,i=r=null}},_changeStateOfBlocks:function(e,t,a,i,r,o){var n=[];if(e===this.editor.editNode){if(!e.hasChildNodes())return;this._isInlineOrTextElement(e.firstChild)&&this._rebuildBlock(e),e=this._getClosestBlock(e.firstChild,"start",null)}if(t===this.editor.editNode){if(!t.hasChildNodes())return;this._isInlineOrTextElement(t.lastChild)&&this._rebuildBlock(t),t=this._getClosestBlock(t.lastChild,"end",null)}var d=o?o.startOffset:0,s=o?o.endOffset:0,l=o?o.startContainer:null,m=o?o.endContainer:null,h=this._collectNodes(e,t,a,o,n,l,d,m,s,i),u={nodes:n,groups:h.groups,cells:h.cells};switch(i=i.toString()){case"mirror":case"ltr":case"rtl":case"left":case"right":case"center":case"explicitdir":this._execDirAndAlignment(u,i,r);break;case"preparelists":this._prepareLists(u,r);break;case"insertorderedlist":case"insertunorderedlist":this._execInsertLists(u);break;case"prepareoutdent":this._prepareOutdent(u);break;case"prepareindent":this._prepareIndent(u);break;case"indent":this._execIndent(u);break;case"outdent":this._execOutdent(u);break;case"normalizeindent":this._execNormalizedIndent(u);break;case"normalizeoutdent":this._execNormalizedOutdent(u);break;case"prepareformat":this._prepareFormat(u,r);break;case"formatblock":this._execFormatBlocks(u,r)}return o&&(o.setStart(l,d),o.setEnd(m,s),sel=v.getSelection(this.editor.window,!0),sel.removeAllRanges(),sel.addRange(o),this.editor.onDisplayChanged()),u},_collectNodes:function(e,t,a,r,o,n,d,s,l,m){var u,f,c=e,y=c.parentNode,g=[],M=[],p=[],b=[],w=this.editor.editNode,k=i.hitch(this,function(e){o.push(e);var t=this.editor.selection.getParentOfType(e,["TD"]);(w!==t||h("webkit")&&("prepareformat"===m||"preparelists"===m))&&(p.length&&M.push(p),p=[],w!=t&&(w=t)&&b.push(w)),p.push(e)});for(this._rebuildBlock(y);;){if(this._hasTagFrom(c,this._tableContainers)){if(c.firstChild){y=c,c=c.firstChild;continue}}else if(this._isBlockElement(c)){var F=v.getBlockAncestor(c,/li/i,this.editor.editNode).blockNode;if(F&&F!==c){c=F,y=c.parentNode;continue}if(!this._hasTag(c,"LI")&&c.firstChild&&(this._rebuildBlock(c),this._isBlockElement(c.firstChild)||this._hasTagFrom(c.firstChild,this._tableContainers))){y=c,c=c.firstChild;continue}this._hasTagFrom(c,this._lineTextArray)&&k(c)}else if(this._isInlineOrTextElement(c)&&!this._hasTagFrom(c.parentNode,this._tableContainers)){for(u=c;c;){var I=c.nextSibling;if(this._isInlineOrTextElement(c)){if(f=c,this._hasTag(c,"BR")&&(!this._isBlockElement(y)||c!==y.lastChild)){g=this._repackInlineElements(u,f,y),c=g[g.length-1];for(var _=0;_<g.length;_++)k(g[_]);u=f=null,I&&this._isInlineOrTextElement(I)&&(u=I)}}else if(this._isBlockElement(c))break;c=I}if(!u)continue;g=this._repackInlineElements(u,f,y),c=g[g.length-1];for(var _=0;_<g.length;_++)k(g[_])}if(c===t)break;if(c.nextSibling)c=c.nextSibling;else{if(y===a)break;for(;!y.nextSibling&&(c=y,(y=c.parentNode)!==a););if(y===a||!y.nextSibling)break;c=y.nextSibling,y=y.parentNode}}return p.length&&(h("webkit")||w?M.push(p):M.unshift(p)),{groups:M,cells:b}},_execDirAndAlignment:function(e,a,i){switch(a){case"mirror":case"ltr":case"rtl":t.forEach(e.nodes,function(e){var t=m.getComputedStyle(e),i=t.direction,o="ltr"==i?"rtl":"ltr",n="mirror"!=a?a:o,d=t.textAlign,s=isNaN(parseInt(t.marginLeft))?0:parseInt(t.marginLeft),l=isNaN(parseInt(t.marginRight))?0:parseInt(t.marginRight);if(r.remove(e,"dir"),r.remove(e,"align"),m.set(e,{direction:n,textAlign:""}),!this._hasTag(e,"CENTER"))if(d.indexOf("center")>=0&&m.set(e,"textAlign","center"),this._hasTag(e,"LI")){this._refineLIMargins(e);var u="rtl"===i?l:s,f=0,c=e.parentNode;if(i!=m.get(c,"direction")){for(;c!==this.editor.editNode;)this._hasTagFrom(c,["OL","UL"])&&f++,c=c.parentNode;u-=this._getMargins(f)}var y="rtl"==n?"marginRight":"marginLeft",v=m.get(e,y),g=isNaN(v)?0:parseInt(v);if(m.set(e,y,g+u+"px"),h("webkit"))d.indexOf("center")<0&&m.set(e,"textAlign","rtl"==n?"right":"left");else if(e.firstChild&&e.firstChild.tagName&&this._hasTagFrom(e.firstChild,this._lineStyledTextArray)){var t=m.getComputedStyle(e),M=this._refineAlignment(t.direction,t.textAlign);h("mozilla")?m.set(e.firstChild,{textAlign:M}):m.set(e.firstChild,{direction:n,textAlign:M})}}else"rtl"==n&&0!=s?m.set(e,{marginLeft:"",marginRight:s+"px"}):"ltr"==n&&0!=l&&m.set(e,{marginRight:"",marginLeft:l+"px"})},this),u("table",this.editor.editNode).forEach(function(t,i,r){var o=a;"mirror"===a&&(o="ltr"===m.get(t,"direction")?"rtl":"ltr");for(var n=u("td",t),d=!1,s=!1,l=0;l<e.cells.length;l++)if(d||n[0]!==e.cells[l]){if(n[n.length-1]===e.cells[l]){s=!0;break}}else d=!0;if(d&&s)for(m.set(t,"direction",o),l=0;l<n.length;l++)m.set(n[l],"direction",o)},this);break;case"left":case"right":case"center":t.forEach(e.nodes,function(e){if(!this._hasTag(e,"CENTER")&&(r.remove(e,"align"),m.set(e,"textAlign",a),this._hasTag(e,"LI")&&e.firstChild&&e.firstChild.tagName&&this._hasTagFrom(e.firstChild,this._lineStyledTextArray))){var t=m.getComputedStyle(e),i=this._refineAlignment(t.direction,t.textAlign);m.set(e.firstChild,"textAlign",i)}},this);break;case"explicitdir":t.forEach(e.nodes,function(e){var t=m.getComputedStyle(e),a=t.direction;r.remove(e,"dir"),m.set(e,{direction:a})},this)}},_prepareLists:function(e,a){t.forEach(e.nodes,function(e,t,i){if(h("mozilla")||h("webkit")){if(h("mozilla")){var o=this._getParentFrom(e,["TD"]);o&&0==u("div[tempRole]",o).length&&n.create("div",{innerHTML:"<span tempRole='true'>"+this.bogusHtmlContent+"</span",tempRole:"true"},o)}var d,s=this._tag(e);if(h("webkit")&&this._hasTagFrom(e,this._lineStyledTextArray)||this._hasTag(e,"LI")&&this._hasStyledTextLineTag(e.firstChild)){var l=this._hasTag(e,"LI")?this._tag(e.firstChild):s;if(this._hasTag(e,"LI")){for(;e.firstChild.lastChild;)n.place(e.firstChild.lastChild,e.firstChild,"after");e.removeChild(e.firstChild)}d=n.create("span",{innerHTML:this.bogusHtmlContent,bogusFormat:l},e,"first")}if(!h("webkit")&&"DIV"!=s&&"P"!=s&&"LI"!=s)return;if(h("webkit")&&this._isListTypeChanged(e,a)&&e===e.parentNode.lastChild&&n.create("li",{tempRole:"true"},e,"after"),"LI"==s&&e.firstChild&&e.firstChild.tagName&&this._hasTagFrom(e.firstChild,this._lineStyledTextArray))return;var f=m.getComputedStyle(e),c=f.direction,y=f.textAlign;y=this._refineAlignment(c,y);var v=this._getLIIndent(e),g=0==v?"":v+"px";h("webkit")&&"LI"==s&&m.set(e,"textAlign","");var M=d?e.firstChild:n.create("span",{innerHTML:this.bogusHtmlContent},e,"first");r.set(M,"bogusDir",c),""!=y&&r.set(M,"bogusAlign",y),g&&r.set(M,"bogusMargin",g)}else if(h("ie")&&this._hasTag(e,"LI")){m.getComputedStyle(e).direction;if(m.set(e,"marginRight",""),m.set(e,"marginLeft",""),1==this._getLILevel(e)&&!this._isListTypeChanged(e,cmd)&&(e.firstChild&&this._hasTagFrom(e.firstChild,["P","PRE"])&&n.create("span",{bogusIEFormat:this._tag(e.firstChild)},e.firstChild,"first"),this._hasTag(e.firstChild,"PRE"))){for(var p=n.create("p",null,e.firstChild,"after");e.firstChild.firstChild;)n.place(e.firstChild.firstChild,p,"last");p.style.cssText=e.style.cssText,e.removeChild(e.firstChild)}}},this),h("webkit")&&u("table",this.editor.editNode).forEach(function(e,t,a){var i=e.nextSibling;i&&this._hasTagFrom(i,["UL","OL"])&&n.create("UL",{tempRole:"true"},e,"after")},this)},_execInsertLists:function(e){t.forEach(e.nodes,function(e,t){if(this._hasTag(e,"LI")){if(e.firstChild&&e.firstChild.tagName&&this._hasTagFrom(e.firstChild,this._lineStyledTextArray)){var a=m.getComputedStyle(e.firstChild),d=this._refineAlignment(a.direction,a.textAlign);m.set(e,{direction:a.direction,textAlign:d});var s=this._getIntStyleValue(e,"marginLeft")+this._getIntStyleValue(e.firstChild,"marginLeft"),l=this._getIntStyleValue(e,"marginRight")+this._getIntStyleValue(e.firstChild,"marginRight"),u=s?s+"px":"",f=l?l+"px":"";m.set(e,{marginLeft:u,marginRight:f}),m.set(e.firstChild,{direction:"",textAlign:""}),h("mozilla")||m.set(e.firstChild,{marginLeft:"",marginRight:""})}for(;e.childNodes.length>1&&3==e.lastChild.nodeType&&e.lastChild.previousSibling&&3==e.lastChild.previousSibling.nodeType&&""==i.trim(e.lastChild.nodeValue);)e.removeChild(e.lastChild);if(h("safari")&&this._hasTag(e.firstChild,"SPAN")&&o.contains(e.firstChild,"Apple-style-span")){var c=e.firstChild;if(this._hasTag(c.firstChild,"SPAN")&&r.has(c.firstChild,"bogusFormat")){for(;c.lastChild;)n.place(c.lastChild,c,"after");e.removeChild(c)}}}else if(this._hasTag(e,"DIV")&&0==e.childNodes.length)return void e.parentNode.removeChild(e);if(h("ie")){if(this._hasTag(e,"P")&&"DIV"==this.blockMode.toUpperCase()){if(this._hasTag(e.firstChild,"SPAN")&&r.has(e.firstChild,"bogusIEFormat")){if("PRE"===r.get(e.firstChild,"bogusIEFormat").toUpperCase()){var y=n.create("pre",{innerHTML:e.innerHTML},e,"before");y.style.cssText=e.style.cssText,y.removeChild(y.firstChild),e.parentNode.removeChild(e)}else e.removeChild(e.firstChild);return}var v=n.create("div");for(v.style.cssText=e.style.cssText,e.parentNode.insertBefore(v,e);e.firstChild;)v.appendChild(e.firstChild);e.parentNode.removeChild(e)}if(!this._hasTag(e,"LI"))return;this._refineLIMargins(e);var g=e.firstChild;if(!this._hasTag(g,"DIV"))return;if(g!==e.lastChild)return;var a=m.getComputedStyle(g),M=a.direction,d=a.textAlign;m.getComputedStyle(e).textAlign;for(m.set(e,"direction",M),d=this._refineAlignment(M,d),m.set(e,"textAlign",d);g.firstChild;)e.insertBefore(g.firstChild,g);e.removeChild(g)}else if(!this._hasTag(e.firstChild,"SPAN"))return void(this._hasTag(e,"LI")&&(this._refineLIMargins(e),h("mozilla")&&this._hasStyledTextLineTag(e.firstChild)&&this._recountLIMargins(e)));var p=!1,b=!1,w=!1,k=0;if(r.has(e.firstChild,"bogusDir")){p=!0;var M=r.get(e.firstChild,"bogusDir");m.set(e,"direction",M)}if(r.has(e.firstChild,"bogusAlign")){p=!0,w=!0;var d=r.get(e.firstChild,"bogusAlign");m.set(e,"textAlign",d);var F=e.firstChild.nextSibling;if(this._hasTag(F,"SPAN")&&m.get(F,"textAlign")===d&&(m.set(F,"textAlign",""),""==F.style.cssText)){for(;F.lastChild;)n.place(F.lastChild,F,"after");e.removeChild(F)}}if(r.has(e.firstChild,"bogusMargin")&&(p=!0,b=!0,k=parseInt(r.get(e.firstChild,"bogusMargin")),!this._hasTag(e,"LI"))){var I="rtl"===m.get(e,"direction")?"marginRight":"marginLeft",_=this._getIntStyleValue(e,I)+k;m.set(e,I,0==_?"":_+"px")}if(r.has(e.firstChild,"bogusFormat")){if(p=!1,r.remove(e.firstChild,"bogusDir"),e.firstChild.nextSibling&&this._hasTag(e.firstChild.nextSibling,"SPAN")){for(var x=e.firstChild.style.cssText.trim().split(";"),E=e.firstChild.nextSibling.style.cssText.trim().split(";"),S=0;S<x.length;S++)if(x[S])for(var j=0;j<E.length;j++)if(x[S].trim()==E[j].trim()){var a=x[S].trim().split(":")[0];m.set(e.firstChild.nextSibling,a,"");break}if(""===e.firstChild.nextSibling.style.cssText){for(;e.firstChild.nextSibling.firstChild;)n.place(e.firstChild.nextSibling.firstChild,e.firstChild.nextSibling,"after");e.removeChild(e.firstChild.nextSibling)}}for(var T=r.get(e.firstChild,"bogusFormat"),C=n.create(T,null,e.firstChild,"after");C.nextSibling;)n.place(C.nextSibling,C,"last");if(e.removeChild(e.firstChild),h("webkit")&&this._hasTag(e,"LI")){var A=e.parentNode.parentNode;this._hasTag(A,T)&&r.set(A,"tempRole","true")}1!=e.childNodes.length||this._hasTag(e,"TD")||(h("mozilla")||this._hasTag(e,"LI")?this._hasTag(e,"LI")||(C.style.cssText=e.style.cssText,n.place(C,e,"after"),r.set(e,"tempRole","true")):(C.style.cssText=e.style.cssText,r.set(e,"tempRole","true")))}if(p&&e.removeChild(e.firstChild),this._hasTag(e,"LI")){h("webkit")&&!w&&"center"!=m.get(e,"textAlign")&&m.set(e,"textAlign","rtl"==m.get(e,"direction")?"right":"left"),h("safari")&&this._hasTag(e,"DIV")&&(e.innerHTML=e.nextSibling.innerHTML,e.parentNode.removeChild(e.nextSibling));var z=e.parentNode.parentNode;z!==this.editor.editNode&&this._hasTag(z,"DIV")&&1==z.childNodes.length&&(z.parentNode.insertBefore(e.parentNode,z),z.parentNode.removeChild(z)),this._refineLIMargins(e),b&&this._recountLIMargins(e,k)}},this),h("mozilla")?u("*[tempRole]",this.editor.editNode).forEach(function(e,t,a){if(this._hasTag(e,"SPAN")){if(r.get(e.parentNode,"tempRole"))return;if(this._hasTag(e.parentNode,"LI"))return void e.parentNode.parentNode.removeChild(e.parentNode)}e.parentNode.removeChild(e)},this):h("webkit")&&u("*[tempRole]",this.editor.editNode).forEach(function(e,t,a){if(!this._hasTag(e,"LI")&&!this._hasTag(e,"UL")){for(;e.lastChild;)n.place(e.lastChild,e,"after");e.parentNode.removeChild(e)}},this)},_execNormalizedIndent:function(e){t.forEach(e.nodes,function(e){var t="rtl"===m.get(e,"direction")?"marginRight":"marginLeft",a=m.get(e,t),i=isNaN(a)?0:parseInt(a);m.set(e,t,i+this._indentBy+"px")},this)},_execNormalizedOutdent:function(e){t.forEach(e.nodes,function(e){var t="rtl"===m.get(e,"direction")?"marginRight":"marginLeft",a=m.get(e,t),i=isNaN(a)?0:parseInt(a),r=0;if("LI"===e.tagName.toUpperCase()){var o=0,n=e.parentNode;if(m.get(e,"direction")!=m.get(n,"direction")){for(;n!==this.editor.editNode;)this._hasTagFrom(n,["OL","UL"])&&o++,n=n.parentNode;r=this._getMargins(o)}}i>=this._indentBy+r&&m.set(e,t,i==this._indentBy?"":i-this._indentBy+"px")},this)},_prepareIndent:function(e){t.forEach(e.nodes,function(e){if(h("mozilla")){var t=this._getParentFrom(e,["TD"]);if(t&&0==u("div[tempRole]",t).length&&n.create("div",{innerHTML:this.bogusHtmlContent,tempRole:"true"},t),this._hasTag(e,"LI")){var a=this._getLIIndent(e);r.set(e,"tempIndent",a)}}if(h("webkit")&&this._hasTag(e,"LI")&&this._hasStyledTextLineTag(e.firstChild)){for(var i=this._tag(e.firstChild);e.firstChild.lastChild;)n.place(e.firstChild.lastChild,e.firstChild,"after");e.removeChild(e.firstChild),n.create("span",{innerHTML:this.bogusHtmlContent,bogusFormat:i},e,"first")}},this)},_prepareOutdent:function(e){t.forEach(e.nodes,function(e){if(h("mozilla")||h("webkit")){if(h("mozilla")){var t=this._getParentFrom(e,["TD"]);t&&0==u("div[tempRole]",t).length&&n.create("div",{innerHTML:this.bogusHtmlContent,tempRole:"true"},t)}var a=this._tag(e);if(h("mozilla")&&"LI"!==a)return;var i=null;if(h("webkit")&&this._hasTag(e,"LI")&&this._hasStyledTextLineTag(e.firstChild)){a=this._tag(e.firstChild);for(var o=e.firstChild;o.lastChild;)n.place(o.lastChild,o,"after");e.removeChild(e.firstChild),i=n.create("span",{innerHTML:this.bogusHtmlContent,bogusFormat:a},e,"first")}if(e.firstChild&&e.firstChild.tagName&&this._hasTagFrom(e.firstChild,this._lineStyledTextArray)){if(h("mozilla")){e.firstChild.style.cssText=e.style.cssText;var d="rtl"===m.get(e,"direction")?"marginRight":"marginLeft",s=this._getLIIndent(e);s>0&&m.set(e.firstChild,d,s+"px")}return}var l=m.getComputedStyle(e),f=l.direction,c=l.textAlign;c=this._refineAlignment(f,c),h("webkit")&&"LI"==a&&m.set(e,"textAlign","");var y=i?e.firstChild:n.create("span",{innerHTML:this.bogusHtmlContent},e,"first");if(r.set(y,"bogusDir",f),""!=c&&r.set(y,"bogusAlign",c),h("mozilla")){var s=this._getLIIndent(e);r.set(y,"bogusIndent",s)}}if(h("ie")&&"LI"==e.tagName.toUpperCase()&&(m.set(e,"marginLeft",""),m.set(e,"marginRight",""),1==this._getLILevel(e)&&(e.firstChild&&this._hasTagFrom(e.firstChild,["P","PRE"])&&n.create("span",{bogusIEFormat:this._tag(e.firstChild)},e.firstChild,"first"),this._hasTag(e.firstChild,"PRE")))){for(var v=n.create("p",null,e.firstChild,"after");e.firstChild.firstChild;)n.place(e.firstChild.firstChild,v,"last");v.style.cssText=e.style.cssText,e.removeChild(e.firstChild)}},this)},_execIndent:function(e){t.forEach(e.nodes,function(e){if(h("mozilla")||m.set(e,"margin",""),this._hasTag(e,"LI")){var t=0;h("mozilla")&&r.has(e,"tempIndent")&&(t=parseInt(r.get(e,"tempIndent")),r.remove(e,"tempIndent")),this._refineLIMargins(e),h("mozilla")&&this._recountLIMargins(e,t)}if(r.has(e.firstChild,"bogusFormat")){for(var a=r.get(e.firstChild,"bogusFormat"),i=n.create(a,null,e.firstChild,"after");i.nextSibling;)n.place(i.nextSibling,i,"last");e.removeChild(e.firstChild)}if(h("ie")||h("webkit"))for(var o=e.parentNode;o!==this.editor.editNode&&(o=v.getBlockAncestor(o,/blockquote/i,this.editor.editNode).blockNode);)r.has(o,"dir")&&r.remove(o,"dir"),m.set(o,"marginLeft",""),m.set(o,"marginRight",""),m.set(o,"margin",""),o=o.parentNode},this),h("mozilla")&&(u("div[tempRole]",this.editor.editNode).forEach(function(e,t,a){e.parentNode.removeChild(e)}),u("ul,ol",this.editor.editNode).forEach(function(e,t,a){m.set(e,"marginLeft",""),m.set(e,"marginRight","")}))},_execOutdent:function(e){t.forEach(e.nodes,function(e){if(h("mozilla")||h("webkit")){if(!this._hasTag(e.firstChild,"SPAN"))return void(this._hasTag(e,"LI")&&(this._refineLIMargins(e),h("mozilla")&&this._hasStyledTextLineTag(e.firstChild)&&(this._recountLIMargins(e),e.firstChild.style.cssText="")));var t=!1,a=!1,i=0;if(r.has(e.firstChild,"bogusDir")){t=!0;var o=r.get(e.firstChild,"bogusDir");m.set(e,"direction",o)}if(r.has(e.firstChild,"bogusAlign")){t=!0;var d=r.get(e.firstChild,"bogusAlign");m.set(e,"textAlign",d)}if(r.has(e.firstChild,"bogusIndent")&&(t=!0,i=parseInt(r.get(e.firstChild,"bogusIndent")),!this._hasTag(e,"LI"))){var s="rtl"===m.get(e,"direction")?"marginRight":"marginLeft",l=this._getIntStyleValue(e,s)+i+"px";m.set(e,s,l)}if(r.has(e.firstChild,"bogusFormat")){t=!0;for(var u=r.get(e.firstChild,"bogusFormat"),f=n.create(u,null,e.firstChild,"after");f.nextSibling;)n.place(f.nextSibling,f,"last");this._hasTag(e,"LI")||(f.style.cssText=e.style.cssText,a=!0)}if(t&&(e.removeChild(e.firstChild),a)){for(;e.lastChild;)n.place(e.lastChild,e,"after");r.set(e,"tempRole","true")}if(h("webkit")&&this._hasTag(e,"LI")&&"center"!=m.get(e,"textAlign")&&m.set(e,"textAlign","rtl"==m.get(e,"direction")?"right":"left"),h("mozilla")&&this._hasTag(e,"LI")){var c=e.parentNode.parentNode;c!==this.editor.editNode&&this._hasTag(c,"DIV")&&1==c.childNodes.length&&(c.parentNode.insertBefore(e.parentNode,c),c.parentNode.removeChild(c))}}if(h("ie")&&this._hasTag(e,"P")&&"DIV"==this.blockMode.toUpperCase()){if(this._hasTag(e.firstChild,"SPAN")&&r.has(e.firstChild,"bogusIEFormat")){if("PRE"===r.get(e.firstChild,"bogusIEFormat").toUpperCase()){var y=n.create("pre",{innerHTML:e.innerHTML},e,"before");y.style.cssText=e.style.cssText,y.removeChild(y.firstChild),e.parentNode.removeChild(e)}else e.removeChild(e.firstChild);return}var v=n.create("div");for(v.style.cssText=e.style.cssText,e.parentNode.insertBefore(v,e);e.firstChild;)v.appendChild(e.firstChild);e.parentNode.removeChild(e)}this._hasTag(e,"LI")&&(this._refineLIMargins(e),h("mozilla")&&this._recountLIMargins(e,i))},this),(h("mozilla")||h("webkit"))&&u("div[tempRole]",this.editor.editNode).forEach(function(e,t,a){e.parentNode.removeChild(e)})},_prepareFormat:function(e,a){t.forEach(e.nodes,function(e){if(h("mozilla")&&this._hasTag(e,"LI")){if(e.firstChild&&!this._isBlockElement(e.firstChild)){var t=e.ownerDocument.createElement(a),i=e.firstChild;for(e.insertBefore(t,e.firstChild);i;)t.appendChild(i),i=i.nextSibling}var o=this._getLIIndent(e);r.set(e,"tempIndent",o)}if(h("webkit")){var d;if(this._hasTag(e,"LI")){var s=a;if(this._hasStyledTextLineTag(e.firstChild)){for(;e.firstChild.lastChild;)n.place(e.firstChild.lastChild,e.firstChild,"after");e.removeChild(e.firstChild)}d=n.create("span",{innerHTML:this.bogusHtmlContent,bogusFormat:s},e,"first")}var l=m.getComputedStyle(e),u=l.direction,f=l.textAlign;f=this._refineAlignment(u,f);var c=d?e.firstChild:n.create("span",{innerHTML:this.bogusHtmlContent},e,"first");r.set(c,"bogusDir",u),""!=f&&r.set(c,"bogusAlign",f)}},this)},_execFormatBlocks:function(e,a){t.forEach(e.nodes,function(e){if(this._hasTagFrom(e,this._lineTextArray)){if(this._hasTag(e.parentNode,"DIV")&&e.parentNode!==this.editor.editNode)for(;e.parentNode.lastChild&&(3==e.parentNode.lastChild.nodeType&&""==i.trim(e.parentNode.lastChild.nodeValue)||this._hasTag(e.parentNode.lastChild,"BR"));)e.parentNode.removeChild(e.parentNode.lastChild);if(this._hasTag(e.parentNode,"DIV")&&e.parentNode!==this.editor.editNode&&1==e.parentNode.childNodes.length){var t=e.parentNode,o=m.getComputedStyle(t),d=this._refineAlignment(o.direction,o.textAlign);m.set(e,{direction:o.direction,textAlign:d});var s="rtl"===o.direction?"marginRight":"marginLeft",l=parseInt(m.get(t,s));0==l||isNan(l)||m.set(e,s,l),t.parentNode.insertBefore(e,t),t.parentNode.removeChild(t)}}if(this._hasTag(e,"LI")){var u=0;for(r.has(e,"tempIndent")&&(u=parseInt(r.get(e,"tempIndent")),r.remove(e,"tempIndent")),this._refineLIMargins(e),u&&this._recountLIMargins(e,u);e.childNodes.length>1&&3==e.lastChild.nodeType&&""==i.trim(e.lastChild.nodeValue);)e.removeChild(e.lastChild);if(this._hasTagFrom(e.firstChild,this._lineStyledTextArray)){var o=m.getComputedStyle(e),d=this._refineAlignment(o.direction,o.textAlign);h("mozilla")||h("ie")&&this._hasTag(e,"LI")||m.set(e.firstChild,{direction:o.direction,textAlign:d})}else if(this._hasTag(e.firstChild,"DIV")){for(var t=e.firstChild;t.firstChild;)e.insertBefore(t.firstChild,t);e.removeChild(t)}if(h("ie")&&!this._hasTag(e.firstChild,"P")&&"<p>"===a){for(var f=n.create("p"),c=this._hasTagFrom(f.nextSibling,this._lineStyledTextArray)?f.nextSibling:e;c.firstChild;)n.place(c.firstChild,f,"last");n.place(f,e,"first"),c!==e&&e.removeChild(c)}}if(h("webkit")){if(this._hasTag(e,"DIV")){if(r.has(e,"tempRole"))return;if(this._hasTag(e.previousSibling,"LI")){for(;e.firstChild;)n.place(e.firstChild,e.previousSibling,"last");r.set(e,"tempRole",!0),e=e.previousSibling}}var y=!1;if(r.has(e.firstChild,"bogusDir")){y=!0;var v=r.get(e.firstChild,"bogusDir");m.set(e,"direction",v)}if(r.has(e.firstChild,"bogusAlign")){y=!0;var d=r.get(e.firstChild,"bogusAlign");m.set(e,"textAlign",d)}if(r.has(e.firstChild,"bogusFormat")){y=!0;var c,g=r.get(e.firstChild,"bogusFormat");if("DIV"!==g.toUpperCase())for(c=n.create(g,null,e.firstChild,"after");c.nextSibling;)n.place(c.nextSibling,c,"last");else c=e;if(h("safari")&&this._hasTag(e.nextSibling,"DIV")){for(;e.nextSibling.firstChild;)n.place(e.nextSibling.firstChild,c,"last");r.set(e.nextSibling,"tempRole","true")}}if(y&&e.removeChild(e.firstChild),g&&this._hasTag(e,"LI")){var M=e.parentNode.parentNode;this._hasTag(M,g)&&r.set(M,"tempRole","true")}}},this),h("webkit")&&u("*[tempRole]",this.editor.editNode).forEach(function(e,t,a){for(;e.lastChild;)n.place(e.lastChild,e,"after");e.parentNode.removeChild(e)},this)},_rebuildBlock:function(e){for(var t,a,i=e.firstChild,r=!1;i;)this._isInlineOrTextElement(i)&&!this._hasTagFrom(i,this._tableContainers)?(r=!this._hasTagFrom(e,this._lineTextArray),t||(t=i),a=i):(this._isBlockElement(i)||this._hasTagFrom(i,this._tableContainers))&&(t&&(this._repackInlineElements(t,a,e),t=null),r=!0),i=i.nextSibling;r&&t&&this._repackInlineElements(t,a,e)},_repackInlineElements:function(e,t,a){var i,r=[],o=a.ownerDocument.createElement(this.blockMode),d=e.previousSibling&&1==e.previousSibling.nodeType?e.previousSibling.style.cssText:a.style.cssText,s=a===this.editor.editNode;r.push(o),e=a.replaceChild(o,e),n.place(e,o,"after"),s?m.set(o,"direction",m.get(this.editor.editNode,"direction")):o.style.cssText=d;for(var l=e;l;){var u=l.nextSibling;if(this._isInlineOrTextElement(l)&&(this._hasTag(l,"BR")&&l!==t&&(i=a.ownerDocument.createElement(this.blockMode),r.push(i),l=a.replaceChild(i,l),n.place(l,i,"after"),s?m.set(i,"direction",m.get(this.editor.editNode,"direction")):i.style.cssText=d),!this._hasTag(l,"BR")&&8!=l.nodeType||o.hasChildNodes()||(o.innerHTML=this.bogusHtmlContent),this._hasTag(l,"BR")&&h("ie")?l.parentNode.removeChild(l):8!=l.nodeType?o.appendChild(l):l.parentNode.removeChild(l),3==l.nodeType&&l.previousSibling&&3==l.previousSibling.nodeType&&(l.previousSibling.nodeValue+=l.nodeValue,l.parentNode.removeChild(l)),i&&(o=i,i=null)),l===t)break;l=u}return r},_preFilterNewLines:function(e){for(var t=e.split(/(<\/?pre.*>)/i),a=!1,i=0;i<t.length;i++)t[i].search(/<\/?pre/i)<0&&!a?t[i]=t[i].replace(/\n/g,"").replace(/\t+/g," ").replace(/^\s+/," ").replace(/\xA0\xA0+$/,""):t[i].search(/<\/?pre/i)>=0&&(a=!a);return t.join("")},_refineAlignment:function(e,t){return t=t.indexOf("left")>=0&&"rtl"==e?"left":t.indexOf("right")>=0&&"ltr"==e?"right":t.indexOf("center")>=0?"center":""},_refineLIMargins:function(e){var t,a,i,r=m.get(e,"direction"),o=m.get(e.parentNode,"direction"),n=0,d=e.parentNode;for(h("webkit")&&(o=m.get(this.editor.editNode,"direction"));d!==this.editor.editNode;)this._hasTagFrom(d,["OL","UL"])&&n++,d=d.parentNode;m.set(e,"marginRight",""),m.set(e,"marginLeft",""),t="rtl"==r?"marginRight":"marginLeft",a=this._getMargins(n),i=a+"px",r!=o&&m.set(e,t,i)},_getMargins:function(e){if(0==e)return 0;var t=35;return h("mozilla")?t=45:h("ie")&&(t=25),t+40*(e-1)},_recountLIMargins:function(e,t){var a=m.get(e,"direction"),i=m.get(e.parentNode,"direction"),r="rtl"==a?"marginRight":"marginLeft",o=m.get(e,r),d=(isNaN(parseInt(o))?0:parseInt(o))+(t||0);e.firstChild&&1==e.firstChild.nodeType&&(o=m.get(e.firstChild,r),d+=isNaN(parseInt(o))?0:parseInt(o),m.set(e.firstChild,{marginLeft:"",marginRight:""})),a!=i&&(d-=this._getMargins(this._getLILevel(e)));var s=this._getListMargins(e);if(s)for(var l=0;l<s/40;l++){var h=n.create(this._tag(e.parentNode),null,e,"before");n.place(e,h,"last")}a!=i&&(d+=this._getMargins(this._getLILevel(e))),d&&m.set(e,r,d+"px")},_getLILevel:function(e){for(var t=e.parentNode,a=0;this._hasTagFrom(t,["UL","OL"]);)a++,t=t.parentNode;return a},_getLIIndent:function(e){var t=e.parentNode,a=m.get(e,"direction"),i=m.get(t,"direction"),r="rtl"===a?"marginRight":"marginLeft";return this._getIntStyleValue(e,r)-(a===i?0:this._getMargins(this._getLILevel(e)))},_getListMargins:function(e){for(var t,a,i=e.parentNode,r=0;this._hasTagFrom(i,["UL","OL"]);){t="rtl"==m.get(i,"direction")?"marginRight":"marginLeft",a=m.get(i,t),r+=isNaN(parseInt(a))?0:parseInt(a),i=i.parentNode}return r},_tag:function(e){return e&&e.tagName&&e.tagName.toUpperCase()},_hasTag:function(e,t){return e&&t&&e.tagName&&e.tagName.toUpperCase()===t.toUpperCase()},_hasStyledTextLineTag:function(e){return this._hasTagFrom(e,this._lineStyledTextArray)},_hasTagFrom:function(e,a){return e&&a&&e.tagName&&t.indexOf(a,e.tagName.toUpperCase())>=0},_getParentFrom:function(e,t){if(!e||!t||!t.length)return null;for(var a=e;a!==this.editor.editNode;){if(this._hasTagFrom(a,t))return a;a=a.parentNode}return null},_isSimpleInfo:function(e){return!e||e.groups.length<2},_isListTypeChanged:function(e,t){if(!this._hasTag(e,"LI"))return!1;var a=e.parentNode;return this._hasTag(a,"UL")&&"insertorderedlist"===t||this._hasTag(a,"OL")&&"insertunorderedlist"===t},_getIntStyleValue:function(e,t){var a=parseInt(m.get(e,t));return isNaN(a)?0:a},_mergeLists:function(){var e=v.getSelection(this.editor.window),t=e&&e.rangeCount>0;if(t)var a=e.getRangeAt(0).cloneRange(),i=a.startContainer,o=a.startOffset,d=a.endContainer,s=a.endOffset;var l=!1;if(u("ul,ol",this.editor.editNode).forEach(function(e,t,a){if(r.has(e,"tempRole"))return void e.parentNode.removeChild(e);for(var i=e.nextSibling;this._hasTag(i,this._tag(e));){for(;i.firstChild;)n.place(i.firstChild,e,"last"),l=!0;r.set(i,"tempRole","true"),i=i.nextSibling}},this),t&&l){e.removeAllRanges();try{a.setStart(i,o),a.setEnd(d,s),e.addRange(a)}catch(e){}}},_cleanLists:function(){h("webkit")&&(u("table",this.editor.editNode).forEach(function(e,t,a){var i=e.nextSibling;this._hasTag(i,"UL")&&"true"===r.get(i,"tempRole")&&i.parentNode.removeChild(i)},this),u("li[tempRole]",this.editor.editNode).forEach(function(e,t,a){1==e.parentNode.childNodes.length?e.parentNode.parentNode.removeChild(e.parentNode):e.parentNode.removeChild(e)}));var e=v.getSelection(this.editor.window),t=e&&e.rangeCount>0;if(t)var a=e.getRangeAt(0).cloneRange(),i=a.startContainer,o=a.startOffset,d=a.endContainer,s=a.endOffset;var l=!1;if(u("span[bogusDir]",this.editor.editNode).forEach(function(e,t,a){var i=e.firstChild,r=i;if(1==i.nodeType)for(;i;)r=i.nextSibling,n.place(i,e,"after"),l=!0,i=r;e.parentNode.removeChild(e)},this),t&&l){e.removeAllRanges();try{a.setStart(i,o),a.setEnd(d,s),e.addRange(a)}catch(e){}}}});return y.registry.bidiSupport=y.registry.bidisupport=function(e){return new w({})},w});//# sourceMappingURL=BidiSupport.js.map