//>>built
define("dojox/editor/plugins/Breadcrumb",["dojo","dijit","dojox","dijit/_Widget","dijit/_TemplatedMixin","dijit/_Contained","dijit/Toolbar","dijit/Menu","dijit/MenuItem","dijit/MenuSeparator","dijit/_editor/_Plugin","dijit/form/Button","dijit/form/ComboButton","dojo/_base/connect","dojo/_base/declare","dojo/i18n","dojo/string","dojo/i18n!dojox/editor/plugins/nls/Breadcrumb"],function(e,t,i,a,r,n,o,s,d,l,h){e.experimental("dojox.editor.plugins.Breadcrumb");var u=e.declare("dojox.editor.plugins._BreadcrumbMenuTitle",[a,r,n],{templateString:'<tr><td dojoAttachPoint="title" colspan="4" class="dijitToolbar" style="font-weight: bold; padding: 3px;"></td></tr>',menuTitle:"",postCreate:function(){e.setSelectable(this.domNode,!1);var t=this.id+"_text";this.domNode.setAttribute("aria-labelledby",t)},_setMenuTitleAttr:function(e){this.title.innerHTML=e},_getMenuTitleAttr:function(e){return this.title.innerHTML}}),c=e.declare("dojox.editor.plugins.Breadcrumb",h,{_menu:null,breadcrumbBar:null,setEditor:function(i){this.editor=i,this._buttons=[],this.breadcrumbBar=new t.Toolbar;var a=e.i18n.getLocalization("dojox.editor.plugins","Breadcrumb");this._titleTemplate=a.nodeActions,e.place(this.breadcrumbBar.domNode,i.footer),this.editor.onLoadDeferred.addCallback(e.hitch(this,function(){this._menu=new t.Menu({}),e.addClass(this.breadcrumbBar.domNode,"dojoxEditorBreadcrumbArrow");var r=new t.form.ComboButton({showLabel:!0,label:"body",_selNode:i.editNode,dropDown:this._menu,onClick:e.hitch(this,function(){this._menuTarget=i.editNode,this._selectContents()})});this._menuTitle=new u({menuTitle:a.nodeActions}),this._selCMenu=new t.MenuItem({label:a.selectContents,onClick:e.hitch(this,this._selectContents)}),this._delCMenu=new t.MenuItem({label:a.deleteContents,onClick:e.hitch(this,this._deleteContents)}),this._selEMenu=new t.MenuItem({label:a.selectElement,onClick:e.hitch(this,this._selectElement)}),this._delEMenu=new t.MenuItem({label:a.deleteElement,onClick:e.hitch(this,this._deleteElement)}),this._moveSMenu=new t.MenuItem({label:a.moveStart,onClick:e.hitch(this,this._moveCToStart)}),this._moveEMenu=new t.MenuItem({label:a.moveEnd,onClick:e.hitch(this,this._moveCToEnd)}),this._menu.addChild(this._menuTitle),this._menu.addChild(this._selCMenu),this._menu.addChild(this._delCMenu),this._menu.addChild(new t.MenuSeparator({})),this._menu.addChild(this._selEMenu),this._menu.addChild(this._delEMenu),this._menu.addChild(new t.MenuSeparator({})),this._menu.addChild(this._moveSMenu),this._menu.addChild(this._moveEMenu),r._ddConnect=e.connect(r,"openDropDown",e.hitch(this,function(){this._menuTarget=r._selNode,this._menuTitle.set("menuTitle",e.string.substitute(this._titleTemplate,{nodeName:"&lt;body&gt;"})),this._selEMenu.set("disabled",!0),this._delEMenu.set("disabled",!0),this._selCMenu.set("disabled",!1),this._delCMenu.set("disabled",!1),this._moveSMenu.set("disabled",!1),this._moveEMenu.set("disabled",!1)})),this.breadcrumbBar.addChild(r),this.connect(this.editor,"onNormalizedDisplayChanged","updateState")})),this.breadcrumbBar.startup(),e.isIE&&setTimeout(e.hitch(this,function(){this.breadcrumbBar.domNode.className=this.breadcrumbBar.domNode.className}),100)},_selectContents:function(){if(this.editor.focus(),this._menuTarget){var e=this._menuTarget.tagName.toLowerCase();switch(e){case"br":case"hr":case"img":case"input":case"base":case"meta":case"area":case"basefont":break;default:try{this.editor._sCall("collapse",[null]),this.editor._sCall("selectElementChildren",[this._menuTarget]),this.editor.onDisplayChanged()}catch(t){}}}},_deleteContents:function(){this._menuTarget&&(this.editor.beginEditing(),this._selectContents(),this.editor._sCall("remove",[this._menuTarget]),this.editor.endEditing(),this._updateBreadcrumb(),this.editor.onDisplayChanged())},_selectElement:function(){this.editor.focus(),this._menuTarget&&(this.editor._sCall("collapse",[null]),this.editor._sCall("selectElement",[this._menuTarget]),this.editor.onDisplayChanged())},_deleteElement:function(){this._menuTarget&&(this.editor.beginEditing(),this._selectElement(),this.editor._sCall("remove",[this._menuTarget]),this.editor.endEditing(),this._updateBreadcrumb(),this.editor.onDisplayChanged())},_moveCToStart:function(){this.editor.focus(),this._menuTarget&&(this._selectContents(),this.editor._sCall("collapse",[!0]))},_moveCToEnd:function(){this.editor.focus(),this._menuTarget&&(this._selectContents(),this.editor._sCall("collapse",[!1]))},_updateBreadcrumb:function(){var i=this.editor;if(i.window){var a=t.range.getSelection(i.window);if(a&&a.rangeCount>0){var r=a.getRangeAt(0),n=i._sCall("getSelectedElement",[])||r.startContainer,o=[];if(n&&n.ownerDocument===i.document){for(;n&&n!==i.editNode&&n!=i.document.body&&n!=i.document;)1===n.nodeType&&o.push({type:n.tagName.toLowerCase(),node:n}),n=n.parentNode;for(o=o.reverse();this._buttons.length;){var s=this._buttons.pop();e.disconnect(s._ddConnect),this.breadcrumbBar.removeChild(s)}this._buttons=[];var d,l=this;for(d=0;d<o.length;d++){var h=o[d],u=new t.form.ComboButton({showLabel:!0,label:h.type,_selNode:h.node,dropDown:this._menu,onClick:function(){l._menuTarget=this._selNode,l._selectContents()}});u._ddConnect=e.connect(u,"openDropDown",e.hitch(u,function(){l._menuTarget=this._selNode;var t=l._menuTarget.tagName.toLowerCase(),i=e.string.substitute(l._titleTemplate,{nodeName:"&lt;"+t+"&gt;"});switch(l._menuTitle.set("menuTitle",i),t){case"br":case"hr":case"img":case"input":case"base":case"meta":case"area":case"basefont":l._selCMenu.set("disabled",!0),l._delCMenu.set("disabled",!0),l._moveSMenu.set("disabled",!0),l._moveEMenu.set("disabled",!0),l._selEMenu.set("disabled",!1),l._delEMenu.set("disabled",!1);break;default:l._selCMenu.set("disabled",!1),l._delCMenu.set("disabled",!1),l._selEMenu.set("disabled",!1),l._delEMenu.set("disabled",!1),l._moveSMenu.set("disabled",!1),l._moveEMenu.set("disabled",!1)}})),this._buttons.push(u),this.breadcrumbBar.addChild(u)}e.isIE&&(this.breadcrumbBar.domNode.className=this.breadcrumbBar.domNode.className)}}}},updateState:function(){if("none"===e.style(this.editor.iframe,"display")||this.get("disabled"))e.style(this.breadcrumbBar.domNode,"display","none");else{"none"===e.style(this.breadcrumbBar.domNode,"display")&&e.style(this.breadcrumbBar.domNode,"display","block"),this._updateBreadcrumb();var t=e.marginBox(this.editor.domNode);this.editor.resize({h:t.h})}},destroy:function(){this.breadcrumbBar&&(this.breadcrumbBar.destroyRecursive(),this.breadcrumbBar=null),this._menu&&(this._menu.destroyRecursive(),delete this._menu),this._buttons=null,delete this.editor.breadcrumbBar,this.inherited(arguments)}});return c._BreadcrumbMenuTitle=u,e.subscribe(t._scopeName+".Editor.getPlugin",null,function(e){if(!e.plugin){var t=e.args.name.toLowerCase();"breadcrumb"===t&&(e.plugin=new c({}))}}),c});//# sourceMappingURL=Breadcrumb.js.map