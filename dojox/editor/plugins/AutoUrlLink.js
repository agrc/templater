//>>built
define("dojox/editor/plugins/AutoUrlLink",["dojo","dijit","dojox","dijit/_editor/_Plugin","dijit/form/Button","dojo/_base/declare","dojo/string"],function(e,t,a,i){var r=e.declare("dojox.editor.plugins.AutoUrlLink",[i],{_template:"<a _djrealurl='${url}' href='${url}'>${url}</a>",setEditor:function(a){this.editor=a,e.isIE||(e.some(a._plugins,function(e){return!!e.isInstanceOf(t._editor.plugins.EnterKeyHandling)&&(this.blockNodeForEnter=e.blockNodeForEnter,!0)},this),this.connect(a,"onKeyPress","_keyPress"),this.connect(a,"onClick","_recognize"),this.connect(a,"onBlur","_recognize"))},_keyPress:function(t){var a=e.keys,i=t.keyCode,r=t.charCode;r==a.SPACE||t.ctrlKey&&(118==r||86==r)?setTimeout(e.hitch(this,"_recognize"),0):i==a.ENTER?setTimeout(e.hitch(this,function(){this._recognize({enter:!0})}),0):this._saved=this.editor.window.getSelection().anchorNode},_recognize:function(t){var a=this._template,i=!!t&&t.enter,r=this.editor,o=r.window.getSelection();if(o){var d=i?this._findLastEditingNode(o.anchorNode):this._saved||o.anchorNode,n=this._saved=o.anchorNode,l=o.anchorOffset;if(3==d.nodeType&&!this._inLink(d)){var s,m=!1,u=this._findUrls(d,n,l),f=r.document.createRange(),h=0,c=n==d;for(s=u.shift();s;)f.setStart(d,s.start),f.setEnd(d,s.end),o.removeAllRanges(),o.addRange(f),r.execCommand("insertHTML",e.string.substitute(a,{url:f.toString()})),h+=s.end,s=u.shift(),m=!0;if(c&&(l-=h)<=0)return;if(!m)return;try{f.setStart(n,0),f.setEnd(n,l),o.removeAllRanges(),o.addRange(f),r._sCall("collapse",[])}catch(e){}}}},_inLink:function(e){var t=this.editor.editNode,a=!1;for(e=e.parentNode;e&&e!==t;){if("a"==(e.tagName?e.tagName.toLowerCase():"")){a=!0;break}e=e.parentNode}return a},_findLastEditingNode:function(a){var i,r=t.range.BlockTagNames,o=this.editor.editNode;if(!a)return a;if("BR"!=this.blockNodeForEnter||(i=t.range.getBlockAncestor(a,null,o).blockNode)&&"LI"==i.tagName.toUpperCase()){for(a=(i||(i=t.range.getBlockAncestor(a,null,o).blockNode))&&"LI"==i.tagName.toUpperCase()?i:t.range.getBlockAncestor(a,null,o).blockNode;(a=a.previousSibling)&&(!a.tagName||!a.tagName.match(r)););if(a)for(a=a.lastChild;a&&(3!=a.nodeType||""==e.trim(a.nodeValue));)a=1==a.nodeType?a.lastChild:a.previousSibling}else for(;(a=a.previousSibling)&&3!=a.nodeType;);return a},_findUrls:function(e,t,a){var i,r,o=/(http|https|ftp):\/\/[^\s]+/gi,d=[],n=0,l=e.nodeValue;for(e===t&&a<l.length&&(l=l.substr(0,a));null!=(i=o.exec(l));)0!=i.index&&" "!=(r=l.charAt(i.index-1))&&"Â "!=r||(d.push({start:i.index-n,end:i.index+i[0].length-n}),n=i.index+i[0].length);return d}});return e.subscribe(t._scopeName+".Editor.getPlugin",null,function(e){if(!e.plugin){"autourllink"===e.args.name.toLowerCase()&&(e.plugin=new r)}}),r});//# sourceMappingURL=AutoUrlLink.js.map