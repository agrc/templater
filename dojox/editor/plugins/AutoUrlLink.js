//>>built
define("dojox/editor/plugins/AutoUrlLink",["dojo","dijit","dojox","dijit/_editor/_Plugin","dijit/form/Button","dojo/_base/declare","dojo/string"],function(e,t,i,a){var r=e.declare("dojox.editor.plugins.AutoUrlLink",[a],{_template:"<a _djrealurl='${url}' href='${url}'>${url}</a>",setEditor:function(i){this.editor=i,e.isIE||(e.some(i._plugins,function(e){return e.isInstanceOf(t._editor.plugins.EnterKeyHandling)?(this.blockNodeForEnter=e.blockNodeForEnter,!0):!1},this),this.connect(i,"onKeyPress","_keyPress"),this.connect(i,"onClick","_recognize"),this.connect(i,"onBlur","_recognize"))},_keyPress:function(t){var i=e.keys,a=118,r=86,o=t.keyCode,n=t.charCode;n==i.SPACE||t.ctrlKey&&(n==a||n==r)?setTimeout(e.hitch(this,"_recognize"),0):o==i.ENTER?setTimeout(e.hitch(this,function(){this._recognize({enter:!0})}),0):this._saved=this.editor.window.getSelection().anchorNode},_recognize:function(t){var i=this._template,a=t?t.enter:!1,r=this.editor,o=r.window.getSelection();if(o){var n=a?this._findLastEditingNode(o.anchorNode):this._saved||o.anchorNode,s=this._saved=o.anchorNode,d=o.anchorOffset;if(3==n.nodeType&&!this._inLink(n)){var l,h=!1,m=this._findUrls(n,s,d),u=r.document.createRange(),f=0,c=s==n;for(l=m.shift();l;)u.setStart(n,l.start),u.setEnd(n,l.end),o.removeAllRanges(),o.addRange(u),r.execCommand("insertHTML",e.string.substitute(i,{url:u.toString()})),f+=l.end,l=m.shift(),h=!0;if(c&&(d-=f)<=0)return;if(!h)return;try{u.setStart(s,0),u.setEnd(s,d),o.removeAllRanges(),o.addRange(u),r._sCall("collapse",[])}catch(y){}}}},_inLink:function(e){var t,i=this.editor.editNode,a=!1;for(e=e.parentNode;e&&e!==i;){if(t=e.tagName?e.tagName.toLowerCase():"","a"==t){a=!0;break}e=e.parentNode}return a},_findLastEditingNode:function(i){var a,r=t.range.BlockTagNames,o=this.editor.editNode;if(!i)return i;if("BR"!=this.blockNodeForEnter||(a=t.range.getBlockAncestor(i,null,o).blockNode)&&"LI"==a.tagName.toUpperCase()){for(i=(a||(a=t.range.getBlockAncestor(i,null,o).blockNode))&&"LI"==a.tagName.toUpperCase()?a:t.range.getBlockAncestor(i,null,o).blockNode;(i=i.previousSibling)&&(!i.tagName||!i.tagName.match(r)););if(i)for(i=i.lastChild;i&&(3!=i.nodeType||""==e.trim(i.nodeValue));)i=1==i.nodeType?i.lastChild:i.previousSibling}else for(;(i=i.previousSibling)&&3!=i.nodeType;);return i},_findUrls:function(e,t,i){var a,r,o=/(http|https|ftp):\/\/[^\s]+/gi,n=[],s=0,d=e.nodeValue;for(e===t&&i<d.length&&(d=d.substr(0,i));null!=(a=o.exec(d));)0!=a.index&&" "!=(r=d.charAt(a.index-1))&&"Â "!=r||(n.push({start:a.index-s,end:a.index+a[0].length-s}),s=a.index+a[0].length);return n}});return e.subscribe(t._scopeName+".Editor.getPlugin",null,function(e){if(!e.plugin){var t=e.args.name.toLowerCase();"autourllink"===t&&(e.plugin=new r)}}),r});//# sourceMappingURL=AutoUrlLink.js.map