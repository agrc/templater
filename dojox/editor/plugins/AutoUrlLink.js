//>>built
define("dojox/editor/plugins/AutoUrlLink",["dojo","dijit","dojox","dijit/_editor/_Plugin","dijit/form/Button","dojo/_base/declare","dojo/string"],function(e,t,a,i){var r=e.declare("dojox.editor.plugins.AutoUrlLink",[i],{_template:"<a _djrealurl='${url}' href='${url}'>${url}</a>",setEditor:function(a){this.editor=a,e.isIE||(e.some(a._plugins,function(e){return e.isInstanceOf(t._editor.plugins.EnterKeyHandling)?(this.blockNodeForEnter=e.blockNodeForEnter,!0):!1},this),this.connect(a,"onKeyPress","_keyPress"),this.connect(a,"onClick","_recognize"),this.connect(a,"onBlur","_recognize"))},_keyPress:function(t){var a=e.keys,i=118,r=86,o=t.keyCode,n=t.charCode;n==a.SPACE||t.ctrlKey&&(n==i||n==r)?setTimeout(e.hitch(this,"_recognize"),0):o==a.ENTER?setTimeout(e.hitch(this,function(){this._recognize({enter:!0})}),0):this._saved=this.editor.window.getSelection().anchorNode},_recognize:function(t){var a=this._template,i=t?t.enter:!1,r=this.editor,o=r.window.getSelection();if(o){var n=i?this._findLastEditingNode(o.anchorNode):this._saved||o.anchorNode,s=this._saved=o.anchorNode,d=o.anchorOffset;if(3==n.nodeType&&!this._inLink(n)){var l,m=!1,h=this._findUrls(n,s,d),u=r.document.createRange(),f=0,c=s==n;for(l=h.shift();l;)u.setStart(n,l.start),u.setEnd(n,l.end),o.removeAllRanges(),o.addRange(u),r.execCommand("insertHTML",e.string.substitute(a,{url:u.toString()})),f+=l.end,l=h.shift(),m=!0;if(c&&(d-=f)<=0)return;if(!m)return;try{u.setStart(s,0),u.setEnd(s,d),o.removeAllRanges(),o.addRange(u),r._sCall("collapse",[])}catch(y){}}}},_inLink:function(e){var t,a=this.editor.editNode,i=!1;for(e=e.parentNode;e&&e!==a;){if(t=e.tagName?e.tagName.toLowerCase():"","a"==t){i=!0;break}e=e.parentNode}return i},_findLastEditingNode:function(a){var i,r=t.range.BlockTagNames,o=this.editor.editNode;if(!a)return a;if("BR"!=this.blockNodeForEnter||(i=t.range.getBlockAncestor(a,null,o).blockNode)&&"LI"==i.tagName.toUpperCase()){for(a=(i||(i=t.range.getBlockAncestor(a,null,o).blockNode))&&"LI"==i.tagName.toUpperCase()?i:t.range.getBlockAncestor(a,null,o).blockNode;(a=a.previousSibling)&&(!a.tagName||!a.tagName.match(r)););if(a)for(a=a.lastChild;a&&(3!=a.nodeType||""==e.trim(a.nodeValue));)a=1==a.nodeType?a.lastChild:a.previousSibling}else for(;(a=a.previousSibling)&&3!=a.nodeType;);return a},_findUrls:function(e,t,a){var i,r,o=/(http|https|ftp):\/\/[^\s]+/gi,n=[],s=0,d=e.nodeValue;for(e===t&&a<d.length&&(d=d.substr(0,a));null!=(i=o.exec(d));)0!=i.index&&" "!=(r=d.charAt(i.index-1))&&"Â "!=r||(n.push({start:i.index-s,end:i.index+i[0].length-s}),s=i.index+i[0].length);return n}});return e.subscribe(t._scopeName+".Editor.getPlugin",null,function(e){if(!e.plugin){var t=e.args.name.toLowerCase();"autourllink"===t&&(e.plugin=new r)}}),r});//# sourceMappingURL=AutoUrlLink.js.map