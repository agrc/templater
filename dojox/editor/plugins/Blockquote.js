//>>built
define("dojox/editor/plugins/Blockquote",["dojo","dijit","dojox","dijit/_editor/_Plugin","dijit/form/ToggleButton","dojo/_base/connect","dojo/_base/declare","dojo/i18n","dojo/i18n!dojox/editor/plugins/nls/Blockquote"],function(e,t,i,a){var r=e.declare("dojox.editor.plugins.Blockquote",a,{iconClassPrefix:"dijitAdditionalEditorIcon",_initButton:function(){this._nlsResources=e.i18n.getLocalization("dojox.editor.plugins","Blockquote"),this.button=new t.form.ToggleButton({label:this._nlsResources.blockquote,showLabel:!1,iconClass:this.iconClassPrefix+" "+this.iconClassPrefix+"Blockquote",tabIndex:"-1",onClick:e.hitch(this,"_toggleQuote")})},setEditor:function(e){this.editor=e,this._initButton(),this.connect(this.editor,"onNormalizedDisplayChanged","updateState"),e.customUndo=!0},_toggleQuote:function(i){try{var a=this.editor;a.focus();var r,n,o,s,d=this.button.get("checked"),l=t.range.getSelection(a.window);if(l&&l.rangeCount>0&&(r=l.getRangeAt(0)),r){if(a.beginEditing(),d){var u,c;if(r.startContainer===r.endContainer){if(this._isRootInline(r.startContainer)){for(o=r.startContainer;o&&o.parentNode!==a.editNode;)o=o.parentNode;for(;o&&o.previousSibling&&(this._isTextElement(o)||1===o.nodeType&&this._isInlineFormat(this._getTagName(o)));)o=o.previousSibling;if(o&&1===o.nodeType&&!this._isInlineFormat(this._getTagName(o))&&(o=o.nextSibling),o)for(u=a.document.createElement("blockquote"),e.place(u,o,"after"),u.appendChild(o),s=u.nextSibling;s&&(this._isTextElement(s)||1===s.nodeType&&this._isInlineFormat(this._getTagName(s)));)u.appendChild(s),s=u.nextSibling}else{for(var h=r.startContainer;(this._isTextElement(h)||this._isInlineFormat(this._getTagName(h))||"li"===this._getTagName(h))&&h!==a.editNode&&h!==a.document.body;)h=h.parentNode;h!==a.editNode&&h!==h.ownerDocument.documentElement&&(u=a.document.createElement("blockquote"),e.place(u,h,"after"),u.appendChild(h))}u&&(a._sCall("selectElementChildren",[u]),a._sCall("collapse",[!0]))}else{var f;for(o=r.startContainer,s=r.endContainer;o&&this._isTextElement(o)&&o.parentNode!==a.editNode;)o=o.parentNode;for(f=o;f.nextSibling&&a._sCall("inSelection",[f]);)f=f.nextSibling;if(s=f,s===a.editNode||s===a.document.body){if(u=a.document.createElement("blockquote"),e.place(u,o,"after"),c=this._getTagName(o),this._isTextElement(o)||this._isInlineFormat(c))for(var m=o;m&&(this._isTextElement(m)||1===m.nodeType&&this._isInlineFormat(this._getTagName(m)));)u.appendChild(m),m=u.nextSibling;else u.appendChild(o);return}for(s=s.nextSibling,f=o;f&&f!==s;){if(1===f.nodeType){if(c=this._getTagName(f),"br"!==c){if(!window.getSelection&&"p"===c&&this._isEmpty(f)){f=f.nextSibling;continue}this._isInlineFormat(c)?(u?u.appendChild(f):(u=a.document.createElement("blockquote"),e.place(u,f,"after"),u.appendChild(f)),f=u):(u&&this._isEmpty(u)&&u.parentNode.removeChild(u),u=a.document.createElement("blockquote"),e.place(u,f,"after"),u.appendChild(f),f=u)}}else this._isTextElement(f)&&(u?u.appendChild(f):(u=a.document.createElement("blockquote"),e.place(u,f,"after"),u.appendChild(f)),f=u);f=f.nextSibling}u&&(this._isEmpty(u)?u.parentNode.removeChild(u):(a._sCall("selectElementChildren",[u]),a._sCall("collapse",[!0])),u=null)}}else{var y=!1;if(r.startContainer===r.endContainer){for(n=r.endContainer;n&&n!==a.editNode&&n!==a.document.body;){var p=n.tagName?n.tagName.toLowerCase():"";if("blockquote"===p){y=!0;break}n=n.parentNode}if(y){for(var v;n.firstChild;)v=n.firstChild,e.place(v,n,"before");n.parentNode.removeChild(n),v&&(a._sCall("selectElementChildren",[v]),a._sCall("collapse",[!0]))}}else{for(o=r.startContainer,s=r.endContainer;o&&this._isTextElement(o)&&o.parentNode!==a.editNode;)o=o.parentNode;for(var g=[],b=o;b&&b.nextSibling&&a._sCall("inSelection",[b]);)b.parentNode&&"blockquote"===this._getTagName(b.parentNode)&&(b=b.parentNode),g.push(b),b=b.nextSibling;for(var M=this._findBlockQuotes(g);M.length;){var _=M.pop();if(_.parentNode){for(;_.firstChild;)e.place(_.firstChild,_,"before");_.parentNode.removeChild(_)}}}}a.endEditing()}a.onNormalizedDisplayChanged()}catch(w){}},updateState:function(){var e=this.editor,i=this.get("disabled");if(e&&e.isLoaded&&this.button){if(this.button.set("disabled",i),i)return;var a,r=!1,n=t.range.getSelection(e.window);if(n&&n.rangeCount>0){var o=n.getRangeAt(0);o&&(a=o.endContainer)}for(;a&&a!==e.editNode&&a!==e.document;){var s=a.tagName?a.tagName.toLowerCase():"";if("blockquote"===s){r=!0;break}a=a.parentNode}this.button.set("checked",r)}},_findBlockQuotes:function(e){var t=[];if(e){var i;for(i=0;i<e.length;i++){var a=e[i];1===a.nodeType&&("blockquote"===this._getTagName(a)&&t.push(a),a.childNodes&&a.childNodes.length>0&&(t=t.concat(this._findBlockQuotes(a.childNodes))))}}return t},_getTagName:function(e){var t="";return e&&1===e.nodeType&&(t=e.tagName?e.tagName.toLowerCase():""),t},_isRootInline:function(e){var t=this.editor;if(this._isTextElement(e)&&e.parentNode===t.editNode)return!0;if(1===e.nodeType&&this._isInlineFormat(e)&&e.parentNode===t.editNode)return!0;if(this._isTextElement(e)&&this._isInlineFormat(this._getTagName(e.parentNode))){for(e=e.parentNode;e&&e!==t.editNode&&this._isInlineFormat(this._getTagName(e));)e=e.parentNode;if(e===t.editNode)return!0}return!1},_isTextElement:function(e){return!!(e&&3===e.nodeType||4===e.nodeType)},_isEmpty:function(t){if(t.childNodes){var i,a=!0;for(i=0;i<t.childNodes.length;i++){var r=t.childNodes[i];if(1===r.nodeType){if("p"===this._getTagName(r)&&!e.trim(r.innerHTML))continue;a=!1;break}if(!this._isTextElement(r)){a=!1;break}var n=e.trim(r.nodeValue);if(n&&"&nbsp;"!==n&&"Â "!==n){a=!1;break}}return a}return!0},_isInlineFormat:function(e){switch(e){case"a":case"b":case"strong":case"s":case"strike":case"i":case"u":case"em":case"sup":case"sub":case"span":case"font":case"big":case"cite":case"q":case"img":case"small":return!0;default:return!1}}});return e.subscribe(t._scopeName+".Editor.getPlugin",null,function(e){if(!e.plugin){var t=e.args.name.toLowerCase();"blockquote"===t&&(e.plugin=new r({}))}}),r});//# sourceMappingURL=Blockquote.js.map