//>>built
define("dojox/editor/plugins/ResizeTableColumn",["dojo","dijit","dojox","./TablePlugins"],function(dojo,dijit,dojox,TablePlugins){var ResizeTableColumn=dojo.declare("dojox.editor.plugins.ResizeTableColumn",TablePlugins,{constructor:function(){this.isLtr=this.dir?"ltr"==this.dir:dojo._isBodyLtr(),this.ruleDiv=dojo.create("div",{style:"top: -10000px; z-index: 10001"},dojo.body(),"last")},setEditor:function(editor){function isBoundary(e,t){var i=dojo.query("> td",e.parentNode);switch(t){case"first":return i[0]==e;case"last":return i[i.length-1]==e;default:return!1}}function nextSibling(e){for(e=e.nextSibling;e&&(!e.tagName||"td"!=e.tagName.toLowerCase());)e=e.nextSibling;return e}function getTable(e){for(;(e=e.parentNode)&&"table"!=e.tagName.toLowerCase(););return e}function getHeaderCell(e){for(var t=dojo.query("td",getTable(e)),i=t.length,a=0;a<i;a++)if(dojo.position(t[a]).x==dojo.position(e).x)return t[a];return null}function marginBox(node,width){function px(element,avalue){if(!avalue)return 0;if("medium"==avalue)return 1;if(avalue.slice&&"px"==avalue.slice(-2))return parseFloat(avalue);with(element){var sLeft=style.left,rsLeft=runtimeStyle.left;runtimeStyle.left=currentStyle.left;try{style.left=avalue,avalue=style.pixelLeft}catch(e){avalue=0}style.left=sLeft,runtimeStyle.left=rsLeft}return avalue}if(dojo.isIE){var s=node.currentStyle,bl=px(node,s.borderLeftWidth),br=px(node,s.borderRightWidth),pl=px(node,s.paddingLeft),pr=px(node,s.paddingRight);node.style.width=width-bl-br-pl-pr}else dojo.marginBox(node,{w:width})}var ruleDiv=this.ruleDiv;this.editor=editor,this.editor.customUndo=!0,this.onEditorLoaded(),editor.onLoadDeferred.addCallback(dojo.hitch(this,function(){this.connect(this.editor.editNode,"onmousemove",function(e){var t=dojo.position(editor.iframe,!0),i=t.x,a=e.clientX;if(this.isDragging){var r,o,n,d=this.activeCell,s=dojo.position(d),l=s.x,m=s.w,u=nextSibling(d),h=dojo.position(getTable(d).parentNode),c=h.x,f=h.w;u&&(r=dojo.position(u),o=r.x,n=r.w),(this.isLtr&&(ruleDiv.headerColumn&&u&&c<a&&a<l+m||!u&&l<a&&a<c+f||u&&l<a&&a<o+n)||!this.isLtr&&(ruleDiv.headerColumn&&u&&c>a&&a>l||!u&&l+m>a&&a>c||u&&l+m>a&&a>o))&&dojo.style(ruleDiv,{left:i+a+"px"})}else{var y=e.target;if(y.tagName&&"td"==y.tagName.toLowerCase()){var p=dojo.position(y),v=p.x,g=p.w,M=i+p.x-2;this.isLtr?(ruleDiv.headerColumn=!0,(!isBoundary(y,"first")||a>v+g/2)&&(M+=g,ruleDiv.headerColumn=!1)):(ruleDiv.headerColumn=!1,isBoundary(y,"first")&&a>v+g/2&&(M+=g,ruleDiv.headerColumn=!0)),dojo.style(ruleDiv,{position:"absolute",cursor:"col-resize",display:"block",width:"4px",backgroundColor:"transparent",top:t.y+p.y+"px",left:M+"px",height:p.h+"px"}),this.activeCell=y}else dojo.style(ruleDiv,{display:"none",top:"-10000px"})}}),this.connect(ruleDiv,"onmousedown",function(e){var t=dojo.position(editor.iframe,!0),i=dojo.position(getTable(this.activeCell));this.isDragging=!0,dojo.style(editor.editNode,{cursor:"col-resize"}),dojo.style(ruleDiv,{width:"1px",left:e.clientX+"px",top:t.y+i.y+"px",height:i.h+"px",backgroundColor:"#777"})}),this.connect(ruleDiv,"onmouseup",function(e){var t,i,a,r,o,n,d=this.activeCell,s=dojo.position(d),l=s.w,m=s.x,u=nextSibling(d),h=dojo.position(editor.iframe),c=h.x,f=getTable(d),y=dojo.position(f),p=f.getAttribute("cellspacing"),v=e.clientX,g=getHeaderCell(d);(!p||(p=parseInt(p,10))<0)&&(p=2),u&&(t=dojo.position(u),i=t.x,a=t.w,r=getHeaderCell(u)),this.isLtr?ruleDiv.headerColumn?o=c+m+l-v:(o=v-c-m,u&&(n=c+i+a-v-p)):ruleDiv.headerColumn?o=v-c-m:(o=c+m+l-v,u&&(n=v-c-i-p)),this.isDragging=!1,marginBox(g,o),u&&(ruleDiv.headerColumn||marginBox(r,n)),(ruleDiv.headerColumn&&isBoundary(d,"first")||isBoundary(d,"last"))&&dojo.marginBox(f,{w:y.w+o-l}),marginBox(g,dojo.position(d).w),u&&marginBox(r,dojo.position(u).w),dojo.style(editor.editNode,{cursor:"auto"}),dojo.style(ruleDiv,{display:"none",top:"-10000px"}),this.activeCell=null})}))}});return dojo.subscribe(dijit._scopeName+".Editor.getPlugin",null,function(e){if(!e.plugin&&e.args&&e.args.command){var t=e.args.command.charAt(0).toLowerCase()+e.args.command.substring(1,e.args.command.length);"resizeTableColumn"==t&&(e.plugin=new ResizeTableColumn({commandName:t}))}}),ResizeTableColumn});//# sourceMappingURL=ResizeTableColumn.js.map