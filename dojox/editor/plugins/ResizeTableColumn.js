//>>built
define("dojox/editor/plugins/ResizeTableColumn",["dojo","dijit","dojox","./TablePlugins"],function(dojo,dijit,dojox,TablePlugins){var ResizeTableColumn=dojo.declare("dojox.editor.plugins.ResizeTableColumn",TablePlugins,{constructor:function(){this.isLtr=this.dir?"ltr"==this.dir:dojo._isBodyLtr(),this.ruleDiv=dojo.create("div",{style:"top: -10000px; z-index: 10001"},dojo.body(),"last")},setEditor:function(editor){function isBoundary(e,t){var i=dojo.query("> td",e.parentNode);switch(t){case"first":return i[0]==e;case"last":return i[i.length-1]==e;default:return!1}}function nextSibling(e){for(e=e.nextSibling;e&&(!e.tagName||"td"!=e.tagName.toLowerCase());)e=e.nextSibling;return e}function getTable(e){for(;(e=e.parentNode)&&"table"!=e.tagName.toLowerCase(););return e}function getHeaderCell(e){for(var t=dojo.query("td",getTable(e)),i=t.length,a=0;i>a;a++)if(dojo.position(t[a]).x==dojo.position(e).x)return t[a];return null}function marginBox(node,width){function px(element,avalue){if(!avalue)return 0;if("medium"==avalue)return 1;if(avalue.slice&&"px"==avalue.slice(-2))return parseFloat(avalue);with(element){var sLeft=style.left,rsLeft=runtimeStyle.left;runtimeStyle.left=currentStyle.left;try{style.left=avalue,avalue=style.pixelLeft}catch(e){avalue=0}style.left=sLeft,runtimeStyle.left=rsLeft}return avalue}if(dojo.isIE){var s=node.currentStyle,bl=px(node,s.borderLeftWidth),br=px(node,s.borderRightWidth),pl=px(node,s.paddingLeft),pr=px(node,s.paddingRight);node.style.width=width-bl-br-pl-pr}else dojo.marginBox(node,{w:width})}var ruleDiv=this.ruleDiv;this.editor=editor,this.editor.customUndo=!0,this.onEditorLoaded(),editor.onLoadDeferred.addCallback(dojo.hitch(this,function(){this.connect(this.editor.editNode,"onmousemove",function(e){var t=dojo.position(editor.iframe,!0),i=t.x,a=e.clientX;if(this.isDragging){var r,o,n,d=this.activeCell,s=dojo.position(d),l=s.x,m=s.w,h=nextSibling(d),u=dojo.position(getTable(d).parentNode),f=u.x,c=u.w;h&&(r=dojo.position(h),o=r.x,n=r.w),(this.isLtr&&(ruleDiv.headerColumn&&h&&a>f&&l+m>a||!h&&a>l&&f+c>a||h&&a>l&&o+n>a)||!this.isLtr&&(ruleDiv.headerColumn&&h&&f>a&&a>l||!h&&l+m>a&&a>f||h&&l+m>a&&a>o))&&dojo.style(ruleDiv,{left:i+a+"px"})}else{var y=e.target;if(y.tagName&&"td"==y.tagName.toLowerCase()){var v=dojo.position(y),p=v.x,g=v.w,M=i+v.x-2;this.isLtr?(ruleDiv.headerColumn=!0,(!isBoundary(y,"first")||a>p+g/2)&&(M+=g,ruleDiv.headerColumn=!1)):(ruleDiv.headerColumn=!1,isBoundary(y,"first")&&a>p+g/2&&(M+=g,ruleDiv.headerColumn=!0)),dojo.style(ruleDiv,{position:"absolute",cursor:"col-resize",display:"block",width:"4px",backgroundColor:"transparent",top:t.y+v.y+"px",left:M+"px",height:v.h+"px"}),this.activeCell=y}else dojo.style(ruleDiv,{display:"none",top:"-10000px"})}}),this.connect(ruleDiv,"onmousedown",function(e){var t=dojo.position(editor.iframe,!0),i=dojo.position(getTable(this.activeCell));this.isDragging=!0,dojo.style(editor.editNode,{cursor:"col-resize"}),dojo.style(ruleDiv,{width:"1px",left:e.clientX+"px",top:t.y+i.y+"px",height:i.h+"px",backgroundColor:"#777"})}),this.connect(ruleDiv,"onmouseup",function(e){var t,i,a,r,o,n,d=this.activeCell,s=dojo.position(d),l=s.w,m=s.x,h=nextSibling(d),u=dojo.position(editor.iframe),f=u.x,c=getTable(d),y=dojo.position(c),v=c.getAttribute("cellspacing"),p=e.clientX,g=getHeaderCell(d);(!v||(v=parseInt(v,10))<0)&&(v=2),h&&(t=dojo.position(h),i=t.x,a=t.w,r=getHeaderCell(h)),this.isLtr?ruleDiv.headerColumn?o=f+m+l-p:(o=p-f-m,h&&(n=f+i+a-p-v)):ruleDiv.headerColumn?o=p-f-m:(o=f+m+l-p,h&&(n=p-f-i-v)),this.isDragging=!1,marginBox(g,o),h&&(ruleDiv.headerColumn||marginBox(r,n)),(ruleDiv.headerColumn&&isBoundary(d,"first")||isBoundary(d,"last"))&&dojo.marginBox(c,{w:y.w+o-l}),marginBox(g,dojo.position(d).w),h&&marginBox(r,dojo.position(h).w),dojo.style(editor.editNode,{cursor:"auto"}),dojo.style(ruleDiv,{display:"none",top:"-10000px"}),this.activeCell=null})}))}});return dojo.subscribe(dijit._scopeName+".Editor.getPlugin",null,function(e){if(!e.plugin&&e.args&&e.args.command){var t=e.args.command.charAt(0).toLowerCase()+e.args.command.substring(1,e.args.command.length);"resizeTableColumn"==t&&(e.plugin=new ResizeTableColumn({commandName:t}))}}),ResizeTableColumn});//# sourceMappingURL=ResizeTableColumn.js.map