//>>built
define("dojox/sketch/DoubleArrowAnnotation",["dojo/_base/kernel","dojo/_base/lang","./Annotation","./Anchor"],function(e){e.getObject("sketch",!0,dojox);var t=dojox.sketch;t.DoubleArrowAnnotation=function(e,i){t.Annotation.call(this,e,i),this.transform={dx:0,dy:0},this.start={x:0,y:0},this.control={x:100,y:-50},this.end={x:200,y:0},this.textPosition={x:0,y:0},this.textOffset=6,this.textYOffset=10,this.textAlign="middle",this.startRotation=0,this.endRotation=0,this.labelShape=null,this.pathShape=null,this.startArrow=null,this.startArrowGroup=null,this.endArrow=null,this.endArrowGroup=null,this.anchors.start=new t.Anchor(this,"start"),this.anchors.control=new t.Anchor(this,"control"),this.anchors.end=new t.Anchor(this,"end")},t.DoubleArrowAnnotation.prototype=new t.Annotation;var i=t.DoubleArrowAnnotation.prototype;return i.constructor=t.DoubleArrowAnnotation,i.type=function(){return"DoubleArrow"},i.getType=function(){return t.DoubleArrowAnnotation},i._rot=function(){var e=this.control.y-this.start.y,t=this.control.x-this.start.x;this.startRotation=Math.atan2(e,t),e=this.end.y-this.control.y,t=this.end.x-this.control.x,this.endRotation=Math.atan2(e,t)},i._pos=function(){var e=this.textOffset;this.control.y<this.end.y?e*=-1:e+=this.textYOffset;var t={x:.5*(this.control.x-this.start.x)+this.start.x,y:.5*(this.control.y-this.start.y)+this.start.y},i={x:.5*(this.end.x-this.control.x)+this.control.x,y:.5*(this.end.y-this.control.y)+this.control.y};this.textPosition={x:.5*(i.x-t.x)+t.x,y:.5*(i.y-t.y)+t.y+e}},i.apply=function(e){if(e){e.documentElement&&(e=e.documentElement),this.readCommonAttrs(e);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if("text"==i.localName)this.property("label",i.childNodes.length?i.childNodes[0].nodeValue:"");else if("path"==i.localName){var o=i.getAttribute("d").split(" "),n=o[0].split(",");this.start.x=parseFloat(n[0].substr(1),10),this.start.y=parseFloat(n[1],10),n=o[1].split(","),this.control.x=parseFloat(n[0].substr(1),10),this.control.y=parseFloat(n[1],10),n=o[2].split(","),this.end.x=parseFloat(n[0],10),this.end.y=parseFloat(n[1],10);var a=this.property("stroke"),r=i.getAttribute("style"),s=r.match(/stroke:([^;]+);/);s&&(a.color=s[1],this.property("fill",s[1])),s=r.match(/stroke-width:([^;]+);/),s&&(a.width=s[1]),this.property("stroke",a)}}}},i.initialize=function(e){t.Annotation.labelFont?t.Annotation.labelFont:{family:"Times",size:"16px"};this.apply(e),this._rot(),this._pos();var i=this.startRotation,o=dojox.gfx.matrix.rotate(i);i=this.endRotation;var n=dojox.gfx.matrix.rotateAt(i,this.end.x,this.end.y);this.shape=this.figure.group.createGroup(),this.shape.getEventSource().setAttribute("id",this.id),this.pathShape=this.shape.createPath("M"+this.start.x+" "+this.start.y+"Q"+this.control.x+" "+this.control.y+" "+this.end.x+" "+this.end.y+" l0,0"),this.startArrowGroup=this.shape.createGroup().setTransform({dx:this.start.x,dy:this.start.y}),this.startArrowGroup.applyTransform(o),this.startArrow=this.startArrowGroup.createPath(),this.endArrowGroup=this.shape.createGroup().setTransform(n),this.endArrow=this.endArrowGroup.createPath(),this.labelShape=this.shape.createText({x:this.textPosition.x,y:this.textPosition.y,text:this.property("label"),align:this.textAlign}).setFill(this.property("fill")),this.labelShape.getEventSource().setAttribute("id",this.id+"-labelShape"),this.draw()},i.destroy=function(){this.shape&&(this.startArrowGroup.remove(this.startArrow),this.endArrowGroup.remove(this.endArrow),this.shape.remove(this.startArrowGroup),this.shape.remove(this.endArrowGroup),this.shape.remove(this.pathShape),this.shape.remove(this.labelShape),this.figure.group.remove(this.shape),this.shape=this.pathShape=this.labelShape=this.startArrowGroup=this.startArrow=this.endArrowGroup=this.endArrow=null)},i.draw=function(e){this.apply(e),this._rot(),this._pos();var t=this.startRotation,i=dojox.gfx.matrix.rotate(t);t=this.endRotation;var o=dojox.gfx.matrix.rotateAt(t,this.end.x,this.end.y);this.shape.setTransform(this.transform),this.pathShape.setShape("M"+this.start.x+" "+this.start.y+" Q"+this.control.x+" "+this.control.y+" "+this.end.x+" "+this.end.y+" l0,0"),this.startArrowGroup.setTransform({dx:this.start.x,dy:this.start.y}).applyTransform(i),this.startArrow.setFill(this.property("fill")),this.endArrowGroup.setTransform(o),this.endArrow.setFill(this.property("fill")),this.labelShape.setShape({x:this.textPosition.x,y:this.textPosition.y,text:this.property("label")}).setFill(this.property("fill")),this.zoom()},i.zoom=function(e){if(this.startArrow){e=e||this.figure.zoomFactor,t.Annotation.prototype.zoom.call(this,e);var i=e>1?20:Math.floor(20/e),o=e>1?5:Math.floor(5/e),n=e>1?3:Math.floor(3/e);this.startArrow.setShape("M0,0 l"+i+",-"+o+" -"+n+","+o+" "+n+","+o+" Z"),this.endArrow.setShape("M"+this.end.x+","+this.end.y+" l-"+i+",-"+o+" "+n+","+o+" -"+n+","+o+" Z")}},i.getBBox=function(){var e=Math.min(this.start.x,this.control.x,this.end.x),t=Math.min(this.start.y,this.control.y,this.end.y),i=Math.max(this.start.x,this.control.x,this.end.x)-e,o=Math.max(this.start.y,this.control.y,this.end.y)-t;return{x:e,y:t,width:i,height:o}},i.serialize=function(){var e=this.property("stroke");return"<g "+this.writeCommonAttrs()+'><path style="stroke:'+e.color+";stroke-width:"+e.width+';fill:none;" d="M'+this.start.x+","+this.start.y+" Q"+this.control.x+","+this.control.y+" "+this.end.x+","+this.end.y+'" /><g transform="translate('+this.start.x+","+this.start.y+") rotate("+Math.round(this.startRotation*(180/Math.PI)*Math.pow(10,4))/Math.pow(10,4)+')"><path style="fill:'+e.color+';" d="M0,0 l20,-5, -3,5, 3,5 Z" /></g><g transform="rotate('+Math.round(this.endRotation*(180/Math.PI)*Math.pow(10,4))/Math.pow(10,4)+", "+this.end.x+", "+this.end.y+')"><path style="fill:'+e.color+';" d="M'+this.end.x+","+this.end.y+' l-20,-5, 3,5, -3,5 Z" /></g><text style="fill:'+e.color+";text-anchor:"+this.textAlign+'" font-weight="bold" x="'+this.textPosition.x+'" y="'+this.textPosition.y+'">'+this.property("label")+"</text></g>"},t.Annotation.register("DoubleArrow"),dojox.sketch.DoubleArrowAnnotation});//# sourceMappingURL=DoubleArrowAnnotation.js.map