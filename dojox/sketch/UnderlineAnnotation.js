//>>built
define("dojox/sketch/UnderlineAnnotation",["./Annotation","./Anchor"],function(){var e=dojox.sketch;e.UnderlineAnnotation=function(t,i){e.Annotation.call(this,t,i),this.transform={dx:0,dy:0},this.start={x:0,y:0},this.property("label","#"),this.labelShape=null,this.lineShape=null},e.UnderlineAnnotation.prototype=new e.Annotation;var t=e.UnderlineAnnotation.prototype;return t.constructor=e.UnderlineAnnotation,t.type=function(){return"Underline"},t.getType=function(){return e.UnderlineAnnotation},t.apply=function(e){if(e){e.documentElement&&(e=e.documentElement),this.readCommonAttrs(e);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if("text"==i.localName){this.property("label",i.childNodes[0].nodeValue);var o=i.getAttribute("style"),r=o.match(/fill:([^;]+);/);if(r){var n=this.property("stroke");n.collor=r[1],this.property("stroke",n),this.property("fill",n.collor)}}}}},t.initialize=function(e){this.apply(e),this.shape=this.figure.group.createGroup(),this.shape.getEventSource().setAttribute("id",this.id),this.labelShape=this.shape.createText({x:0,y:0,text:this.property("label"),decoration:"underline",align:"start"}),this.labelShape.getEventSource().setAttribute("id",this.id+"-labelShape"),this.lineShape=this.shape.createLine({x1:1,x2:this.labelShape.getTextWidth(),y1:2,y2:2}),this.lineShape.getEventSource().setAttribute("shape-rendering","crispEdges"),this.draw()},t.destroy=function(){this.shape&&(this.shape.remove(this.labelShape),this.shape.remove(this.lineShape),this.figure.group.remove(this.shape),this.shape=this.lineShape=this.labelShape=null)},t.getBBox=function(){var e=this.getTextBox(),t=this.figure.zoomFactor;return{x:0,y:(-1*e.h+4)/t,width:(e.w+2)/t,height:e.h/t}},t.draw=function(e){this.apply(e),this.shape.setTransform(this.transform),this.labelShape.setShape({x:0,y:0,text:this.property("label")}).setFill(this.property("fill")),this.zoom()},t.zoom=function(t){if(this.labelShape){t=t||this.figure.zoomFactor;var i="vml"==dojox.gfx.renderer?0:2/t;e.Annotation.prototype.zoom.call(this,t),t="vml"==dojox.gfx.renderer?1:t,this.lineShape.setShape({x1:0,x2:this.getBBox().width-i,y1:2,y2:2}).setStroke({color:this.property("fill"),width:1/t}),this.mode==e.Annotation.Modes.Edit&&this.drawBBox()}},t.serialize=function(){this.property("stroke");return"<g "+this.writeCommonAttrs()+'><text style="fill:'+this.property("fill")+';" font-weight="bold" text-decoration="underline" x="0" y="0">'+this.property("label")+"</text></g>"},dojo.declare("dojox.sketch.UnderlineAnnotationTool",e.AnnotationTool,{onMouseDown:function(){},onMouseUp:function(){var e=this.figure;e._start&&(e._end={x:0,y:0},this._create(e._start,{x:e._start.x+10,y:e._start.y+10}))},onMouseMove:function(){}}),e.Annotation.register("Underline",e.UnderlineAnnotationTool),dojox.sketch.UnderlineAnnotation});//# sourceMappingURL=UnderlineAnnotation.js.map