//>>built
define("dojox/sketch/UndoStack",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/declare","../xml/DomParser"],function(e){e.getObject("sketch",!0,dojox);var t=dojox.sketch;return t.CommandTypes={Create:"Create",Move:"Move",Modify:"Modify",Delete:"Delete",Convert:"Convert"},e.declare("dojox.sketch.UndoStack",null,{constructor:function(e){this.figure=e,this._steps=[],this._undoedSteps=[]},apply:function(e,t,i){if(!t&&!i&&e.fullText)return void this.figure.setValue(e.fullText);var o=t.shapeText,n=i.shapeText;if(0!=o.length||0!=n.length){if(0==o.length){var a=dojox.xml.DomParser.parse(n).documentElement,r=this.figure._loadAnnotation(a);return void(r&&this.figure._add(r))}if(0==n.length){var s=this.figure.getAnnotator(t.shapeId);return void this.figure._delete([s],!0)}var d=this.figure.getAnnotator(i.shapeId),l=dojox.xml.DomParser.parse(n).documentElement;d.draw(l),this.figure.select(d)}},add:function(e,i,o){var n=i?i.id:"",a=i?i.serialize():"";e==t.CommandTypes.Delete&&(a="");var r={cmdname:e,before:{shapeId:n,shapeText:o||""},after:{shapeId:n,shapeText:a}};this._steps.push(r),this._undoedSteps=[]},destroy:function(){},undo:function(){var e=this._steps.pop();e&&(this._undoedSteps.push(e),this.apply(e,e.after,e.before))},redo:function(){var e=this._undoedSteps.pop();e&&(this._steps.push(e),this.apply(e,e.before,e.after))}}),dojox.sketch.UndoStack});//# sourceMappingURL=UndoStack.js.map