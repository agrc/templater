//>>built
define("dojox/mobile/_EditableListMixin",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/event","dojo/_base/window","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/touch","dojo/dom-attr","dijit/registry","./ListItem","./common"],function(e,t,i,a,o,r,n,s,l,d,h,u,c){return i("dojox.mobile._EditableListMixin",null,{rightIconForEdit:"mblDomButtonGrayKnob",deleteIconForEdit:"mblDomButtonRedCircleMinus",isEditing:!1,destroy:function(){this._blankItem&&this._blankItem.destroy(),this.inherited(arguments)},_setupMoveItem:function(e){s.set(e,{width:n.getContentBox(e).w+"px",top:e.offsetTop+"px"}),r.add(e,"mblListItemFloat")},_resetMoveItem:function(e){this.defer(function(){r.remove(e,"mblListItemFloat"),s.set(e,{width:"",top:""})})},_onClick:function(e){if((!e||"keydown"!==e.type||13===e.keyCode)&&!1!==this.onClick(e))for(var i=h.getEnclosingWidget(e.target),a=e.target;a!==i.domNode;a=a.parentNode)if(a===i.deleteIconNode){t.publish("/dojox/mobile/deleteListItem",[i]),this.onDeleteItem(i);break}},onClick:function(){},_onTouchStart:function(t){if(!(this.getChildren().length<=1)){this._blankItem||(this._blankItem=new u);var i=this._movingItem=h.getEnclosingWidget(t.target);this._startIndex=this.getIndexOfChild(i);for(var r=!1,s=t.target;s!==i.domNode;s=s.parentNode)if(s===i.rightIconNode){r=!0,d.set(i.rightIconNode,"aria-grabbed","true"),d.set(this.domNode,"aria-dropeffect","move");break}if(r){var c=i.getNextSibling();c=c?c.domNode:null,this.containerNode.insertBefore(this._blankItem.domNode,c),this._setupMoveItem(i.domNode),this.containerNode.appendChild(i.domNode),this._conn||(this._conn=[this.connect(this.domNode,l.move,"_onTouchMove"),this.connect(o.doc,l.release,"_onTouchEnd")]),this._pos=[],e.forEach(this.getChildren(),function(e,t){this._pos.push(n.position(e.domNode,!0).y)},this),this.touchStartY=t.touches?t.touches[0].pageY:t.pageY,this._startTop=n.getMarginBox(i.domNode).t,a.stop(t)}}},_onTouchMove:function(e){for(var t=e.touches?e.touches[0].pageY:e.pageY,i=this._pos.length-1,a=1;a<this._pos.length;a++)if(t<this._pos[a]){i=a-1;break}var o=this.getChildren()[i],r=this._blankItem;if(o!==r){var n=o.domNode.parentNode;o.getIndexInParent()<r.getIndexInParent()?n.insertBefore(r.domNode,o.domNode):n.insertBefore(o.domNode,r.domNode)}this._movingItem.domNode.style.top=this._startTop+(t-this.touchStartY)+"px"},_onTouchEnd:function(i){var a=this._startIndex,o=this.getIndexOfChild(this._blankItem),r=this._blankItem.getNextSibling();r=r?r.domNode:null,null===r&&o--,this.containerNode.insertBefore(this._movingItem.domNode,r),this.containerNode.removeChild(this._blankItem.domNode),this._resetMoveItem(this._movingItem.domNode),e.forEach(this._conn,t.disconnect),this._conn=null,this.onMoveItem(this._movingItem,a,o),d.set(this._movingItem.rightIconNode,"aria-grabbed","false"),d.remove(this.domNode,"aria-dropeffect")},startEdit:function(){this.isEditing=!0,r.add(this.domNode,"mblEditableRoundRectList"),e.forEach(this.getChildren(),function(e){e.deleteIconNode||(e.set("rightIcon",this.rightIconForEdit),e.rightIconNode&&(d.set(e.rightIconNode,"role","button"),d.set(e.rightIconNode,"aria-grabbed","false")),e.set("deleteIcon",this.deleteIconForEdit),e.deleteIconNode.tabIndex=e.tabIndex,e.deleteIconNode&&d.set(e.deleteIconNode,"role","button")),e.rightIconNode.style.display="",e.deleteIconNode.style.display="",c._setTouchAction(e.rightIconNode,"none")},this),this._handles||(this._handles=[this.connect(this.domNode,l.press,"_onTouchStart"),this.connect(this.domNode,"onclick","_onClick"),this.connect(this.domNode,"onkeydown","_onClick")]),this.onStartEdit()},endEdit:function(){r.remove(this.domNode,"mblEditableRoundRectList"),e.forEach(this.getChildren(),function(e){e.rightIconNode.style.display="none",e.deleteIconNode.style.display="none",c._setTouchAction(e.rightIconNode,"auto")}),this._handles&&(e.forEach(this._handles,this.disconnect,this),this._handles=null),this.isEditing=!1,this.onEndEdit()},onDeleteItem:function(e){},onMoveItem:function(e,t,i){},onStartEdit:function(){},onEndEdit:function(){}})});//# sourceMappingURL=_EditableListMixin.js.map