//>>built
define("dojox/mobile/app/List",["dojo","dijit","dojox","dojo/require!dojo/string,dijit/_WidgetBase"],function(e,t,i){e.provide("dojox.mobile.app.List"),e.experimental("dojox.mobile.app.List"),e.require("dojo.string"),e.require("dijit._WidgetBase"),function(){var a={};e.declare("dojox.mobile.app.List",t._WidgetBase,{items:null,itemTemplate:"",emptyTemplate:"",dividerTemplate:"",dividerFunction:null,labelDelete:"Delete",labelCancel:"Cancel",controller:null,autoDelete:!0,enableDelete:!0,enableHold:!0,formatters:null,_templateLoadCount:0,_mouseDownPos:null,baseClass:"list",constructor:function(){this._checkLoadComplete=e.hitch(this,this._checkLoadComplete),this._replaceToken=e.hitch(this,this._replaceToken),this._postDeleteAnim=e.hitch(this,this._postDeleteAnim)},postCreate:function(){var t=this;if(this.emptyTemplate&&this._templateLoadCount++,this.itemTemplate&&this._templateLoadCount++,this.dividerTemplate&&this._templateLoadCount++,this.connect(this.domNode,"onmousedown",function(e){var i=e;e.targetTouches&&e.targetTouches.length>0&&(i=e.targetTouches[0]);var a=t._getRowNode(e.target);a&&(t._setDataInfo(a,e),t._selectRow(a),t._mouseDownPos={x:i.pageX,y:i.pageY},t._dragThreshold=null)}),this.connect(this.domNode,"onmouseup",function(e){e.targetTouches&&e.targetTouches.length>0&&(e=e.targetTouches[0]);var i=t._getRowNode(e.target);i&&(t._setDataInfo(i,e),t._selectedRow&&t.onSelect(i._data,i._idx,i),this._deselectRow())}),this.enableDelete&&this.connect(this.domNode,"mousemove",function(i){if(e.stopEvent(i),t._selectedRow){var a=t._getRowNode(i.target);t.enableDelete&&a&&!t._deleting&&t.handleDrag(i)}}),this.connect(this.domNode,"onclick",function(e){e.touches&&e.touches.length>0&&(e=e.touches[0]);var i=t._getRowNode(e.target,!0);i&&t._setDataInfo(i,e)}),this.connect(this.domNode,"mouseout",function(e){e.touches&&e.touches.length>0&&(e=e.touches[0]),e.target==t._selectedRow&&t._deselectRow()}),!this.itemTemplate)throw Error("An item template must be provided to "+this.declaredClass);this._loadTemplate(this.itemTemplate,"itemTemplate",this._checkLoadComplete),this.emptyTemplate&&this._loadTemplate(this.emptyTemplate,"emptyTemplate",this._checkLoadComplete),this.dividerTemplate&&this._loadTemplate(this.dividerTemplate,"dividerTemplate",this._checkLoadComplete)},handleDrag:function(t){var i=t;t.targetTouches&&t.targetTouches.length>0&&(i=t.targetTouches[0]);var a=i.pageX-this._mouseDownPos.x,n=Math.abs(a);n>10&&!this._dragThreshold&&(this._dragThreshold=.6*e.marginBox(this._selectedRow).w,this.autoDelete||this.createDeleteButtons(this._selectedRow)),this._selectedRow.style.left=(n>10?a:0)+"px",this._dragThreshold&&this._dragThreshold<n&&this.preDelete(a)},handleDragCancel:function(){this._deleting||(e.removeClass(this._selectedRow,"hold"),this._selectedRow.style.left=0,this._mouseDownPos=null,this._dragThreshold=null,this._deleteBtns&&e.style(this._deleteBtns,"display","none"))},preDelete:function(t){this._deleting=!0,e.animateProperty({node:this._selectedRow,duration:400,properties:{left:{end:t+(t>0?1:-1)*this._dragThreshold*.8}},onEnd:e.hitch(this,function(){this.autoDelete&&this.deleteRow(this._selectedRow)})}).play()},deleteRow:function(t){e.style(t,{visibility:"hidden",minHeight:"0px"}),e.removeClass(t,"hold"),this._deleteAnimConn=this.connect(t,"webkitAnimationEnd",this._postDeleteAnim),e.addClass(t,"collapsed")},_postDeleteAnim:function(t){this._deleteAnimConn&&(this.disconnect(this._deleteAnimConn),this._deleteAnimConn=null);var i=this._selectedRow,a=i.nextSibling,n=i.previousSibling;for(n&&n._isDivider&&(a&&!a._isDivider||n.parentNode.removeChild(n)),i.parentNode.removeChild(i),this.onDelete(i._data,i._idx,this.items);a;)a._idx&&a._idx--,a=a.nextSibling;e.destroy(i),e.query("> *:not(.buttons)",this.domNode).forEach(this.applyClass),this._deleting=!1,this._deselectRow()},createDeleteButtons:function(t){var a=e.marginBox(t);e._abs(t,!0);this._deleteBtns||(this._deleteBtns=e.create("div",{"class":"buttons"},this.domNode),this.buttons=[],this.buttons.push(new i.mobile.Button({btnClass:"mblRedButton",label:this.labelDelete})),this.buttons.push(new i.mobile.Button({btnClass:"mblBlueButton",label:this.labelCancel})),e.place(this.buttons[0].domNode,this._deleteBtns),e.place(this.buttons[1].domNode,this._deleteBtns),e.addClass(this.buttons[0].domNode,"deleteBtn"),e.addClass(this.buttons[1].domNode,"cancelBtn"),this._handleButtonClick=e.hitch(this._handleButtonClick),this.connect(this._deleteBtns,"onclick",this._handleButtonClick)),e.removeClass(this._deleteBtns,"fade out fast"),e.style(this._deleteBtns,{display:"",width:a.w+"px",height:a.h+"px",top:t.offsetTop+"px",left:"0px"})},onDelete:function(e,t,i){i.splice(t,1),i.length<1&&this.render()},cancelDelete:function(){this._deleting=!1,this.handleDragCancel()},_handleButtonClick:function(t){t.touches&&t.touches.length>0&&(t=t.touches[0]);var i=t.target;if(e.hasClass(i,"deleteBtn"))this.deleteRow(this._selectedRow);else{if(!e.hasClass(i,"cancelBtn"))return;this.cancelDelete()}e.addClass(this._deleteBtns,"fade out")},applyClass:function(t,i,a){e.removeClass(t,"first last"),0==i&&e.addClass(t,"first"),i==a.length-1&&e.addClass(t,"last")},_setDataInfo:function(e,t){t.item=e._data,t.index=e._idx},onSelect:function(e,t,i){},_selectRow:function(t){this._deleting&&this._selectedRow&&t!=this._selectedRow&&this.cancelDelete(),e.hasClass(t,"row")&&((this.enableHold||this.enableDelete)&&e.addClass(t,"hold"),this._selectedRow=t)},_deselectRow:function(){this._selectedRow&&!this._deleting&&(this.handleDragCancel(),e.removeClass(this._selectedRow,"hold"),this._selectedRow=null)},_getRowNode:function(t,i){for(;t&&!t._data&&t!=this.domNode;){if(!i&&e.hasClass(t,"noclick"))return null;t=t.parentNode}return t==this.domNode?null:t},applyTemplate:function(t,i){return e._toDom(e.string.substitute(t,i,this._replaceToken,this.formatters||this))},render:function(){e.query("> *:not(.buttons)",this.domNode).forEach(e.destroy),this.items.length<1&&this.emptyTemplate?e.place(e._toDom(this.emptyTemplate),this.domNode,"first"):this.domNode.appendChild(this._renderRange(0,this.items.length)),e.hasClass(this.domNode.parentNode,"mblRoundRect")&&e.addClass(this.domNode.parentNode,"mblRoundRectList");var t=e.query("> .row",this.domNode);t.length>0&&(e.addClass(t[0],"first"),e.addClass(t[t.length-1],"last"))},_renderRange:function(t,i){var a,n,o=[],r=document.createDocumentFragment();for(t=Math.max(0,t),i=Math.min(i,this.items.length),n=t;i>n;n++)a=this.applyTemplate(this.itemTemplate,this.items[n]),e.addClass(a,"row"),a._data=this.items[n],a._idx=n,o.push(a);if(this.dividerFunction&&this.dividerTemplate){var s,l,d=null;for(n=t;i>n;n++)o[n]._data=this.items[n],o[n]._idx=n,s=this.dividerFunction(this.items[n]),s&&s!=d&&(l=this.applyTemplate(this.dividerTemplate,{label:s,item:this.items[n]}),l._isDivider=!0,r.appendChild(l),d=s),r.appendChild(o[n])}else for(n=t;i>n;n++)o[n]._data=this.items[n],o[n]._idx=n,r.appendChild(o[n]);return r},_replaceToken:function(t,i){return"!"==i.charAt(0)&&(t=e.getObject(i.substr(1),!1,_this)),"undefined"==typeof t?"":null==t?"":"!"==i.charAt(0)?t:t.toString().replace(/"/g,"&quot;")},_checkLoadComplete:function(){this._templateLoadCount--,this._templateLoadCount<1&&this.get("items")&&this.render()},_loadTemplate:function(t,i,n){if(!t)return void n();if(a[t])this.set(i,a[t]),n();else{var o=this;e.xhrGet({url:t,sync:!1,handleAs:"text",load:function(r){a[t]=e.trim(r),o.set(i,a[t]),n()}})}},_setFormattersAttr:function(e){this.formatters=e},_setItemsAttr:function(e){this.items=e||[],this._templateLoadCount<1&&e&&this.render()},destroy:function(){this.buttons&&(e.forEach(this.buttons,function(e){e.destroy()}),this.buttons=null),this.inherited(arguments)}})}()});//# sourceMappingURL=List.js.map