//>>built
define("dojox/mobile/app/ImageThumbView",["dojo","dijit","dojox","dojo/require!dijit/_WidgetBase,dojo/string"],function(e,t,i){e.provide("dojox.mobile.app.ImageThumbView"),e.experimental("dojox.mobile.app.ImageThumbView"),e.require("dijit._WidgetBase"),e.require("dojo.string"),e.declare("dojox.mobile.app.ImageThumbView",t._WidgetBase,{items:[],urlParam:"url",labelParam:null,itemTemplate:'<div class="mblThumbInner"><div class="mblThumbOverlay"></div><div class="mblThumbMask"><div class="mblThumbSrc" style="background-image:url(${url})"></div></div></div>',minPadding:4,maxPerRow:3,maxRows:-1,baseClass:"mblImageThumbView",thumbSize:"medium",animationEnabled:!0,selectedIndex:-1,cache:null,cacheMustMatch:!1,clickEvent:"onclick",cacheBust:!1,disableHide:!1,constructor:function(e,t){},postCreate:function(){this.inherited(arguments);var t=this;this.addThumb=e.hitch(this,this.addThumb),this.handleImgLoad=e.hitch(this,this.handleImgLoad),this.hideCached=e.hitch(this,this.hideCached),this._onLoadImages={},this.cache=[],this.visibleImages=[],this._cacheCounter=0,this.connect(this.domNode,this.clickEvent,function(i){var a=t._getItemNodeFromEvent(i);a&&!a._cached&&(t.onSelect(a._item,a._index,t.items),e.query(".selected",this.domNode).removeClass("selected"),e.addClass(a,"selected"))}),e.addClass(this.domNode,this.thumbSize),this.resize(),this.render()},onSelect:function(e,t,i){},_setAnimationEnabledAttr:function(t){this.animationEnabled=t,e[t?"addClass":"removeClass"](this.domNode,"animated")},_setItemsAttr:function(t){this.items=t||[];var i,a={};for(i=0;i<this.items.length;i++)a[this.items[i][this.urlParam]]=1;var r=[];for(var o in this._onLoadImages)!a[o]&&this._onLoadImages[o]._conn&&(e.disconnect(this._onLoadImages[o]._conn),this._onLoadImages[o].src=null,r.push(o));for(i=0;i<r.length;i++)delete this._onLoadImages[o];this.render()},_getItemNode:function(t){for(;t&&!e.hasClass(t,"mblThumb")&&t!=this.domNode;)t=t.parentNode;return t==this.domNode?null:t},_getItemNodeFromEvent:function(e){return e.touches&&e.touches.length>0&&(e=e.touches[0]),this._getItemNode(e.target)},resize:function(){this._thumbSize=null,this._size=e.contentBox(this.domNode),this.disableHide=!0,this.render(),this.disableHide=!1},hideCached:function(){for(var t=0;t<this.cache.length;t++)this.cache[t]&&e.style(this.cache[t],"display","none")},render:function(){for(var t,i,a,r;this.visibleImages&&this.visibleImages.length>0;)r=this.visibleImages.pop(),this.cache.push(r),this.disableHide||e.addClass(r,"hidden"),r._cached=!0;if(this.cache&&this.cache.length>0&&setTimeout(this.hideCached,1e3),this.items&&0!=this.items.length){for(t=0;t<this.items.length&&(a=this.items[t],i=e.isString(a)?a:a[this.urlParam],this.addThumb(a,i,t),!(this.maxRows>0&&(t+1)/this.maxPerRow>=this.maxRows));t++);if(this._thumbSize){var o=0,n=-1,s=this._thumbSize.w+2*this.padding,l=this._thumbSize.h+2*this.padding,d=this.thumbNodes=e.query(".mblThumb",this.domNode),h=0;for(d=this.visibleImages,t=0;t<d.length;t++)d[t]._cached||(h%this.maxPerRow==0&&n++,o=h%this.maxPerRow,this.place(d[t],o*s+this.padding,n*l+this.padding),d[t]._loading||e.removeClass(d[t],"hidden"),h==this.selectedIndex&&e[h==this.selectedIndex?"addClass":"removeClass"](d[t],"selected"),h++);var u=Math.ceil(h/this.maxPerRow);this._numRows=u,this.setContainerHeight(u*(this._thumbSize.h+2*this.padding))}}},setContainerHeight:function(t){e.style(this.domNode,"height",t+"px")},addThumb:function(t,i,a){var r,o=!1;if(this.cache.length>0){for(var n=0;n<this.cache.length;n++)if(this.cache[n]._url==i){r=this.cache.splice(n,1)[0],!0;break}r||this.cacheMustMatch?o=!0:(r=this.cache.pop(),e.removeClass(r,"selected"))}if(r||(r=e.create("div",{class:"mblThumb hidden",innerHTML:e.string.substitute(this.itemTemplate,{url:i},null,this)},this.domNode)),this.labelParam){var s=e.query(".mblThumbLabel",r)[0];s||(s=e.create("div",{class:"mblThumbLabel"},r)),s.innerHTML=t[this.labelParam]||""}if(e.style(r,"display",""),this.disableHide||e.addClass(r,"hidden"),!o){var l=e.create("img",{});l._thumbDiv=r,l._conn=e.connect(l,"onload",this.handleImgLoad),l._url=i,r._loading=!0,this._onLoadImages[i]=l,l&&(l.src=i)}this.visibleImages.push(r),r._index=a,r._item=t,r._url=i,r._cached=!1,this._thumbSize||(this._thumbSize=e.marginBox(r),0==this._thumbSize.h&&(this._thumbSize.h=100,this._thumbSize.w=100),this.labelParam&&(this._thumbSize.h+=8),this.calcPadding())},handleImgLoad:function(t){var i=t.target;e.disconnect(i._conn),e.removeClass(i._thumbDiv,"hidden"),i._thumbDiv._loading=!1,i._conn=null;var a=i._url;this.cacheBust&&(a+=(a.indexOf("?")>-1?"&":"?")+"cacheBust="+(new Date).getTime()+"_"+this._cacheCounter++),e.query(".mblThumbSrc",i._thumbDiv).style("backgroundImage","url("+a+")"),delete this._onLoadImages[i._url]},calcPadding:function(){var e=this._size.w,t=this._thumbSize.w,i=t+this.minPadding;this.maxPerRow=Math.floor(e/i),this.padding=Math.floor((e-t*this.maxPerRow)/(2*this.maxPerRow))},place:function(t,i,a){e.style(t,{"-webkit-transform":"translate("+i+"px,"+a+"px)"})},destroy:function(){var e,t=0;for(var i in this._onLoadImages)(e=this._onLoadImages[i])&&(e.src=null,t++);this.inherited(arguments)}})});//# sourceMappingURL=ImageThumbView.js.map