//>>built
define("dojox/mobile/app/ImageThumbView",["dojo","dijit","dojox","dojo/require!dijit/_WidgetBase,dojo/string"],function(e,t,i){e.provide("dojox.mobile.app.ImageThumbView"),e.experimental("dojox.mobile.app.ImageThumbView"),e.require("dijit._WidgetBase"),e.require("dojo.string"),e.declare("dojox.mobile.app.ImageThumbView",t._WidgetBase,{items:[],urlParam:"url",labelParam:null,itemTemplate:'<div class="mblThumbInner"><div class="mblThumbOverlay"></div><div class="mblThumbMask"><div class="mblThumbSrc" style="background-image:url(${url})"></div></div></div>',minPadding:4,maxPerRow:3,maxRows:-1,baseClass:"mblImageThumbView",thumbSize:"medium",animationEnabled:!0,selectedIndex:-1,cache:null,cacheMustMatch:!1,clickEvent:"onclick",cacheBust:!1,disableHide:!1,constructor:function(e,t){},postCreate:function(){this.inherited(arguments);var t=this;this.addThumb=e.hitch(this,this.addThumb),this.handleImgLoad=e.hitch(this,this.handleImgLoad),this.hideCached=e.hitch(this,this.hideCached),this._onLoadImages={},this.cache=[],this.visibleImages=[],this._cacheCounter=0,this.connect(this.domNode,this.clickEvent,function(i){var r=t._getItemNodeFromEvent(i);r&&!r._cached&&(t.onSelect(r._item,r._index,t.items),e.query(".selected",this.domNode).removeClass("selected"),e.addClass(r,"selected"))}),e.addClass(this.domNode,this.thumbSize),this.resize(),this.render()},onSelect:function(e,t,i){},_setAnimationEnabledAttr:function(t){this.animationEnabled=t,e[t?"addClass":"removeClass"](this.domNode,"animated")},_setItemsAttr:function(t){this.items=t||[];var i,r={};for(i=0;i<this.items.length;i++)r[this.items[i][this.urlParam]]=1;var o=[];for(var n in this._onLoadImages)!r[n]&&this._onLoadImages[n]._conn&&(e.disconnect(this._onLoadImages[n]._conn),this._onLoadImages[n].src=null,o.push(n));for(i=0;i<o.length;i++)delete this._onLoadImages[n];this.render()},_getItemNode:function(t){for(;t&&!e.hasClass(t,"mblThumb")&&t!=this.domNode;)t=t.parentNode;return t==this.domNode?null:t},_getItemNodeFromEvent:function(e){return e.touches&&e.touches.length>0&&(e=e.touches[0]),this._getItemNode(e.target)},resize:function(){this._thumbSize=null,this._size=e.contentBox(this.domNode),this.disableHide=!0,this.render(),this.disableHide=!1},hideCached:function(){for(var t=0;t<this.cache.length;t++)this.cache[t]&&e.style(this.cache[t],"display","none")},render:function(){for(var t,i,r,o;this.visibleImages&&this.visibleImages.length>0;)o=this.visibleImages.pop(),this.cache.push(o),this.disableHide||e.addClass(o,"hidden"),o._cached=!0;if(this.cache&&this.cache.length>0&&setTimeout(this.hideCached,1e3),this.items&&0!=this.items.length){for(t=0;t<this.items.length&&(r=this.items[t],i=e.isString(r)?r:r[this.urlParam],this.addThumb(r,i,t),!(this.maxRows>0&&(t+1)/this.maxPerRow>=this.maxRows));t++);if(this._thumbSize){var n=0,a=-1,s=this._thumbSize.w+2*this.padding,d=this._thumbSize.h+2*this.padding,l=this.thumbNodes=e.query(".mblThumb",this.domNode),u=0;for(l=this.visibleImages,t=0;t<l.length;t++)l[t]._cached||(u%this.maxPerRow==0&&a++,n=u%this.maxPerRow,this.place(l[t],n*s+this.padding,a*d+this.padding),l[t]._loading||e.removeClass(l[t],"hidden"),u==this.selectedIndex&&e[u==this.selectedIndex?"addClass":"removeClass"](l[t],"selected"),u++);var c=Math.ceil(u/this.maxPerRow);this._numRows=c,this.setContainerHeight(c*(this._thumbSize.h+2*this.padding))}}},setContainerHeight:function(t){e.style(this.domNode,"height",t+"px")},addThumb:function(t,i,r){var o,n=!1;if(this.cache.length>0){for(var a=0;a<this.cache.length;a++)if(this.cache[a]._url==i){o=this.cache.splice(a,1)[0],!0;break}o||this.cacheMustMatch?n=!0:(o=this.cache.pop(),e.removeClass(o,"selected"))}if(o||(o=e.create("div",{class:"mblThumb hidden",innerHTML:e.string.substitute(this.itemTemplate,{url:i},null,this)},this.domNode)),this.labelParam){var s=e.query(".mblThumbLabel",o)[0];s||(s=e.create("div",{class:"mblThumbLabel"},o)),s.innerHTML=t[this.labelParam]||""}if(e.style(o,"display",""),this.disableHide||e.addClass(o,"hidden"),!n){var d=e.create("img",{});d._thumbDiv=o,d._conn=e.connect(d,"onload",this.handleImgLoad),d._url=i,o._loading=!0,this._onLoadImages[i]=d,d&&(d.src=i)}this.visibleImages.push(o),o._index=r,o._item=t,o._url=i,o._cached=!1,this._thumbSize||(this._thumbSize=e.marginBox(o),0==this._thumbSize.h&&(this._thumbSize.h=100,this._thumbSize.w=100),this.labelParam&&(this._thumbSize.h+=8),this.calcPadding())},handleImgLoad:function(t){var i=t.target;e.disconnect(i._conn),e.removeClass(i._thumbDiv,"hidden"),i._thumbDiv._loading=!1,i._conn=null;var r=i._url;this.cacheBust&&(r+=(r.indexOf("?")>-1?"&":"?")+"cacheBust="+(new Date).getTime()+"_"+this._cacheCounter++),e.query(".mblThumbSrc",i._thumbDiv).style("backgroundImage","url("+r+")"),delete this._onLoadImages[i._url]},calcPadding:function(){var e=this._size.w,t=this._thumbSize.w,i=t+this.minPadding;this.maxPerRow=Math.floor(e/i),this.padding=Math.floor((e-t*this.maxPerRow)/(2*this.maxPerRow))},place:function(t,i,r){e.style(t,{"-webkit-transform":"translate("+i+"px,"+r+"px)"})},destroy:function(){var e,t=0;for(var i in this._onLoadImages)(e=this._onLoadImages[i])&&(e.src=null,t++);this.inherited(arguments)}})});//# sourceMappingURL=ImageThumbView.js.map