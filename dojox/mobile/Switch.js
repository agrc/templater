//>>built
define("dojox/mobile/Switch",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/event","dojo/_base/window","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/dom-attr","dojo/touch","dijit/_Contained","dijit/_WidgetBase","./sniff","./_maskUtils","./common","dojo/has!dojo-bidi?dojox/mobile/bidi/Switch"],function(e,t,i,a,o,r,n,s,l,d,h,u,c,m,f,g){var p=i(c("dojo-bidi")?"dojox.mobile.NonBidiSwitch":"dojox.mobile.Switch",[u,h],{value:"on",name:"",leftLabel:"ON",rightLabel:"OFF",shape:"mblSwDefaultShape",tabIndex:"0",_setTabIndexAttr:"",baseClass:"mblSwitch",role:"",buildRendering:function(){if(this.templateString||(this.domNode=this.srcNodeRef&&"SPAN"===this.srcNodeRef.tagName?this.srcNodeRef:n.create("span")),f._setTouchAction(this.domNode,"none"),this.inherited(arguments),!this.templateString){var e=this.srcNodeRef&&this.srcNodeRef.className||this.className||this["class"];(e=e.match(/mblSw.*Shape\d*/))&&(this.shape=e),r.add(this.domNode,this.shape);var t=this.name?' name="'+this.name+'"':"";this.domNode.innerHTML='<div class="mblSwitchInner"><div class="mblSwitchBg mblSwitchBgLeft"><div class="mblSwitchText mblSwitchTextLeft"></div></div><div class="mblSwitchBg mblSwitchBgRight"><div class="mblSwitchText mblSwitchTextRight"></div></div><div class="mblSwitchKnob"></div><input type="hidden"'+t+' value="'+this.value+'"></div></div>';var i=this.inner=this.domNode.firstChild;this.left=i.childNodes[0],this.right=i.childNodes[1],this.knob=i.childNodes[2],this.input=i.childNodes[3]}if(l.set(this.domNode,"role","checkbox"),l.set(this.domNode,"aria-checked","on"===this.value?"true":"false"),this.switchNode=this.domNode,c("windows-theme")){var a=n.create("div",{className:"mblSwitchContainer"});this.labelNode=n.create("label",{"class":"mblSwitchLabel","for":this.id},a),a.appendChild(this.domNode.cloneNode(!0)),this.domNode=a,this.focusNode=a.childNodes[1],this.labelNode.innerHTML="off"==this.value?this.rightLabel:this.leftLabel,this.switchNode=this.domNode.childNodes[1];var o=this.inner=this.domNode.childNodes[1].firstChild;this.left=o.childNodes[0],this.right=o.childNodes[1],this.knob=o.childNodes[2],this.input=o.childNodes[3]}},postCreate:function(){this.connect(this.switchNode,"onclick","_onClick"),this.connect(this.switchNode,"onkeydown","_onClick"),this._startHandle=this.connect(this.switchNode,d.press,"onTouchStart"),this._initialValue=this.value},startup:function(){this.inherited(arguments),this._started||this.resize()},resize:function(){if(c("windows-theme"))s.set(this.domNode,"width","100%");else{var e=s.get(this.domNode,"width"),t=e+"px",i=e-s.get(this.knob,"width")+"px";s.set(this.left,"width",t),s.set(this.right,this.isLeftToRight()?{width:t,left:i}:{width:t}),s.set(this.left.firstChild,"width",i),s.set(this.right.firstChild,"width",i),s.set(this.knob,"left",i),"off"==this.value&&s.set(this.inner,"left",this.isLeftToRight()?"-"+i:0),this._hasMaskImage=!1,this._createMaskImage()}},_changeState:function(e,t){var i="on"===e;this.left.style.display="",this.right.style.display="",this.inner.style.left="",t&&r.add(this.switchNode,"mblSwitchAnimation"),r.remove(this.switchNode,i?"mblSwitchOff":"mblSwitchOn"),r.add(this.switchNode,i?"mblSwitchOn":"mblSwitchOff"),l.set(this.switchNode,"aria-checked",i?"true":"false"),i||c("windows-theme")||(this.inner.style.left=(this.isLeftToRight()?-(s.get(this.domNode,"width")-s.get(this.knob,"width")):0)+"px");var a=this;a.defer(function(){a.left.style.display=i?"":"none",a.right.style.display=i?"none":"",r.remove(a.switchNode,"mblSwitchAnimation")},t?300:0)},_createMaskImage:function(){if(this._timer&&(this._timer.remove(),delete this._timer),!this._hasMaskImage){var e=s.get(this.domNode,"width"),t=s.get(this.domNode,"height");if(this._width=e-s.get(this.knob,"width"),this._hasMaskImage=!0,c("mask-image")){var i=s.get(this.left,"borderTopLeftRadius");if("0px"!=i){var a=i.split(" "),o=parseFloat(a[0]),r=1==a.length?o:parseFloat(a[1]);(this.shape+"Mask"+e+t+o+r).replace(/\./,"_");m.createRoundMask(this.switchNode,0,0,0,0,e,t,o,r,1)}}}},_onClick:function(e){e&&"keydown"===e.type&&13!==e.keyCode||this.onClick(e)!==!1&&(this._moved||(this._set("value",this.input.value="on"==this.value?"off":"on"),this._changeState(this.value,!0),this.onStateChanged(this.value)))},onClick:function(){},onTouchStart:function(e){this._moved=!1,this.innerStartX=this.inner.offsetLeft,this._conn||(this._conn=[this.connect(this.inner,d.move,"onTouchMove"),this.connect(o.doc,d.release,"onTouchEnd")],c("windows-theme")&&this._conn.push(this.connect(o.doc,"MSPointerCancel","onTouchEnd"))),this.touchStartX=e.touches?e.touches[0].pageX:e.clientX,this.left.style.display="",this.right.style.display="",a.stop(e),this._createMaskImage()},onTouchMove:function(e){e.preventDefault();var t;if(e.targetTouches){if(1!=e.targetTouches.length)return;t=e.targetTouches[0].clientX-this.touchStartX}else t=e.clientX-this.touchStartX;var i=this.innerStartX+t,a=10;i<=-(this._width-a)&&(i=-this._width),i>=-a&&(i=0),this.inner.style.left=i+"px",Math.abs(t)>a&&(this._moved=!0)},onTouchEnd:function(i){if(e.forEach(this._conn,t.disconnect),this._conn=null,this.innerStartX==this.inner.offsetLeft)return void(c("touch")&&c("clicks-prevented")&&f._sendClick(this.inner,i));var a=this.inner.offsetLeft<-(this._width/2)?"off":"on";a=this._newState(a),this._changeState(a,!0),a!=this.value&&(this._set("value",this.input.value=a),this.onStateChanged(a))},_newState:function(e){return e},onStateChanged:function(e){this.labelNode&&(this.labelNode.innerHTML="off"==e?this.rightLabel:this.leftLabel)},_setValueAttr:function(e){this._changeState(e,!1),this.value!=e&&(this._set("value",this.input.value=e),this.onStateChanged(e))},_setLeftLabelAttr:function(e){this.leftLabel=e,this.left.firstChild.innerHTML=this._cv?this._cv(e):e},_setRightLabelAttr:function(e){this.rightLabel=e,this.right.firstChild.innerHTML=this._cv?this._cv(e):e},reset:function(){this.set("value",this._initialValue)}});return c("dojo-bidi")?i("dojox.mobile.Switch",[p,g]):p});//# sourceMappingURL=Switch.js.map