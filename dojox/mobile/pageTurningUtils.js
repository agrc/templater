//>>built
define("dojox/mobile/pageTurningUtils",["dojo/_base/kernel","dojo/_base/array","dojo/_base/connect","dojo/_base/event","dojo/dom-class","dojo/dom-construct","dojo/dom-style","./_css3"],function(e,t,i,a,r,o,n,s){return e.experimental("dojox.mobile.pageTurningUtils"),function(){this.w=0,this.h=0,this.turnfrom="top",this.page=1,this.dogear=1,this.duration=2,this.alwaysDogeared=!1,this._styleParams={},this._catalogNode=null,this._currentPageNode=null,this._transitionEndHandle=null,this.init=function(e,t,i,a,r,o,n){this.w=e,this.h=t,this.turnfrom=i||this.turnfrom,this.page=a||this.page,this.dogear=void 0!==r?r:this.dogear,this.duration=void 0!==o?o:this.duration,this.alwaysDogeared=void 0!==n?n:this.alwaysDogeared,"bottom"===this.turnfrom&&(this.alwaysDogeared=!0),this._calcStyleParams()},this._calcStyleParams=function(){var e,t,i,a,r,o=Math.tan(58*Math.PI/180),n=Math.cos(32*Math.PI/180),l=Math.sin(32*Math.PI/180),d=Math.tan(32*Math.PI/180),h=this.w,u=this.h,c=this.page,m=this.turnfrom,f=this._styleParams,g=h*o,p=g,v=p*l+p*n*o,y=g+h+h/o,b=.11*h*this.dogear,_=h-b,w=_*n;switch(this.turnfrom){case"top":e=v-w,t=w*o,i=v-b,a=t+_/o-7,r=t/n,f.init={page:s.add({top:-r+"px",left:-v+(2===c?h:0)+"px",width:v+"px",height:y+"px"},{transformOrigin:"100% 0%"}),front:s.add({width:h+"px",height:u+"px"},{boxShadow:"0 0"}),back:s.add({width:h+"px",height:u+"px"},{boxShadow:"0 0"}),shadow:{display:"",left:v+"px",height:1.5*u+"px"}},f.turnForward={page:s.add({},{transform:"rotate(0deg)"}),front:s.add({},{transform:"translate("+v+"px,"+r+"px) rotate(0deg)",transformOrigin:"-110px -18px"}),back:s.add({},{transform:"translate("+(v-h)+"px,"+r+"px) rotate(0deg)",transformOrigin:"0px 0px"})},f.turnBackward={page:s.add({},{transform:"rotate(-32deg)"}),front:s.add({},{transform:"translate("+e+"px,"+t+"px) rotate(32deg)",transformOrigin:"0px 0px"}),back:s.add({},{transform:"translate("+i+"px,"+a+"px) rotate(-32deg)",transformOrigin:"0px 0px"})};break;case"bottom":e=v-(u*l+h*n)-2,t=y-(u+h/d)*n,i=v,a=y-h/l-u,r=y-h/d-u,f.init={page:s.add({top:50-r+"px",left:-v+(2===c?h:0)+"px",width:v+"px",height:y+"px"},{transformOrigin:"100% 100%"}),front:s.add({width:h+"px",height:u+"px"},{boxShadow:"0 0"}),back:s.add({width:h+"px",height:u+"px"},{boxShadow:"0 0"}),shadow:{display:"none"}},f.turnForward={page:s.add({},{transform:"rotate(0deg)"}),front:s.add({},{transform:"translate("+v+"px,"+r+"px) rotate(0deg)",transformOrigin:"-220px 35px"}),back:s.add({},{transform:"translate("+2*h+"px,"+r+"px) rotate(0deg)",transformOrigin:"0px 0px"})},f.turnBackward={page:s.add({},{transform:"rotate(32deg)"}),front:s.add({},{transform:"translate("+e+"px,"+t+"px) rotate(-32deg)",transformOrigin:"0px 0px"}),back:s.add({},{transform:"translate("+i+"px,"+a+"px) rotate(0deg)",transformOrigin:"0px 0px"})};break;case"left":e=-h,t=_/d-2,i=-_,a=r=_/l+b*l,f.init={page:s.add({top:-t+"px",left:h+"px",width:v+"px",height:y+"px"},{transformOrigin:"0% 0%"}),front:s.add({width:h+"px",height:u+"px"},{boxShadow:"0 0"}),back:s.add({width:h+"px",height:u+"px"},{boxShadow:"0 0"}),shadow:{display:"",left:"-4px",height:(2===c?1.5*u:u)+50+"px"}},f.turnForward={page:s.add({},{transform:"rotate(0deg)"}),front:s.add({},{transform:"translate("+e+"px,"+t+"px) rotate(0deg)",transformOrigin:"160px 68px"}),back:s.add({},{transform:"translate(0px,"+t+"px) rotate(0deg)",transformOrigin:"0px 0px"})},f.turnBackward={page:s.add({},{transform:"rotate(32deg)"}),front:s.add({},{transform:"translate("+-b+"px,"+a+"px) rotate(-32deg)",transformOrigin:"0px 0px"}),back:s.add({},{transform:"translate("+i+"px,"+a+"px) rotate(32deg)",transformOrigin:"top right"})}}f.init.catalog={width:(2===c?2*h:h)+"px",height:(2===c?1.5*u:u)+("top"==m?0:50)+"px"}},this.getChildren=function(e){return t.filter(e.childNodes,function(e){return 1===e.nodeType})},this.getPages=function(){return this._catalogNode?this.getChildren(this._catalogNode):null},this.getCurrentPage=function(){return this._currentPageNode},this.getIndexOfPage=function(e,t){t||(t=this.getPages());for(var i=0;i<t.length;i++)if(e===t[i])return i;return-1},this.getNextPage=function(e){for(var t=e.nextSibling;t;t=t.nextSibling)if(1===t.nodeType)return t;return null},this.getPreviousPage=function(e){for(var t=e.previousSibling;t;t=t.previousSibling)if(1===t.nodeType)return t;return null},this.isPageTurned=function(e){return"rotate(0deg)"==e.style[s.name("transform")]},this._onPageTurned=function(e){a.stop(e),r.contains(e.target,"mblPageTurningPage")&&this.onPageTurned(e.target)},this.onPageTurned=function(){},this.initCatalog=function(e){this._catalogNode!=e&&(this._transitionEndHandle&&i.disconnect(this._transitionEndHandle),this._transitionEndHandle=i.connect(e,s.name("transitionEnd"),this,"_onPageTurned"),this._catalogNode=e),r.add(e,"mblPageTurningCatalog"),n.set(e,this._styleParams.init.catalog);var a=this.getPages();t.forEach(a,function(e){this.initPage(e)},this),this.resetCatalog()},this._getBaseZIndex=function(){return this._catalogNode.style.zIndex||0},this.resetCatalog=function(){for(var e=this.getPages(),t=e.length,i=this._getBaseZIndex(),a=t-1;a>=0;a--){var r=e[a];this.showDogear(r),this.isPageTurned(r)?r.style.zIndex=i+t+1:(r.style.zIndex=i+t-a,!this.alwaysDogeared&&this.hideDogear(r),this._currentPageNode=r)}this.alwaysDogeared||this._currentPageNode==e[t-1]||this.showDogear(this._currentPageNode)},this.initPage=function(e,t){for(var i=this.getChildren(e);i.length<3;)e.appendChild(o.create("div",null)),i=this.getChildren(e);var a=!r.contains(e,"mblPageTurningPage");r.add(e,"mblPageTurningPage"),r.add(i[0],"mblPageTurningFront"),r.add(i[1],"mblPageTurningBack"),r.add(i[2],"mblPageTurningShadow");var s=this._styleParams.init;if(n.set(e,s.page),n.set(i[0],s.front),n.set(i[1],s.back),s.shadow&&n.set(i[2],s.shadow),!t)if(a&&this._currentPageNode){this.getPages();t=this.getIndexOfPage(e)<this.getIndexOfPage(this._currentPageNode)?1:-1}else t=this.isPageTurned(e)?1:-1;this._turnPage(e,t,0)},this.turnToNext=function(e){var t=this.getNextPage(this._currentPageNode);t&&(this._turnPage(this._currentPageNode,1,e),this._currentPageNode=t)},this.turnToPrev=function(e){var t=this.getPreviousPage(this._currentPageNode);t&&(this._turnPage(t,-1,e),this._currentPageNode=t)},this.goTo=function(e){var t=this.getPages();if(!(this._currentPageNode===t[e]||t.length<=e))for(var i=e<this.getIndexOfPage(this._currentPageNode,t);this._currentPageNode!==t[e];)i?this.turnToPrev(0):this.turnToNext(0)},this._turnPage=function(e,t,i){var a=this.getChildren(e),r=(void 0!==i?i:this.duration)+"s",o=1===t?this._styleParams.turnForward:this._styleParams.turnBackward;o.page[s.name("transitionDuration")]=r,n.set(e,o.page),o.front[s.name("transitionDuration")]=r,n.set(a[0],o.front),o.back[s.name("transitionDuration")]=r,n.set(a[1],o.back);var l=this.getPages(),d=this.getNextPage(e),h=l.length,u=this._getBaseZIndex();1===t?(e.style.zIndex=u+h+1,!this.alwaysDogeared&&d&&this.getNextPage(d)&&this.showDogear(d)):d&&(d.style.zIndex=u+h-this.getIndexOfPage(d,l),!this.alwaysDogeared&&this.hideDogear(d))},this.showDogear=function(e){var t=this.getChildren(e);n.set(e,"overflow",""),t[1]&&n.set(t[1],"display",""),t[2]&&n.set(t[2],"display","bottom"===this.turnfrom?"none":"")},this.hideDogear=function(e){if("bottom"!==this.turnfrom){var t=this.getChildren(e);n.set(e,"overflow","visible"),t[1]&&n.set(t[1],"display","none"),t[2]&&n.set(t[2],"display","none")}}}});//# sourceMappingURL=pageTurningUtils.js.map