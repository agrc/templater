//>>built
define("dojox/mobile/Carousel",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/sniff","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dijit/registry","dijit/_Contained","dijit/_Container","dijit/_WidgetBase","./lazyLoadUtils","./CarouselItem","./PageIndicator","./SwapView","require","dojo/has!dojo-bidi?dojox/mobile/bidi/Carousel","dojo/i18n!dojox/mobile/nls/messages"],function(e,t,i,a,n,o,r,s,l,d,u,h,c,m,f,p,y,g,v,b){var M=i(o("dojo-bidi")?"dojox.mobile.NonBidiCarousel":"dojox.mobile.Carousel",[c,h,u],{numVisible:2,itemWidth:0,title:"",pageIndicator:!0,navButton:!1,height:"",selectable:!0,baseClass:"mblCarousel",buildRendering:function(){this.containerNode=s.create("div",{className:"mblCarouselPages",id:this.id+"_pages"}),this.inherited(arguments);var e,t;if(this.srcNodeRef)for(e=0,t=this.srcNodeRef.childNodes.length;e<t;e++)this.containerNode.appendChild(this.srcNodeRef.firstChild);this.headerNode=s.create("div",{className:"mblCarouselHeaderBar"},this.domNode),this.navButton&&(this.btnContainerNode=s.create("div",{className:"mblCarouselBtnContainer"},this.headerNode),l.set(this.btnContainerNode,"float","right"),this.prevBtnNode=s.create("button",{className:"mblCarouselBtn",title:b.CarouselPrevious,innerHTML:"&lt;","aria-controls":this.containerNode.id},this.btnContainerNode),this.nextBtnNode=s.create("button",{className:"mblCarouselBtn",title:b.CarouselNext,innerHTML:"&gt;","aria-controls":this.containerNode.id},this.btnContainerNode),this._prevHandle=this.connect(this.prevBtnNode,"onclick","onPrevBtnClick"),this._nextHandle=this.connect(this.nextBtnNode,"onclick","onNextBtnClick")),this.pageIndicator&&(this.title||(this.title="&nbsp;"),this.piw=new p,this.headerNode.appendChild(this.piw.domNode)),this.titleNode=s.create("div",{className:"mblCarouselTitle"},this.headerNode),this.domNode.appendChild(this.containerNode),this.subscribe("/dojox/mobile/viewChanged","handleViewChanged"),this.connect(this.domNode,"onclick","_onClick"),this.connect(this.domNode,"onkeydown","_onClick"),this._dragstartHandle=this.connect(this.domNode,"ondragstart",a.stop),this.selectedItemIndex=-1,this.items=[]},startup:function(){if(!this._started){var t;if("inherit"===this.height?this.domNode.offsetParent&&(t=this.domNode.offsetParent.offsetHeight+"px"):this.height&&(t=this.height),t&&(this.domNode.style.height=t),this.store){if(!this.setStore)throw new Error("Use StoreCarousel or DataCarousel instead of Carousel.");var i=this.store;this.store=null,this.setStore(i,this.query,this.queryOptions)}else this.resizeItems();this.inherited(arguments),this.currentView=e.filter(this.getChildren(),function(e){return e.isVisible()})[0]}},resizeItems:function(){var t,i,a,n,s=0,d=this.domNode.offsetHeight-(this.headerNode?this.headerNode.offsetHeight:0),u=o("ie")<10?5/this.numVisible-1:5/this.numVisible;e.forEach(this.getChildren(),function(e){if(e instanceof y){e.lazy||(e._instantiated=!0);var o=e.containerNode.childNodes;for(t=0,i=o.length;t<i;t++)a=o[t],1===a.nodeType&&(n=this.items[s]||{},l.set(a,{width:n.width||90/this.numVisible+"%",height:n.height||d+"px",margin:"0 "+(n.margin||u+"%")}),r.add(a,"mblCarouselSlot"),s++)}},this),this.piw&&(this.piw.refId=this.containerNode.firstChild,this.piw.reset())},resize:function(){if(this.itemWidth){var e=Math.floor(this.domNode.offsetWidth/this.itemWidth);e!==this.numVisible&&(this.selectedItemIndex=this.getIndexByItemWidget(this.selectedItem),this.numVisible=e,this.items.length>0&&(this.onComplete(this.items),this.select(this.selectedItemIndex)))}},fillPages:function(){e.forEach(this.getChildren(),function(t,i){var a,n="";for(a=0;a<this.numVisible;a++){var o,r,s="",l=i*this.numVisible+a,d={};l<this.items.length?(d=this.items[l],o=this.store.getValue(d,"type"),o?(s=this.store.getValue(d,"props"),r=this.store.getValue(d,"mixins")):(o="dojox.mobile.CarouselItem",e.forEach(["alt","src","headerText","footerText"],function(e){var t=this.store.getValue(d,e);void 0!==t&&(s&&(s+=","),s+=e+':"'+t+'"')},this))):(o="dojox.mobile.CarouselItem",s='src:"'+g.toUrl("dojo/resources/blank.gif")+'", className:"mblCarouselItemBlank"'),n+='<div data-dojo-type="'+o+'"',s&&(n+=" data-dojo-props='"+s+"'"),r&&(n+=" data-dojo-mixins='"+r+"'"),n+="></div>"}t.containerNode.innerHTML=n},this)},onComplete:function(t){e.forEach(this.getChildren(),function(e){e instanceof y&&e.destroyRecursive()}),this.selectedItem=null,this.items=t;var i,a=Math.ceil(t.length/this.numVisible),n=this.domNode.offsetHeight-this.headerNode.offsetHeight,o=-1===this.selectedItemIndex?0:this.selectedItemIndex,r=Math.floor(o/this.numVisible);for(i=0;i<a;i++){var s=new y({height:n+"px",lazy:!0});this.addChild(s),i===r?(s.show(),this.currentView=s):s.hide()}this.fillPages(),this.resizeItems();var l=this.getChildren(),d=r-1<0?0:r-1,u=r+1>a-1?a-1:r+1;for(i=d;i<=u;i++)this.instantiateView(l[i])},onError:function(){},onUpdate:function(){},onDelete:function(){},onSet:function(e,t,i,a){},onNew:function(e,t){},onStoreClose:function(e){},getParentView:function(e){var t;for(t=d.getEnclosingWidget(e);t;t=t.getParent())if(t.getParent()instanceof y)return t;return null},getIndexByItemWidget:function(t){if(!t)return-1;var i=t.getParent();return e.indexOf(this.getChildren(),i)*this.numVisible+e.indexOf(i.getChildren(),t)},getItemWidgetByIndex:function(e){return-1===e?null:this.getChildren()[Math.floor(e/this.numVisible)].getChildren()[e%this.numVisible]},onPrevBtnClick:function(){this.currentView&&this.currentView.goTo(-1)},onNextBtnClick:function(){this.currentView&&this.currentView.goTo(1)},_onClick:function(e){if(!1!==this.onClick(e)){if(e&&"keydown"===e.type)if(39===e.keyCode)this.onNextBtnClick();else if(37===e.keyCode)this.onPrevBtnClick();else if(13!==e.keyCode)return;var i;for(i=d.getEnclosingWidget(e.target);;i=i.getParent()){if(!i)return;if(i.getParent()instanceof y)break}this.select(i);var a=this.getIndexByItemWidget(i);t.publish("/dojox/mobile/carouselSelect",[this,i,this.items[a],a])}},select:function(e){"number"==typeof e&&(e=this.getItemWidgetByIndex(e)),this.selectable&&(this.selectedItem&&(this.selectedItem.set("selected",!1),r.remove(this.selectedItem.domNode,"mblCarouselSlotSelected")),e&&(e.set("selected",!0),r.add(e.domNode,"mblCarouselSlotSelected")),this.selectedItem=e)},onClick:function(){},instantiateView:function(e){if(e&&!e._instantiated){var t="none"===l.get(e.domNode,"display");t&&l.set(e.domNode,{visibility:"hidden",display:""}),m.instantiateLazyWidgets(e.containerNode,null,function(i){t&&l.set(e.domNode,{visibility:"visible",display:"none"})}),e._instantiated=!0}},handleViewChanged:function(e){e.getParent()===this&&(this.currentView.nextView(this.currentView.domNode)===e?this.instantiateView(e.nextView(e.domNode)):this.instantiateView(e.previousView(e.domNode)),this.currentView=e)},_setTitleAttr:function(e){this.titleNode.innerHTML=this._cv?this._cv(e):e,this._set("title",e)}});return M.ChildSwapViewProperties={lazy:!1},n.extend(y,M.ChildSwapViewProperties),o("dojo-bidi")?i("dojox.mobile.Carousel",[M,v]):M});//# sourceMappingURL=Carousel.js.map