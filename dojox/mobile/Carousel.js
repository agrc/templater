//>>built
define("dojox/mobile/Carousel",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/sniff","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dijit/registry","dijit/_Contained","dijit/_Container","dijit/_WidgetBase","./lazyLoadUtils","./CarouselItem","./PageIndicator","./SwapView","require","dojo/has!dojo-bidi?dojox/mobile/bidi/Carousel","dojo/i18n!dojox/mobile/nls/messages"],function(e,t,i,o,r,a,n,s,d,l,c,u,h,f,m,p,g,v,y,b){var _=i(a("dojo-bidi")?"dojox.mobile.NonBidiCarousel":"dojox.mobile.Carousel",[h,u,c],{numVisible:2,itemWidth:0,title:"",pageIndicator:!0,navButton:!1,height:"",selectable:!0,baseClass:"mblCarousel",buildRendering:function(){this.containerNode=s.create("div",{className:"mblCarouselPages",id:this.id+"_pages"}),this.inherited(arguments);var e,t;if(this.srcNodeRef)for(e=0,t=this.srcNodeRef.childNodes.length;t>e;e++)this.containerNode.appendChild(this.srcNodeRef.firstChild);this.headerNode=s.create("div",{className:"mblCarouselHeaderBar"},this.domNode),this.navButton&&(this.btnContainerNode=s.create("div",{className:"mblCarouselBtnContainer"},this.headerNode),d.set(this.btnContainerNode,"float","right"),this.prevBtnNode=s.create("button",{className:"mblCarouselBtn",title:b.CarouselPrevious,innerHTML:"&lt;","aria-controls":this.containerNode.id},this.btnContainerNode),this.nextBtnNode=s.create("button",{className:"mblCarouselBtn",title:b.CarouselNext,innerHTML:"&gt;","aria-controls":this.containerNode.id},this.btnContainerNode),this._prevHandle=this.connect(this.prevBtnNode,"onclick","onPrevBtnClick"),this._nextHandle=this.connect(this.nextBtnNode,"onclick","onNextBtnClick")),this.pageIndicator&&(this.title||(this.title="&nbsp;"),this.piw=new p,this.headerNode.appendChild(this.piw.domNode)),this.titleNode=s.create("div",{className:"mblCarouselTitle"},this.headerNode),this.domNode.appendChild(this.containerNode),this.subscribe("/dojox/mobile/viewChanged","handleViewChanged"),this.connect(this.domNode,"onclick","_onClick"),this.connect(this.domNode,"onkeydown","_onClick"),this._dragstartHandle=this.connect(this.domNode,"ondragstart",o.stop),this.selectedItemIndex=-1,this.items=[]},startup:function(){if(!this._started){var t;if("inherit"===this.height?this.domNode.offsetParent&&(t=this.domNode.offsetParent.offsetHeight+"px"):this.height&&(t=this.height),t&&(this.domNode.style.height=t),this.store){if(!this.setStore)throw new Error("Use StoreCarousel or DataCarousel instead of Carousel.");var i=this.store;this.store=null,this.setStore(i,this.query,this.queryOptions)}else this.resizeItems();this.inherited(arguments),this.currentView=e.filter(this.getChildren(),function(e){return e.isVisible()})[0]}},resizeItems:function(){var t,i,o,r,s=0,l=this.domNode.offsetHeight-(this.headerNode?this.headerNode.offsetHeight:0),c=a("ie")<10?5/this.numVisible-1:5/this.numVisible;e.forEach(this.getChildren(),function(e){if(e instanceof g){e.lazy||(e._instantiated=!0);var a=e.containerNode.childNodes;for(t=0,i=a.length;i>t;t++)o=a[t],1===o.nodeType&&(r=this.items[s]||{},d.set(o,{width:r.width||90/this.numVisible+"%",height:r.height||l+"px",margin:"0 "+(r.margin||c+"%")}),n.add(o,"mblCarouselSlot"),s++)}},this),this.piw&&(this.piw.refId=this.containerNode.firstChild,this.piw.reset())},resize:function(){if(this.itemWidth){var e=Math.floor(this.domNode.offsetWidth/this.itemWidth);e!==this.numVisible&&(this.selectedItemIndex=this.getIndexByItemWidget(this.selectedItem),this.numVisible=e,this.items.length>0&&(this.onComplete(this.items),this.select(this.selectedItemIndex)))}},fillPages:function(){e.forEach(this.getChildren(),function(t,i){var o,r="";for(o=0;o<this.numVisible;o++){var a,n,s="",d=i*this.numVisible+o,l={};d<this.items.length?(l=this.items[d],a=this.store.getValue(l,"type"),a?(s=this.store.getValue(l,"props"),n=this.store.getValue(l,"mixins")):(a="dojox.mobile.CarouselItem",e.forEach(["alt","src","headerText","footerText"],function(e){var t=this.store.getValue(l,e);void 0!==t&&(s&&(s+=","),s+=e+':"'+t+'"')},this))):(a="dojox.mobile.CarouselItem",s='src:"'+v.toUrl("dojo/resources/blank.gif")+'", className:"mblCarouselItemBlank"'),r+='<div data-dojo-type="'+a+'"',s&&(r+=" data-dojo-props='"+s+"'"),n&&(r+=" data-dojo-mixins='"+n+"'"),r+="></div>"}t.containerNode.innerHTML=r},this)},onComplete:function(t){e.forEach(this.getChildren(),function(e){e instanceof g&&e.destroyRecursive()}),this.selectedItem=null,this.items=t;var i,o=Math.ceil(t.length/this.numVisible),r=this.domNode.offsetHeight-this.headerNode.offsetHeight,a=-1===this.selectedItemIndex?0:this.selectedItemIndex,n=Math.floor(a/this.numVisible);for(i=0;o>i;i++){var s=new g({height:r+"px",lazy:!0});this.addChild(s),i===n?(s.show(),this.currentView=s):s.hide()}this.fillPages(),this.resizeItems();var d=this.getChildren(),l=0>n-1?0:n-1,c=n+1>o-1?o-1:n+1;for(i=l;c>=i;i++)this.instantiateView(d[i])},onError:function(){},onUpdate:function(){},onDelete:function(){},onSet:function(e,t,i,o){},onNew:function(e,t){},onStoreClose:function(e){},getParentView:function(e){var t;for(t=l.getEnclosingWidget(e);t;t=t.getParent())if(t.getParent()instanceof g)return t;return null},getIndexByItemWidget:function(t){if(!t)return-1;var i=t.getParent();return e.indexOf(this.getChildren(),i)*this.numVisible+e.indexOf(i.getChildren(),t)},getItemWidgetByIndex:function(e){if(-1===e)return null;var t=this.getChildren()[Math.floor(e/this.numVisible)];return t.getChildren()[e%this.numVisible]},onPrevBtnClick:function(){this.currentView&&this.currentView.goTo(-1)},onNextBtnClick:function(){this.currentView&&this.currentView.goTo(1)},_onClick:function(e){if(this.onClick(e)!==!1){if(e&&"keydown"===e.type)if(39===e.keyCode)this.onNextBtnClick();else if(37===e.keyCode)this.onPrevBtnClick();else if(13!==e.keyCode)return;var i;for(i=l.getEnclosingWidget(e.target);;i=i.getParent()){if(!i)return;if(i.getParent()instanceof g)break}this.select(i);var o=this.getIndexByItemWidget(i);t.publish("/dojox/mobile/carouselSelect",[this,i,this.items[o],o])}},select:function(e){"number"==typeof e&&(e=this.getItemWidgetByIndex(e)),this.selectable&&(this.selectedItem&&(this.selectedItem.set("selected",!1),n.remove(this.selectedItem.domNode,"mblCarouselSlotSelected")),e&&(e.set("selected",!0),n.add(e.domNode,"mblCarouselSlotSelected")),this.selectedItem=e)},onClick:function(){},instantiateView:function(e){if(e&&!e._instantiated){var t="none"===d.get(e.domNode,"display");t&&d.set(e.domNode,{visibility:"hidden",display:""}),f.instantiateLazyWidgets(e.containerNode,null,function(i){t&&d.set(e.domNode,{visibility:"visible",display:"none"})}),e._instantiated=!0}},handleViewChanged:function(e){e.getParent()===this&&(this.currentView.nextView(this.currentView.domNode)===e?this.instantiateView(e.nextView(e.domNode)):this.instantiateView(e.previousView(e.domNode)),this.currentView=e)},_setTitleAttr:function(e){this.titleNode.innerHTML=this._cv?this._cv(e):e,this._set("title",e)}});return _.ChildSwapViewProperties={lazy:!1},r.extend(g,_.ChildSwapViewProperties),a("dojo-bidi")?i("dojox.mobile.Carousel",[_,y]):_});//# sourceMappingURL=Carousel.js.map