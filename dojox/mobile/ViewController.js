//>>built
define("dojox/mobile/ViewController",["dojo/_base/kernel","dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/_base/Deferred","dojo/dom","dojo/dom-class","dojo/dom-construct","dojo/on","dojo/ready","dijit/registry","./ProgressIndicator","./TransitionEvent","./viewRegistry"],function(e,t,i,a,o,n,r,s,l,d,c,u,h,m,f,g){var p=a("dojox.mobile.ViewController",null,{dataHandlerClass:"dojox/mobile/dh/DataHandler",dataSourceClass:"dojox/mobile/dh/UrlDataSource",fileTypeMapClass:"dojox/mobile/dh/SuffixFileTypeMap",constructor:function(){this.viewMap={},u(o.hitch(this,function(){c(n.body(),"startTransition",o.hitch(this,"onStartTransition"))}))},findTransitionViews:function(e){if(!e)return[];e.match(/^#?([^&?]+)(.*)/);var t=RegExp.$2,i=h.byId(RegExp.$1);if(!i)return[];for(var a=i.getParent();a;a=a.getParent())if(a.isVisible&&!a.isVisible()){var o=i.getShowingView();o&&o.id!==i.id&&i.show(),i=a}return[i.getShowingView(),i,t]},openExternalView:function(e,t){var i=new r,a=this.viewMap[e.url];if(a)return e.moveTo=a,e.noTransition?h.byId(a).hide():new f(n.body(),e).dispatch(),i.resolve(!0),i;for(var s=null,l=t.childNodes.length-1;l>=0;l--){var d=t.childNodes[l];if(1===d.nodeType){if("bottom"===(d.getAttribute("fixed")||d.getAttribute("data-mobile-fixed")||h.byNode(d)&&h.byNode(d).fixed)){s=d;break}}}var c=e.dataHandlerClass||this.dataHandlerClass,u=e.dataSourceClass||this.dataSourceClass,m=e.fileTypeMapClass||this.fileTypeMapClass;return require([c,u,m],o.hitch(this,function(a,r,l){var d=new a(new r(e.data||e.url),t,s),c=e.contentType||l.getContentType(e.url)||"html";d.processData(c,o.hitch(this,function(t){t?(this.viewMap[e.url]=e.moveTo=t,e.noTransition?h.byId(t).hide():new f(n.body(),e).dispatch(),i.resolve(!0)):i.reject("Failed to load "+e.url)}))})),i},onStartTransition:function(e){if(e.preventDefault(),e.detail){var t=e.detail;if(t.moveTo||t.href||t.url||t.scene){if(t.url&&!t.moveTo){var a=t.urlTarget,o=h.byId(a),r=o&&o.containerNode||s.byId(a);r||(o=g.getEnclosingView(e.target),r=o&&o.domNode.parentNode||n.body());var l=h.getEnclosingWidget(e.target);return l&&l.callback&&(t.context=l,t.method=l.callback),void this.openExternalView(t,r)}if(t.href)if(t.hrefTarget&&"_self"!=t.hrefTarget)n.global.open(t.href,t.hrefTarget);else{for(var d,c=g.getEnclosingView(e.target);c;c=g.getParentView(c))d=c;d&&d.performTransition(null,t.transitionDir,t.transition,e.target,function(){location.href=t.href})}else{if(t.scene)return void i.publish("/dojox/mobile/app/pushScene",[t.scene]);var u=this.findTransitionViews(t.moveTo),m=u[0],f=u[1],p=u[2];location.hash||t.hashchange||(g.initialView=m),t.moveTo&&f&&(t.moveTo=("#"===t.moveTo.charAt(0)?"#"+f.id:f.id)+p),!m||t.moveTo&&m===h.byId(t.moveTo.replace(/^#?([^&?]+).*/,"$1"))||(l=h.getEnclosingWidget(e.target),l&&l.callback&&(t.context=l,t.method=l.callback),m.performTransition(t))}}}}});return p._instance=new p,p.getInstance=function(){return p._instance},p});//# sourceMappingURL=ViewController.js.map