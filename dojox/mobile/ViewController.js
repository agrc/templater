//>>built
define("dojox/mobile/ViewController",["dojo/_base/kernel","dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/_base/Deferred","dojo/dom","dojo/dom-class","dojo/dom-construct","dojo/on","dojo/ready","dijit/registry","./ProgressIndicator","./TransitionEvent","./viewRegistry"],function(e,t,i,a,o,r,n,s,l,d,h,u,c,m,f,p){var g=a("dojox.mobile.ViewController",null,{dataHandlerClass:"dojox/mobile/dh/DataHandler",dataSourceClass:"dojox/mobile/dh/UrlDataSource",fileTypeMapClass:"dojox/mobile/dh/SuffixFileTypeMap",constructor:function(){this.viewMap={},u(o.hitch(this,function(){h(r.body(),"startTransition",o.hitch(this,"onStartTransition"))}))},findTransitionViews:function(e){if(!e)return[];e.match(/^#?([^&?]+)(.*)/);var t=RegExp.$2,i=c.byId(RegExp.$1);if(!i)return[];for(var a=i.getParent();a;a=a.getParent())if(a.isVisible&&!a.isVisible()){var o=i.getShowingView();o&&o.id!==i.id&&i.show(),i=a}return[i.getShowingView(),i,t]},openExternalView:function(e,t){var i=new n,a=this.viewMap[e.url];if(a)return e.moveTo=a,e.noTransition?c.byId(a).hide():new f(r.body(),e).dispatch(),i.resolve(!0),i;for(var s=null,l=t.childNodes.length-1;l>=0;l--){var d=t.childNodes[l];if(1===d.nodeType){var h=d.getAttribute("fixed")||d.getAttribute("data-mobile-fixed")||c.byNode(d)&&c.byNode(d).fixed;if("bottom"===h){s=d;break}}}var u=e.dataHandlerClass||this.dataHandlerClass,m=e.dataSourceClass||this.dataSourceClass,p=e.fileTypeMapClass||this.fileTypeMapClass;return require([u,m,p],o.hitch(this,function(a,n,l){var d=new a(new n(e.data||e.url),t,s),h=e.contentType||l.getContentType(e.url)||"html";d.processData(h,o.hitch(this,function(t){t?(this.viewMap[e.url]=e.moveTo=t,e.noTransition?c.byId(t).hide():new f(r.body(),e).dispatch(),i.resolve(!0)):i.reject("Failed to load "+e.url)}))})),i},onStartTransition:function(e){if(e.preventDefault(),e.detail){var t=e.detail;if(t.moveTo||t.href||t.url||t.scene){if(t.url&&!t.moveTo){var a=t.urlTarget,o=c.byId(a),n=o&&o.containerNode||s.byId(a);n||(o=p.getEnclosingView(e.target),n=o&&o.domNode.parentNode||r.body());var l=c.getEnclosingWidget(e.target);return l&&l.callback&&(t.context=l,t.method=l.callback),void this.openExternalView(t,n)}if(t.href)if(t.hrefTarget&&"_self"!=t.hrefTarget)r.global.open(t.href,t.hrefTarget);else{for(var d,h=p.getEnclosingView(e.target);h;h=p.getParentView(h))d=h;d&&d.performTransition(null,t.transitionDir,t.transition,e.target,function(){location.href=t.href})}else{if(t.scene)return void i.publish("/dojox/mobile/app/pushScene",[t.scene]);var u=this.findTransitionViews(t.moveTo),m=u[0],f=u[1],g=u[2];location.hash||t.hashchange||(p.initialView=m),t.moveTo&&f&&(t.moveTo=("#"===t.moveTo.charAt(0)?"#"+f.id:f.id)+g),!m||t.moveTo&&m===c.byId(t.moveTo.replace(/^#?([^&?]+).*/,"$1"))||(l=c.getEnclosingWidget(e.target),l&&l.callback&&(t.context=l,t.method=l.callback),m.performTransition(t))}}}}});return g._instance=new g,g.getInstance=function(){return g._instance},g});//# sourceMappingURL=ViewController.js.map