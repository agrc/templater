//>>built
define("dojox/mobile/View",["dojo/_base/array","dojo/_base/config","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/sniff","dojo/_base/window","dojo/_base/Deferred","dojo/dom","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dijit/registry","dijit/_Contained","dijit/_Container","dijit/_WidgetBase","./ViewController","./common","./transition","./viewRegistry","./_css3"],function(e,t,i,a,o,r,n,s,l,d,h,c,u,m,f,g,p,y,v,b,x,w){o.getObject("dojox.mobile",!0);return a("dojox.mobile.View",[p,g,f],{selected:!1,keepScrollPos:!0,tag:"div",baseClass:"mblView",constructor:function(e,t){t&&(l.byId(t).style.visibility="hidden")},destroy:function(){x.remove(this.id),this.inherited(arguments)},buildRendering:function(){this.templateString||(this.domNode=this.containerNode=this.srcNodeRef||h.create(this.tag)),this._animEndHandle=this.connect(this.domNode,w.name("animationEnd"),"onAnimationEnd"),this._animStartHandle=this.connect(this.domNode,w.name("animationStart"),"onAnimationStart"),t.mblCSS3Transition||(this._transEndHandle=this.connect(this.domNode,w.name("transitionEnd"),"onAnimationEnd")),r("mblAndroid3Workaround")&&u.set(this.domNode,w.name("transformStyle"),"preserve-3d"),x.add(this),this.inherited(arguments)},startup:function(){if(!this._started){if(void 0===this._visible){var t,a,o,r=this.getSiblingViews(),n=location.hash&&location.hash.substring(1).split(/,/);e.forEach(r,function(i,r){-1!==e.indexOf(n,i.id)&&(t=i),0==r&&(o=i),i.selected&&(a=i),i._visible=!1},this),(t||a||o)._visible=!0}this._visible&&(this.show(!0,!0),this.defer(function(){this.onStartView(),i.publish("/dojox/mobile/startView",[this])})),"hidden"===this.domNode.style.visibility&&(this.domNode.style.visibility="inherit"),this.inherited(arguments);var s=this.getParent();s&&s.resize||this.resize(),this._visible||this.hide()}},resize:function(){e.forEach(this.getChildren(),function(e){e.resize&&e.resize()})},onStartView:function(){},onBeforeTransitionIn:function(e,t,i,a,o){},onAfterTransitionIn:function(e,t,i,a,o){},onBeforeTransitionOut:function(e,t,i,a,o){},onAfterTransitionOut:function(e,t,i,a,o){},_clearClasses:function(t){if(t){var i=[];e.forEach(o.trim(t.className||"").split(/\s+/),function(e){(e.match(/^mbl\w*View$/)||-1===e.indexOf("mbl"))&&i.push(e)},this),t.className=i.join(" ")}},_fixViewState:function(e){for(var t=this.domNode.parentNode.childNodes,i=0;i<t.length;i++){var a=t[i];1===a.nodeType&&d.contains(a,"mblView")&&this._clearClasses(a)}this._clearClasses(e);var o=m.byNode(e);o&&(o._inProgress=!1)},convertToId:function(e){return"string"==typeof e?e.replace(/^#?([^&?]+).*/,"$1"):e},_isBookmarkable:function(e){return e.moveTo&&(t.mblForceBookmarkable||"#"===e.moveTo.charAt(0))&&!e.hashchange},performTransition:function(e,a,s,h,c){if(!this._inProgress){this._inProgress=!0;var f,g;if(e&&"object"==typeof e)f=e,g=a;else{f={moveTo:e,transitionDir:a,transition:s,context:h,method:c},g=[];for(var p=5;p<arguments.length;p++)g.push(arguments[p])}if(this._detail=f,this._optArgs=g,this._arguments=[f.moveTo,f.transitionDir,f.transition,f.context,f.method],"#"!==f.moveTo){var y;f.moveTo?y=this.convertToId(f.moveTo):(this._dummyNode||(this._dummyNode=n.doc.createElement("div"),n.body().appendChild(this._dummyNode)),y=this._dummyNode),this.addTransitionInfo&&"string"==typeof f.moveTo&&this._isBookmarkable(f)&&this.addTransitionInfo(this.id,f.moveTo,{transitionDir:f.transitionDir,transition:f.transition});var b=this.domNode,x=b.offsetTop;if(y=this.toNode=l.byId(y)){y.style.visibility="hidden",y.style.display="",this._fixViewState(y);var k=m.byNode(y);if(k&&(!t.mblAlwaysResizeOnTransition&&k._resized||(v.resizeAll(null,k),k._resized=!0),f.transition&&"none"!=f.transition&&k._addTransitionPaddingTop(x),k.load&&k.load(),k.movedFrom=b.id),r("mblAndroidWorkaround")&&!t.mblCSS3Transition&&f.transition&&"none"!=f.transition&&(u.set(y,w.name("transformStyle"),"preserve-3d"),u.set(b,w.name("transformStyle"),"preserve-3d"),d.add(y,"mblAndroidWorkaround")),this.onBeforeTransitionOut.apply(this,this._arguments),i.publish("/dojox/mobile/beforeTransitionOut",[this].concat(o._toArray(this._arguments))),k){if(this.keepScrollPos&&!this.getParent()){var _=n.body().scrollTop||n.doc.documentElement.scrollTop||n.global.pageYOffset||0;b._scrollTop=_;var M=1==f.transitionDir?0:y._scrollTop||0;y.style.top="0px",(_>1||0!==M)&&(b.style.top=M-_+"px",r("ios")>=7||t.mblHideAddressBar===!1||this.defer(function(){n.global.scrollTo(0,M||1)}))}else y.style.top="0px";k.onBeforeTransitionIn.apply(k,this._arguments),i.publish("/dojox/mobile/beforeTransitionIn",[k].concat(o._toArray(this._arguments)))}y.style.display="none",y.style.visibility="inherit",v.fromView=this,v.toView=k,this._doTransition(b,y,f.transition,f.transitionDir)}}}},_addTransitionPaddingTop:function(e){this.containerNode.style.paddingTop=e+"px"},_removeTransitionPaddingTop:function(){this.containerNode.style.paddingTop=""},_toCls:function(e){return"mbl"+e.charAt(0).toUpperCase()+e.substring(1)},_doTransition:function(e,i,a,l){var h=-1==l?" mblReverse":"";if(i.style.display="",a&&"none"!=a)if(t.mblCSS3Transition)s.when(b,o.hitch(this,function(t){var r=u.get(i,"position");u.set(i,"position","absolute"),s.when(t(e,i,{transition:a,reverse:-1===l}),o.hitch(this,function(){u.set(i,"position",r),i.style.paddingTop="",this.invokeCallback()}))}));else{-1!=a.indexOf("cube")&&(r("ipad")?u.set(i.parentNode,{webkitPerspective:1600}):r("ios")&&u.set(i.parentNode,{webkitPerspective:800}));var m=this._toCls(a);if(r("mblAndroidWorkaround")){var f=this;f.defer(function(){d.add(e,m+" mblOut"+h),d.add(i,m+" mblIn"+h),d.remove(i,"mblAndroidWorkaround"),f.defer(function(){d.add(e,"mblTransition"),d.add(i,"mblTransition")},30)},70)}else d.add(e,m+" mblOut"+h),d.add(i,m+" mblIn"+h),this.defer(function(){d.add(e,"mblTransition"),d.add(i,"mblTransition")},100);var g,p,y,v="50% 50%",x="50% 50%";if(-1!=a.indexOf("swirl")||-1!=a.indexOf("zoom"))g=this.keepScrollPos&&!this.getParent()?n.body().scrollTop||n.doc.documentElement.scrollTop||n.global.pageYOffset||0:-c.position(e,!0).y,y=n.global.innerHeight/2+g,v="50% "+y+"px",x="50% "+y+"px";else if(-1!=a.indexOf("scale")){var k=c.position(e,!0);p=(void 0!==this.clickedPosX?this.clickedPosX:n.global.innerWidth/2)-k.x,g=this.keepScrollPos&&!this.getParent()?n.body().scrollTop||n.doc.documentElement.scrollTop||n.global.pageYOffset||0:-k.y,y=(void 0!==this.clickedPosY?this.clickedPosY:n.global.innerHeight/2)+g,v=p+"px "+y+"px",x=p+"px "+y+"px"}u.set(e,w.add({},{transformOrigin:v})),u.set(i,w.add({},{transformOrigin:x}))}else this.domNode.style.display="none",this.invokeCallback()},onAnimationStart:function(e){},onAnimationEnd:function(e){var t=e.animationName||e.target.className;if(-1!==t.indexOf("Out")||-1!==t.indexOf("In")||-1!==t.indexOf("Shrink")){var i=!1;if(d.contains(this.domNode,"mblOut")?(i=!0,this.domNode.style.display="none",d.remove(this.domNode,[this._toCls(this._detail.transition),"mblIn","mblOut","mblReverse"])):this._removeTransitionPaddingTop(),u.set(this.domNode,w.add({},{transformOrigin:""})),-1!==t.indexOf("Shrink")){var a=e.target;a.style.display="none",d.remove(a,"mblCloseContent");var o=x.getEnclosingScrollable(this.domNode);o&&o.onTouchEnd()}i&&this.invokeCallback(),this._clearClasses(this.domNode),this.clickedPosX=this.clickedPosY=void 0,-1!==t.indexOf("Cube")&&-1!==t.indexOf("In")&&r("ios")&&(this.domNode.parentNode.style[w.name("perspective")]="")}},invokeCallback:function(){this.onAfterTransitionOut.apply(this,this._arguments),i.publish("/dojox/mobile/afterTransitionOut",[this].concat(this._arguments));var e=m.byNode(this.toNode);e&&(e.onAfterTransitionIn.apply(e,this._arguments),i.publish("/dojox/mobile/afterTransitionIn",[e].concat(this._arguments)),e.movedFrom=void 0,this.setFragIds&&this._isBookmarkable(this._detail)&&this.setFragIds(e)),r("mblAndroidWorkaround")&&this.defer(function(){e&&u.set(this.toNode,w.name("transformStyle"),""),u.set(this.domNode,w.name("transformStyle"),"")});var t=this._detail.context,a=this._detail.method;(t||a)&&(a||(a=t,t=null),t=t||n.global,"string"==typeof a?t[a].apply(t,this._optArgs):"function"==typeof a&&a.apply(t,this._optArgs)),this._detail=this._optArgs=this._arguments=void 0,this._inProgress=!1},isVisible:function(e){var t=function(e){return"none"!==u.get(e,"display")};if(e){for(var i=this.domNode;"BODY"!==i.tagName;i=i.parentNode)if(!t(i))return!1;return!0}return t(this.domNode)},getShowingView:function(){for(var e=this.domNode.parentNode.childNodes,t=0;t<e.length;t++){var i=e[t];if(1===i.nodeType&&d.contains(i,"mblView")&&"none"!==i.style.display)return m.byNode(i)}return null},getSiblingViews:function(){return this.domNode.parentNode?e.map(e.filter(this.domNode.parentNode.childNodes,function(e){return 1===e.nodeType&&d.contains(e,"mblView")}),function(e){return m.byNode(e)}):[this]},show:function(t,a){var o=this.getShowingView();t||(o&&(o.onBeforeTransitionOut(o.id),i.publish("/dojox/mobile/beforeTransitionOut",[o,o.id])),this.onBeforeTransitionIn(this.id),i.publish("/dojox/mobile/beforeTransitionIn",[this,this.id])),a?this.domNode.style.display="":e.forEach(this.getSiblingViews(),function(e){e.domNode.style.display=e===this?"":"none"},this),this.load&&this.load(),t||(o&&(o.onAfterTransitionOut(o.id),i.publish("/dojox/mobile/afterTransitionOut",[o,o.id])),this.onAfterTransitionIn(this.id),i.publish("/dojox/mobile/afterTransitionIn",[this,this.id]))},hide:function(){this.domNode.style.display="none"}})});//# sourceMappingURL=View.js.map