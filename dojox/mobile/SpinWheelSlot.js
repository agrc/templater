//>>built
define("dojox/mobile/SpinWheelSlot",["dojo/_base/kernel","dojo/_base/array","dojo/_base/declare","dojo/_base/window","dojo/dom-class","dojo/dom-construct","dojo/has","dojo/has!dojo-bidi?dojox/mobile/bidi/SpinWheelSlot","dojo/touch","dojo/on","dijit/_Contained","dijit/_WidgetBase","./scrollable","./common"],function(e,t,i,a,o,r,n,s,l,d,u,h,c){var m=i(n("dojo-bidi")?"dojox.mobile.NonBidiSpinWheelSlot":"dojox.mobile.SpinWheelSlot",[h,u,c],{items:[],labels:[],labelFrom:0,labelTo:0,zeroPad:0,value:"",step:1,pageSteps:1,baseClass:"mblSpinWheelSlot",maxSpeed:500,minItems:15,centerPos:0,scrollBar:!1,constraint:!1,propagatable:!1,androidWorkaroud:!1,buildRendering:function(){this.inherited(arguments),this.initLabels();var e,t;if(this.labels.length>0)for(this.items=[],e=0;e<this.labels.length;e++)this.items.push([e,this.labels[e]]);this.containerNode=r.create("div",{className:"mblSpinWheelSlotContainer"}),this.containerNode.style.height=2*(a.global.innerHeight||a.doc.documentElement.clientHeight)+"px",this.panelNodes=[];for(var i=0;3>i;i++){this.panelNodes[i]=r.create("div",{className:"mblSpinWheelSlotPanel"}),this.panelNodes[i].setAttribute("aria-hidden","true");var s=this.items.length;if(s>0){var u=Math.ceil(this.minItems/s);for(t=0;u>t;t++)for(e=0;s>e;e++)r.create("div",{className:"mblSpinWheelSlotLabel",name:this.items[e][0],"data-mobile-val":this.items[e][1],innerHTML:this._cv?this._cv(this.items[e][1]):this.items[e][1]},this.panelNodes[i])}this.containerNode.appendChild(this.panelNodes[i])}if(this.domNode.appendChild(this.containerNode),this.touchNode=r.create("div",{className:"mblSpinWheelSlotTouch"},this.domNode),this.setSelectable(this.domNode,!1),this.touchNode.setAttribute("tabindex",0),this.touchNode.setAttribute("role","slider"),""===this.value&&this.items.length>0&&(this.value=this.items[0][1]),this._initialValue=this.value,n("windows-theme")){var h=this,c=this.containerNode,m=5;this.own(d(h.touchNode,l.press,function(e){for(var t=e.pageY,i=h.getParent().getChildren(),a=0,r=i.length;r>a;a++){var n=i[a].containerNode;c!==n?(o.remove(n,"mblSelectedSlot"),n.selected=!1):o.add(c,"mblSelectedSlot")}var s=d(h.touchNode,l.move,function(e){if(!(Math.abs(e.pageY-t)<m)){s.remove(),u.remove(),c.selected=!0;var i=h.getCenterItem();i&&o.remove(i,"mblSelectedSlotItem")}}),u=d(h.touchNode,l.release,function(){u.remove(),s.remove(),c.selected?o.remove(c,"mblSelectedSlot"):o.add(c,"mblSelectedSlot"),c.selected=!c.selected})})),this.on("flickAnimationEnd",function(){var e=h.getCenterItem();h.previousCenterItem&&o.remove(h.previousCenterItem,"mblSelectedSlotItem"),o.add(e,"mblSelectedSlotItem"),h.previousCenterItem=e})}},startup:function(){if(!this._started){if(this.inherited(arguments),this.noResize=!0,this.items.length>0){this.init(),this.centerPos=this.getParent().centerPos;var e=this.panelNodes[1].childNodes;this._itemHeight=e[0].offsetHeight,this.adjust(),this.connect(this.touchNode,"onkeydown","_onKeyDown")}n("windows-theme")&&(this.previousCenterItem=this.getCenterItem(),this.previousCenterItem&&o.add(this.previousCenterItem,"mblSelectedSlotItem"))}},initLabels:function(){if(this.labelFrom!==this.labelTo)for(var e=this.labels=[],t=this.zeroPad&&Array(this.zeroPad).join("0"),i=this.labelFrom;i<=this.labelTo;i+=this.step)e.push(this.zeroPad?(t+i).slice(-this.zeroPad):i+"")},onTouchStart:function(e){this.touchNode.focus(),this.inherited(arguments)},adjust:function(){for(var e,t=this.panelNodes[1].childNodes,i=0,a=t.length;a>i;i++){var o=t[i];if(o.offsetTop<=this.centerPos&&this.centerPos<o.offsetTop+o.offsetHeight){e=this.centerPos-(o.offsetTop+Math.round(o.offsetHeight/2));break}}var r=this.panelNodes[0].offsetHeight;this.panelNodes[0].style.top=-r+e+"px",this.panelNodes[1].style.top=e+"px",this.panelNodes[2].style.top=r+e+"px"},setInitialValue:function(){this.set("value",this._initialValue),this.touchNode.setAttribute("aria-valuetext",this._initialValue)},_onKeyDown:function(e){if(!e||"keydown"!==e.type||e.altKey||e.ctrlKey||e.shiftKey)return!0;switch(e.keyCode){case 38:case 39:return this.spin(1),e.stopPropagation(),!1;case 40:case 37:return this.spin(-1),e.stopPropagation(),!1;case 33:return this.spin(this.pageSteps),e.stopPropagation(),!1;case 34:return this.spin(-1*this.pageSteps),e.stopPropagation(),!1}return!0},_getCenterPanel:function(){for(var e=this.getPos(),t=0,i=this.panelNodes.length;i>t;t++){var a=e.y+this.panelNodes[t].offsetTop;if(a<=this.centerPos&&this.centerPos<a+this.panelNodes[t].offsetHeight)return this.panelNodes[t]}return null},setColor:function(e,i){t.forEach(this.panelNodes,function(a){t.forEach(a.childNodes,function(t,a){o.toggle(t,i||"mblSpinWheelSlotLabelBlue",t.innerHTML===e)},this)},this)},disableValues:function(e){t.forEach(this.panelNodes,function(t){for(var i=0;i<t.childNodes.length;i++)o.toggle(t.childNodes[i],"mblSpinWheelSlotLabelGray",i>=e)})},getCenterItem:function(){var e=this.getPos(),t=this._getCenterPanel();if(t)for(var i=e.y+t.offsetTop,a=t.childNodes,o=0,r=a.length;r>o;o++)if(i+a[o].offsetTop<=this.centerPos&&this.centerPos<i+a[o].offsetTop+a[o].offsetHeight)return a[o];return null},_getKeyAttr:function(){if(!this._started){if(this.items)for(var e=(this.value,0);e<this.items.length;e++)if(this.items[e][1]==this.value)return this.items[e][0];return null}var t=this.getCenterItem();return t&&t.getAttribute("name")},_getValueAttr:function(){if(!this._started)return this.value;if(this.items.length>0){var e=this.getCenterItem();return e&&e.getAttribute("data-mobile-val")}return this._initialValue},_setValueAttr:function(e){this.items.length>0&&this._spinToValue(e,!0)},_spinToValue:function(e,t){var i,a,o=this.get("value");if(!o)return void(this._pendingValue=e);if(o!=e){this._pendingValue=void 0,t&&this._set("value",e);for(var r=this.items.length,n=0;r>n&&(this.items[n][1]===String(o)&&(i=n),this.items[n][1]===String(e)&&(a=n),void 0===i||void 0===a);n++);var s,l=a-(i||0);s=l>0?r-l>l?-l:r-l:r+l>-l?-l:-(r+l),this.spin(s)}},onFlickAnimationStart:function(e){this._onFlickAnimationStartCalled=!0,this.inherited(arguments)},onFlickAnimationEnd:function(e){this._duringSlideTo=!1,this._onFlickAnimationStartCalled=!1,this.inherited(arguments),this.touchNode.setAttribute("aria-valuetext",this.get("value"))},spin:function(e){if(this._started&&!this._duringSlideTo){var t=this.getPos();t.y+=e*this._itemHeight,this.slideTo(t,1)}},getSpeed:function(){var e=0,t=this._time.length,i=(new Date).getTime()-this.startTime-this._time[t-1];if(t>=2&&200>i){var a=this._posY[t-1]-this._posY[t-6>=0?t-6:0],o=this._time[t-1]-this._time[t-6>=0?t-6:0];e=this.calcSpeed(a,o)}return{x:0,y:e}},calcSpeed:function(e,t){var i=this.inherited(arguments);if(!i)return 0;var a=Math.abs(i),o=i;return a>this.maxSpeed&&(o=this.maxSpeed*(i/a)),o},adjustDestination:function(e,t,i){var a=this._itemHeight,o=e.y+Math.round(a/2),r=o>=0?o%a:o%a+a;return e.y=o-r,!0},resize:function(e){if(this.panelNodes&&this.panelNodes.length>0){var t=this.panelNodes[1].childNodes;if(t.length>0&&!n("windows-theme")){var i=this.getParent();i&&(this._itemHeight=t[0].offsetHeight,this.centerPos=i.centerPos,this.panelNodes[0].style.top||this.adjust())}}this._pendingValue&&this.set("value",this._pendingValue)},slideTo:function(e,t,i){this._duringSlideTo=!0;var a,o=this.getPos(),r=o.y+this.panelNodes[1].offsetTop,n=r+this.panelNodes[1].offsetHeight,s=this.domNode.parentNode.offsetHeight;o.y<e.y?n>s&&(a=this.panelNodes[2],a.style.top=this.panelNodes[0].offsetTop-this.panelNodes[0].offsetHeight+"px",this.panelNodes[2]=this.panelNodes[1],this.panelNodes[1]=this.panelNodes[0],this.panelNodes[0]=a):o.y>e.y&&0>r&&(a=this.panelNodes[0],a.style.top=this.panelNodes[2].offsetTop+this.panelNodes[2].offsetHeight+"px",this.panelNodes[0]=this.panelNodes[1],this.panelNodes[1]=this.panelNodes[2],this.panelNodes[2]=a),this.getParent()._duringStartup?t=0:Math.abs(this._speed.y)<40&&(t=.2),t&&t>0?(this.inherited(arguments,[e,t,i]),this._onFlickAnimationStartCalled||(this._duringSlideTo=!1)):(this.onFlickAnimationStart(),this.scrollTo(e,!0),this.onFlickAnimationEnd())}});return n("dojo-bidi")?i("dojox.mobile.SpinWheelSlot",[m,s]):m});//# sourceMappingURL=SpinWheelSlot.js.map