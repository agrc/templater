//>>built
define("dijit/tree/TreeStoreModel",["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang"],function(t,e,i,n){return i("dijit.tree.TreeStoreModel",null,{store:null,childrenAttrs:["children"],newItemIdAttr:"id",labelAttr:"",root:null,query:null,deferItemLoadingUntilExpand:!1,constructor:function(t){n.mixin(this,t),this.connects=[];var i=this.store;if(!i.getFeatures()["dojo.data.api.Identity"])throw new Error("dijit.tree.TreeStoreModel: store must support dojo.data.Identity");i.getFeatures()["dojo.data.api.Notification"]&&(this.connects=this.connects.concat([e.after(i,"onNew",n.hitch(this,"onNewItem"),!0),e.after(i,"onDelete",n.hitch(this,"onDeleteItem"),!0),e.after(i,"onSet",n.hitch(this,"onSetItem"),!0)]))},destroy:function(){for(var t;t=this.connects.pop();)t.remove()},getRoot:function(t,e){this.root?t(this.root):this.store.fetch({query:this.query,onComplete:n.hitch(this,function(e){if(1!=e.length)throw new Error("dijit.tree.TreeStoreModel: root query returned "+e.length+" items, but must return exactly one");this.root=e[0],t(this.root)}),onError:e})},mayHaveChildren:function(e){return t.some(this.childrenAttrs,function(t){return this.store.hasAttribute(e,t)},this)},getChildren:function(e,i,o){var s=this.store;if(!s.isItemLoaded(e)){var a=n.hitch(this,arguments.callee);return void s.loadItem({item:e,onItem:function(t){a(t,i,o)},onError:o})}for(var r=[],d=0;d<this.childrenAttrs.length;d++){var l=s.getValues(e,this.childrenAttrs[d]);r=r.concat(l)}var h=0;this.deferItemLoadingUntilExpand||t.forEach(r,function(t){s.isItemLoaded(t)||h++}),0==h?i(r):t.forEach(r,function(t,e){s.isItemLoaded(t)||s.loadItem({item:t,onItem:function(t){r[e]=t,0==--h&&i(r)},onError:o})})},isItem:function(t){return this.store.isItem(t)},fetchItemByIdentity:function(t){this.store.fetchItemByIdentity(t)},getIdentity:function(t){return this.store.getIdentity(t)},getLabel:function(t){return this.labelAttr?this.store.getValue(t,this.labelAttr):this.store.getLabel(t)},newItem:function(t,e,i){var n,o={parent:e,attribute:this.childrenAttrs[0]};this.newItemIdAttr&&t[this.newItemIdAttr]?this.fetchItemByIdentity({identity:t[this.newItemIdAttr],scope:this,onItem:function(s){s?this.pasteItem(s,null,e,!0,i):(n=this.store.newItem(t,o),n&&void 0!=i&&this.pasteItem(n,e,e,!1,i))}}):(n=this.store.newItem(t,o),n&&void 0!=i&&this.pasteItem(n,e,e,!1,i))},pasteItem:function(e,i,n,o,s){var a=this.store,r=this.childrenAttrs[0];if(i&&t.forEach(this.childrenAttrs,function(n){if(a.containsValue(i,n,e)){if(!o){var s=t.filter(a.getValues(i,n),function(t){return t!=e});a.setValues(i,n,s)}r=n}}),n)if("number"==typeof s){var d=a.getValues(n,r).slice();d.splice(s,0,e),a.setValues(n,r,d)}else a.setValues(n,r,a.getValues(n,r).concat(e))},onChange:function(){},onChildrenChange:function(){},onDelete:function(){},onNewItem:function(t,e){e&&this.getChildren(e.item,n.hitch(this,function(t){this.onChildrenChange(e.item,t)}))},onDeleteItem:function(t){this.onDelete(t)},onSetItem:function(e,i){-1!=t.indexOf(this.childrenAttrs,i)?this.getChildren(e,n.hitch(this,function(t){this.onChildrenChange(e,t)})):this.onChange(e)}})});//# sourceMappingURL=TreeStoreModel.js.map