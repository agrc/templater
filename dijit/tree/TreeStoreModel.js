//>>built
define("dijit/tree/TreeStoreModel",["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang"],function(e,t,i,n){return i("dijit.tree.TreeStoreModel",null,{store:null,childrenAttrs:["children"],newItemIdAttr:"id",labelAttr:"",root:null,query:null,deferItemLoadingUntilExpand:!1,constructor:function(e){n.mixin(this,e),this.connects=[];var i=this.store;if(!i.getFeatures()["dojo.data.api.Identity"])throw new Error("dijit.tree.TreeStoreModel: store must support dojo.data.Identity");i.getFeatures()["dojo.data.api.Notification"]&&(this.connects=this.connects.concat([t.after(i,"onNew",n.hitch(this,"onNewItem"),!0),t.after(i,"onDelete",n.hitch(this,"onDeleteItem"),!0),t.after(i,"onSet",n.hitch(this,"onSetItem"),!0)]))},destroy:function(){for(var e;e=this.connects.pop();)e.remove()},getRoot:function(e,t){this.root?e(this.root):this.store.fetch({query:this.query,onComplete:n.hitch(this,function(t){if(1!=t.length)throw new Error("dijit.tree.TreeStoreModel: root query returned "+t.length+" items, but must return exactly one");this.root=t[0],e(this.root)}),onError:t})},mayHaveChildren:function(t){return e.some(this.childrenAttrs,function(e){return this.store.hasAttribute(t,e)},this)},getChildren:function(t,i,o){var s=this.store;if(!s.isItemLoaded(t)){var r=n.hitch(this,arguments.callee);return void s.loadItem({item:t,onItem:function(e){r(e,i,o)},onError:o})}for(var a=[],d=0;d<this.childrenAttrs.length;d++){var l=s.getValues(t,this.childrenAttrs[d]);a=a.concat(l)}var c=0;this.deferItemLoadingUntilExpand||e.forEach(a,function(e){s.isItemLoaded(e)||c++}),0==c?i(a):e.forEach(a,function(e,t){s.isItemLoaded(e)||s.loadItem({item:e,onItem:function(e){a[t]=e,0==--c&&i(a)},onError:o})})},isItem:function(e){return this.store.isItem(e)},fetchItemByIdentity:function(e){this.store.fetchItemByIdentity(e)},getIdentity:function(e){return this.store.getIdentity(e)},getLabel:function(e){return this.labelAttr?this.store.getValue(e,this.labelAttr):this.store.getLabel(e)},newItem:function(e,t,i){var n,o={parent:t,attribute:this.childrenAttrs[0]};this.newItemIdAttr&&e[this.newItemIdAttr]?this.fetchItemByIdentity({identity:e[this.newItemIdAttr],scope:this,onItem:function(s){s?this.pasteItem(s,null,t,!0,i):(n=this.store.newItem(e,o),n&&void 0!=i&&this.pasteItem(n,t,t,!1,i))}}):(n=this.store.newItem(e,o),n&&void 0!=i&&this.pasteItem(n,t,t,!1,i))},pasteItem:function(t,i,n,o,s){var r=this.store,a=this.childrenAttrs[0];if(i&&e.forEach(this.childrenAttrs,function(n){if(r.containsValue(i,n,t)){if(!o){var s=e.filter(r.getValues(i,n),function(e){return e!=t});r.setValues(i,n,s)}a=n}}),n)if("number"==typeof s){var d=r.getValues(n,a).slice();d.splice(s,0,t),r.setValues(n,a,d)}else r.setValues(n,a,r.getValues(n,a).concat(t))},onChange:function(){},onChildrenChange:function(){},onDelete:function(){},onNewItem:function(e,t){t&&this.getChildren(t.item,n.hitch(this,function(e){this.onChildrenChange(t.item,e)}))},onDeleteItem:function(e){this.onDelete(e)},onSetItem:function(t,i){-1!=e.indexOf(this.childrenAttrs,i)?this.getChildren(t,n.hitch(this,function(e){this.onChildrenChange(t,e)})):this.onChange(t)}})});//# sourceMappingURL=TreeStoreModel.js.map