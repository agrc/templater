//>>built
define("dijit/tree/_dndSelector",["dojo/_base/array","dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","dojo/dnd/common","dojo/dom","dojo/mouse","dojo/on","dojo/touch","../a11yclick","./_dndContainer"],function(e,t,i,o,n,s,r,a,d,l,c){return t("dijit.tree._dndSelector",c,{constructor:function(){this.selection={},this.anchor=null,this.events.push(a(this.tree.domNode,d.press,o.hitch(this,"onMouseDown")),a(this.tree.domNode,d.release,o.hitch(this,"onMouseUp")),a(this.tree.domNode,d.move,o.hitch(this,"onMouseMove")),a(this.tree.domNode,l.press,o.hitch(this,"onClickPress")),a(this.tree.domNode,l.release,o.hitch(this,"onClickRelease")))},singular:!1,getSelectedTreeNodes:function(){var e=[],t=this.selection;for(var i in t)e.push(t[i]);return e},selectNone:function(){return this.setSelection([]),this},destroy:function(){this.inherited(arguments),this.selection=this.anchor=null},addTreeNode:function(e,t){return this.setSelection(this.getSelectedTreeNodes().concat([e])),t&&(this.anchor=e),e},removeTreeNode:function(t){var i=e.filter(this.getSelectedTreeNodes(),function(e){return!s.isDescendant(e.domNode,t.domNode)});return this.setSelection(i),t},isTreeNodeSelected:function(e){return e.id&&!!this.selection[e.id]},setSelection:function(t){var i=this.getSelectedTreeNodes();e.forEach(this._setDifference(i,t),o.hitch(this,function(e){e.setSelected(!1),this.anchor==e&&delete this.anchor,delete this.selection[e.id]})),e.forEach(this._setDifference(t,i),o.hitch(this,function(e){e.setSelected(!0),this.selection[e.id]=e})),this._updateSelectionProperties()},_setDifference:function(t,i){e.forEach(i,function(e){e.__exclude__=!0});var o=e.filter(t,function(e){return!e.__exclude__});return e.forEach(i,function(e){delete e.__exclude__}),o},_updateSelectionProperties:function(){var t=this.getSelectedTreeNodes(),i=[],o=[];e.forEach(t,function(e){var t=e.getTreePath();o.push(e),i.push(t)},this);var n=e.map(o,function(e){return e.item});this.tree._set("paths",i),this.tree._set("path",i[0]||[]),this.tree._set("selectedNodes",o),this.tree._set("selectedNode",o[0]||null),this.tree._set("selectedItems",n),this.tree._set("selectedItem",n[0]||null)},onClickPress:function(e){if(!(this.current&&this.current.isExpandable&&this.tree.isExpandoNode(e.target,this.current))){"mousedown"==e.type&&r.isLeft(e)&&e.preventDefault();var t="keydown"==e.type?this.tree.focusedChild:this.current;if(t){var i=n.getCopyKeyState(e),o=t.id;if(!this.singular&&!e.shiftKey&&this.selection[o])return void(this._doDeselect=!0);this._doDeselect=!1,this.userSelect(t,i,e.shiftKey)}}},onClickRelease:function(e){this._doDeselect&&(this._doDeselect=!1,this.userSelect("keyup"==e.type?this.tree.focusedChild:this.current,n.getCopyKeyState(e),e.shiftKey))},onMouseMove:function(){this._doDeselect=!1},onMouseDown:function(){},onMouseUp:function(){},_compareNodes:function(e,t){if(e===t)return 0;if("sourceIndex"in document.documentElement)return e.sourceIndex-t.sourceIndex;if("compareDocumentPosition"in document.documentElement)return 2&e.compareDocumentPosition(t)?1:-1;if(document.createRange){var i=doc.createRange();i.setStartBefore(e);var o=doc.createRange();return o.setStartBefore(t),i.compareBoundaryPoints(i.END_TO_END,o)}throw Error("dijit.tree._compareNodes don't know how to compare two different nodes in this browser")},userSelect:function(e,t,i){if(this.singular)this.anchor==e&&t?this.selectNone():(this.setSelection([e]),this.anchor=e);else if(i&&this.anchor){var o,n,s=this._compareNodes(this.anchor.rowNode,e.rowNode),r=this.anchor;0>s?(o=r,n=e):(o=e,n=r);for(var a=[];o!=n;)a.push(o),o=this.tree._getNext(o);a.push(n),this.setSelection(a)}else this.selection[e.id]&&t?this.removeTreeNode(e):t?this.addTreeNode(e,!0):(this.setSelection([e]),this.anchor=e)},getItem:function(e){var t=this.selection[e];return{data:t,type:["treeNode"]}},forInSelectedItems:function(e,t){t=t||i.global;for(var o in this.selection)e.call(t,this.getItem(o),o,this)}})});//# sourceMappingURL=_dndSelector.js.map