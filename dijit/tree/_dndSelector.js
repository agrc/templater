//>>built
define("dijit/tree/_dndSelector",["dojo/_base/array","dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","dojo/dnd/common","dojo/dom","dojo/mouse","dojo/on","dojo/touch","../a11yclick","./_dndContainer"],function(t,e,i,o,n,a,s,r,d,l,u){return e("dijit.tree._dndSelector",u,{constructor:function(){this.selection={},this.anchor=null,this.events.push(r(this.tree.domNode,d.press,o.hitch(this,"onMouseDown")),r(this.tree.domNode,d.release,o.hitch(this,"onMouseUp")),r(this.tree.domNode,d.move,o.hitch(this,"onMouseMove")),r(this.tree.domNode,l.press,o.hitch(this,"onClickPress")),r(this.tree.domNode,l.release,o.hitch(this,"onClickRelease")))},singular:!1,getSelectedTreeNodes:function(){var t=[],e=this.selection;for(var i in e)t.push(e[i]);return t},selectNone:function(){return this.setSelection([]),this},destroy:function(){this.inherited(arguments),this.selection=this.anchor=null},addTreeNode:function(t,e){return this.setSelection(this.getSelectedTreeNodes().concat([t])),e&&(this.anchor=t),t},removeTreeNode:function(e){var i=t.filter(this.getSelectedTreeNodes(),function(t){return!a.isDescendant(t.domNode,e.domNode)});return this.setSelection(i),e},isTreeNodeSelected:function(t){return t.id&&!!this.selection[t.id]},setSelection:function(e){var i=this.getSelectedTreeNodes();t.forEach(this._setDifference(i,e),o.hitch(this,function(t){t.setSelected(!1),this.anchor==t&&delete this.anchor,delete this.selection[t.id]})),t.forEach(this._setDifference(e,i),o.hitch(this,function(t){t.setSelected(!0),this.selection[t.id]=t})),this._updateSelectionProperties()},_setDifference:function(e,i){t.forEach(i,function(t){t.__exclude__=!0});var o=t.filter(e,function(t){return!t.__exclude__});return t.forEach(i,function(t){delete t.__exclude__}),o},_updateSelectionProperties:function(){var e=this.getSelectedTreeNodes(),i=[],o=[];t.forEach(e,function(t){var e=t.getTreePath();o.push(t),i.push(e)},this);var n=t.map(o,function(t){return t.item});this.tree._set("paths",i),this.tree._set("path",i[0]||[]),this.tree._set("selectedNodes",o),this.tree._set("selectedNode",o[0]||null),this.tree._set("selectedItems",n),this.tree._set("selectedItem",n[0]||null)},onClickPress:function(t){if(!(this.current&&this.current.isExpandable&&this.tree.isExpandoNode(t.target,this.current))){"mousedown"==t.type&&s.isLeft(t)&&t.preventDefault();var e="keydown"==t.type?this.tree.focusedChild:this.current;if(e){var i=n.getCopyKeyState(t),o=e.id;if(!this.singular&&!t.shiftKey&&this.selection[o])return void(this._doDeselect=!0);this._doDeselect=!1,this.userSelect(e,i,t.shiftKey)}}},onClickRelease:function(t){this._doDeselect&&(this._doDeselect=!1,this.userSelect("keyup"==t.type?this.tree.focusedChild:this.current,n.getCopyKeyState(t),t.shiftKey))},onMouseMove:function(){this._doDeselect=!1},onMouseDown:function(){},onMouseUp:function(){},_compareNodes:function(t,e){if(t===e)return 0;if("sourceIndex"in document.documentElement)return t.sourceIndex-e.sourceIndex;if("compareDocumentPosition"in document.documentElement)return 2&t.compareDocumentPosition(e)?1:-1;if(document.createRange){var i=doc.createRange();i.setStartBefore(t);var o=doc.createRange();return o.setStartBefore(e),i.compareBoundaryPoints(i.END_TO_END,o)}throw Error("dijit.tree._compareNodes don't know how to compare two different nodes in this browser")},userSelect:function(t,e,i){if(this.singular)this.anchor==t&&e?this.selectNone():(this.setSelection([t]),this.anchor=t);else if(i&&this.anchor){var o,n,a=this._compareNodes(this.anchor.rowNode,t.rowNode),s=this.anchor;0>a?(o=s,n=t):(o=t,n=s);for(var r=[];o!=n;)r.push(o),o=this.tree._getNext(o);r.push(n),this.setSelection(r)}else this.selection[t.id]&&e?this.removeTreeNode(t):e?this.addTreeNode(t,!0):(this.setSelection([t]),this.anchor=t)},getItem:function(t){var e=this.selection[t];return{data:e,type:["treeNode"]}},forInSelectedItems:function(t,e){e=e||i.global;for(var o in this.selection)t.call(e,this.getItem(o),o,this)}})});//# sourceMappingURL=_dndSelector.js.map