//>>built
define("dijit/form/_FormSelectWidget",["dojo/_base/array","dojo/_base/Deferred","dojo/aspect","dojo/data/util/sorter","dojo/_base/declare","dojo/dom","dojo/dom-class","dojo/_base/kernel","dojo/_base/lang","dojo/query","dojo/when","dojo/store/util/QueryResults","./_FormValueWidget"],function(e,t,i,o,n,r,a,s,l,d,h,u,c){var p=n("dijit.form._FormSelectWidget",c,{multiple:!1,options:null,store:null,_setStoreAttr:function(e){this._created&&this._deprecatedSetStore(e)},query:null,_setQueryAttr:function(e){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:e})},queryOptions:null,_setQueryOptionsAttr:function(e){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:e})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,onLoadDeferred:null,getOptions:function(t){var i=this.options||[];return null==t?i:l.isArrayLike(t)?e.map(t,"return this.getOptions(item);",this):(l.isString(t)&&(t={value:t}),l.isObject(t)&&(e.some(i,function(e,i){for(var o in t)if(!(o in e)||e[o]!=t[o])return!1;return t=i,!0})||(t=-1)),t>=0&&t<i.length?i[t]:null)},addOption:function(t){e.forEach(l.isArrayLike(t)?t:[t],function(e){e&&l.isObject(e)&&this.options.push(e)},this),this._loadChildren()},removeOption:function(t){var i=this.getOptions(l.isArrayLike(t)?t:[t]);e.forEach(i,function(t){t&&(this.options=e.filter(this.options,function(e){return e.value!==t.value||e.label!==t.label}),this._removeOptionItem(t))},this),this._loadChildren()},updateOption:function(t){e.forEach(l.isArrayLike(t)?t:[t],function(e){var t,i=this.getOptions({value:e.value});if(i)for(t in e)i[t]=e[t]},this),this._loadChildren()},setStore:function(e,t,i){s.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.","","2.0"),this._deprecatedSetStore(e,t,i)},_deprecatedSetStore:function(n,r,a){var s=this.store;if(a=a||{},s!==n){for(var d;d=this._notifyConnections.pop();)d.remove();n.get||(l.mixin(n,{_oldAPI:!0,get:function(e){var i=new t;return this.fetchItemByIdentity({identity:e,onItem:function(e){i.resolve(e)},onError:function(e){i.reject(e)}}),i.promise},query:function(e,i){var o=new t(function(){n.abort&&n.abort()});o.total=new t;var n=this.fetch(l.mixin({query:e,onBegin:function(e){o.total.resolve(e)},onComplete:function(e){o.resolve(e)},onError:function(e){o.reject(e)}},i));return new u(o)}}),n.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[i.after(n,"onNew",l.hitch(this,"_onNewItem"),!0),i.after(n,"onDelete",l.hitch(this,"_onDeleteItem"),!0),i.after(n,"onSet",l.hitch(this,"_onSetItem"),!0)])),this._set("store",n)}return this.options&&this.options.length&&this.removeOption(this.options),this._queryRes&&this._queryRes.close&&this._queryRes.close(),this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null),a.query&&this._set("query",a.query),a.queryOptions&&this._set("queryOptions",a.queryOptions),n&&n.query&&(this._loadingStore=!0,this.onLoadDeferred=new t,this._queryRes=n.query(this.query,this.queryOptions),h(this._queryRes,l.hitch(this,function(t){if(this.sortByLabel&&!a.sort&&t.length)if(n.getValue)t.sort(o.createSortFunction([{attribute:n.getLabelAttributes(t[0])[0]}],n));else{var i=this.labelAttr;t.sort(function(e,t){return e[i]>t[i]?1:t[i]>e[i]?-1:0})}a.onFetch&&(t=a.onFetch.call(this,t,a)),e.forEach(t,function(e){this._addOptionForItem(e)},this),this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(l.hitch(this,function(e,t,i){t==i?this._onSetItem(e):(-1!=t&&this._onDeleteItem(e),-1!=i&&this._onNewItem(e))}),!0)),this._loadingStore=!1,this.set("value","_pendingValue"in this?this._pendingValue:r),delete this._pendingValue,this.loadChildrenOnOpen?this._pseudoLoadChildren(t):this._loadChildren(),this.onLoadDeferred.resolve(!0),this.onSetStore()}),function(e){this.onLoadDeferred.reject(e)})),s},_setValueAttr:function(t,i){if(this._onChangeActive||(i=null),this._loadingStore)return void(this._pendingValue=t);if(null!=t){t=l.isArrayLike(t)?e.map(t,function(e){return l.isObject(e)?e:{value:e}}):l.isObject(t)?[t]:[{value:t}],t=e.filter(this.getOptions(t),function(e){return e&&e.value});var o=this.getOptions()||[];this.multiple||t[0]&&t[0].value||!o.length||(t[0]=o[0]),e.forEach(o,function(i){i.selected=e.some(t,function(e){return e.value===i.value})});var n=e.map(t,function(e){return e.value});if("undefined"!=typeof n&&"undefined"!=typeof n[0]){var r=e.map(t,function(e){return e.label});this._setDisplay(this.multiple?r:r[0]),this.inherited(arguments,[this.multiple?n:n[0],i]),this._updateSelection()}}},_getDisplayedValueAttr:function(){var t=e.map([].concat(this.get("selectedOptions")),function(e){return e&&"label"in e?e.label:e?e.value:null},this);return this.multiple?t:t[0]},_setDisplayedValueAttr:function(e){this.set("value",this.getOptions("string"==typeof e?{label:e}:e))},_loadChildren:function(){this._loadingStore||(e.forEach(this._getChildren(),function(e){e.destroyRecursive()}),e.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null,this._set("value",this._getValueFromOpts());var t=[].concat(this.value);if(t&&t[0]){var i=this;e.forEach(this._getChildren(),function(o){var n=e.some(t,function(e){return o.option&&e===o.option.value});n&&!i.multiple&&(i.focusedChild=o),a.toggle(o.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),n),o.domNode.setAttribute("aria-selected",n?"true":"false")},this)}},_getValueFromOpts:function(){var t=this.getOptions()||[];if(!this.multiple&&t.length){var i=e.filter(t,function(e){return e.selected})[0];return i&&i.value?i.value:(t[0].selected=!0,t[0].value)}return this.multiple?e.map(e.filter(t,function(e){return e.selected}),function(e){return e.value})||[]:""},_onNewItem:function(e,t){t&&t.parent||this._addOptionForItem(e)},_onDeleteItem:function(e){var t=this.store;this.removeOption({value:t.getIdentity(e)})},_onSetItem:function(e){this.updateOption(this._getOptionObjForItem(e))},_getOptionObjForItem:function(e){var t=this.store,i=this.labelAttr&&this.labelAttr in e?e[this.labelAttr]:t.getLabel(e),o=i?t.getIdentity(e):null;return{value:o,label:i,item:e}},_addOptionForItem:function(e){var t=this.store;if(t.isItemLoaded&&!t.isItemLoaded(e))return void t.loadItem({item:e,onItem:function(e){this._addOptionForItem(e)},scope:this});var i=this._getOptionObjForItem(e);this.addOption(i)},constructor:function(e){this._oValue=(e||{}).value||null,this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments),r.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?d("> *",this.srcNodeRef).map(function(e){return"separator"===e.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:e.getAttribute("data-"+s._scopeName+"-value")||e.getAttribute("value"),label:String(e.innerHTML),selected:e.getAttribute("selected")||!1,disabled:e.getAttribute("disabled")||!1}},this):[]),this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments),i.after(this,"onChange",l.hitch(this,"_updateSelection"));var e=this.store;e&&(e.getIdentity||e.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(e,this._oValue,{query:this.query,queryOptions:this.queryOptions})),this._storeInitialized=!0},startup:function(){this._loadChildren(),this.inherited(arguments)},destroy:function(){for(var e;e=this._notifyConnections.pop();)e.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close(),this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null),this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}});return p});//# sourceMappingURL=_FormSelectWidget.js.map