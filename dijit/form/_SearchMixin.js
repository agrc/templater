//>>built
define("dijit/form/_SearchMixin",["dojo/_base/declare","dojo/keys","dojo/_base/lang","dojo/query","dojo/string","dojo/when","../registry"],function(e,t,i,n,o,s,r){return e("dijit.form._SearchMixin",null,{pageSize:1/0,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(e){this._set("list",e)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(e){return new RegExp("^"+e.replace(/(\\.)|(\*)|(\?)|\W/g,function(e,t,i,n){return i?".*":n?".":t?t:"\\"+e})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove()),this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove()),this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(e){if(!this.disabled&&!this.readOnly){var i=e.charOrCode,n=!1;switch(this._prev_key_backspace=!1,i){case t.DELETE:case t.BACKSPACE:this._prev_key_backspace=!0,this._maskValidSubsetError=!0,n=!0;break;default:n="string"==typeof i||229==i}n&&(this.store?this.searchTimer=this.defer("_startSearchFromInput",1):this.onSearch())}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(e){this._abortQuery();var t,n=this,r=i.clone(this.query),a={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},d=o.substitute(this.queryExpr,[e.replace(/([\\\*\?])/g,"\\$1")]),l=function(){var e=n._fetchHandle=n.store.query(r,a);n.disabled||n.readOnly||t!==n._lastQuery||s(e,function(i){n._fetchHandle=null,n.disabled||n.readOnly||t!==n._lastQuery||s(e.total,function(e){i.total=e;var t=n.pageSize;(isNaN(t)||t>i.total)&&(t=i.total),i.nextPage=function(e){a.direction=e=e!==!1,a.count=t,e?(a.start+=i.length,a.start>=i.total&&(a.count=0)):(a.start-=t,a.start<0&&(a.count=Math.max(t+a.start,0),a.start=0)),a.count<=0?(i.length=0,n.onSearch(i,r,a)):l()},n.onSearch(i,r,a)})},function(e){n._fetchHandle=null,!n._cancelingQuery})};i.mixin(a,this.fetchProperties),this.store._oldAPI?t=d:(t=this._patternToRegExp(d),t.toString=function(){return d}),this._lastQuery=r[this.searchAttr]=t,this._queryDeferHandle=this.defer(l,this.searchDelay)},constructor:function(){this.query={},this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var e=this.list;e&&(this.store=r.byId(e))}this.inherited(arguments)}})});//# sourceMappingURL=_SearchMixin.js.map