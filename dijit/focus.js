//>>built
define("dijit/focus",["dojo/aspect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/Evented","dojo/_base/lang","dojo/on","dojo/domReady","dojo/sniff","dojo/Stateful","dojo/_base/window","dojo/window","./a11y","./registry","./main"],function(t,e,i,o,n,s,a,r,d,c,h,l,u,f,p,m,_){var g,v,j=e([l,a],{curNode:null,activeStack:[],constructor:function(){var e=r.hitch(this,function(t){i.isDescendant(this.curNode,t)&&this.set("curNode",null),i.isDescendant(this.prevNode,t)&&this.set("prevNode",null)});t.before(s,"empty",e),t.before(s,"destroy",e)},registerIframe:function(t){return this.registerWin(t.contentWindow,t)},registerWin:function(t,e){var i=this,o=t.document&&t.document.body;if(o){var n=h("pointer-events")?"pointerdown":h("MSPointer")?"MSPointerDown":h("touch-events")?"mousedown, touchstart":"mousedown",s=d(t.document,n,function(t){t&&t.target&&null==t.target.parentNode||i._onTouchNode(e||t.target,"mouse")}),a=d(o,"focusin",function(t){if(t.target.tagName){var o=t.target.tagName.toLowerCase();"#document"!=o&&"body"!=o&&(p.isFocusable(t.target)?i._onFocusNode(e||t.target):i._onTouchNode(e||t.target))}}),r=d(o,"focusout",function(t){i._onBlurNode(e||t.target)});return{remove:function(){s.remove(),a.remove(),r.remove(),s=a=r=null,o=null}}}},_onBlurNode:function(t){var e=(new Date).getTime();e<g+100||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(r.hitch(this,function(){this.set("prevNode",this.curNode),this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),e<v+100||(this._clearActiveWidgetsTimer=setTimeout(r.hitch(this,function(){delete this._clearActiveWidgetsTimer,this._setStack([])}),0)))},_onTouchNode:function(t,e){v=(new Date).getTime(),this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer),n.contains(t,"dijitPopup")&&(t=t.firstChild);var i=[];try{for(;t;){var s=o.get(t,"dijitPopupParent");if(s)t=m.byId(s).domNode;else if(t.tagName&&"body"==t.tagName.toLowerCase()){if(t===u.body())break;t=f.get(t.ownerDocument).frameElement}else{var a=t.getAttribute&&t.getAttribute("widgetId"),r=a&&m.byId(a);!r||"mouse"==e&&r.get("disabled")||i.unshift(a),t=t.parentNode}}}catch(t){}this._setStack(i,e)},_onFocusNode:function(t){t&&9!=t.nodeType&&(g=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(t),t!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",t)))},_setStack:function(t,e){var i=this.activeStack,o=i.length-1,n=t.length-1;if(t[n]!=i[o]){this.set("activeStack",t);var s,a;for(a=o;a>=0&&i[a]!=t[a];a--)(s=m.byId(i[a]))&&(s._hasBeenBlurred=!0,s.set("focused",!1),s._focusManager==this&&s._onBlur(e),this.emit("widget-blur",s,e));for(a++;a<=n;a++)(s=m.byId(t[a]))&&(s.set("focused",!0),s._focusManager==this&&s._onFocus(e),this.emit("widget-focus",s,e))}},focus:function(t){if(t)try{t.focus()}catch(t){}}}),b=new j;c(function(){var t=b.registerWin(f.get(document));h("ie")&&d(window,"unload",function(){t&&(t.remove(),t=null)})}),_.focus=function(t){b.focus(t)};for(var N in b)/^_/.test(N)||(_.focus[N]="function"==typeof b[N]?r.hitch(b,N):b[N]);return b.watch(function(t,e,i){_.focus[t]=i}),b});//# sourceMappingURL=focus.js.map