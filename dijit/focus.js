//>>built
define("dijit/focus",["dojo/aspect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/Evented","dojo/_base/lang","dojo/on","dojo/domReady","dojo/sniff","dojo/Stateful","dojo/_base/window","dojo/window","./a11y","./registry","./main"],function(e,t,i,o,n,s,d,r,a,l,h,c,u,p,f,m,_){var g,N,v=t([c,d],{curNode:null,activeStack:[],constructor:function(){var t=r.hitch(this,function(e){i.isDescendant(this.curNode,e)&&this.set("curNode",null),i.isDescendant(this.prevNode,e)&&this.set("prevNode",null)});e.before(s,"empty",t),e.before(s,"destroy",t)},registerIframe:function(e){return this.registerWin(e.contentWindow,e)},registerWin:function(e,t){var i=this,o=e.document&&e.document.body;if(o){var n=h("pointer-events")?"pointerdown":h("MSPointer")?"MSPointerDown":h("touch-events")?"mousedown, touchstart":"mousedown",s=a(e.document,n,function(e){e&&e.target&&null==e.target.parentNode||i._onTouchNode(t||e.target,"mouse")}),d=a(o,"focusin",function(e){if(e.target.tagName){var o=e.target.tagName.toLowerCase();"#document"!=o&&"body"!=o&&(f.isFocusable(e.target)?i._onFocusNode(t||e.target):i._onTouchNode(t||e.target))}}),r=a(o,"focusout",function(e){i._onBlurNode(t||e.target)});return{remove:function(){s.remove(),d.remove(),r.remove(),s=d=r=null,o=null}}}},_onBlurNode:function(e){var t=(new Date).getTime();g+100>t||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(r.hitch(this,function(){this.set("prevNode",this.curNode),this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),N+100>t||(this._clearActiveWidgetsTimer=setTimeout(r.hitch(this,function(){delete this._clearActiveWidgetsTimer,this._setStack([])}),0)))},_onTouchNode:function(e,t){N=(new Date).getTime(),this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer),n.contains(e,"dijitPopup")&&(e=e.firstChild);var i=[];try{for(;e;){var s=o.get(e,"dijitPopupParent");if(s)e=m.byId(s).domNode;else if(e.tagName&&"body"==e.tagName.toLowerCase()){if(e===u.body())break;e=p.get(e.ownerDocument).frameElement}else{var d=e.getAttribute&&e.getAttribute("widgetId"),r=d&&m.byId(d);!r||"mouse"==t&&r.get("disabled")||i.unshift(d),e=e.parentNode}}}catch(a){}this._setStack(i,t)},_onFocusNode:function(e){e&&9!=e.nodeType&&(g=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(e),e!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",e)))},_setStack:function(e,t){var i=this.activeStack,o=i.length-1,n=e.length-1;if(e[n]!=i[o]){this.set("activeStack",e);var s,d;for(d=o;d>=0&&i[d]!=e[d];d--)s=m.byId(i[d]),s&&(s._hasBeenBlurred=!0,s.set("focused",!1),s._focusManager==this&&s._onBlur(t),this.emit("widget-blur",s,t));for(d++;n>=d;d++)s=m.byId(e[d]),s&&(s.set("focused",!0),s._focusManager==this&&s._onFocus(t),this.emit("widget-focus",s,t))}},focus:function(e){if(e)try{e.focus()}catch(t){}}}),b=new v;l(function(){var e=b.registerWin(p.get(document));h("ie")&&a(window,"unload",function(){e&&(e.remove(),e=null)})}),_.focus=function(e){b.focus(e)};for(var C in b)/^_/.test(C)||(_.focus[C]="function"==typeof b[C]?r.hitch(b,C):b[C]);return b.watch(function(e,t,i){_.focus[e]=i}),b});//# sourceMappingURL=focus.js.map