//>>built
define("dijit/popup",["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/keys","dojo/_base/lang","dojo/on","./place","./BackgroundIframe","./Viewport","./main","dojo/touch"],function(t,e,i,o,n,s,a,d,r,l,h,u,p,c,g,f){function m(){this._popupWrapper&&(s.destroy(this._popupWrapper),delete this._popupWrapper)}var v=i(null,{_stack:[],_beginZIndex:1e3,_idGen:1,_repositionAll:function(){if(this._firstAroundNode){var t=this._firstAroundPosition,e=a.position(this._firstAroundNode,!0),i=e.x-t.x,o=e.y-t.y;if(i||o){this._firstAroundPosition=e;for(var n=0;n<this._stack.length;n++){var s=this._stack[n].wrapper.style;s.top=parseFloat(s.top)+o+"px","auto"==s.right?s.left=parseFloat(s.left)+i+"px":s.right=parseFloat(s.right)-i+"px"}}this._aroundMoveListener=setTimeout(h.hitch(this,"_repositionAll"),i||o?10:50)}},_createWrapper:function(t){var i=t._popupWrapper,o=t.domNode;if(!i){i=s.create("div",{class:"dijitPopup",style:{display:"none"},role:"region","aria-label":t["aria-label"]||t.label||t.name||t.id},t.ownerDocumentBody),i.appendChild(o);var n=o.style;n.display="",n.visibility="",n.position="",n.top="0px",t._popupWrapper=i,e.after(t,"destroy",m,!0),"ontouchend"in document&&u(i,"touchend",function(t){/^(input|button|textarea)$/i.test(t.target.tagName)||t.preventDefault()}),i.dojoClick=!0}return i},moveOffScreen:function(t){var e=this._createWrapper(t),i=a.isBodyLtr(t.ownerDocument),o={visibility:"hidden",top:"-9999px",display:""};return o[i?"left":"right"]="-9999px",o[i?"right":"left"]="auto",d.set(e,o),e},hide:function(t){var e=this._createWrapper(t);d.set(e,{display:"none",height:"auto",overflowY:"visible",border:""});var i=t.domNode;"_originalStyle"in i&&(i.style.cssText=i._originalStyle)},getTopPopup:function(){for(var t=this._stack,e=t.length-1;e>0&&t[e].parent===t[e-1].widget;e--);return t[e]},open:function(t){for(var e=this._stack,i=t.popup,s=i.domNode,f=t.orient||["below","below-alt","above","above-alt"],m=t.parent?t.parent.isLeftToRight():a.isBodyLtr(i.ownerDocument),v=t.around,b=t.around&&t.around.id?t.around.id+"_dropdown":"popup_"+this._idGen++;e.length&&(!t.parent||!o.isDescendant(t.parent.domNode,e[e.length-1].widget.domNode));)this.close(e[e.length-1].widget);var y=this.moveOffScreen(i);i.startup&&!i._started&&i.startup();var _,j=a.position(s);if("maxHeight"in t&&-1!=t.maxHeight)_=t.maxHeight||1/0;else{var x=g.getEffectiveBox(this.ownerDocument),C=v?a.position(v,!1):{y:t.y-(t.padding||0),h:2*(t.padding||0)};_=Math.floor(Math.max(C.y,x.h-(C.y+C.h)))}if(j.h>_){var N=d.getComputedStyle(s),B=N.borderLeftWidth+" "+N.borderLeftStyle+" "+N.borderLeftColor;d.set(y,{overflowY:"scroll",height:_+"px",border:B}),s._originalStyle=s.style.cssText,s.style.border="none"}n.set(y,{id:b,style:{zIndex:this._beginZIndex+e.length},class:"dijitPopup "+(i.baseClass||i.class||"").split(" ")[0]+"Popup",dijitPopupParent:t.parent?t.parent.id:""}),0==e.length&&v&&(this._firstAroundNode=v,this._firstAroundPosition=a.position(v,!0),this._aroundMoveListener=setTimeout(h.hitch(this,"_repositionAll"),50)),r("config-bgIframe")&&!i.bgIframe&&(i.bgIframe=new c(y));var w=i.orient?h.hitch(i,"orient"):null,I=v?p.around(y,v,f,m,w):p.at(y,t,"R"==f?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],t.padding,w);y.style.visibility="visible",s.style.visibility="visible";var P=[];return P.push(u(y,"keydown",h.hitch(this,function(e){if(e.keyCode==l.ESCAPE&&t.onCancel)e.stopPropagation(),e.preventDefault(),t.onCancel();else if(e.keyCode==l.TAB){e.stopPropagation(),e.preventDefault();var i=this.getTopPopup();i&&i.onCancel&&i.onCancel()}}))),i.onCancel&&t.onCancel&&P.push(i.on("cancel",t.onCancel)),P.push(i.on(i.onExecute?"execute":"change",h.hitch(this,function(){var t=this.getTopPopup();t&&t.onExecute&&t.onExecute()}))),e.push({widget:i,wrapper:y,parent:t.parent,onExecute:t.onExecute,onCancel:t.onCancel,onClose:t.onClose,handlers:P}),i.onOpen&&i.onOpen(I),I},close:function(e){for(var i=this._stack;e&&t.some(i,function(t){return t.widget==e})||!e&&i.length;){var o=i.pop(),n=o.widget,s=o.onClose;n.bgIframe&&(n.bgIframe.destroy(),delete n.bgIframe),n.onClose&&n.onClose();for(var a;a=o.handlers.pop();)a.remove();n&&n.domNode&&this.hide(n),s&&s()}0==i.length&&this._aroundMoveListener&&(clearTimeout(this._aroundMoveListener),this._firstAroundNode=this._firstAroundPosition=this._aroundMoveListener=null)}});return f.popup=new v});//# sourceMappingURL=popup.js.map