//>>built
define("dijit/_HasDropDown",["dojo/_base/declare","dojo/_base/Deferred","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/keys","dojo/_base/lang","dojo/on","dojo/touch","./registry","./focus","./popup","./_FocusMixin"],function(t,e,i,o,a,n,s,d,r,l,h,c,p,u,f,m){return t("dijit._HasDropDown",m,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(t){this.disabled||this.readOnly||("MSPointerDown"!=t.type&&t.preventDefault(),this.own(h.once(this.ownerDocument,c.release,l.hitch(this,"_onDropDownMouseUp"))),this.toggleDropDown())},_onDropDownMouseUp:function(t){var e=this.dropDown,i=!1;if(t&&this._opened){var o=n.position(this._buttonNode,!0);if(!(t.pageX>=o.x&&t.pageX<=o.x+o.w&&t.pageY>=o.y&&t.pageY<=o.y+o.h)){for(var s=t.target;s&&!i;)a.contains(s,"dijitPopup")?i=!0:s=s.parentNode;if(i){if(s=t.target,e.onItemClick){for(var d;s&&!(d=p.byNode(s));)s=s.parentNode;d&&d.onClick&&d.getParent&&d.getParent().onItemClick(d,t)}return}}}this._opened?e.focus&&(!1!==e.autoFocus||"mouseup"==t.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer(function(){e.focus(),delete this._focusDropDownTimer})):this.focus&&this.defer("focus")},_onDropDownClick:function(t){this._stopClickEvents&&(t.stopPropagation(),t.preventDefault())},buildRendering:function(){this.inherited(arguments),this._buttonNode=this._buttonNode||this.focusNode||this.domNode,this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var t={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||this.dropDownPosition[0]||"Down";a.add(this._arrowWrapperNode||this._buttonNode,"dijit"+t+"ArrowButton")},postCreate:function(){this.inherited(arguments);var t=this.focusNode||this.domNode;this.own(h(this._buttonNode,c.press,l.hitch(this,"_onDropDownMouseDown")),h(this._buttonNode,"click",l.hitch(this,"_onDropDownClick")),h(t,"keydown",l.hitch(this,"_onKey")),h(t,"keyup",l.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0),this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),delete this.dropDown),this.inherited(arguments)},_onKey:function(t){if(!this.disabled&&!this.readOnly){var e=this.dropDown,i=t.target;if(e&&this._opened&&e.handleKey&&!1===e.handleKey(t))return t.stopPropagation(),void t.preventDefault();e&&this._opened&&t.keyCode==r.ESCAPE?(this.closeDropDown(),t.stopPropagation(),t.preventDefault()):!this._opened&&(t.keyCode==r.DOWN_ARROW||(t.keyCode==r.ENTER||t.keyCode==r.SPACE&&(!this._searchTimer||t.ctrlKey||t.altKey||t.metaKey))&&("input"!==(i.tagName||"").toLowerCase()||i.type&&"text"!==i.type.toLowerCase()))&&(this._toggleOnKeyUp=!0,t.stopPropagation(),t.preventDefault())}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp,this.toggleDropDown();var t=this.dropDown;t&&t.focus&&this.defer(l.hitch(t,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1),this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(t){t()},loadAndOpenDropDown:function(){var t=new e,i=l.hitch(this,function(){this.openDropDown(),t.resolve(this.dropDown)});return this.isLoaded()?i():this.loadDropDown(i),t},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var t=this.dropDown,e=t.domNode,i=this._aroundNode||this.domNode,s=this,d=f.open({parent:this,popup:t,around:i,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){s.closeDropDown(!0)},onCancel:function(){s.closeDropDown(!0)},onClose:function(){o.set(s._popupStateNode,"popupActive",!1),a.remove(s._popupStateNode,"dijitHasDropDownOpen"),s._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&i.offsetWidth>t._popupWrapper.offsetWidth){var r=i.offsetWidth-t._popupWrapper.offsetWidth,h={w:t.domNode.offsetWidth+r};this._origStyle=e.style.cssText,l.isFunction(t.resize)?t.resize(h):n.setMarginBox(e,h),"R"==d.corner[1]&&(t._popupWrapper.style.left=t._popupWrapper.style.left.replace("px","")-r+"px")}return o.set(this._popupStateNode,"popupActive","true"),a.add(this._popupStateNode,"dijitHasDropDownOpen"),this._set("_opened",!0),this._popupStateNode.setAttribute("aria-expanded","true"),this._popupStateNode.setAttribute("aria-owns",t.id),"presentation"===e.getAttribute("role")||e.getAttribute("aria-labelledby")||e.setAttribute("aria-labelledby",this.id),d},closeDropDown:function(t){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer),this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),t&&this.focus&&this.focus(),f.close(this.dropDown),this._opened=!1),this._origStyle&&(this.dropDown.domNode.style.cssText=this._origStyle,delete this._origStyle)}})});//# sourceMappingURL=_HasDropDown.js.map