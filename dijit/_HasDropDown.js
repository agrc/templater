//>>built
define("dijit/_HasDropDown",["dojo/_base/declare","dojo/_base/Deferred","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/keys","dojo/_base/lang","dojo/on","dojo/touch","./registry","./focus","./popup","./_FocusMixin"],function(t,e,o,i,n,s,a,d,r,h,l,u,c,p,f,_){return t("dijit._HasDropDown",_,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(t){this.disabled||this.readOnly||("MSPointerDown"!=t.type&&"pointerdown"!=t.type&&t.preventDefault(),this.own(l.once(this.ownerDocument,u.release,h.hitch(this,"_onDropDownMouseUp"))),this.toggleDropDown())},_onDropDownMouseUp:function(t){var e=this.dropDown,o=!1;if(t&&this._opened){var i=s.position(this._buttonNode,!0);if(!(t.pageX>=i.x&&t.pageX<=i.x+i.w&&t.pageY>=i.y&&t.pageY<=i.y+i.h)){for(var a=t.target;a&&!o;)n.contains(a,"dijitPopup")?o=!0:a=a.parentNode;if(o){if(a=t.target,e.onItemClick){for(var d;a&&!(d=c.byNode(a));)a=a.parentNode;d&&d.onClick&&d.getParent&&d.getParent().onItemClick(d,t)}return}}}this._opened?e.focus&&(e.autoFocus!==!1||"mouseup"==t.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer(function(){e.focus(),delete this._focusDropDownTimer})):this.focus&&this.defer("focus")},_onDropDownClick:function(t){this._stopClickEvents&&(t.stopPropagation(),t.preventDefault())},buildRendering:function(){this.inherited(arguments),this._buttonNode=this._buttonNode||this.focusNode||this.domNode,this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var t={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||this.dropDownPosition[0]||"Down";n.add(this._arrowWrapperNode||this._buttonNode,"dijit"+t+"ArrowButton")},postCreate:function(){this.inherited(arguments);var t=this.focusNode||this.domNode;this.own(l(this._buttonNode,u.press,h.hitch(this,"_onDropDownMouseDown")),l(this._buttonNode,"click",h.hitch(this,"_onDropDownClick")),l(t,"keydown",h.hitch(this,"_onKey")),l(t,"keyup",h.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0),this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),delete this.dropDown),this.inherited(arguments)},_onKey:function(t){if(!this.disabled&&!this.readOnly){var e=this.dropDown,o=t.target;return e&&this._opened&&e.handleKey&&e.handleKey(t)===!1?(t.stopPropagation(),void t.preventDefault()):void(e&&this._opened&&t.keyCode==r.ESCAPE?(this.closeDropDown(),t.stopPropagation(),t.preventDefault()):!this._opened&&(t.keyCode==r.DOWN_ARROW||(t.keyCode==r.ENTER||t.keyCode==r.SPACE&&(!this._searchTimer||t.ctrlKey||t.altKey||t.metaKey))&&("input"!==(o.tagName||"").toLowerCase()||o.type&&"text"!==o.type.toLowerCase()))&&(this._toggleOnKeyUp=!0,t.stopPropagation(),t.preventDefault()))}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp,this.toggleDropDown();var t=this.dropDown;t&&t.focus&&this.defer(h.hitch(t,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1),this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(t){t()},loadAndOpenDropDown:function(){var t=new e,o=h.hitch(this,function(){this.openDropDown(),t.resolve(this.dropDown)});return this.isLoaded()?o():this.loadDropDown(o),t},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var t=this.dropDown,e=t.domNode,o=this._aroundNode||this.domNode,a=this,d=f.open({parent:this,popup:t,around:o,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){a.closeDropDown(!0)},onCancel:function(){a.closeDropDown(!0)},onClose:function(){i.set(a._popupStateNode,"popupActive",!1),n.remove(a._popupStateNode,"dijitHasDropDownOpen"),a._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&o.offsetWidth>t._popupWrapper.offsetWidth){var r=o.offsetWidth-t._popupWrapper.offsetWidth,l={w:t.domNode.offsetWidth+r};this._origStyle=e.style.cssText,h.isFunction(t.resize)?t.resize(l):s.setMarginBox(e,l),"R"==d.corner[1]&&(t._popupWrapper.style.left=t._popupWrapper.style.left.replace("px","")-r+"px")}return i.set(this._popupStateNode,"popupActive","true"),n.add(this._popupStateNode,"dijitHasDropDownOpen"),this._set("_opened",!0),this._popupStateNode.setAttribute("aria-expanded","true"),this._popupStateNode.setAttribute("aria-owns",t.id),"presentation"===e.getAttribute("role")||e.getAttribute("aria-labelledby")||e.setAttribute("aria-labelledby",this.id),d},closeDropDown:function(t){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer),this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),t&&this.focus&&this.focus(),f.close(this.dropDown),this._opened=!1),this._origStyle&&(this.dropDown.domNode.style.cssText=this._origStyle,delete this._origStyle)}})});//# sourceMappingURL=_HasDropDown.js.map