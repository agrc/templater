//>>built
define("dijit/_HasDropDown",["dojo/_base/declare","dojo/_base/Deferred","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/keys","dojo/_base/lang","dojo/on","dojo/touch","./registry","./focus","./popup","./_FocusMixin"],function(e,t,o,i,n,s,d,a,r,h,l,c,p,u,_,D){return e("dijit._HasDropDown",D,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(e){this.disabled||this.readOnly||("MSPointerDown"!=e.type&&"pointerdown"!=e.type&&e.preventDefault(),this.own(l.once(this.ownerDocument,c.release,h.hitch(this,"_onDropDownMouseUp"))),this.toggleDropDown())},_onDropDownMouseUp:function(e){var t=this.dropDown,o=!1;if(e&&this._opened){var i=s.position(this._buttonNode,!0);if(!(e.pageX>=i.x&&e.pageX<=i.x+i.w&&e.pageY>=i.y&&e.pageY<=i.y+i.h)){for(var d=e.target;d&&!o;)n.contains(d,"dijitPopup")?o=!0:d=d.parentNode;if(o){if(d=e.target,t.onItemClick){for(var a;d&&!(a=p.byNode(d));)d=d.parentNode;a&&a.onClick&&a.getParent&&a.getParent().onItemClick(a,e)}return}}}this._opened?t.focus&&(t.autoFocus!==!1||"mouseup"==e.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer(function(){t.focus(),delete this._focusDropDownTimer})):this.focus&&this.defer("focus")},_onDropDownClick:function(e){this._stopClickEvents&&(e.stopPropagation(),e.preventDefault())},buildRendering:function(){this.inherited(arguments),this._buttonNode=this._buttonNode||this.focusNode||this.domNode,this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var e={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||this.dropDownPosition[0]||"Down";n.add(this._arrowWrapperNode||this._buttonNode,"dijit"+e+"ArrowButton")},postCreate:function(){this.inherited(arguments);var e=this.focusNode||this.domNode;this.own(l(this._buttonNode,c.press,h.hitch(this,"_onDropDownMouseDown")),l(this._buttonNode,"click",h.hitch(this,"_onDropDownClick")),l(e,"keydown",h.hitch(this,"_onKey")),l(e,"keyup",h.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0),this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),delete this.dropDown),this.inherited(arguments)},_onKey:function(e){if(!this.disabled&&!this.readOnly){var t=this.dropDown,o=e.target;return t&&this._opened&&t.handleKey&&t.handleKey(e)===!1?(e.stopPropagation(),void e.preventDefault()):void(t&&this._opened&&e.keyCode==r.ESCAPE?(this.closeDropDown(),e.stopPropagation(),e.preventDefault()):!this._opened&&(e.keyCode==r.DOWN_ARROW||(e.keyCode==r.ENTER||e.keyCode==r.SPACE&&(!this._searchTimer||e.ctrlKey||e.altKey||e.metaKey))&&("input"!==(o.tagName||"").toLowerCase()||o.type&&"text"!==o.type.toLowerCase()))&&(this._toggleOnKeyUp=!0,e.stopPropagation(),e.preventDefault()))}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp,this.toggleDropDown();var e=this.dropDown;e&&e.focus&&this.defer(h.hitch(e,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1),this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(e){e()},loadAndOpenDropDown:function(){var e=new t,o=h.hitch(this,function(){this.openDropDown(),e.resolve(this.dropDown)});return this.isLoaded()?o():this.loadDropDown(o),e},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var e=this.dropDown,t=e.domNode,o=this._aroundNode||this.domNode,d=this,a=_.open({parent:this,popup:e,around:o,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){d.closeDropDown(!0)},onCancel:function(){d.closeDropDown(!0)},onClose:function(){i.set(d._popupStateNode,"popupActive",!1),n.remove(d._popupStateNode,"dijitHasDropDownOpen"),d._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&o.offsetWidth>e._popupWrapper.offsetWidth){var r=o.offsetWidth-e._popupWrapper.offsetWidth,l={w:e.domNode.offsetWidth+r};this._origStyle=t.style.cssText,h.isFunction(e.resize)?e.resize(l):s.setMarginBox(t,l),"R"==a.corner[1]&&(e._popupWrapper.style.left=e._popupWrapper.style.left.replace("px","")-r+"px")}return i.set(this._popupStateNode,"popupActive","true"),n.add(this._popupStateNode,"dijitHasDropDownOpen"),this._set("_opened",!0),this._popupStateNode.setAttribute("aria-expanded","true"),this._popupStateNode.setAttribute("aria-owns",e.id),"presentation"===t.getAttribute("role")||t.getAttribute("aria-labelledby")||t.setAttribute("aria-labelledby",this.id),a},closeDropDown:function(e){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer),this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),e&&this.focus&&this.focus(),_.close(this.dropDown),this._opened=!1),this._origStyle&&(this.dropDown.domNode.style.cssText=this._origStyle,delete this._origStyle)}})});//# sourceMappingURL=_HasDropDown.js.map