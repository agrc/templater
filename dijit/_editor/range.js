//>>built
define("dijit/_editor/range",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(e,t,i){var n={getIndex:function(e,t){for(var i,n,o=[],s=[],a=e;e!=t;){var r=0;for(i=e.parentNode;n=i.childNodes[r++];)if(n===e){--r;break}o.unshift(r),s.unshift(r-i.childNodes.length),e=i}if(o.length>0&&3==a.nodeType){for(n=a.previousSibling;n&&3==n.nodeType;)o[o.length-1]--,n=n.previousSibling;for(n=a.nextSibling;n&&3==n.nodeType;)s[s.length-1]++,n=n.nextSibling}return{o:o,r:s}},getNode:function(t,n){if(!i.isArray(t)||0==t.length)return n;var o=n;return e.every(t,function(e){return e>=0&&e<o.childNodes.length?(o=o.childNodes[e],!0):(o=null,!1)}),o},getCommonAncestor:function(e,t,i){i=i||e.ownerDocument.body;for(var n=function(e){for(var t=[];e&&(t.unshift(e),e!==i);)e=e.parentNode;return t},o=n(e),s=n(t),a=Math.min(o.length,s.length),r=o[0],d=1;a>d&&o[d]===s[d];d++)r=o[d];return r},getAncestor:function(e,t,i){for(i=i||e.ownerDocument.body;e&&e!==i;){var n=e.nodeName.toUpperCase();if(t.test(n))return e;e=e.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(e,t,i){i=i||e.ownerDocument.body,t=t||n.BlockTagNames;for(var o,s=null;e&&e!==i;){var a=e.nodeName.toUpperCase();!s&&t.test(a)&&(s=e),!o&&/^(?:BODY|TD|TH|CAPTION)$/.test(a)&&(o=e),e=e.parentNode}return{blockNode:s,blockContainer:o||e.ownerDocument.body}},atBeginningOfContainer:function(e,t,i){var n=!1,o=0==i;if(o||3!=t.nodeType||/^[\s\xA0]+$/.test(t.nodeValue.substr(0,i))&&(o=!0),o){var s=t;for(n=!0;s&&s!==e;){if(s.previousSibling){n=!1;break}s=s.parentNode}}return n},atEndOfContainer:function(e,t,i){var n=!1,o=i==(t.length||t.childNodes.length);if(o||3!=t.nodeType||/^[\s\xA0]+$/.test(t.nodeValue.substr(i))&&(o=!0),o){var s=t;for(n=!0;s&&s!==e;){if(s.nextSibling){n=!1;break}s=s.parentNode}}return n},adjacentNoneTextNode:function(e,t){for(var i=e,n=0-e.length||0,o=t?"nextSibling":"previousSibling";i&&3==i.nodeType;)n+=i.length,i=i[o];return[i,n]},create:function(e){return e=e||window,e.getSelection?e.document.createRange():new s},getSelection:function(e,t){if(e.getSelection)return e.getSelection();var i=new o.selection(e);return t||i._getCurrentSelection(),i}};if(!window.getSelection)var o=n.ie={cachedSelection:{},selection:function(e){this._ranges=[],this.addRange=function(e,t){this._ranges.push(e),t||e._select(),this.rangeCount=this._ranges.length},this.removeAllRanges=function(){this._ranges=[],this.rangeCount=0};var t=function(){var t=e.document.selection.createRange(),i=e.document.selection.type.toUpperCase();return new s("CONTROL"==i?o.decomposeControlRange(t):o.decomposeTextRange(t))};this.getRangeAt=function(e){return this._ranges[e]},this._getCurrentSelection=function(){this.removeAllRanges();var e=t();e?(this.addRange(e,!0),this.isCollapsed=e.collapsed):this.isCollapsed=!0}},decomposeControlRange:function(e){var t=e.item(0),i=e.item(e.length-1),o=t.parentNode,s=i.parentNode,a=n.getIndex(t,o).o[0],r=n.getIndex(i,s).o[0]+1;return[o,a,s,r]},getEndPoint:function(t,i){var o=t.duplicate();o.collapse(!i);var s,a,r,d="EndTo"+(i?"End":"Start"),l=o.parentElement();if(l.childNodes.length>0?e.every(l.childNodes,function(e,i){var c;if(3!=e.nodeType){if(o.moveToElementText(e),o.compareEndPoints(d,t)>0){if(!r||3!=r.nodeType)return s=l,a=i,!1;s=r,c=!0}else if(i==l.childNodes.length-1)return s=l,a=l.childNodes.length,!1}else i==l.childNodes.length-1&&(s=e,c=!0);if(c&&s){var h=n.adjacentNoneTextNode(s)[0];s=h?h.nextSibling:l.firstChild;var u=n.adjacentNoneTextNode(s);h=u[0];var f=u[1];return h?(o.moveToElementText(h),o.collapse(!1)):o.moveToElementText(l),o.setEndPoint(d,t),a=o.text.length-f,!1}return r=e,!0}):(s=l,a=0),!i&&1==s.nodeType&&a==s.childNodes.length){var c=s.nextSibling;c&&3==c.nodeType&&(s=c,a=0)}return[s,a]},setEndPoint:function(e,t,i){var o,s,a=e.duplicate();if(3!=t.nodeType)if(i>0){if(o=t.childNodes[i-1])if(3==o.nodeType)t=o,i=o.length;else if(o.nextSibling&&3==o.nextSibling.nodeType)t=o.nextSibling,i=0;else{a.moveToElementText(o.nextSibling?o:t);var r=o.parentNode,d=r.insertBefore(o.ownerDocument.createTextNode(" "),o.nextSibling);a.collapse(!1),r.removeChild(d)}}else a.moveToElementText(t),a.collapse(!0);if(3==t.nodeType){var l=n.adjacentNoneTextNode(t),c=l[0];s=l[1],c?(a.moveToElementText(c),a.collapse(!1),"inherit"!=c.contentEditable&&s++):(a.moveToElementText(t.parentNode),a.collapse(!0),a.move("character",1),a.move("character",-1)),i+=s,i>0&&a.move("character",i)!=i}return a},decomposeTextRange:function(e){var t=o.getEndPoint(e),i=t[0],n=t[1],s=t[0],a=t[1];return e.htmlText.length&&(e.htmlText==e.text?a=n+e.text.length:(t=o.getEndPoint(e,!0),s=t[0],a=t[1])),[i,n,s,a]},setRange:function(e,t,i,n,s,a){var r=o.setEndPoint(e,t,i);if(e.setEndPoint("StartToStart",r),!a)var d=o.setEndPoint(e,n,s);return e.setEndPoint("EndToEnd",d||r),e}},s=n.W3CRange=t(null,{constructor:function(){arguments.length>0?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.commonAncestorContainer=null,this.startContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.startContainer!==this.endContainer?this.commonAncestorContainer=n.getCommonAncestor(this.startContainer,this.endContainer):this.commonAncestorContainer=this.startContainer,this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(e,t){t=parseInt(t),this.startContainer===e&&this.startOffset==t||(delete this._cachedBookmark,this.startContainer=e,this.startOffset=t,this.endContainer?this._updateInternal():this.setEnd(e,t))},setEnd:function(e,t){t=parseInt(t),this.endContainer===e&&this.endOffset==t||(delete this._cachedBookmark,this.endContainer=e,this.endOffset=t,this.startContainer?this._updateInternal():this.setStart(e,t))},setStartAfter:function(e,t){this._setPoint("setStart",e,t,1)},setStartBefore:function(e,t){this._setPoint("setStart",e,t,0)},setEndAfter:function(e,t){this._setPoint("setEnd",e,t,1)},setEndBefore:function(e,t){this._setPoint("setEnd",e,t,0)},_setPoint:function(e,t,i,o){var s=n.getIndex(t,t.parentNode).o;this[e](t.parentNode,s.pop()+o)},_getIERange:function(){var e=(this._body||this.endContainer.ownerDocument.body).createTextRange();return o.setRange(e,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed),e},getBookmark:function(){return this._getIERange(),this._cachedBookmark},_select:function(){var e=this._getIERange();e.select()},deleteContents:function(){var e=this.startContainer,t=this._getIERange();3!==e.nodeType||this.startOffset||this.setStartBefore(e),t.pasteHTML(""),this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.collapsed=!0},cloneRange:function(){var e=new s([this.startContainer,this.startOffset,this.endContainer,this.endOffset]);return e._body=this._body,e},detach:function(){this._body=null,this.commonAncestorContainer=null,this.startContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0}});return i.setObject("dijit.range",n),n});//# sourceMappingURL=range.js.map