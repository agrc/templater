//>>built
define("dijit/_editor/range",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(e,t,n){var i={getIndex:function(e,t){for(var n,i,o=[],s=[],r=e;e!=t;){var a=0;for(n=e.parentNode;i=n.childNodes[a++];)if(i===e){--a;break}o.unshift(a),s.unshift(a-n.childNodes.length),e=n}if(o.length>0&&3==r.nodeType){for(i=r.previousSibling;i&&3==i.nodeType;)o[o.length-1]--,i=i.previousSibling;for(i=r.nextSibling;i&&3==i.nodeType;)s[s.length-1]++,i=i.nextSibling}return{o:o,r:s}},getNode:function(t,i){if(!n.isArray(t)||0==t.length)return i;var o=i;return e.every(t,function(e){return e>=0&&e<o.childNodes.length?(o=o.childNodes[e],!0):(o=null,!1)}),o},getCommonAncestor:function(e,t,n){n=n||e.ownerDocument.body;for(var i=function(e){for(var t=[];e&&(t.unshift(e),e!==n);)e=e.parentNode;return t},o=i(e),s=i(t),r=Math.min(o.length,s.length),a=o[0],d=1;d<r&&o[d]===s[d];d++)a=o[d];return a},getAncestor:function(e,t,n){for(n=n||e.ownerDocument.body;e&&e!==n;){var i=e.nodeName.toUpperCase();if(t.test(i))return e;e=e.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(e,t,n){n=n||e.ownerDocument.body,t=t||i.BlockTagNames;for(var o,s=null;e&&e!==n;){var r=e.nodeName.toUpperCase();!s&&t.test(r)&&(s=e),!o&&/^(?:BODY|TD|TH|CAPTION)$/.test(r)&&(o=e),e=e.parentNode}return{blockNode:s,blockContainer:o||e.ownerDocument.body}},atBeginningOfContainer:function(e,t,n){var i=!1,o=0==n;if(o||3!=t.nodeType||/^[\s\xA0]+$/.test(t.nodeValue.substr(0,n))&&(o=!0),o){var s=t;for(i=!0;s&&s!==e;){if(s.previousSibling){i=!1;break}s=s.parentNode}}return i},atEndOfContainer:function(e,t,n){var i=!1,o=n==(t.length||t.childNodes.length);if(o||3!=t.nodeType||/^[\s\xA0]+$/.test(t.nodeValue.substr(n))&&(o=!0),o){var s=t;for(i=!0;s&&s!==e;){if(s.nextSibling){i=!1;break}s=s.parentNode}}return i},adjacentNoneTextNode:function(e,t){for(var n=e,i=0-e.length||0,o=t?"nextSibling":"previousSibling";n&&3==n.nodeType;)i+=n.length,n=n[o];return[n,i]},create:function(e){return e=e||window,e.getSelection?e.document.createRange():new s},getSelection:function(e,t){if(e.getSelection)return e.getSelection();var n=new o.selection(e);return t||n._getCurrentSelection(),n}};if(!window.getSelection)var o=i.ie={cachedSelection:{},selection:function(e){this._ranges=[],this.addRange=function(e,t){this._ranges.push(e),t||e._select(),this.rangeCount=this._ranges.length},this.removeAllRanges=function(){this._ranges=[],this.rangeCount=0};var t=function(){var t=e.document.selection.createRange(),n=e.document.selection.type.toUpperCase();return new s("CONTROL"==n?o.decomposeControlRange(t):o.decomposeTextRange(t))};this.getRangeAt=function(e){return this._ranges[e]},this._getCurrentSelection=function(){this.removeAllRanges();var e=t();e?(this.addRange(e,!0),this.isCollapsed=e.collapsed):this.isCollapsed=!0}},decomposeControlRange:function(e){var t=e.item(0),n=e.item(e.length-1),o=t.parentNode,s=n.parentNode;return[o,i.getIndex(t,o).o[0],s,i.getIndex(n,s).o[0]+1]},getEndPoint:function(t,n){var o=t.duplicate();o.collapse(!n);var s,r,a,d="EndTo"+(n?"End":"Start"),c=o.parentElement();if(c.childNodes.length>0?e.every(c.childNodes,function(e,n){var h;if(3!=e.nodeType){if(o.moveToElementText(e),o.compareEndPoints(d,t)>0){if(!a||3!=a.nodeType)return s=c,r=n,!1;s=a,h=!0}else if(n==c.childNodes.length-1)return s=c,r=c.childNodes.length,!1}else n==c.childNodes.length-1&&(s=e,h=!0);if(h&&s){var l=i.adjacentNoneTextNode(s)[0];s=l?l.nextSibling:c.firstChild;var u=i.adjacentNoneTextNode(s);l=u[0];var f=u[1];return l?(o.moveToElementText(l),o.collapse(!1)):o.moveToElementText(c),o.setEndPoint(d,t),r=o.text.length-f,!1}return a=e,!0}):(s=c,r=0),!n&&1==s.nodeType&&r==s.childNodes.length){var h=s.nextSibling;h&&3==h.nodeType&&(s=h,r=0)}return[s,r]},setEndPoint:function(e,t,n){var o,s,r=e.duplicate();if(3!=t.nodeType)if(n>0){if(o=t.childNodes[n-1])if(3==o.nodeType)t=o,n=o.length;else if(o.nextSibling&&3==o.nextSibling.nodeType)t=o.nextSibling,n=0;else{r.moveToElementText(o.nextSibling?o:t);var a=o.parentNode,d=a.insertBefore(o.ownerDocument.createTextNode(" "),o.nextSibling);r.collapse(!1),a.removeChild(d)}}else r.moveToElementText(t),r.collapse(!0);if(3==t.nodeType){var c=i.adjacentNoneTextNode(t),h=c[0];s=c[1],h?(r.moveToElementText(h),r.collapse(!1),"inherit"!=h.contentEditable&&s++):(r.moveToElementText(t.parentNode),r.collapse(!0),r.move("character",1),r.move("character",-1)),n+=s,n>0&&r.move("character",n)}return r},decomposeTextRange:function(e){var t=o.getEndPoint(e),n=t[0],i=t[1],s=t[0],r=t[1];return e.htmlText.length&&(e.htmlText==e.text?r=i+e.text.length:(t=o.getEndPoint(e,!0),s=t[0],r=t[1])),[n,i,s,r]},setRange:function(e,t,n,i,s,r){var a=o.setEndPoint(e,t,n);if(e.setEndPoint("StartToStart",a),!r)var d=o.setEndPoint(e,i,s);return e.setEndPoint("EndToEnd",d||a),e}},s=i.W3CRange=t(null,{constructor:function(){arguments.length>0?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.commonAncestorContainer=null,this.startContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.startContainer!==this.endContainer?this.commonAncestorContainer=i.getCommonAncestor(this.startContainer,this.endContainer):this.commonAncestorContainer=this.startContainer,this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(e,t){t=parseInt(t),this.startContainer===e&&this.startOffset==t||(delete this._cachedBookmark,this.startContainer=e,this.startOffset=t,this.endContainer?this._updateInternal():this.setEnd(e,t))},setEnd:function(e,t){t=parseInt(t),this.endContainer===e&&this.endOffset==t||(delete this._cachedBookmark,this.endContainer=e,this.endOffset=t,this.startContainer?this._updateInternal():this.setStart(e,t))},setStartAfter:function(e,t){this._setPoint("setStart",e,t,1)},setStartBefore:function(e,t){this._setPoint("setStart",e,t,0)},setEndAfter:function(e,t){this._setPoint("setEnd",e,t,1)},setEndBefore:function(e,t){this._setPoint("setEnd",e,t,0)},_setPoint:function(e,t,n,o){var s=i.getIndex(t,t.parentNode).o;this[e](t.parentNode,s.pop()+o)},_getIERange:function(){var e=(this._body||this.endContainer.ownerDocument.body).createTextRange();return o.setRange(e,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed),e},getBookmark:function(){return this._getIERange(),this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var e=this.startContainer,t=this._getIERange();3!==e.nodeType||this.startOffset||this.setStartBefore(e),t.pasteHTML(""),this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.collapsed=!0},cloneRange:function(){var e=new s([this.startContainer,this.startOffset,this.endContainer,this.endOffset]);return e._body=this._body,e},detach:function(){this._body=null,this.commonAncestorContainer=null,this.startContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0}});return n.setObject("dijit.range",i),i});//# sourceMappingURL=range.js.map