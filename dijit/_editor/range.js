//>>built
define("dijit/_editor/range",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(e,t,n){var o={getIndex:function(e,t){for(var n,o,i=[],s=[],r=e;e!=t;){var a=0;for(n=e.parentNode;o=n.childNodes[a++];)if(o===e){--a;break}i.unshift(a),s.unshift(a-n.childNodes.length),e=n}if(i.length>0&&3==r.nodeType){for(o=r.previousSibling;o&&3==o.nodeType;)i[i.length-1]--,o=o.previousSibling;for(o=r.nextSibling;o&&3==o.nodeType;)s[s.length-1]++,o=o.nextSibling}return{o:i,r:s}},getNode:function(t,o){if(!n.isArray(t)||0==t.length)return o;var i=o;return e.every(t,function(e){return e>=0&&e<i.childNodes.length?(i=i.childNodes[e],!0):(i=null,!1)}),i},getCommonAncestor:function(e,t,n){n=n||e.ownerDocument.body;for(var o=function(e){for(var t=[];e&&(t.unshift(e),e!==n);)e=e.parentNode;return t},i=o(e),s=o(t),r=Math.min(i.length,s.length),a=i[0],d=1;d<r&&i[d]===s[d];d++)a=i[d];return a},getAncestor:function(e,t,n){for(n=n||e.ownerDocument.body;e&&e!==n;){var o=e.nodeName.toUpperCase();if(t.test(o))return e;e=e.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(e,t,n){n=n||e.ownerDocument.body,t=t||o.BlockTagNames;for(var i,s=null;e&&e!==n;){var r=e.nodeName.toUpperCase();!s&&t.test(r)&&(s=e),!i&&/^(?:BODY|TD|TH|CAPTION)$/.test(r)&&(i=e),e=e.parentNode}return{blockNode:s,blockContainer:i||e.ownerDocument.body}},atBeginningOfContainer:function(e,t,n){var o=!1,i=0==n;if(i||3!=t.nodeType||/^[\s\xA0]+$/.test(t.nodeValue.substr(0,n))&&(i=!0),i){var s=t;for(o=!0;s&&s!==e;){if(s.previousSibling){o=!1;break}s=s.parentNode}}return o},atEndOfContainer:function(e,t,n){var o=!1,i=n==(t.length||t.childNodes.length);if(i||3!=t.nodeType||/^[\s\xA0]+$/.test(t.nodeValue.substr(n))&&(i=!0),i){var s=t;for(o=!0;s&&s!==e;){if(s.nextSibling){o=!1;break}s=s.parentNode}}return o},adjacentNoneTextNode:function(e,t){for(var n=e,o=0-e.length||0,i=t?"nextSibling":"previousSibling";n&&3==n.nodeType;)o+=n.length,n=n[i];return[n,o]},create:function(e){return e=e||window,e.getSelection?e.document.createRange():new s},getSelection:function(e,t){if(e.getSelection)return e.getSelection();var n=new i.selection(e);return t||n._getCurrentSelection(),n}};if(!window.getSelection)var i=o.ie={cachedSelection:{},selection:function(e){this._ranges=[],this.addRange=function(e,t){this._ranges.push(e),t||e._select(),this.rangeCount=this._ranges.length},this.removeAllRanges=function(){this._ranges=[],this.rangeCount=0};var t=function(){var t=e.document.selection.createRange(),n=e.document.selection.type.toUpperCase();return new s("CONTROL"==n?i.decomposeControlRange(t):i.decomposeTextRange(t))};this.getRangeAt=function(e){return this._ranges[e]},this._getCurrentSelection=function(){this.removeAllRanges();var e=t();e?(this.addRange(e,!0),this.isCollapsed=e.collapsed):this.isCollapsed=!0}},decomposeControlRange:function(e){var t=e.item(0),n=e.item(e.length-1),i=t.parentNode,s=n.parentNode;return[i,o.getIndex(t,i).o[0],s,o.getIndex(n,s).o[0]+1]},getEndPoint:function(t,n){var i=t.duplicate();i.collapse(!n);var s,r,a,d="EndTo"+(n?"End":"Start"),c=i.parentElement();if(c.childNodes.length>0?e.every(c.childNodes,function(e,n){var l;if(3!=e.nodeType){if(i.moveToElementText(e),i.compareEndPoints(d,t)>0){if(!a||3!=a.nodeType)return s=c,r=n,!1;s=a,l=!0}else if(n==c.childNodes.length-1)return s=c,r=c.childNodes.length,!1}else n==c.childNodes.length-1&&(s=e,l=!0);if(l&&s){var h=o.adjacentNoneTextNode(s)[0];s=h?h.nextSibling:c.firstChild;var u=o.adjacentNoneTextNode(s);h=u[0];var f=u[1];return h?(i.moveToElementText(h),i.collapse(!1)):i.moveToElementText(c),i.setEndPoint(d,t),r=i.text.length-f,!1}return a=e,!0}):(s=c,r=0),!n&&1==s.nodeType&&r==s.childNodes.length){var l=s.nextSibling;l&&3==l.nodeType&&(s=l,r=0)}return[s,r]},setEndPoint:function(e,t,n){var i,s,r=e.duplicate();if(3!=t.nodeType)if(n>0){if(i=t.childNodes[n-1])if(3==i.nodeType)t=i,n=i.length;else if(i.nextSibling&&3==i.nextSibling.nodeType)t=i.nextSibling,n=0;else{r.moveToElementText(i.nextSibling?i:t);var a=i.parentNode,d=a.insertBefore(i.ownerDocument.createTextNode(" "),i.nextSibling);r.collapse(!1),a.removeChild(d)}}else r.moveToElementText(t),r.collapse(!0);if(3==t.nodeType){var c=o.adjacentNoneTextNode(t),l=c[0];s=c[1],l?(r.moveToElementText(l),r.collapse(!1),"inherit"!=l.contentEditable&&s++):(r.moveToElementText(t.parentNode),r.collapse(!0),r.move("character",1),r.move("character",-1)),n+=s,n>0&&r.move("character",n)}return r},decomposeTextRange:function(e){var t=i.getEndPoint(e),n=t[0],o=t[1],s=t[0],r=t[1];return e.htmlText.length&&(e.htmlText==e.text?r=o+e.text.length:(t=i.getEndPoint(e,!0),s=t[0],r=t[1])),[n,o,s,r]},setRange:function(e,t,n,o,s,r){var a=i.setEndPoint(e,t,n);if(e.setEndPoint("StartToStart",a),!r)var d=i.setEndPoint(e,o,s);return e.setEndPoint("EndToEnd",d||a),e}},s=o.W3CRange=t(null,{constructor:function(){arguments.length>0?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.commonAncestorContainer=null,this.startContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.startContainer!==this.endContainer?this.commonAncestorContainer=o.getCommonAncestor(this.startContainer,this.endContainer):this.commonAncestorContainer=this.startContainer,this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(e,t){t=parseInt(t),this.startContainer===e&&this.startOffset==t||(delete this._cachedBookmark,this.startContainer=e,this.startOffset=t,this.endContainer?this._updateInternal():this.setEnd(e,t))},setEnd:function(e,t){t=parseInt(t),this.endContainer===e&&this.endOffset==t||(delete this._cachedBookmark,this.endContainer=e,this.endOffset=t,this.startContainer?this._updateInternal():this.setStart(e,t))},setStartAfter:function(e,t){this._setPoint("setStart",e,t,1)},setStartBefore:function(e,t){this._setPoint("setStart",e,t,0)},setEndAfter:function(e,t){this._setPoint("setEnd",e,t,1)},setEndBefore:function(e,t){this._setPoint("setEnd",e,t,0)},_setPoint:function(e,t,n,i){var s=o.getIndex(t,t.parentNode).o;this[e](t.parentNode,s.pop()+i)},_getIERange:function(){var e=(this._body||this.endContainer.ownerDocument.body).createTextRange();return i.setRange(e,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed),e},getBookmark:function(){return this._getIERange(),this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var e=this.startContainer,t=this._getIERange();3!==e.nodeType||this.startOffset||this.setStartBefore(e),t.pasteHTML(""),this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.collapsed=!0},cloneRange:function(){var e=new s([this.startContainer,this.startOffset,this.endContainer,this.endOffset]);return e._body=this._body,e},detach:function(){this._body=null,this.commonAncestorContainer=null,this.startContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0}});return n.setObject("dijit.range",o),o});//# sourceMappingURL=range.js.map