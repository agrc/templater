//>>built
define("dijit/_editor/plugins/FullScreen",["dojo/aspect","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/i18n","dojo/keys","dojo/_base/lang","dojo/on","dojo/sniff","dojo/_base/window","dojo/window","../../focus","../_Plugin","../../form/ToggleButton","../../registry","dojo/i18n!../nls/commands"],function(e,t,o,i,n,r,a,s,l,d,c,h,u,f,p,g){var m=t("dijit._editor.plugins.FullScreen",f,{zIndex:500,_origState:null,_origiFrameState:null,_resizeHandle:null,isFullscreen:!1,toggle:function(){this.button.set("checked",!this.button.get("checked"))},_initButton:function(){var e=r.getLocalization("dijit._editor","commands"),t=this.editor;this.button=new p({label:e.fullScreen,ownerDocument:t.ownerDocument,dir:t.dir,lang:t.lang,showLabel:!1,iconClass:this.iconClassPrefix+" "+this.iconClassPrefix+"FullScreen",tabIndex:"-1",onChange:s.hitch(this,"_setFullScreen")})},setEditor:function(e){this.editor=e,this._initButton(),this.editor.addKeyHandler(a.F11,!0,!0,s.hitch(this,function(e){return this.toggle(),e.stopPropagation(),e.preventDefault(),this.editor.defer("focus",250),!0})),this.own(l(this.editor.domNode,"keydown",s.hitch(this,"_containFocus")))},_containFocus:function(e){if(this.isFullscreen){var t=this.editor;if(!t.isTabIndent&&t._fullscreen_oldOnKeyDown&&e.keyCode===a.TAB){var o=u.curNode,i=this._getAltViewNode();o==t.iframe||i&&o===i?setTimeout(s.hitch(this,function(){t.toolbar.focus()}),10):i&&"none"===n.get(t.iframe,"display")?setTimeout(s.hitch(this,function(){u.focus(i)}),10):setTimeout(s.hitch(this,function(){t.focus()}),10),event.stopPropagation(),event.preventDefault()}else t._fullscreen_oldOnKeyDown&&t._fullscreen_oldOnKeyDown(e)}},_resizeEditor:function(){var e=h.getBox(this.editor.ownerDocument);i.setMarginBox(this.editor.domNode,{w:e.w,h:e.h});var t=this.editor.getHeaderHeight(),o=this.editor.getFooterHeight(),n=i.getPadBorderExtents(this.editor.domNode),r=i.getPadBorderExtents(this.editor.iframe.parentNode),a=i.getMarginExtents(this.editor.iframe.parentNode),s=e.h-(t+n.h+o);i.setMarginBox(this.editor.iframe.parentNode,{h:s,w:e.w}),i.setMarginBox(this.editor.iframe,{h:s-(r.h+a.h)})},_getAltViewNode:function(){},_setFullScreen:function(t){var r=this.editor,a=r.ownerDocumentBody,c=r.domNode.parentNode,u=h.getBox(r.ownerDocument);if(this.isFullscreen=t,t){for(;c&&c!==a;)o.add(c,"dijitForceStatic"),c=c.parentNode;this._editorResizeHolder=this.editor.resize,r.resize=function(){},r._fullscreen_oldOnKeyDown=r.onKeyDown,r.onKeyDown=s.hitch(this,this._containFocus),this._origState={},this._origiFrameState={};var f=r.domNode,p=f&&f.style||{};this._origState={width:p.width||"",height:p.height||"",top:n.get(f,"top")||"",left:n.get(f,"left")||"",position:n.get(f,"position")||"static",marginBox:i.getMarginBox(r.domNode)};var m=r.iframe,_=m&&m.style||{},y=n.get(r.iframe,"backgroundColor");if(this._origiFrameState={backgroundColor:y||"transparent",width:_.width||"auto",height:_.height||"auto",zIndex:_.zIndex||""},n.set(r.domNode,{position:"absolute",top:"0px",left:"0px",zIndex:this.zIndex,width:u.w+"px",height:u.h+"px"}),n.set(r.iframe,{height:"100%",width:"100%",zIndex:this.zIndex,backgroundColor:"transparent"!==y&&"rgba(0, 0, 0, 0)"!==y?y:"white"}),n.set(r.iframe.parentNode,{height:"95%",width:"100%"}),a.style&&a.style.overflow?this._oldOverflow=n.get(a,"overflow"):this._oldOverflow="",d("ie")&&!d("quirks")){if(a.parentNode&&a.parentNode.style&&a.parentNode.style.overflow)this._oldBodyParentOverflow=a.parentNode.style.overflow;else try{this._oldBodyParentOverflow=n.get(a.parentNode,"overflow")}catch(v){this._oldBodyParentOverflow="scroll"}n.set(a.parentNode,"overflow","hidden")}n.set(a,"overflow","hidden");var D=function(){var e=h.getBox(r.ownerDocument);if("_prevW"in this&&"_prevH"in this){if(e.w===this._prevW&&e.h===this._prevH)return}else this._prevW=e.w,this._prevH=e.h;this._resizer&&(clearTimeout(this._resizer),delete this._resizer),this._resizer=setTimeout(s.hitch(this,function(){delete this._resizer,this._resizeEditor()}),10)};this._resizeHandle=l(window,"resize",s.hitch(this,D)),this._resizeHandle2=e.after(r,"onResize",s.hitch(this,function(){this._resizer&&(clearTimeout(this._resizer),delete this._resizer),this._resizer=setTimeout(s.hitch(this,function(){delete this._resizer,this._resizeEditor()}),10)})),this._resizeEditor();var w=this.editor.toolbar.domNode;setTimeout(function(){h.scrollIntoView(w)},250)}else{for(this._resizeHandle&&(this._resizeHandle.remove(),this._resizeHandle=null),this._resizeHandle2&&(this._resizeHandle2.remove(),this._resizeHandle2=null),this._rst&&(clearTimeout(this._rst),this._rst=null);c&&c!==a;)o.remove(c,"dijitForceStatic"),c=c.parentNode;if(this._editorResizeHolder&&(this.editor.resize=this._editorResizeHolder),!this._origState&&!this._origiFrameState)return;r._fullscreen_oldOnKeyDown&&(r.onKeyDown=r._fullscreen_oldOnKeyDown,delete r._fullscreen_oldOnKeyDown);var b=this;setTimeout(function(){var e=b._origState.marginBox,t=b._origState.height;d("ie")&&!d("quirks")&&(a.parentNode.style.overflow=b._oldBodyParentOverflow,delete b._oldBodyParentOverflow),n.set(a,"overflow",b._oldOverflow),delete b._oldOverflow,n.set(r.domNode,b._origState),n.set(r.iframe.parentNode,{height:"",width:""}),n.set(r.iframe,b._origiFrameState),delete b._origState,delete b._origiFrameState;var o=g.getEnclosingWidget(r.domNode.parentNode);o&&o.resize?o.resize():(!t||t.indexOf("%")<0)&&setTimeout(s.hitch(this,function(){r.resize({h:e.h})}),0),h.scrollIntoView(b.editor.toolbar.domNode)},100)}},updateState:function(){this.button.set("disabled",this.get("disabled"))},destroy:function(){this._resizeHandle&&(this._resizeHandle.remove(),this._resizeHandle=null),this._resizeHandle2&&(this._resizeHandle2.remove(),this._resizeHandle2=null),this._resizer&&(clearTimeout(this._resizer),this._resizer=null),this.inherited(arguments)}});return f.registry.fullScreen=f.registry.fullscreen=function(e){return new m({zIndex:"zIndex"in e?e.zIndex:500})},m});//# sourceMappingURL=FullScreen.js.map