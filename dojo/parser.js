//>>built
define("dojo/parser",["require","./_base/kernel","./_base/lang","./_base/array","./_base/config","./dom","./_base/window","./_base/url","./aspect","./promise/all","./date/stamp","./Deferred","./has","./query","./on","./ready"],function(require,dojo,dlang,darray,config,dom,dwindow,_Url,aspect,all,dates,Deferred,has,query,don,ready){function myEval(text){return eval("("+text+")")}function getNameMap(e){var t=e._nameCaseMap,i=e.prototype;if(!t||t._extendCnt<extendCnt){t=e._nameCaseMap={};for(var n in i)"_"!==n.charAt(0)&&(t[n.toLowerCase()]=n);t._extendCnt=extendCnt}return t}function getCtor(e,t){var i=e.join();if(!_ctorMap[i]){for(var n=[],o=0,r=e.length;r>o;o++){var a=e[o];n[n.length]=_ctorMap[a]=_ctorMap[a]||dlang.getObject(a)||~a.indexOf("/")&&(t?t(a):require(a))}var s=n.shift();_ctorMap[i]=n.length?s.createSubclass?s.createSubclass(n):s.extend.apply(s,n):s}return _ctorMap[i]}new Date("X");var extendCnt=0;aspect.after(dlang,"extend",function(){extendCnt++},!0);var _ctorMap={},parser={_clearCache:function(){extendCnt++,_ctorMap={}},_functionFromScript:function(e,t){var i="",n="",o=e.getAttribute(t+"args")||e.getAttribute("args"),r=e.getAttribute("with"),a=(o||"").split(/\s*,\s*/);return r&&r.length&&darray.forEach(r.split(/\s*,\s*/),function(e){i+="with("+e+"){",n+="}"}),new Function(a,i+e.innerHTML+n)},instantiate:function(e,t,i){t=t||{},i=i||{};var n=(i.scope||dojo._scopeName)+"Type",o="data-"+(i.scope||dojo._scopeName)+"-",r=o+"type",a=o+"mixins",s=[];return darray.forEach(e,function(e){var i=n in t?t[n]:e.getAttribute(r)||e.getAttribute(n);if(i){var o=e.getAttribute(a),d=o?[i].concat(o.split(/\s*,\s*/)):[i];s.push({node:e,types:d})}}),this._instantiate(s,t,i)},_instantiate:function(e,t,i,n){function o(e){return t._started||i.noStart||darray.forEach(e,function(e){"function"!=typeof e.startup||e._started||e.startup()}),e}var r=darray.map(e,function(e){var n=e.ctor||getCtor(e.types,i.contextRequire);if(!n)throw new Error("Unable to resolve constructor for: '"+e.types.join()+"'");return this.construct(n,e.node,t,i,e.scripts,e.inherited)},this);return n?all(r).then(o):o(r)},construct:function(e,t,i,n,o,r){function a(e){for(m&&dlang.setObject(m,e),v=0;v<T.length;v++)aspect[T[v].advice||"after"](e,T[v].method,dlang.hitch(e,T[v].func),!0);for(v=0;v<L.length;v++)L[v].call(e);for(v=0;v<B.length;v++)e.watch(B[v].prop,B[v].func);for(v=0;v<A.length;v++)don(e,A[v].event,A[v].func);return e}var s=e&&e.prototype;n=n||{};var d={};n.defaults&&dlang.mixin(d,n.defaults),r&&dlang.mixin(d,r);var l;if(has("dom-attributes-explicit"))l=t.attributes;else if(has("dom-attributes-specified-flag"))l=darray.filter(t.attributes,function(e){return e.specified});else{var u=/^input$|^img$/i.test(t.nodeName)?t:t.cloneNode(!1),h=u.outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,"");l=darray.map(h.split(/\s+/),function(e){var i=e.toLowerCase();return{name:e,value:"LI"==t.nodeName&&"value"==e||"enctype"==i?t.getAttribute(i):t.getAttributeNode(i).value}})}var c=n.scope||dojo._scopeName,f="data-"+c+"-",p={};"dojo"!==c&&(p[f+"props"]="data-dojo-props",p[f+"type"]="data-dojo-type",p[f+"mixins"]="data-dojo-mixins",p[c+"type"]="dojoType",p[f+"id"]="data-dojo-id");for(var g,m,b,v=0,y=[];g=l[v++];){var _=g.name,j=_.toLowerCase(),x=g.value;switch(p[j]||j){case"data-dojo-type":case"dojotype":case"data-dojo-mixins":break;case"data-dojo-props":b=x;break;case"data-dojo-id":case"jsid":m=x;break;case"data-dojo-attach-point":case"dojoattachpoint":d.dojoAttachPoint=x;break;case"data-dojo-attach-event":case"dojoattachevent":d.dojoAttachEvent=x;break;case"class":d["class"]=t.className;break;case"style":d.style=t.style&&t.style.cssText;break;default:if(!(_ in s)){var w=getNameMap(e);_=w[j]||_}if(_ in s)switch(typeof s[_]){case"string":d[_]=x;break;case"number":d[_]=x.length?Number(x):NaN;break;case"boolean":d[_]="false"!=x.toLowerCase();break;case"function":""===x||-1!=x.search(/[^\w\.]+/i)?d[_]=new Function(x):d[_]=dlang.getObject(x,!1)||new Function(x),y.push(_);break;default:var C=s[_];d[_]=C&&"length"in C?x?x.split(/\s*,\s*/):[]:C instanceof Date?""==x?new Date(""):"now"==x?new Date:dates.fromISOString(x):C instanceof _Url?dojo.baseUrl+x:myEval(x)}else d[_]=x}}for(var k=0;k<y.length;k++){var S=y[k].toLowerCase();t.removeAttribute(S),t[S]=null}if(b)try{b=myEval.call(n.propsThis,"{"+b+"}"),dlang.mixin(d,b)}catch(N){throw new Error(N.toString()+" in data-dojo-props='"+b+"'")}dlang.mixin(d,i),o||(o=e&&(e._noScript||s._noScript)?[]:query("> script[type^='dojo/']",t));var T=[],L=[],B=[],A=[];if(o)for(v=0;v<o.length;v++){var I=o[v];t.removeChild(I);var D=I.getAttribute(f+"event")||I.getAttribute("event"),z=I.getAttribute(f+"prop"),P=I.getAttribute(f+"method"),M=I.getAttribute(f+"advice"),H=I.getAttribute("type"),E=this._functionFromScript(I,f);D?"dojo/connect"==H?T.push({method:D,func:E}):"dojo/on"==H?A.push({event:D,func:E}):d[D]=E:"dojo/aspect"==H?T.push({method:P,advice:M,func:E}):"dojo/watch"==H?B.push({prop:z,func:E}):L.push(E)}var R=e.markupFactory||s.markupFactory,O=R?R(d,t,e):new e(d,t);return O.then?O.then(a):a(O)},scan:function(e,t){function i(e,t){return e.getAttribute&&e.getAttribute(t)||e.parentNode&&i(e.parentNode,t)}function n(e){if(!e.inherited){e.inherited={};var t=e.node,i=n(e.parent),o={dir:t.getAttribute("dir")||i.dir,lang:t.getAttribute("lang")||i.lang,textDir:t.getAttribute(u)||i.textDir};for(var r in o)o[r]&&(e.inherited[r]=o[r])}return e.inherited}var o=[],r=[],a={},s=(t.scope||dojo._scopeName)+"Type",d="data-"+(t.scope||dojo._scopeName)+"-",l=d+"type",u=d+"textdir",h=d+"mixins",c=e.firstChild,f=t.inherited;if(!f){f={dir:i(e,"dir"),lang:i(e,"lang"),textDir:i(e,u)};for(var p in f)f[p]||delete f[p]}for(var g,m,b={inherited:f};;)if(c)if(1==c.nodeType)if(g&&"script"==c.nodeName.toLowerCase())v=c.getAttribute("type"),v&&/^dojo\/\w/i.test(v)&&g.push(c),c=c.nextSibling;else if(m)c=c.nextSibling;else{var v=c.getAttribute(l)||c.getAttribute(s),y=c.firstChild;if(v||y&&(3!=y.nodeType||y.nextSibling)){var _,j=null;if(v){var x=c.getAttribute(h),w=x?[v].concat(x.split(/\s*,\s*/)):[v];try{j=getCtor(w,t.contextRequire)}catch(C){}j||darray.forEach(w,function(e){~e.indexOf("/")&&!a[e]&&(a[e]=!0,r[r.length]=e)});var k=j&&!j.prototype._noScript?[]:null;_={types:w,ctor:j,parent:b,node:c,scripts:k},_.inherited=n(_),o.push(_)}else _={node:c,scripts:g,parent:b};g=k,m=c.stopParser||j&&j.prototype.stopParser&&!t.template,b=_,c=y}else c=c.nextSibling}else c=c.nextSibling;else{if(!b||!b.node)break;c=b.node.nextSibling,m=!1,b=b.parent,g=b.scripts}var S=new Deferred;if(r.length){has("dojo-debug-messages");var N=t.contextRequire||require;N(r,function(){S.resolve(darray.filter(o,function(e){if(!e.ctor)try{e.ctor=getCtor(e.types,t.contextRequire)}catch(i){}for(var n=e.parent;n&&!n.types;)n=n.parent;var o=e.ctor&&e.ctor.prototype;return e.instantiateChildren=!(o&&o.stopParser&&!t.template),e.instantiate=!n||n.instantiate&&n.instantiateChildren,e.instantiate}))})}else S.resolve(o);return S.promise},_require:function(e,t){var i=myEval("{"+e.innerHTML+"}"),n=[],o=[],r=new Deferred,a=t&&t.contextRequire||require;for(var s in i)n.push(s),o.push(i[s]);return a(o,function(){for(var e=0;e<n.length;e++)dlang.setObject(n[e],arguments[e]);r.resolve(arguments)}),r.promise},_scanAmd:function(e,t){var i=new Deferred,n=i.promise;i.resolve(!0);var o=this;return query("script[type='dojo/require']",e).forEach(function(e){n=n.then(function(){return o._require(e,t)}),e.parentNode.removeChild(e)}),n},parse:function(e,t){var i;!t&&e&&e.rootNode?(t=e,i=t.rootNode):!e||!dlang.isObject(e)||"nodeType"in e?i=e:t=e,i=i?dom.byId(i):dwindow.body(),t=t||{};var n=t.template?{template:!0}:{},o=[],r=this,a=this._scanAmd(i,t).then(function(){return r.scan(i,t)}).then(function(e){return r._instantiate(e,n,t,!0)}).then(function(e){return o=o.concat(e)}).otherwise(function(e){throw e});return dlang.mixin(o,a),o}};return dojo.parser=parser,config.parseOnLoad&&ready(100,parser,"parse"),parser});//# sourceMappingURL=parser.js.map