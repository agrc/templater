//>>built
define("dojo/parser",["require","./_base/kernel","./_base/lang","./_base/array","./_base/config","./dom","./_base/window","./_base/url","./aspect","./promise/all","./date/stamp","./Deferred","./has","./query","./on","./ready"],function(require,dojo,dlang,darray,config,dom,dwindow,_Url,aspect,all,dates,Deferred,has,query,don,ready){function myEval(text){return eval("("+text+")")}function getNameMap(e){var t=e._nameCaseMap,i=e.prototype;if(!t||t._extendCnt<extendCnt){t=e._nameCaseMap={};for(var n in i)"_"!==n.charAt(0)&&(t[n.toLowerCase()]=n);t._extendCnt=extendCnt}return t}function getCtor(e,t){t||(t=require);var i=t._dojoParserCtorMap||(t._dojoParserCtorMap={}),n=e.join();if(!i[n]){for(var o=[],r=0,s=e.length;r<s;r++){var a=e[r];o[o.length]=i[a]=i[a]||dlang.getObject(a)||~a.indexOf("/")&&t(a)}var d=o.shift();i[n]=o.length?d.createSubclass?d.createSubclass(o):d.extend.apply(d,o):d}return i[n]}new Date("X");var extendCnt=0;aspect.after(dlang,"extend",function(){extendCnt++},!0);var parser={_clearCache:function(){extendCnt++,_ctorMap={}},_functionFromScript:function(e,t){var i="",n="",o=e.getAttribute(t+"args")||e.getAttribute("args"),r=e.getAttribute("with"),s=(o||"").split(/\s*,\s*/);return r&&r.length&&darray.forEach(r.split(/\s*,\s*/),function(e){i+="with("+e+"){",n+="}"}),new Function(s,i+e.innerHTML+n)},instantiate:function(e,t,i){t=t||{},i=i||{};var n=(i.scope||dojo._scopeName)+"Type",o="data-"+(i.scope||dojo._scopeName)+"-",r=o+"type",s=o+"mixins",a=[];return darray.forEach(e,function(e){var i=n in t?t[n]:e.getAttribute(r)||e.getAttribute(n);if(i){var o=e.getAttribute(s),d=o?[i].concat(o.split(/\s*,\s*/)):[i];a.push({node:e,types:d})}}),this._instantiate(a,t,i)},_instantiate:function(e,t,i,n){function o(e){return t._started||i.noStart||darray.forEach(e,function(e){"function"!=typeof e.startup||e._started||e.startup()}),e}var r=darray.map(e,function(e){var n=e.ctor||getCtor(e.types,i.contextRequire);if(!n)throw new Error("Unable to resolve constructor for: '"+e.types.join()+"'");return this.construct(n,e.node,t,i,e.scripts,e.inherited)},this);return n?all(r).then(o):o(r)},construct:function(e,t,i,n,o,r){function s(e){for(m&&dlang.setObject(m,e),b=0;b<N.length;b++)aspect[N[b].advice||"after"](e,N[b].method,dlang.hitch(e,N[b].func),!0);for(b=0;b<S.length;b++)S[b].call(e);for(b=0;b<T.length;b++)e.watch(T[b].prop,T[b].func);for(b=0;b<E.length;b++)don(e,E[b].event,E[b].func);return e}var a=e&&e.prototype;n=n||{};var d={};n.defaults&&dlang.mixin(d,n.defaults),r&&dlang.mixin(d,r);var l;if(has("dom-attributes-explicit"))l=t.attributes;else if(has("dom-attributes-specified-flag"))l=darray.filter(t.attributes,function(e){return e.specified});else{var c=/^input$|^img$/i.test(t.nodeName)?t:t.cloneNode(!1),h=c.outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,"");l=darray.map(h.split(/\s+/),function(e){var i=e.toLowerCase();return{name:e,value:"LI"==t.nodeName&&"value"==e||"enctype"==i?t.getAttribute(i):t.getAttributeNode(i).value}})}var u=n.scope||dojo._scopeName,f="data-"+u+"-",p={};"dojo"!==u&&(p[f+"props"]="data-dojo-props",p[f+"type"]="data-dojo-type",p[f+"mixins"]="data-dojo-mixins",p[u+"type"]="dojotype",p[f+"id"]="data-dojo-id");for(var g,m,v,b=0,_=[];g=l[b++];){var y=g.name,j=y.toLowerCase(),x=g.value;switch(p[j]||j){case"data-dojo-type":case"dojotype":case"data-dojo-mixins":break;case"data-dojo-props":v=x;break;case"data-dojo-id":case"jsid":m=x;break;case"data-dojo-attach-point":case"dojoattachpoint":d.dojoAttachPoint=x;break;case"data-dojo-attach-event":case"dojoattachevent":d.dojoAttachEvent=x;break;case"class":d.class=t.className;break;case"style":d.style=t.style&&t.style.cssText;break;default:if(!(y in a)){y=getNameMap(e)[j]||y}if(y in a)switch(typeof a[y]){case"string":d[y]=x;break;case"number":d[y]=x.length?Number(x):NaN;break;case"boolean":d[y]="false"!=x.toLowerCase();break;case"function":""===x||-1!=x.search(/[^\w\.]+/i)?d[y]=new Function(x):d[y]=dlang.getObject(x,!1)||new Function(x),_.push(y);break;default:var C=a[y];d[y]=C&&"length"in C?x?x.split(/\s*,\s*/):[]:C instanceof Date?""==x?new Date(""):"now"==x?new Date:dates.fromISOString(x):C instanceof _Url?dojo.baseUrl+x:myEval(x)}else d[y]=x}}for(var k=0;k<_.length;k++){var w=_[k].toLowerCase();t.removeAttribute(w),t[w]=null}if(v)try{v=myEval.call(n.propsThis,"{"+v+"}"),dlang.mixin(d,v)}catch(e){throw new Error(e.toString()+" in data-dojo-props='"+v+"'")}dlang.mixin(d,i),o||(o=e&&(e._noScript||a._noScript)?[]:query("> script[type^='dojo/']",t));var N=[],S=[],T=[],E=[];if(o)for(b=0;b<o.length;b++){var A=o[b];t.removeChild(A);var B=A.getAttribute(f+"event")||A.getAttribute("event"),R=A.getAttribute(f+"prop"),M=A.getAttribute(f+"method"),D=A.getAttribute(f+"advice"),L=A.getAttribute("type"),P=this._functionFromScript(A,f);B?"dojo/connect"==L?N.push({method:B,func:P}):"dojo/on"==L?E.push({event:B,func:P}):d[B]=P:"dojo/aspect"==L?N.push({method:M,advice:D,func:P}):"dojo/watch"==L?T.push({prop:R,func:P}):S.push(P)}var I=e.markupFactory||a.markupFactory,O=I?I(d,t,e):new e(d,t);return O.then?O.then(s):s(O)},scan:function(e,t){function i(e,t){return e.getAttribute&&e.getAttribute(t)||e.parentNode&&i(e.parentNode,t)}function n(e){if(!e.inherited){e.inherited={};var t=e.node,i=n(e.parent),o={dir:t.getAttribute("dir")||i.dir,lang:t.getAttribute("lang")||i.lang,textDir:t.getAttribute(c)||i.textDir};for(var r in o)o[r]&&(e.inherited[r]=o[r])}return e.inherited}var o=[],r=[],s={},a=(t.scope||dojo._scopeName)+"Type",d="data-"+(t.scope||dojo._scopeName)+"-",l=d+"type",c=d+"textdir",h=d+"mixins",u=e.firstChild,f=t.inherited;if(!f){f={dir:i(e,"dir"),lang:i(e,"lang"),textDir:i(e,c)};for(var p in f)f[p]||delete f[p]}for(var g,m,v={inherited:f};;)if(u)if(1==u.nodeType)if(g&&"script"==u.nodeName.toLowerCase())b=u.getAttribute("type"),b&&/^dojo\/\w/i.test(b)&&g.push(u),u=u.nextSibling;else if(m)u=u.nextSibling;else{var b=u.getAttribute(l)||u.getAttribute(a),_=u.firstChild;if(b||_&&(3!=_.nodeType||_.nextSibling)){var y,j=null;if(b){var x=u.getAttribute(h),C=x?[b].concat(x.split(/\s*,\s*/)):[b];try{j=getCtor(C,t.contextRequire)}catch(e){}j||darray.forEach(C,function(e){~e.indexOf("/")&&!s[e]&&(s[e]=!0,r[r.length]=e)});var k=j&&!j.prototype._noScript?[]:null;y={types:C,ctor:j,parent:v,node:u,scripts:k},y.inherited=n(y),o.push(y)}else y={node:u,scripts:g,parent:v};g=k,m=u.stopParser||j&&j.prototype.stopParser&&!t.template,v=y,u=_}else u=u.nextSibling}else u=u.nextSibling;else{if(!v||!v.node)break;u=v.node.nextSibling,m=!1,v=v.parent,g=v.scripts}var w=new Deferred;if(r.length){has("dojo-debug-messages");(t.contextRequire||require)(r,function(){w.resolve(darray.filter(o,function(e){if(!e.ctor)try{e.ctor=getCtor(e.types,t.contextRequire)}catch(e){}for(var i=e.parent;i&&!i.types;)i=i.parent;var n=e.ctor&&e.ctor.prototype;return e.instantiateChildren=!(n&&n.stopParser&&!t.template),e.instantiate=!i||i.instantiate&&i.instantiateChildren,e.instantiate}))})}else w.resolve(o);return w.promise},_require:function(e,t){var i=myEval("{"+e.innerHTML+"}"),n=[],o=[],r=new Deferred,s=t&&t.contextRequire||require;for(var a in i)n.push(a),o.push(i[a]);return s(o,function(){for(var e=0;e<n.length;e++)dlang.setObject(n[e],arguments[e]);r.resolve(arguments)}),r.promise},_scanAmd:function(e,t){var i=new Deferred,n=i.promise;i.resolve(!0);var o=this;return query("script[type='dojo/require']",e).forEach(function(e){n=n.then(function(){return o._require(e,t)}),e.parentNode.removeChild(e)}),n},parse:function(e,t){!e||"string"==typeof e||"nodeType"in e||(t=e,e=t.rootNode);var i=e?dom.byId(e):dwindow.body();t=t||{};var n=t.template?{template:!0}:{},o=[],r=this,s=this._scanAmd(i,t).then(function(){return r.scan(i,t)}).then(function(e){return r._instantiate(e,n,t,!0)}).then(function(e){return o=o.concat(e)}).otherwise(function(e){throw e});return dlang.mixin(o,s),o}};return dojo.parser=parser,config.parseOnLoad&&ready(100,parser,"parse"),parser});//# sourceMappingURL=parser.js.map