//>>built
define("dojo/parser",["require","./_base/kernel","./_base/lang","./_base/array","./_base/config","./dom","./_base/window","./_base/url","./aspect","./promise/all","./date/stamp","./Deferred","./has","./query","./on","./ready"],function(require,dojo,dlang,darray,config,dom,dwindow,_Url,aspect,all,dates,Deferred,has,query,don,ready){function myEval(text){return eval("("+text+")")}function getNameMap(e){var t=e._nameCaseMap,i=e.prototype;if(!t||t._extendCnt<extendCnt){t=e._nameCaseMap={};for(var n in i)"_"!==n.charAt(0)&&(t[n.toLowerCase()]=n);t._extendCnt=extendCnt}return t}function getCtor(e,t){t||(t=require);var i=t._dojoParserCtorMap||(t._dojoParserCtorMap={}),n=e.join();if(!i[n]){for(var o=[],r=0,a=e.length;r<a;r++){var s=e[r];o[o.length]=i[s]=i[s]||dlang.getObject(s)||~s.indexOf("/")&&t(s)}var d=o.shift();i[n]=o.length?d.createSubclass?d.createSubclass(o):d.extend.apply(d,o):d}return i[n]}new Date("X");var extendCnt=0;aspect.after(dlang,"extend",function(){extendCnt++},!0);var parser={_clearCache:function(){extendCnt++,_ctorMap={}},_functionFromScript:function(e,t){var i="",n="",o=e.getAttribute(t+"args")||e.getAttribute("args"),r=e.getAttribute("with"),a=(o||"").split(/\s*,\s*/);return r&&r.length&&darray.forEach(r.split(/\s*,\s*/),function(e){i+="with("+e+"){",n+="}"}),new Function(a,i+e.innerHTML+n)},instantiate:function(e,t,i){t=t||{},i=i||{};var n=(i.scope||dojo._scopeName)+"Type",o="data-"+(i.scope||dojo._scopeName)+"-",r=o+"type",a=o+"mixins",s=[];return darray.forEach(e,function(e){var i=n in t?t[n]:e.getAttribute(r)||e.getAttribute(n);if(i){var o=e.getAttribute(a),d=o?[i].concat(o.split(/\s*,\s*/)):[i];s.push({node:e,types:d})}}),this._instantiate(s,t,i)},_instantiate:function(e,t,i,n){function o(e){return t._started||i.noStart||darray.forEach(e,function(e){"function"!=typeof e.startup||e._started||e.startup()}),e}var r=darray.map(e,function(e){var n=e.ctor||getCtor(e.types,i.contextRequire);if(!n)throw new Error("Unable to resolve constructor for: '"+e.types.join()+"'");return this.construct(n,e.node,t,i,e.scripts,e.inherited)},this);return n?all(r).then(o):o(r)},construct:function(e,t,i,n,o,r){function a(e){for(m&&dlang.setObject(m,e),b=0;b<N.length;b++)aspect[N[b].advice||"after"](e,N[b].method,dlang.hitch(e,N[b].func),!0);for(b=0;b<S.length;b++)S[b].call(e);for(b=0;b<T.length;b++)e.watch(T[b].prop,T[b].func);for(b=0;b<R.length;b++)don(e,R[b].event,R[b].func);return e}var s=e&&e.prototype;n=n||{};var d={};n.defaults&&dlang.mixin(d,n.defaults),r&&dlang.mixin(d,r);var l;if(has("dom-attributes-explicit"))l=t.attributes;else if(has("dom-attributes-specified-flag"))l=darray.filter(t.attributes,function(e){return e.specified});else{var c=/^input$|^img$/i.test(t.nodeName)?t:t.cloneNode(!1),h=c.outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,"");l=darray.map(h.split(/\s+/),function(e){var i=e.toLowerCase();return{name:e,value:"LI"==t.nodeName&&"value"==e||"enctype"==i?t.getAttribute(i):t.getAttributeNode(i).value}})}var u=n.scope||dojo._scopeName,f="data-"+u+"-",p={};"dojo"!==u&&(p[f+"props"]="data-dojo-props",p[f+"type"]="data-dojo-type",p[f+"mixins"]="data-dojo-mixins",p[u+"type"]="dojotype",p[f+"id"]="data-dojo-id");for(var g,m,v,b=0,y=[];g=l[b++];){var _=g.name,j=_.toLowerCase(),C=g.value;switch(p[j]||j){case"data-dojo-type":case"dojotype":case"data-dojo-mixins":break;case"data-dojo-props":v=C;break;case"data-dojo-id":case"jsid":m=C;break;case"data-dojo-attach-point":case"dojoattachpoint":d.dojoAttachPoint=C;break;case"data-dojo-attach-event":case"dojoattachevent":d.dojoAttachEvent=C;break;case"class":d.class=t.className;break;case"style":d.style=t.style&&t.style.cssText;break;default:if(!(_ in s)){_=getNameMap(e)[j]||_}if(_ in s)switch(typeof s[_]){case"string":d[_]=C;break;case"number":d[_]=C.length?Number(C):NaN;break;case"boolean":d[_]="false"!=C.toLowerCase();break;case"function":""===C||-1!=C.search(/[^\w\.]+/i)?d[_]=new Function(C):d[_]=dlang.getObject(C,!1)||new Function(C),y.push(_);break;default:var k=s[_];d[_]=k&&"length"in k?C?C.split(/\s*,\s*/):[]:k instanceof Date?""==C?new Date(""):"now"==C?new Date:dates.fromISOString(C):k instanceof _Url?dojo.baseUrl+C:myEval(C)}else d[_]=C}}for(var x=0;x<y.length;x++){var w=y[x].toLowerCase();t.removeAttribute(w),t[w]=null}if(v)try{v=myEval.call(n.propsThis,"{"+v+"}"),dlang.mixin(d,v)}catch(e){throw new Error(e.toString()+" in data-dojo-props='"+v+"'")}dlang.mixin(d,i),o||(o=e&&(e._noScript||s._noScript)?[]:query("> script[type^='dojo/']",t));var N=[],S=[],T=[],R=[];if(o)for(b=0;b<o.length;b++){var A=o[b];t.removeChild(A);var B=A.getAttribute(f+"event")||A.getAttribute("event"),M=A.getAttribute(f+"prop"),L=A.getAttribute(f+"method"),E=A.getAttribute(f+"advice"),P=A.getAttribute("type"),D=this._functionFromScript(A,f);B?"dojo/connect"==P?N.push({method:B,func:D}):"dojo/on"==P?R.push({event:B,func:D}):d[B]=D:"dojo/aspect"==P?N.push({method:L,advice:E,func:D}):"dojo/watch"==P?T.push({prop:M,func:D}):S.push(D)}var O=e.markupFactory||s.markupFactory,I=O?O(d,t,e):new e(d,t);return I.then?I.then(a):a(I)},scan:function(e,t){function i(e,t){return e.getAttribute&&e.getAttribute(t)||e.parentNode&&i(e.parentNode,t)}function n(e){if(!e.inherited){e.inherited={};var t=e.node,i=n(e.parent),o={dir:t.getAttribute("dir")||i.dir,lang:t.getAttribute("lang")||i.lang,textDir:t.getAttribute(c)||i.textDir};for(var r in o)o[r]&&(e.inherited[r]=o[r])}return e.inherited}var o=[],r=[],a={},s=(t.scope||dojo._scopeName)+"Type",d="data-"+(t.scope||dojo._scopeName)+"-",l=d+"type",c=d+"textdir",h=d+"mixins",u=e.firstChild,f=t.inherited;if(!f){f={dir:i(e,"dir"),lang:i(e,"lang"),textDir:i(e,c)};for(var p in f)f[p]||delete f[p]}for(var g,m,v={inherited:f};;)if(u)if(1==u.nodeType)if(g&&"script"==u.nodeName.toLowerCase())b=u.getAttribute("type"),b&&/^dojo\/\w/i.test(b)&&g.push(u),u=u.nextSibling;else if(m)u=u.nextSibling;else{var b=u.getAttribute(l)||u.getAttribute(s),y=u.firstChild;if(b||y&&(3!=y.nodeType||y.nextSibling)){var _,j=null;if(b){var C=u.getAttribute(h),k=C?[b].concat(C.split(/\s*,\s*/)):[b];try{j=getCtor(k,t.contextRequire)}catch(e){}j||darray.forEach(k,function(e){~e.indexOf("/")&&!a[e]&&(a[e]=!0,r[r.length]=e)});var x=j&&!j.prototype._noScript?[]:null;_={types:k,ctor:j,parent:v,node:u,scripts:x},_.inherited=n(_),o.push(_)}else _={node:u,scripts:g,parent:v};g=x,m=u.stopParser||j&&j.prototype.stopParser&&!t.template,v=_,u=y}else u=u.nextSibling}else u=u.nextSibling;else{if(!v||!v.node)break;u=v.node.nextSibling,m=!1,v=v.parent,g=v.scripts}var w=new Deferred;if(r.length){has("dojo-debug-messages");(t.contextRequire||require)(r,function(){w.resolve(darray.filter(o,function(e){if(!e.ctor)try{e.ctor=getCtor(e.types,t.contextRequire)}catch(e){}for(var i=e.parent;i&&!i.types;)i=i.parent;var n=e.ctor&&e.ctor.prototype;return e.instantiateChildren=!(n&&n.stopParser&&!t.template),e.instantiate=!i||i.instantiate&&i.instantiateChildren,e.instantiate}))})}else w.resolve(o);return w.promise},_require:function(e,t){var i=myEval("{"+e.innerHTML+"}"),n=[],o=[],r=new Deferred,a=t&&t.contextRequire||require;for(var s in i)n.push(s),o.push(i[s]);return a(o,function(){for(var e=0;e<n.length;e++)dlang.setObject(n[e],arguments[e]);r.resolve(arguments)}),r.promise},_scanAmd:function(e,t){var i=new Deferred,n=i.promise;i.resolve(!0);var o=this;return query("script[type='dojo/require']",e).forEach(function(e){n=n.then(function(){return o._require(e,t)}),e.parentNode.removeChild(e)}),n},parse:function(e,t){!e||"string"==typeof e||"nodeType"in e||(t=e,e=t.rootNode);var i=e?dom.byId(e):dwindow.body();t=t||{};var n=t.template?{template:!0}:{},o=[],r=this,a=this._scanAmd(i,t).then(function(){return r.scan(i,t)}).then(function(e){return r._instantiate(e,n,t,!0)}).then(function(e){return o=o.concat(e)}).otherwise(function(e){throw e});return dlang.mixin(o,a),o}};return dojo.parser=parser,config.parseOnLoad&&ready(100,parser,"parse"),parser});//# sourceMappingURL=parser.js.map