//>>built
define("dojo/parser",["require","./_base/kernel","./_base/lang","./_base/array","./_base/config","./dom","./_base/window","./_base/url","./aspect","./promise/all","./date/stamp","./Deferred","./has","./query","./on","./ready"],function(require,dojo,dlang,darray,config,dom,dwindow,_Url,aspect,all,dates,Deferred,has,query,don,ready){function myEval(text){return eval("("+text+")")}function getNameMap(t){var e=t._nameCaseMap,i=t.prototype;if(!e||e._extendCnt<extendCnt){e=t._nameCaseMap={};for(var n in i)"_"!==n.charAt(0)&&(e[n.toLowerCase()]=n);e._extendCnt=extendCnt}return e}function getCtor(t,e){var i=t.join();if(!_ctorMap[i]){for(var n=[],o=0,r=t.length;r>o;o++){var a=t[o];n[n.length]=_ctorMap[a]=_ctorMap[a]||dlang.getObject(a)||~a.indexOf("/")&&(e?e(a):require(a))}var s=n.shift();_ctorMap[i]=n.length?s.createSubclass?s.createSubclass(n):s.extend.apply(s,n):s}return _ctorMap[i]}new Date("X");var extendCnt=0;aspect.after(dlang,"extend",function(){extendCnt++},!0);var _ctorMap={},parser={_clearCache:function(){extendCnt++,_ctorMap={}},_functionFromScript:function(t,e){var i="",n="",o=t.getAttribute(e+"args")||t.getAttribute("args"),r=t.getAttribute("with"),a=(o||"").split(/\s*,\s*/);return r&&r.length&&darray.forEach(r.split(/\s*,\s*/),function(t){i+="with("+t+"){",n+="}"}),new Function(a,i+t.innerHTML+n)},instantiate:function(t,e,i){e=e||{},i=i||{};var n=(i.scope||dojo._scopeName)+"Type",o="data-"+(i.scope||dojo._scopeName)+"-",r=o+"type",a=o+"mixins",s=[];return darray.forEach(t,function(t){var i=n in e?e[n]:t.getAttribute(r)||t.getAttribute(n);if(i){var o=t.getAttribute(a),d=o?[i].concat(o.split(/\s*,\s*/)):[i];s.push({node:t,types:d})}}),this._instantiate(s,e,i)},_instantiate:function(t,e,i,n){function o(t){return e._started||i.noStart||darray.forEach(t,function(t){"function"!=typeof t.startup||t._started||t.startup()}),t}var r=darray.map(t,function(t){var n=t.ctor||getCtor(t.types,i.contextRequire);if(!n)throw new Error("Unable to resolve constructor for: '"+t.types.join()+"'");return this.construct(n,t.node,e,i,t.scripts,t.inherited)},this);return n?all(r).then(o):o(r)},construct:function(t,e,i,n,o,r){function a(t){for(m&&dlang.setObject(m,t),v=0;v<T.length;v++)aspect[T[v].advice||"after"](t,T[v].method,dlang.hitch(t,T[v].func),!0);for(v=0;v<B.length;v++)B[v].call(t);for(v=0;v<A.length;v++)t.watch(A[v].prop,A[v].func);for(v=0;v<I.length;v++)don(t,I[v].event,I[v].func);return t}var s=t&&t.prototype;n=n||{};var d={};n.defaults&&dlang.mixin(d,n.defaults),r&&dlang.mixin(d,r);var l;if(has("dom-attributes-explicit"))l=e.attributes;else if(has("dom-attributes-specified-flag"))l=darray.filter(e.attributes,function(t){return t.specified});else{var u=/^input$|^img$/i.test(e.nodeName)?e:e.cloneNode(!1),h=u.outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,"");l=darray.map(h.split(/\s+/),function(t){var i=t.toLowerCase();return{name:t,value:"LI"==e.nodeName&&"value"==t||"enctype"==i?e.getAttribute(i):e.getAttributeNode(i).value}})}var c=n.scope||dojo._scopeName,f="data-"+c+"-",p={};"dojo"!==c&&(p[f+"props"]="data-dojo-props",p[f+"type"]="data-dojo-type",p[f+"mixins"]="data-dojo-mixins",p[c+"type"]="dojoType",p[f+"id"]="data-dojo-id");for(var g,m,b,v=0,y=[];g=l[v++];){var _=g.name,j=_.toLowerCase(),x=g.value;switch(p[j]||j){case"data-dojo-type":case"dojotype":case"data-dojo-mixins":break;case"data-dojo-props":b=x;break;case"data-dojo-id":case"jsid":m=x;break;case"data-dojo-attach-point":case"dojoattachpoint":d.dojoAttachPoint=x;break;case"data-dojo-attach-event":case"dojoattachevent":d.dojoAttachEvent=x;break;case"class":d["class"]=e.className;break;case"style":d.style=e.style&&e.style.cssText;break;default:if(!(_ in s)){var w=getNameMap(t);_=w[j]||_}if(_ in s)switch(typeof s[_]){case"string":d[_]=x;break;case"number":d[_]=x.length?Number(x):NaN;break;case"boolean":d[_]="false"!=x.toLowerCase();break;case"function":""===x||-1!=x.search(/[^\w\.]+/i)?d[_]=new Function(x):d[_]=dlang.getObject(x,!1)||new Function(x),y.push(_);break;default:var C=s[_];d[_]=C&&"length"in C?x?x.split(/\s*,\s*/):[]:C instanceof Date?""==x?new Date(""):"now"==x?new Date:dates.fromISOString(x):C instanceof _Url?dojo.baseUrl+x:myEval(x)}else d[_]=x}}for(var k=0;k<y.length;k++){var S=y[k].toLowerCase();e.removeAttribute(S),e[S]=null}if(b)try{b=myEval.call(n.propsThis,"{"+b+"}"),dlang.mixin(d,b)}catch(N){throw new Error(N.toString()+" in data-dojo-props='"+b+"'")}dlang.mixin(d,i),o||(o=t&&(t._noScript||s._noScript)?[]:query("> script[type^='dojo/']",e));var T=[],B=[],A=[],I=[];if(o)for(v=0;v<o.length;v++){var D=o[v];e.removeChild(D);var L=D.getAttribute(f+"event")||D.getAttribute("event"),M=D.getAttribute(f+"prop"),P=D.getAttribute(f+"method"),E=D.getAttribute(f+"advice"),O=D.getAttribute("type"),R=this._functionFromScript(D,f);L?"dojo/connect"==O?T.push({method:L,func:R}):"dojo/on"==O?I.push({event:L,func:R}):d[L]=R:"dojo/aspect"==O?T.push({method:P,advice:E,func:R}):"dojo/watch"==O?A.push({prop:M,func:R}):B.push(R)}var H=t.markupFactory||s.markupFactory,z=H?H(d,e,t):new t(d,e);return z.then?z.then(a):a(z)},scan:function(t,e){function i(t,e){return t.getAttribute&&t.getAttribute(e)||t.parentNode&&i(t.parentNode,e)}function n(t){if(!t.inherited){t.inherited={};var e=t.node,i=n(t.parent),o={dir:e.getAttribute("dir")||i.dir,lang:e.getAttribute("lang")||i.lang,textDir:e.getAttribute(u)||i.textDir};for(var r in o)o[r]&&(t.inherited[r]=o[r])}return t.inherited}var o=[],r=[],a={},s=(e.scope||dojo._scopeName)+"Type",d="data-"+(e.scope||dojo._scopeName)+"-",l=d+"type",u=d+"textdir",h=d+"mixins",c=t.firstChild,f=e.inherited;if(!f){f={dir:i(t,"dir"),lang:i(t,"lang"),textDir:i(t,u)};for(var p in f)f[p]||delete f[p]}for(var g,m,b={inherited:f};;)if(c)if(1==c.nodeType)if(g&&"script"==c.nodeName.toLowerCase())v=c.getAttribute("type"),v&&/^dojo\/\w/i.test(v)&&g.push(c),c=c.nextSibling;else if(m)c=c.nextSibling;else{var v=c.getAttribute(l)||c.getAttribute(s),y=c.firstChild;if(v||y&&(3!=y.nodeType||y.nextSibling)){var _,j=null;if(v){var x=c.getAttribute(h),w=x?[v].concat(x.split(/\s*,\s*/)):[v];try{j=getCtor(w,e.contextRequire)}catch(C){}j||darray.forEach(w,function(t){~t.indexOf("/")&&!a[t]&&(a[t]=!0,r[r.length]=t)});var k=j&&!j.prototype._noScript?[]:null;_={types:w,ctor:j,parent:b,node:c,scripts:k},_.inherited=n(_),o.push(_)}else _={node:c,scripts:g,parent:b};g=k,m=c.stopParser||j&&j.prototype.stopParser&&!e.template,b=_,c=y}else c=c.nextSibling}else c=c.nextSibling;else{if(!b||!b.node)break;c=b.node.nextSibling,m=!1,b=b.parent,g=b.scripts}var S=new Deferred;if(r.length){has("dojo-debug-messages");var N=e.contextRequire||require;N(r,function(){S.resolve(darray.filter(o,function(t){if(!t.ctor)try{t.ctor=getCtor(t.types,e.contextRequire)}catch(i){}for(var n=t.parent;n&&!n.types;)n=n.parent;var o=t.ctor&&t.ctor.prototype;return t.instantiateChildren=!(o&&o.stopParser&&!e.template),t.instantiate=!n||n.instantiate&&n.instantiateChildren,t.instantiate}))})}else S.resolve(o);return S.promise},_require:function(t,e){var i=myEval("{"+t.innerHTML+"}"),n=[],o=[],r=new Deferred,a=e&&e.contextRequire||require;for(var s in i)n.push(s),o.push(i[s]);return a(o,function(){for(var t=0;t<n.length;t++)dlang.setObject(n[t],arguments[t]);r.resolve(arguments)}),r.promise},_scanAmd:function(t,e){var i=new Deferred,n=i.promise;i.resolve(!0);var o=this;return query("script[type='dojo/require']",t).forEach(function(t){n=n.then(function(){return o._require(t,e)}),t.parentNode.removeChild(t)}),n},parse:function(t,e){var i;!e&&t&&t.rootNode?(e=t,i=e.rootNode):!t||!dlang.isObject(t)||"nodeType"in t?i=t:e=t,i=i?dom.byId(i):dwindow.body(),e=e||{};var n=e.template?{template:!0}:{},o=[],r=this,a=this._scanAmd(i,e).then(function(){return r.scan(i,e)}).then(function(t){return r._instantiate(t,n,e,!0)}).then(function(t){return o=o.concat(t)}).otherwise(function(t){throw t});return dlang.mixin(o,a),o}};return dojo.parser=parser,config.parseOnLoad&&ready(100,parser,"parse"),parser});//# sourceMappingURL=parser.js.map