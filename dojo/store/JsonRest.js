//>>built
define("dojo/store/JsonRest",["../_base/xhr","../_base/lang","../json","../_base/declare","./util/QueryResults"],function(e,t,a,i,r){var o=null;return i("dojo.store.JsonRest",o,{constructor:function(e){this.headers={},i.safeMixin(this,e)},headers:{},target:"",idProperty:"id",ascendingPrefix:"+",descendingPrefix:"-",_getTarget:function(e){var t=this.target;return"undefined"!=typeof e&&(t+="/"==t.charAt(t.length-1)||"="==t.charAt(t.length-1)?e:"/"+e),t},get:function(a,i){i=i||{};var r=t.mixin({Accept:this.accepts},this.headers,i.headers||i);return e("GET",{url:this._getTarget(a),handleAs:"json",headers:r})},accepts:"application/javascript, application/json",getIdentity:function(e){return e[this.idProperty]},put:function(i,r){r=r||{};var o="id"in r?r.id:this.getIdentity(i),d="undefined"!=typeof o;return e(d&&!r.incremental?"PUT":"POST",{url:this._getTarget(o),postData:a.stringify(i),handleAs:"json",headers:t.mixin({"Content-Type":"application/json",Accept:this.accepts,"If-Match":r.overwrite===!0?"*":null,"If-None-Match":r.overwrite===!1?"*":null},this.headers,r.headers)})},add:function(e,t){return t=t||{},t.overwrite=!1,this.put(e,t)},remove:function(a,i){return i=i||{},e("DELETE",{url:this._getTarget(a),headers:t.mixin({},this.headers,i.headers)})},query:function(a,i){i=i||{};var o=t.mixin({Accept:this.accepts},this.headers,i.headers),d=this.target.indexOf("?")>-1;if(a&&"object"==typeof a&&(a=e.objectToQuery(a),a=a?(d?"&":"?")+a:""),(i.start>=0||i.count>=0)&&(o["X-Range"]="items="+(i.start||"0")+"-"+("count"in i&&i.count!=1/0?i.count+(i.start||0)-1:""),this.rangeParam?(a+=(a||d?"&":"?")+this.rangeParam+"="+o["X-Range"],d=!0):o.Range=o["X-Range"]),i&&i.sort){var n=this.sortParam;a+=(a||d?"&":"?")+(n?n+"=":"sort(");for(var s=0;s<i.sort.length;s++){var l=i.sort[s];a+=(s>0?",":"")+(l.descending?this.descendingPrefix:this.ascendingPrefix)+encodeURIComponent(l.attribute)}n||(a+=")")}var m=e("GET",{url:this.target+(a||""),handleAs:"json",headers:o});return m.total=m.then(function(){var e=m.ioArgs.xhr.getResponseHeader("Content-Range");return e||(e=m.ioArgs.xhr.getResponseHeader("X-Content-Range")),e&&(e=e.match(/\/(.*)/))&&+e[1]}),r(m)}})});//# sourceMappingURL=JsonRest.js.map