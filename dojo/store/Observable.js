//>>built
define("dojo/store/Observable",["../_base/kernel","../_base/lang","../when","../_base/array"],function(e,t,a,i){var r=function(e){function r(t,i){var r=e[t];r&&(e[t]=function(d){var n;if("put"===t&&(n=e.getIdentity(d)),s)return r.apply(this,arguments);s=!0;try{var o=r.apply(this,arguments);return a(o,function(e){i("object"==typeof e&&e||d,n)}),o}finally{s=!1}})}var d,n=[],o=0;e=t.delegate(e),e.notify=function(e,t){o++;for(var a=n.slice(),i=0,r=a.length;i<r;i++)a[i](e,t)};var l=e.query;e.query=function(r,s){s=s||{};var m=l.apply(this,arguments);if(m&&m.forEach){var f=t.mixin({},s);delete f.start,delete f.count;var u,h=e.queryEngine&&e.queryEngine(r,f),y=o,c=[];m.observe=function(t,r){1==c.push(t)&&n.push(u=function(t,n){a(m,function(a){var l,m,f,u=a.length!=s.count;if(++y!=o)throw new Error("Query is out of date, you must observe() the query prior to any data modifications");var v,M=-1,g=-1;if(n!==d){var p=[].concat(a);for(h&&!t&&(p=h(a)),l=0,m=a.length;l<m;l++){var b=a[l];if(e.getIdentity(b)==n){if(p.indexOf(b)<0)continue;v=b,M=l,!h&&t||a.splice(l,1);break}}}if(h){if(t&&(h.matches?h.matches(t):h([t]).length)){var k=M>-1?M:a.length;a.splice(k,0,t),g=i.indexOf(h(a),t),a.splice(k,1),s.start&&0==g||!u&&g==a.length?g=-1:a.splice(g,0,t)}}else t&&(n!==d?g=M:s.start||(g=e.defaultIndex||0,a.splice(g,0,t)));if((M>-1||g>-1)&&(r||!h||M!=g)){var w=c.slice();for(l=0;f=w[l];l++)f(t||v,M,g)}})});var l={};return l.remove=l.cancel=function(){var e=i.indexOf(c,t);e>-1&&(c.splice(e,1),c.length||n.splice(i.indexOf(n,u),1))},l}}return m};var s;return r("put",function(t,a){e.notify(t,a)}),r("add",function(t){e.notify(t)}),r("remove",function(t){e.notify(void 0,t)}),e};return t.setObject("dojo.store.Observable",r),r});//# sourceMappingURL=Observable.js.map