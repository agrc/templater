//>>built
define("dojo/store/Observable",["../_base/kernel","../_base/lang","../when","../_base/array"],function(e,t,a,i){var r=function(e){function r(t,i){var r=e[t];r&&(e[t]=function(d){var o;if("put"===t&&(o=e.getIdentity(d)),s)return r.apply(this,arguments);s=!0;try{var n=r.apply(this,arguments);return a(n,function(e){i("object"==typeof e&&e||d,o)}),n}finally{s=!1}})}var d,o=[],n=0;e=t.delegate(e),e.notify=function(e,t){n++;for(var a=o.slice(),i=0,r=a.length;r>i;i++)a[i](e,t)};var l=e.query;e.query=function(r,s){s=s||{};var m=l.apply(this,arguments);if(m&&m.forEach){var f=t.mixin({},s);delete f.start,delete f.count;var y,u=e.queryEngine&&e.queryEngine(r,f),h=n,v=[];m.observe=function(t,r){1==v.push(t)&&o.push(y=function(t,o){a(m,function(a){var l,m,f,y=a.length!=s.count;if(++h!=n)throw new Error("Query is out of date, you must observe() the query prior to any data modifications");var c,M=-1,g=-1;if(o!==d){var p=[].concat(a);for(u&&!t&&(p=u(a)),l=0,m=a.length;m>l;l++){var b=a[l];if(e.getIdentity(b)==o){if(p.indexOf(b)<0)continue;c=b,M=l,!u&&t||a.splice(l,1);break}}}if(u){if(t&&(u.matches?u.matches(t):u([t]).length)){var k=M>-1?M:a.length;a.splice(k,0,t),g=i.indexOf(u(a),t),a.splice(k,1),s.start&&0==g||!y&&g==a.length?g=-1:a.splice(g,0,t)}}else t&&(o!==d?g=M:s.start||(g=e.defaultIndex||0,a.splice(g,0,t)));if((M>-1||g>-1)&&(r||!u||M!=g)){var w=v.slice();for(l=0;f=w[l];l++)f(t||c,M,g)}})});var l={};return l.remove=l.cancel=function(){var e=i.indexOf(v,t);e>-1&&(v.splice(e,1),v.length||o.splice(i.indexOf(o,y),1))},l}}return m};var s;return r("put",function(t,a){e.notify(t,a)}),r("add",function(t){e.notify(t)}),r("remove",function(t){e.notify(void 0,t)}),e};return t.setObject("dojo.store.Observable",r),r});//# sourceMappingURL=Observable.js.map