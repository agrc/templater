//>>built
define("dojo/store/Observable",["../_base/kernel","../_base/lang","../when","../_base/array"],function(e,t,a,i){var r=function(e){function r(t,i){var r=e[t];r&&(e[t]=function(d){var o;if("put"===t&&(o=e.getIdentity(d)),s)return r.apply(this,arguments);s=!0;try{var n=r.apply(this,arguments);return a(n,function(e){i("object"==typeof e&&e||d,o)}),n}finally{s=!1}})}var d,o=[],n=0;e=t.delegate(e),e.notify=function(e,t){n++;for(var a=o.slice(),i=0,r=a.length;r>i;i++)a[i](e,t)};var l=e.query;e.query=function(r,s){s=s||{};var m=l.apply(this,arguments);if(m&&m.forEach){var u=t.mixin({},s);delete u.start,delete u.count;var f,y=e.queryEngine&&e.queryEngine(r,u),h=n,c=[];m.observe=function(t,r){1==c.push(t)&&o.push(f=function(t,o){a(m,function(a){var l,m,u,f=a.length!=s.count;if(++h!=n)throw new Error("Query is out of date, you must observe() the query prior to any data modifications");var v,M=-1,g=-1;if(o!==d){var p=[].concat(a);for(y&&!t&&(p=y(a)),l=0,m=a.length;m>l;l++){var b=a[l];if(e.getIdentity(b)==o){if(p.indexOf(b)<0)continue;v=b,M=l,!y&&t||a.splice(l,1);break}}}if(y){if(t&&(y.matches?y.matches(t):y([t]).length)){var w=M>-1?M:a.length;a.splice(w,0,t),g=i.indexOf(y(a),t),a.splice(w,1),s.start&&0==g||!f&&g==a.length?g=-1:a.splice(g,0,t)}}else t&&(o!==d?g=M:s.start||(g=e.defaultIndex||0,a.splice(g,0,t)));if((M>-1||g>-1)&&(r||!y||M!=g)){var k=c.slice();for(l=0;u=k[l];l++)u(t||v,M,g)}})});var l={};return l.remove=l.cancel=function(){var e=i.indexOf(c,t);e>-1&&(c.splice(e,1),c.length||o.splice(i.indexOf(o,f),1))},l}}return m};var s;return r("put",function(t,a){e.notify(t,a)}),r("add",function(t){e.notify(t)}),r("remove",function(t){e.notify(void 0,t)}),e};return t.setObject("dojo.store.Observable",r),r});//# sourceMappingURL=Observable.js.map