//>>built
define("dojo/store/Observable",["../_base/kernel","../_base/lang","../when","../_base/array"],function(e,t,a,i){var r=function(e){function r(t,i){var r=e[t];r&&(e[t]=function(n){var d;if("put"===t&&(d=e.getIdentity(n)),s)return r.apply(this,arguments);s=!0;try{var o=r.apply(this,arguments);return a(o,function(e){i("object"==typeof e&&e||n,d)}),o}finally{s=!1}})}var n,d=[],o=0;e=t.delegate(e),e.notify=function(e,t){o++;for(var a=d.slice(),i=0,r=a.length;r>i;i++)a[i](e,t)};var l=e.query;e.query=function(r,s){s=s||{};var m=l.apply(this,arguments);if(m&&m.forEach){var u=t.mixin({},s);delete u.start,delete u.count;var f,h=e.queryEngine&&e.queryEngine(r,u),c=o,y=[];m.observe=function(t,r){1==y.push(t)&&d.push(f=function(t,d){a(m,function(a){var l,m,u,f=a.length!=s.count;if(++c!=o)throw new Error("Query is out of date, you must observe() the query prior to any data modifications");var v,g=-1,p=-1;if(d!==n){var M=[].concat(a);for(h&&!t&&(M=h(a)),l=0,m=a.length;m>l;l++){var b=a[l];if(e.getIdentity(b)==d){if(M.indexOf(b)<0)continue;v=b,g=l,!h&&t||a.splice(l,1);break}}}if(h){if(t&&(h.matches?h.matches(t):h([t]).length)){var k=g>-1?g:a.length;a.splice(k,0,t),p=i.indexOf(h(a),t),a.splice(k,1),s.start&&0==p||!f&&p==a.length?p=-1:a.splice(p,0,t)}}else t&&(d!==n?p=g:s.start||(p=e.defaultIndex||0,a.splice(p,0,t)));if((g>-1||p>-1)&&(r||!h||g!=p)){var w=y.slice();for(l=0;u=w[l];l++)u(t||v,g,p)}})});var l={};return l.remove=l.cancel=function(){var e=i.indexOf(y,t);e>-1&&(y.splice(e,1),y.length||d.splice(i.indexOf(d,f),1))},l}}return m};var s;return r("put",function(t,a){e.notify(t,a)}),r("add",function(t){e.notify(t)}),r("remove",function(t){e.notify(void 0,t)}),e};return t.setObject("dojo.store.Observable",r),r});//# sourceMappingURL=Observable.js.map