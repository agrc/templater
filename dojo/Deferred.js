//>>built
define("dojo/Deferred",["./has","./_base/lang","./errors/CancelError","./promise/Promise","./promise/instrumentation"],function(e,t,i,n,o){"use strict";var s=0,r=1,a=2,d="This deferred has already been fulfilled.",l=Object.freeze||function(){},c=function(e,t,i,n,o){t===a&&p.instrumentRejected&&0===e.length&&p.instrumentRejected(i,!1,n,o);for(var s=0;s<e.length;s++)u(e[s],t,i,n)},u=function(e,t,i,n){var o=e[t],d=e.deferred;if(o)try{var l=o(i);if(t===s)"undefined"!=typeof l&&f(d,t,l);else{if(l&&"function"==typeof l.then)return e.cancel=l.cancel,void l.then(h(d,r),h(d,a),h(d,s));f(d,r,l)}}catch(c){f(d,a,c)}else f(d,t,i);t===a&&p.instrumentRejected&&p.instrumentRejected(i,!!o,n,d.promise)},h=function(e,t){return function(i){f(e,t,i)}},f=function(e,t,i){if(!e.isCanceled())switch(t){case s:e.progress(i);break;case r:e.resolve(i);break;case a:e.reject(i)}},p=function(e){var t,o,h,f=this.promise=new n,m=this,g=!1,v=[];Error.captureStackTrace&&(Error.captureStackTrace(m,p),Error.captureStackTrace(f,p)),this.isResolved=f.isResolved=function(){return t===r},this.isRejected=f.isRejected=function(){return t===a},this.isFulfilled=f.isFulfilled=function(){return!!t},this.isCanceled=f.isCanceled=function(){return g},this.progress=function(e,i){if(t){if(i===!0)throw new Error(d);return f}return c(v,s,e,null,m),f},this.resolve=function(e,i){if(t){if(i===!0)throw new Error(d);return f}return c(v,t=r,o=e,null,m),v=null,f};var b=this.reject=function(e,i){if(t){if(i===!0)throw new Error(d);return f}return Error.captureStackTrace&&Error.captureStackTrace(h={},b),c(v,t=a,o=e,h,m),v=null,f};this.then=f.then=function(e,i,n){var s=[n,e,i];return s.cancel=f.cancel,s.deferred=new p(function(e){return s.cancel&&s.cancel(e)}),t&&!v?u(s,t,o,h):v.push(s),s.deferred.promise},this.cancel=f.cancel=function(n,s){if(t){if(s===!0)throw new Error(d)}else{if(e){var r=e(n);n="undefined"==typeof r?n:r}if(g=!0,!t)return"undefined"==typeof n&&(n=new i),b(n),n;if(t===a&&o===n)return n}},l(f)};return p.prototype.toString=function(){return"[object Deferred]"},o&&o(p),p});//# sourceMappingURL=Deferred.js.map