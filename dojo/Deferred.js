//>>built
define("dojo/Deferred",["./has","./_base/lang","./errors/CancelError","./promise/Promise","./promise/instrumentation"],function(e,t,i,o,n){"use strict";var r=0,s=1,a=2,l="This deferred has already been fulfilled.",d=Object.freeze||function(){},h=function(e,t,i,o,n){t===a&&p.instrumentRejected&&0===e.length&&p.instrumentRejected(i,!1,o,n);for(var r=0;r<e.length;r++)c(e[r],t,i,o)},c=function(e,t,i,o){var n=e[t],l=e.deferred;if(n)try{var d=n(i);if(t===r)"undefined"!=typeof d&&f(l,t,d);else{if(d&&"function"==typeof d.then)return e.cancel=d.cancel,void d.then(u(l,s),u(l,a),u(l,r));f(l,s,d)}}catch(h){f(l,a,h)}else f(l,t,i);t===a&&p.instrumentRejected&&p.instrumentRejected(i,!!n,o,l.promise)},u=function(e,t){return function(i){f(e,t,i)}},f=function(e,t,i){if(!e.isCanceled())switch(t){case r:e.progress(i);break;case s:e.resolve(i);break;case a:e.reject(i)}},p=function(e){var t,n,u,f=this.promise=new o,g=this,m=!1,_=[];Error.captureStackTrace&&(Error.captureStackTrace(g,p),Error.captureStackTrace(f,p)),this.isResolved=f.isResolved=function(){return t===s},this.isRejected=f.isRejected=function(){return t===a},this.isFulfilled=f.isFulfilled=function(){return!!t},this.isCanceled=f.isCanceled=function(){return m},this.progress=function(e,i){if(t){if(i===!0)throw new Error(l);return f}return h(_,r,e,null,g),f},this.resolve=function(e,i){if(t){if(i===!0)throw new Error(l);return f}return h(_,t=s,n=e,null,g),_=null,f};var v=this.reject=function(e,i){if(t){if(i===!0)throw new Error(l);return f}return Error.captureStackTrace&&Error.captureStackTrace(u={},v),h(_,t=a,n=e,u,g),_=null,f};this.then=f.then=function(e,i,o){var r=[o,e,i];return r.cancel=f.cancel,r.deferred=new p(function(e){return r.cancel&&r.cancel(e)}),t&&!_?c(r,t,n,u):_.push(r),r.deferred.promise},this.cancel=f.cancel=function(o,r){if(t){if(r===!0)throw new Error(l)}else{if(e){var s=e(o);o="undefined"==typeof s?o:s}if(m=!0,!t)return"undefined"==typeof o&&(o=new i),v(o),o;if(t===a&&n===o)return o}},d(f)};return p.prototype.toString=function(){return"[object Deferred]"},n&&n(p),p});//# sourceMappingURL=Deferred.js.map