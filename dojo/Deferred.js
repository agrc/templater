//>>built
define("dojo/Deferred",["./has","./_base/lang","./errors/CancelError","./promise/Promise","./promise/instrumentation"],function(t,e,i,o,n){"use strict";var r=0,s=1,a=2,d="This deferred has already been fulfilled.",l=Object.freeze||function(){},c=function(t,e,i,o,n){e===a&&p.instrumentRejected&&0===t.length&&p.instrumentRejected(i,!1,o,n);for(var r=0;r<t.length;r++)h(t[r],e,i,o)},h=function(t,e,i,o){var n=t[e],d=t.deferred;if(n)try{var l=n(i);if(e===r)void 0!==l&&f(d,e,l);else{if(l&&"function"==typeof l.then)return t.cancel=l.cancel,void l.then(u(d,s),u(d,a),u(d,r));f(d,s,l)}}catch(t){f(d,a,t)}else f(d,e,i);e===a&&p.instrumentRejected&&p.instrumentRejected(i,!!n,o,d.promise)},u=function(t,e){return function(i){f(t,e,i)}},f=function(t,e,i){if(!t.isCanceled())switch(e){case r:t.progress(i);break;case s:t.resolve(i);break;case a:t.reject(i)}},p=function(t){var e,n,u,f=this.promise=new o,m=this,g=!1,b=[];Error.captureStackTrace&&(Error.captureStackTrace(m,p),Error.captureStackTrace(f,p)),this.isResolved=f.isResolved=function(){return e===s},this.isRejected=f.isRejected=function(){return e===a},this.isFulfilled=f.isFulfilled=function(){return!!e},this.isCanceled=f.isCanceled=function(){return g},this.progress=function(t,i){if(e){if(!0===i)throw new Error(d);return f}return c(b,r,t,null,m),f},this.resolve=function(t,i){if(e){if(!0===i)throw new Error(d);return f}return c(b,e=s,n=t,null,m),b=null,f};var j=this.reject=function(t,i){if(e){if(!0===i)throw new Error(d);return f}return Error.captureStackTrace&&Error.captureStackTrace(u={},j),c(b,e=a,n=t,u,m),b=null,f};this.then=f.then=function(t,i,o){var r=[o,t,i];return r.cancel=f.cancel,r.deferred=new p(function(t){return r.cancel&&r.cancel(t)}),e&&!b?h(r,e,n,u):b.push(r),r.deferred.promise},this.cancel=f.cancel=function(o,r){if(e){if(!0===r)throw new Error(d)}else{if(t){var s=t(o);o=void 0===s?o:s}if(g=!0,!e)return void 0===o&&(o=new i),j(o),o;if(e===a&&n===o)return o}},l(f)};return p.prototype.toString=function(){return"[object Deferred]"},n&&n(p),p});//# sourceMappingURL=Deferred.js.map