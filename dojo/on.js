//>>built
define("dojo/on",["./has!dom-addeventlistener?:./aspect","./_base/kernel","./sniff"],function(e,t,n){"use strict";function i(e,t,i,o,r){var a=t.match(/(.*):(.*)/);if(a)return t=a[2],a=a[1],s.selector(a,t).call(r,e,i);if(n("touch")&&(d.test(t)&&(i=C(i)),n("event-orientationchange")||"orientationchange"!=t||(t="resize",e=window,i=C(i))),f&&(i=f(i)),e.addEventListener){var c=t in u,l=c?u[t]:t;return e.addEventListener(l,i,c),{remove:function(){e.removeEventListener(l,i,c)}}}if(t="on"+t,v&&e.attachEvent)return v(e,t,i);throw new Error("Target must be an event emitter")}function o(){this.cancelable=!1,this.defaultPrevented=!0}function r(){this.bubbles=!1}var a=window.ScriptEngineMajorVersion;n.add("jscript",a&&a()+ScriptEngineMinorVersion()/10),n.add("event-orientationchange",n("touch")&&!n("android")),n.add("event-stopimmediatepropagation",window.Event&&!!window.Event.prototype&&!!window.Event.prototype.stopImmediatePropagation),n.add("event-focusin",function(e,t,n){return"onfocusin"in n}),n("touch")&&n.add("touch-can-modify-event-delegate",function(){var e=function(){};e.prototype=document.createEvent("MouseEvents");try{var t=new e;return t.target=null,null===t.target}catch(n){return!1}});var s=function(e,t,n,o){return"function"!=typeof e.on||"function"==typeof t||e.nodeType?s.parse(e,t,n,i,o,this):e.on(t,n)};s.pausable=function(e,t,n,i){var o,r=s(e,t,function(){return o?void 0:n.apply(this,arguments)},i);return r.pause=function(){o=!0},r.resume=function(){o=!1},r},s.once=function(e,t,n,i){var o=s(e,t,function(){return o.remove(),n.apply(this,arguments)});return o},s.parse=function(e,t,n,i,o,r){var a;if(t.call)return t.call(r,e,n);if(t instanceof Array?a=t:t.indexOf(",")>-1&&(a=t.split(/\s*,\s*/)),a){for(var d,c=[],l=0;d=a[l++];)c.push(s.parse(e,d,n,i,o,r));return c.remove=function(){for(var e=0;e<c.length;e++)c[e].remove()},c}return i(e,t,n,o,r)};var d=/^touch/;s.matches=function(e,n,i,o,r){for(r=r&&"function"==typeof r.matches?r:t.query,o=o!==!1,1!=e.nodeType&&(e=e.parentNode);!r.matches(e,n,i);)if(e==i||o===!1||!(e=e.parentNode)||1!=e.nodeType)return!1;return e},s.selector=function(e,t,n){return function(i,o){function r(t){return s.matches(t,e,i,n,a)}var a="function"==typeof e?{matches:e}:this,d=t.bubble;return d?s(i,d(r),o):s(i,t,function(e){var t=r(e.target);return t?o.call(t,e):void 0})}};var c=[].slice,l=s.emit=function(e,t,n){var i=c.call(arguments,2),a="on"+t;if("parentNode"in e){var s=i[0]={};for(var d in n)s[d]=n[d];s.preventDefault=o,s.stopPropagation=r,s.target=e,s.type=t,n=s}do e[a]&&e[a].apply(e,i);while(n&&n.bubbles&&(e=e.parentNode));return n&&n.cancelable&&n},u=n("event-focusin")?{}:{focusin:"focus",focusout:"blur"};if(!n("event-stopimmediatepropagation"))var h=function(){this.immediatelyStopped=!0,this.modified=!0},f=function(e){return function(t){return t.immediatelyStopped?void 0:(t.stopImmediatePropagation=h,e.apply(this,arguments))}};if(n("dom-addeventlistener"))s.emit=function(e,t,n){if(e.dispatchEvent&&document.createEvent){var i=e.ownerDocument||document,o=i.createEvent("HTMLEvents");o.initEvent(t,!!n.bubbles,!!n.cancelable);for(var r in n)r in o||(o[r]=n[r]);return e.dispatchEvent(o)&&o}return l.apply(s,arguments)};else{s._fixEvent=function(e,t){if(!e){var n=t&&(t.ownerDocument||t.document||t).parentWindow||window;e=n.event}if(!e)return e;try{p&&e.type==p.type&&e.srcElement==p.target&&(e=p)}catch(i){}if(!e.target)switch(e.target=e.srcElement,e.currentTarget=t||e.srcElement,"mouseover"==e.type&&(e.relatedTarget=e.fromElement),"mouseout"==e.type&&(e.relatedTarget=e.toElement),e.stopPropagation||(e.stopPropagation=y,e.preventDefault=_),e.type){case"keypress":var o="charCode"in e?e.charCode:e.keyCode;10==o?(o=0,e.keyCode=13):13==o||27==o?o=0:3==o&&(o=99),e.charCode=o,b(e)}return e};var p,m=function(e){this.handle=e};m.prototype.remove=function(){delete _dojoIEListeners_[this.handle]};var g=function(e){return function(t){t=s._fixEvent(t,this);var n=e.call(this,t);return t.modified&&(p||setTimeout(function(){p=null}),p=t),n}},v=function(t,i,o){if(o=g(o),((t.ownerDocument?t.ownerDocument.parentWindow:t.parentWindow||t.window||window)!=top||n("jscript")<5.8)&&!n("config-_allow_leaks")){"undefined"==typeof _dojoIEListeners_&&(_dojoIEListeners_=[]);var r=t[i];if(!r||!r.listeners){var a=r;r=Function("event","var callee = arguments.callee; for(var i = 0; i<callee.listeners.length; i++){var listener = _dojoIEListeners_[callee.listeners[i]]; if(listener){listener.call(this,event);}}"),r.listeners=[],t[i]=r,r.global=this,a&&r.listeners.push(_dojoIEListeners_.push(a)-1)}var s;return r.listeners.push(s=r.global._dojoIEListeners_.push(o)-1),new m(s)}return e.after(t,i,o,!0)},b=function(e){e.keyChar=e.charCode?String.fromCharCode(e.charCode):"",e.charOrCode=e.keyChar||e.keyCode},y=function(){this.cancelBubble=!0},_=s._preventDefault=function(){if(this.bubbledKeyCode=this.keyCode,this.ctrlKey)try{this.keyCode=0}catch(e){}this.defaultPrevented=!0,this.returnValue=!1,this.modified=!0}}if(n("touch"))var j=function(){},w=window.orientation,C=function(e){return function(t){var i=t.corrected;if(!i){var o=t.type;try{delete t.type}catch(r){}if(t.type){if(n("touch-can-modify-event-delegate"))j.prototype=t,i=new j;else{i={};for(var a in t)i[a]=t[a]}i.preventDefault=function(){t.preventDefault()},i.stopPropagation=function(){t.stopPropagation()}}else i=t,i.type=o;if(t.corrected=i,"resize"==o)return w==window.orientation?null:(w=window.orientation,i.type="orientationchange",e.call(this,i));"rotation"in i||(i.rotation=0,i.scale=1);var s=i.changedTouches[0];for(var d in s)delete i[d],i[d]=s[d]}return e.call(this,i)}};return s});//# sourceMappingURL=on.js.map