//>>built
define("dojo/_base/Deferred",["./kernel","../Deferred","../promise/Promise","../errors/CancelError","../has","./lang","../when"],function(t,e,i,n,o,r,s){var a=function(){},d=Object.freeze||function(){},l=t.Deferred=function(t){function s(t){if(h)throw new Error("This deferred has already been resolved");u=t,h=!0,c()}function c(){for(var t;!t&&b;){var i=b;b=b.next,(t=i.progress==a)&&(h=!1);var n=m?i.error:i.resolved;if(o("config-useDeferredInstrumentation")&&m&&e.instrumentRejected&&e.instrumentRejected(u,!!n),n)try{var s=n(u);if(s&&"function"==typeof s.then){s.then(r.hitch(i.deferred,"resolve"),r.hitch(i.deferred,"reject"),r.hitch(i.deferred,"progress"));continue}var d=t&&void 0===s;t&&!d&&(m=s instanceof Error),i.deferred[d&&m?"reject":"resolve"](d?u:s)}catch(t){i.deferred.reject(t)}else m?i.deferred.reject(u):i.deferred.resolve(u)}}var u,h,f,p,m,g,b,v=this.promise=new i;this.isResolved=v.isResolved=function(){return 0==p},this.isRejected=v.isRejected=function(){return 1==p},this.isFulfilled=v.isFulfilled=function(){return p>=0},this.isCanceled=v.isCanceled=function(){return f},this.resolve=this.callback=function(t){this.fired=p=0,this.results=[t,null],s(t)},this.reject=this.errback=function(t){m=!0,this.fired=p=1,o("config-useDeferredInstrumentation")&&e.instrumentRejected&&e.instrumentRejected(t,!!b),s(t),this.results=[null,t]},this.progress=function(t){for(var e=b;e;){var i=e.progress;i&&i(t),e=e.next}},this.addCallbacks=function(t,e){return this.then(t,e,a),this},v.then=this.then=function(t,e,i){var n=i==a?this:new l(v.cancel),o={resolved:t,error:e,progress:i,deferred:n};return b?g=g.next=o:b=g=o,h&&c(),n.promise};var _=this;v.cancel=this.cancel=function(){if(!h){var e=t&&t(_);h||(e instanceof Error||(e=new n(e)),e.log=!1,_.reject(e))}f=!0},d(v)};return r.extend(l,{addCallback:function(e){return this.addCallbacks(r.hitch.apply(t,arguments))},addErrback:function(e){return this.addCallbacks(null,r.hitch.apply(t,arguments))},addBoth:function(e){var i=r.hitch.apply(t,arguments);return this.addCallbacks(i,i)},fired:-1}),l.when=t.when=s,l});//# sourceMappingURL=Deferred.js.map