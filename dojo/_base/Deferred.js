//>>built
define("dojo/_base/Deferred",["./kernel","../Deferred","../promise/Promise","../errors/CancelError","../has","./lang","../when"],function(t,e,i,n,o,r,a){var s=function(){},d=Object.freeze||function(){},l=t.Deferred=function(t){function a(t){if(c)throw new Error("This deferred has already been resolved");h=t,c=!0,u()}function u(){for(var t;!t&&b;){var i=b;b=b.next,(t=i.progress==s)&&(c=!1);var n=g?i.error:i.resolved;if(o("config-useDeferredInstrumentation")&&g&&e.instrumentRejected&&e.instrumentRejected(h,!!n),n)try{var a=n(h);if(a&&"function"==typeof a.then){a.then(r.hitch(i.deferred,"resolve"),r.hitch(i.deferred,"reject"),r.hitch(i.deferred,"progress"));continue}var d=t&&void 0===a;t&&!d&&(g=a instanceof Error),i.deferred[d&&g?"reject":"resolve"](d?h:a)}catch(l){i.deferred.reject(l)}else g?i.deferred.reject(h):i.deferred.resolve(h)}}var h,c,f,p,g,m,b,v=this.promise=new i;this.isResolved=v.isResolved=function(){return 0==p},this.isRejected=v.isRejected=function(){return 1==p},this.isFulfilled=v.isFulfilled=function(){return p>=0},this.isCanceled=v.isCanceled=function(){return f},this.resolve=this.callback=function(t){this.fired=p=0,this.results=[t,null],a(t)},this.reject=this.errback=function(t){g=!0,this.fired=p=1,o("config-useDeferredInstrumentation")&&e.instrumentRejected&&e.instrumentRejected(t,!!b),a(t),this.results=[null,t]},this.progress=function(t){for(var e=b;e;){var i=e.progress;i&&i(t),e=e.next}},this.addCallbacks=function(t,e){return this.then(t,e,s),this},v.then=this.then=function(t,e,i){var n=i==s?this:new l(v.cancel),o={resolved:t,error:e,progress:i,deferred:n};return b?m=m.next=o:b=m=o,c&&u(),n.promise};var _=this;v.cancel=this.cancel=function(){if(!c){var e=t&&t(_);c||(e instanceof Error||(e=new n(e)),e.log=!1,_.reject(e))}f=!0},d(v)};return r.extend(l,{addCallback:function(e){return this.addCallbacks(r.hitch.apply(t,arguments))},addErrback:function(e){return this.addCallbacks(null,r.hitch.apply(t,arguments))},addBoth:function(e){var i=r.hitch.apply(t,arguments);return this.addCallbacks(i,i)},fired:-1}),l.when=t.when=a,l});//# sourceMappingURL=Deferred.js.map