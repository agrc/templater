//>>built
define("dojo/_base/Deferred",["./kernel","../Deferred","../promise/Promise","../errors/CancelError","../has","./lang","../when"],function(e,t,i,n,o,r,a){var s=function(){},d=Object.freeze||function(){},l=e.Deferred=function(e){function a(e){if(h)throw new Error("This deferred has already been resolved");u=e,h=!0,c()}function c(){for(var e;!e&&v;){var i=v;v=v.next,(e=i.progress==s)&&(h=!1);var n=g?i.error:i.resolved;if(o("config-useDeferredInstrumentation")&&g&&t.instrumentRejected&&t.instrumentRejected(u,!!n),n)try{var a=n(u);if(a&&"function"==typeof a.then){a.then(r.hitch(i.deferred,"resolve"),r.hitch(i.deferred,"reject"),r.hitch(i.deferred,"progress"));continue}var d=e&&void 0===a;e&&!d&&(g=a instanceof Error),i.deferred[d&&g?"reject":"resolve"](d?u:a)}catch(l){i.deferred.reject(l)}else g?i.deferred.reject(u):i.deferred.resolve(u)}}var u,h,f,p,g,m,v,_=this.promise=new i;this.isResolved=_.isResolved=function(){return 0==p},this.isRejected=_.isRejected=function(){return 1==p},this.isFulfilled=_.isFulfilled=function(){return p>=0},this.isCanceled=_.isCanceled=function(){return f},this.resolve=this.callback=function(e){this.fired=p=0,this.results=[e,null],a(e)},this.reject=this.errback=function(e){g=!0,this.fired=p=1,o("config-useDeferredInstrumentation")&&t.instrumentRejected&&t.instrumentRejected(e,!!v),a(e),this.results=[null,e]},this.progress=function(e){for(var t=v;t;){var i=t.progress;i&&i(e),t=t.next}},this.addCallbacks=function(e,t){return this.then(e,t,s),this},_.then=this.then=function(e,t,i){var n=i==s?this:new l(_.cancel),o={resolved:e,error:t,progress:i,deferred:n};return v?m=m.next=o:v=m=o,h&&c(),n.promise};var b=this;_.cancel=this.cancel=function(){if(!h){var t=e&&e(b);h||(t instanceof Error||(t=new n(t)),t.log=!1,b.reject(t))}f=!0},d(_)};return r.extend(l,{addCallback:function(t){return this.addCallbacks(r.hitch.apply(e,arguments))},addErrback:function(t){return this.addCallbacks(null,r.hitch.apply(e,arguments))},addBoth:function(t){var i=r.hitch.apply(e,arguments);return this.addCallbacks(i,i)},fired:-1}),l.when=e.when=a,l});//# sourceMappingURL=Deferred.js.map