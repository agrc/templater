//>>built
define("dojo/_base/connect",["./kernel","../on","../topic","../aspect","./event","../mouse","./sniff","./lang","../keys"],function(t,e,i,o,n,r,s,a){function d(i,n,s,d,l){if(d=a.hitch(s,d),!i||!i.addEventListener&&!i.attachEvent)return o.after(i||t.global,n,d,!0);if("string"==typeof n&&"on"==n.substring(0,2)&&(n=n.substring(2)),i||(i=t.global),!l)switch(n){case"keypress":n=c;break;case"mouseenter":n=r.enter;break;case"mouseleave":n=r.leave}return e(i,n,d,l)}function l(t){t.keyChar=t.charCode?String.fromCharCode(t.charCode):"",t.charOrCode=t.keyChar||t.keyCode}s.add("events-keypress-typed",function(){var t={charCode:0};try{t=document.createEvent("KeyboardEvent"),(t.initKeyboardEvent||t.initKeyEvent).call(t,"keypress",!0,!0,null,!1,!1,!1,!1,9,3)}catch(e){}return 0==t.charCode&&!s("opera")});var c,u={106:42,111:47,186:59,187:43,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39,229:113},h=s("mac")?"metaKey":"ctrlKey",f=function(t,e){var i=a.mixin({},t,e);return l(i),i.preventDefault=function(){t.preventDefault()},i.stopPropagation=function(){t.stopPropagation()},i};if(s("events-keypress-typed")){var p=function(t,e){try{return t.keyCode=e}catch(t){return 0}};c=function(t,i){var o=e(t,"keydown",function(t){var e=t.keyCode,o=13!=e&&32!=e&&(27!=e||!s("ie"))&&(48>e||e>90)&&(96>e||e>111)&&(186>e||e>192)&&(219>e||e>222)&&229!=e;if(o||t.ctrlKey){var n=o?0:e;if(t.ctrlKey){if(3==e||13==e)return i.call(t.currentTarget,t);n>95&&106>n?n-=48:!t.shiftKey&&n>=65&&90>=n?n+=32:n=u[n]||n}var r=f(t,{type:"keypress",faux:!0,charCode:n});i.call(t.currentTarget,r),s("ie")&&p(t,r.keyCode)}}),n=e(t,"keypress",function(t){var e=t.charCode;return e=e>=32?e:0,t=f(t,{charCode:e,faux:!0}),i.call(this,t)});return{remove:function(){o.remove(),n.remove()}}}}else c=s("opera")?function(t,i){return e(t,"keypress",function(t){var e=t.which;return 3==e&&(e=99),e=32>e&&!t.shiftKey?0:e,t.ctrlKey&&!t.shiftKey&&e>=65&&90>=e&&(e+=32),i.call(this,f(t,{charCode:e}))})}:function(t,i){return e(t,"keypress",function(t){return l(t),i.call(this,t)})};var m={_keypress:c,connect:function(t,e,i,o,n){var r=arguments,s=[],a=0;s.push("string"==typeof r[0]?null:r[a++],r[a++]);var l=r[a+1];s.push("string"==typeof l||"function"==typeof l?r[a++]:null,r[a++]);for(var c=r.length;c>a;a++)s.push(r[a]);return d.apply(this,s)},disconnect:function(t){t&&t.remove()},subscribe:function(t,e,o){return i.subscribe(t,a.hitch(e,o))},publish:function(t,e){return i.publish.apply(i,[t].concat(e))},connectPublisher:function(t,e,i){var o=function(){m.publish(t,arguments)};return i?m.connect(e,i,o):m.connect(e,o)},isCopyKey:function(t){return t[h]}};return m.unsubscribe=m.disconnect,a.mixin(t,m),m});//# sourceMappingURL=connect.js.map