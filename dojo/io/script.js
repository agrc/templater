//>>built
define("dojo/io/script",["../_base/connect","../_base/kernel","../_base/lang","../sniff","../_base/window","../_base/xhr","../dom","../dom-construct","../request/script","../aspect"],function(connect,kernel,lang,has,win,xhr,dom,domConstruct,_script,aspect){kernel.deprecated("dojo/io/script","Use dojo/request/script.","2.0");var script={get:function(e){var t,a=this._makeScriptDeferred(e,function(e){t&&t.cancel()}),i=a.ioArgs;return xhr._ioAddQueryToUrl(i),xhr._ioNotifyStart(a),t=_script.get(i.url,{timeout:e.timeout,jsonp:i.jsonp,checkString:e.checkString,ioArgs:i,frameDoc:e.frameDoc,canAttach:function(e){return i.requestId=e.id,i.scriptId=e.scriptId,i.canDelete=e.canDelete,script._canAttach(i)}},!0),aspect.around(t,"isValid",function(e){return function(t){return script._validCheck(a),e.call(this,t)}}),t.then(function(){a.resolve(a)}).otherwise(function(e){a.ioArgs.error=e,a.reject(e)}),a},attach:_script._attach,remove:_script._remove,_makeScriptDeferred:function(e,t){var a=xhr._ioSetArgs(e,t||this._deferredCancel,this._deferredOk,this._deferredError),i=a.ioArgs;return i.id=kernel._scopeName+"IoScript"+this._counter++,i.canDelete=!1,i.jsonp=e.callbackParamName||e.jsonp,i.jsonp&&(i.query=i.query||"",i.query.length>0&&(i.query+="&"),i.query+=i.jsonp+"="+(e.frameDoc?"parent.":"")+kernel._scopeName+".io.script.jsonp_"+i.id+"._jsonpCallback",i.frameDoc=e.frameDoc,i.canDelete=!0,a._jsonpCallback=this._jsonpCallback,this["jsonp_"+i.id]=a),a.addBoth(function(e){i.canDelete&&(e instanceof Error?script["jsonp_"+i.id]._jsonpCallback=function(){delete script["jsonp_"+i.id],i.requestId&&kernel.global[_script._callbacksProperty][i.requestId]()}:script._addDeadScript(i))}),a},_deferredCancel:function(e){e.canceled=!0},_deferredOk:function(e){var t=e.ioArgs;return t.json||t.scriptLoaded||t},_deferredError:function(e,t){return e},_deadScripts:[],_counter:1,_addDeadScript:function(e){script._deadScripts.push({id:e.id,frameDoc:e.frameDoc}),e.frameDoc=null},_validCheck:function(e){var t=script._deadScripts;if(t&&t.length>0){for(var a=0;a<t.length;a++)script.remove(t[a].id,t[a].frameDoc),delete script["jsonp_"+t[a].id],t[a].frameDoc=null;script._deadScripts=[]}return!0},_ioCheck:function(dfd){var ioArgs=dfd.ioArgs;if(ioArgs.json||ioArgs.scriptLoaded&&!ioArgs.args.checkString)return!0;var checkString=ioArgs.args.checkString;return checkString&&eval("typeof("+checkString+") != 'undefined'")},_resHandle:function(e){script._ioCheck(e)?e.callback(e):e.errback(new Error("inconceivable dojo.io.script._resHandle error"))},_canAttach:function(){return!0},_jsonpCallback:function(e){this.ioArgs.json=e,this.ioArgs.requestId&&kernel.global[_script._callbacksProperty][this.ioArgs.requestId](e)}};return lang.setObject("dojo.io.script",script),script});//# sourceMappingURL=script.js.map