//>>built
define("dojo/router/RouterBase",["dojo/_base/declare","dojo/hash","dojo/topic"],function(e,t,i){function a(e,t,i){var a,r,n,o,s,d,l;if(a=this.callbackQueue,r=!1,n=!1,o={stopImmediatePropagation:function(){r=!0},preventDefault:function(){n=!0},oldPath:t,newPath:i,params:e},s=[o],e instanceof Array)s=s.concat(e);else for(var u in e)s.push(e[u]);for(d=0,l=a.length;d<l;++d)r||a[d].apply(null,s);return!n}var r;return r=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},e(null,{_routes:null,_routeIndex:null,_started:!1,_currentPath:"",idMatch:/:(\w[\w\d]*)/g,idReplacement:"([^\\/]+)",globMatch:/\*(\w[\w\d]*)/,globReplacement:"(.+)",constructor:function(e){this._routes=[],this._routeIndex={};for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},register:function(e,t){return this._registerRoute(e,t)},registerBefore:function(e,t){return this._registerRoute(e,t,!0)},go:function(e,i){var a;return"string"==typeof e&&(e=r(e),a=this._handlePathChange(e),a&&t(e,i),a)},startup:function(e){if(!this._started){var a=this,r=t();this._started=!0,this._hashchangeHandle=i.subscribe("/dojo/hashchange",function(){a._handlePathChange.apply(a,arguments)}),r?this._handlePathChange(r):this.go(e,!0)}},destroy:function(){this._hashchangeHandle&&this._hashchangeHandle.remove(),this._routes=null,this._routeIndex=null},_handlePathChange:function(e){var t,i,a,r,n,o,s,d,l,u=this._routes,c=this._currentPath;if(!this._started||e===c)return s;for(s=!0,t=0,a=u.length;t<a;++t)if(n=u[t],o=n.route.exec(e)){if(n.parameterNames)for(d=n.parameterNames,l={},i=0,r=d.length;i<r;++i)l[d[i]]=o[i+1];else l=o.slice(1);s=n.fire(l,c,e)}return s&&(this._currentPath=e),s},_convertRouteToRegExp:function(e){return e=e.replace(this.idMatch,this.idReplacement),e=e.replace(this.globMatch,this.globReplacement),e="^"+e+"$",new RegExp(e)},_getParameterNames:function(e){var t,i=this.idMatch,a=this.globMatch,r=[];for(i.lastIndex=0;null!==(t=i.exec(e));)r.push(t[1]);return null!==(t=a.exec(e))&&r.push(t[1]),r.length>0?r:null},_indexRoutes:function(){var e,t,i,a,r=this._routes;for(a=this._routeIndex={},e=0,t=r.length;e<t;++e)i=r[e],a[i.route]=e},_registerRoute:function(e,t,i){var r,n,o,s,d,l=this,u=this._routes,c=this._routeIndex;return r=this._routeIndex[e],n=void 0!==r,n&&(o=u[r]),o||(o={route:e,callbackQueue:[],fire:a}),s=o.callbackQueue,"string"==typeof e&&(o.parameterNames=this._getParameterNames(e),o.route=this._convertRouteToRegExp(e)),i?s.unshift(t):s.push(t),n||(r=u.length,c[e]=r,u.push(o)),d=!1,{remove:function(){var e,i;if(!d){for(e=0,i=s.length;e<i;++e)s[e]===t&&s.splice(e,1);0===s.length&&(u.splice(r,1),l._indexRoutes()),d=!0}},register:function(t,i){return l.register(e,t,i)}}}})});//# sourceMappingURL=RouterBase.js.map