//>>built
define("dojo/router/RouterBase",["dojo/_base/declare","dojo/hash","dojo/topic"],function(e,t,a){function i(e,t,a){var i,r,o,d,n,l,s;if(i=this.callbackQueue,r=!1,o=!1,d={stopImmediatePropagation:function(){r=!0},preventDefault:function(){o=!0},oldPath:t,newPath:a,params:e},n=[d],e instanceof Array)n=n.concat(e);else for(var m in e)n.push(e[m]);for(l=0,s=i.length;s>l;++l)r||i[l].apply(null,n);return!o}var r;r=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};var o=e(null,{_routes:null,_routeIndex:null,_started:!1,_currentPath:"",idMatch:/:(\w[\w\d]*)/g,idReplacement:"([^\\/]+)",globMatch:/\*(\w[\w\d]*)/,globReplacement:"(.+)",constructor:function(e){this._routes=[],this._routeIndex={};for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},register:function(e,t){return this._registerRoute(e,t)},registerBefore:function(e,t){return this._registerRoute(e,t,!0)},go:function(e,a){var i;return"string"!=typeof e?!1:(e=r(e),i=this._handlePathChange(e),i&&t(e,a),i)},startup:function(e){if(!this._started){var i=this,r=t();this._started=!0,this._hashchangeHandle=a.subscribe("/dojo/hashchange",function(){i._handlePathChange.apply(i,arguments)}),r?this._handlePathChange(r):this.go(e,!0)}},destroy:function(){this._hashchangeHandle&&this._hashchangeHandle.remove(),this._routes=null,this._routeIndex=null},_handlePathChange:function(e){var t,a,i,r,o,d,n,l,s,m=this._routes,f=this._currentPath;if(!this._started||e===f)return n;for(n=!0,t=0,i=m.length;i>t;++t)if(o=m[t],d=o.route.exec(e)){if(o.parameterNames)for(l=o.parameterNames,s={},a=0,r=l.length;r>a;++a)s[l[a]]=d[a+1];else s=d.slice(1);n=o.fire(s,f,e)}return n&&(this._currentPath=e),n},_convertRouteToRegExp:function(e){return e=e.replace(this.idMatch,this.idReplacement),e=e.replace(this.globMatch,this.globReplacement),e="^"+e+"$",new RegExp(e)},_getParameterNames:function(e){var t,a=this.idMatch,i=this.globMatch,r=[];for(a.lastIndex=0;null!==(t=a.exec(e));)r.push(t[1]);return null!==(t=i.exec(e))&&r.push(t[1]),r.length>0?r:null},_indexRoutes:function(){var e,t,a,i,r=this._routes;for(i=this._routeIndex={},e=0,t=r.length;t>e;++e)a=r[e],i[a.route]=e},_registerRoute:function(e,t,a){var r,o,d,n,l,s=this,m=this._routes,f=this._routeIndex;return r=this._routeIndex[e],o="undefined"!=typeof r,o&&(d=m[r]),d||(d={route:e,callbackQueue:[],fire:i}),n=d.callbackQueue,"string"==typeof e&&(d.parameterNames=this._getParameterNames(e),d.route=this._convertRouteToRegExp(e)),a?n.unshift(t):n.push(t),o||(r=m.length,f[e]=r,m.push(d)),l=!1,{remove:function(){var e,a;if(!l){for(e=0,a=n.length;a>e;++e)n[e]===t&&n.splice(e,1);0===n.length&&(m.splice(r,1),s._indexRoutes()),l=!0}},register:function(t,a){return s.register(e,t,a)}}}});return o});//# sourceMappingURL=RouterBase.js.map