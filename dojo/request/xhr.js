//>>built
define("dojo/request/xhr",["../errors/RequestError","./watch","./handlers","./util","../has"],function(e,t,i,a,r){function n(t,r){var n=t.xhr;t.status=t.xhr.status;try{t.text=n.responseText}catch(o){}if("xml"===t.options.handleAs&&(t.data=n.responseXML),!r)try{i(t)}catch(o){r=o}r?this.reject(r):a.checkStatus(n.status)?this.resolve(t):(r=new e("Unable to load "+t.url+" status: "+n.status,t),this.reject(r))}function o(e){return this.xhr.getResponseHeader(e)}function d(i,y,v){var p=r("native-formdata")&&y&&y.data&&y.data instanceof FormData,g=a.parseArgs(i,a.deepCreate(h,y),p);i=g.url,y=g.options;var b,M=function(){b&&b()},w=a.deferred(g,c,l,s,n,M),k=g.xhr=d._create();if(!k)return w.cancel(new e("XHR was not created")),v?w:w.promise;g.getHeader=o,u&&(b=u(k,w,g));var _=y.data,F=!y.sync,j=y.method;try{k.open(j,i,F,y.user||f,y.password||f),y.withCredentials&&(k.withCredentials=y.withCredentials),r("native-response-type")&&y.handleAs in m&&(k.responseType=m[y.handleAs]);var I=y.headers,E=p?!1:"application/x-www-form-urlencoded";if(I)for(var x in I)"content-type"===x.toLowerCase()?E=I[x]:I[x]&&k.setRequestHeader(x,I[x]);E&&E!==!1&&k.setRequestHeader("Content-Type",E),I&&"X-Requested-With"in I||k.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.notify&&a.notify.emit("send",g,w.promise.cancel),k.send(_)}catch(A){w.reject(A)}return t(w),k=null,v?w:w.promise}r.add("native-xhr",function(){return"undefined"!=typeof XMLHttpRequest}),r.add("dojo-force-activex-xhr",function(){return r("activex")&&"file:"===window.location.protocol}),r.add("native-xhr2",function(){if(r("native-xhr")&&!r("dojo-force-activex-xhr")){var e=new XMLHttpRequest;return"undefined"!=typeof e.addEventListener&&("undefined"==typeof opera||"undefined"!=typeof e.upload)}}),r.add("native-formdata",function(){return"undefined"!=typeof FormData}),r.add("native-response-type",function(){return r("native-xhr")&&"undefined"!=typeof(new XMLHttpRequest).responseType}),r.add("native-xhr2-blob",function(){if(r("native-response-type")){var e=new XMLHttpRequest;e.open("GET","/",!0),e.responseType="blob";var t=e.responseType;return e.abort(),"blob"===t}});var l,s,u,c,m={blob:r("native-xhr2-blob")?"blob":"arraybuffer",document:"document",arraybuffer:"arraybuffer"};r("native-xhr2")?(l=function(e){return!this.isFulfilled()},c=function(e,t){t.xhr.abort()},u=function(t,i,a){function r(e){i.handleResponse(a)}function n(t){var r=t.target,n=new e("Unable to load "+a.url+" status: "+r.status,a);i.handleResponse(a,n)}function o(e){e.lengthComputable?(a.loaded=e.loaded,a.total=e.total,i.progress(a)):3===a.xhr.readyState&&(a.loaded="loaded"in e?e.loaded:e.position,i.progress(a))}return t.addEventListener("load",r,!1),t.addEventListener("error",n,!1),t.addEventListener("progress",o,!1),function(){t.removeEventListener("load",r,!1),t.removeEventListener("error",n,!1),t.removeEventListener("progress",o,!1),t=null}}):(l=function(e){return e.xhr.readyState},s=function(e){return 4===e.xhr.readyState},c=function(e,t){var i=t.xhr,a=typeof i.abort;"function"!==a&&"object"!==a&&"unknown"!==a||i.abort()});var f,h={data:null,query:null,sync:!1,method:"GET"};if(d._create=function(){throw new Error("XMLHTTP not available")},r("native-xhr")&&!r("dojo-force-activex-xhr"))d._create=function(){return new XMLHttpRequest};else if(r("activex"))try{new ActiveXObject("Msxml2.XMLHTTP"),d._create=function(){return new ActiveXObject("Msxml2.XMLHTTP")}}catch(y){try{new ActiveXObject("Microsoft.XMLHTTP"),d._create=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}catch(y){}}return a.addCommonMethods(d),d});//# sourceMappingURL=xhr.js.map