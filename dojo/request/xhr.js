//>>built
define("dojo/request/xhr",["../errors/RequestError","./watch","./handlers","./util","../has"],function(e,t,a,r,i){function n(t,i){var n=t.xhr;t.status=t.xhr.status;try{t.text=n.responseText}catch(o){}if("xml"===t.options.handleAs&&(t.data=n.responseXML),!i)try{a(t)}catch(o){i=o}i?this.reject(i):r.checkStatus(n.status)?this.resolve(t):(i=new e("Unable to load "+t.url+" status: "+n.status,t),this.reject(i))}function o(e){return this.xhr.getResponseHeader(e)}function s(a,p,y){var v=i("native-formdata")&&p&&p.data&&p.data instanceof FormData,g=r.parseArgs(a,r.deepCreate(h,p),v);a=g.url,p=g.options;var b,M=function(){b&&b()},k=r.deferred(g,c,d,l,n,M),w=g.xhr=s._create();if(!w)return k.cancel(new e("XHR was not created")),y?k:k.promise;g.getHeader=o,u&&(b=u(w,k,g));var _=p.data,F=!p.sync,j=p.method;try{w.open(j,a,F,p.user||m,p.password||m),p.withCredentials&&(w.withCredentials=p.withCredentials),i("native-response-type")&&p.handleAs in f&&(w.responseType=f[p.handleAs]);var I=p.headers,E=v?!1:"application/x-www-form-urlencoded";if(I)for(var x in I)"content-type"===x.toLowerCase()?E=I[x]:I[x]&&w.setRequestHeader(x,I[x]);E&&E!==!1&&w.setRequestHeader("Content-Type",E),I&&"X-Requested-With"in I||w.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.notify&&r.notify.emit("send",g,k.promise.cancel),w.send(_)}catch(A){k.reject(A)}return t(k),w=null,y?k:k.promise}i.add("native-xhr",function(){return"undefined"!=typeof XMLHttpRequest}),i.add("dojo-force-activex-xhr",function(){return i("activex")&&"file:"===window.location.protocol}),i.add("native-xhr2",function(){if(i("native-xhr")&&!i("dojo-force-activex-xhr")){var e=new XMLHttpRequest;return"undefined"!=typeof e.addEventListener&&("undefined"==typeof opera||"undefined"!=typeof e.upload)}}),i.add("native-formdata",function(){return"undefined"!=typeof FormData}),i.add("native-response-type",function(){return i("native-xhr")&&"undefined"!=typeof(new XMLHttpRequest).responseType}),i.add("native-xhr2-blob",function(){if(i("native-response-type")){var e=new XMLHttpRequest;e.open("GET","/",!0),e.responseType="blob";var t=e.responseType;return e.abort(),"blob"===t}});var d,l,u,c,f={blob:i("native-xhr2-blob")?"blob":"arraybuffer",document:"document",arraybuffer:"arraybuffer"};i("native-xhr2")?(d=function(e){return!this.isFulfilled()},c=function(e,t){t.xhr.abort()},u=function(t,a,r){function i(e){a.handleResponse(r)}function n(t){var i=t.target,n=new e("Unable to load "+r.url+" status: "+i.status,r);a.handleResponse(r,n)}function o(e){e.lengthComputable?(r.loaded=e.loaded,r.total=e.total,a.progress(r)):3===r.xhr.readyState&&(r.loaded="loaded"in e?e.loaded:e.position,a.progress(r))}return t.addEventListener("load",i,!1),t.addEventListener("error",n,!1),t.addEventListener("progress",o,!1),function(){t.removeEventListener("load",i,!1),t.removeEventListener("error",n,!1),t.removeEventListener("progress",o,!1),t=null}}):(d=function(e){return e.xhr.readyState},l=function(e){return 4===e.xhr.readyState},c=function(e,t){var a=t.xhr,r=typeof a.abort;"function"!==r&&"object"!==r&&"unknown"!==r||a.abort()});var m,h={data:null,query:null,sync:!1,method:"GET"};if(s._create=function(){throw new Error("XMLHTTP not available")},i("native-xhr")&&!i("dojo-force-activex-xhr"))s._create=function(){return new XMLHttpRequest};else if(i("activex"))try{new ActiveXObject("Msxml2.XMLHTTP"),s._create=function(){return new ActiveXObject("Msxml2.XMLHTTP")}}catch(p){try{new ActiveXObject("Microsoft.XMLHTTP"),s._create=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}catch(p){}}return r.addCommonMethods(s),s});//# sourceMappingURL=xhr.js.map