//>>built
define("dojo/request/xhr",["../errors/RequestError","./watch","./handlers","./util","../has"],function(e,t,a,i,r){function d(t,r){var d=t.xhr;t.status=t.xhr.status;try{t.text=d.responseText}catch(e){}if("xml"===t.options.handleAs&&(t.data=d.responseXML),!r)try{a(t)}catch(e){r=e}var o;if(r)this.reject(r);else{try{a(t)}catch(e){o=e}i.checkStatus(d.status)?o?this.reject(o):this.resolve(t):o?(r=new e("Unable to load "+t.url+" status: "+d.status+" and an error in handleAs: transformation of response",t),this.reject(r)):(r=new e("Unable to load "+t.url+" status: "+d.status,t),this.reject(r))}}function o(e){return this.xhr.getResponseHeader(e)}function n(a,c,v){var M=r("native-formdata")&&c&&c.data&&c.data instanceof FormData,g=i.parseArgs(a,i.deepCreate(y,c),M);a=g.url,c=g.options,r("ie")<=10&&(a=a.split("#")[0]);var p,b=function(){p&&p()},k=i.deferred(g,f,l,s,d,b),w=g.xhr=n._create();if(!w)return k.cancel(new e("XHR was not created")),v?k:k.promise;g.getHeader=o,m&&(p=m(w,k,g));var F=void 0===c.data?null:c.data,I=!c.sync,_=c.method;try{w.open(_,a,I,c.user||h,c.password||h),c.withCredentials&&(w.withCredentials=c.withCredentials),r("native-response-type")&&c.handleAs in u&&(w.responseType=u[c.handleAs]);var j=c.headers,A=!M&&"application/x-www-form-urlencoded";if(j)for(var z in j)"content-type"===z.toLowerCase()?A=j[z]:j[z]&&w.setRequestHeader(z,j[z]);A&&!1!==A&&w.setRequestHeader("Content-Type",A),j&&"X-Requested-With"in j||w.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.notify&&i.notify.emit("send",g,k.promise.cancel),w.send(F)}catch(e){k.reject(e)}return t(k),w=null,v?k:k.promise}r.add("native-xhr",function(){return"undefined"!=typeof XMLHttpRequest}),r.add("dojo-force-activex-xhr",function(){return r("activex")&&"file:"===window.location.protocol}),r.add("native-xhr2",function(){if(r("native-xhr")&&!r("dojo-force-activex-xhr")){var e=new XMLHttpRequest;return void 0!==e.addEventListener&&("undefined"==typeof opera||void 0!==e.upload)}}),r.add("native-formdata",function(){return"undefined"!=typeof FormData}),r.add("native-response-type",function(){return r("native-xhr")&&void 0!==(new XMLHttpRequest).responseType}),r.add("native-xhr2-blob",function(){if(r("native-response-type")){var e=new XMLHttpRequest;e.open("GET","https://dojotoolkit.org/",!0),e.responseType="blob";var t=e.responseType;return e.abort(),"blob"===t}});var l,s,m,f,u={blob:r("native-xhr2-blob")?"blob":"arraybuffer",document:"document",arraybuffer:"arraybuffer"};r("native-xhr2")?(l=function(e){return!this.isFulfilled()},f=function(e,t){t.xhr.abort()},m=function(t,a,i){function r(e){a.handleResponse(i)}function d(t){var r=t.target,d=new e("Unable to load "+i.url+" status: "+r.status,i);a.handleResponse(i,d)}function o(e){e.lengthComputable?(i.loaded=e.loaded,i.total=e.total,a.progress(i)):3===i.xhr.readyState&&(i.loaded="loaded"in e?e.loaded:e.position,a.progress(i))}return t.addEventListener("load",r,!1),t.addEventListener("error",d,!1),t.addEventListener("progress",o,!1),function(){t.removeEventListener("load",r,!1),t.removeEventListener("error",d,!1),t.removeEventListener("progress",o,!1),t=null}}):(l=function(e){return e.xhr.readyState},s=function(e){return 4===e.xhr.readyState},f=function(e,t){var a=t.xhr,i=typeof a.abort;"function"!==i&&"object"!==i&&"unknown"!==i||a.abort()});var h,y={data:null,query:null,sync:!1,method:"GET"};if(n._create=function(){throw new Error("XMLHTTP not available")},r("native-xhr")&&!r("dojo-force-activex-xhr"))n._create=function(){return new XMLHttpRequest};else if(r("activex"))try{new ActiveXObject("Msxml2.XMLHTTP"),n._create=function(){return new ActiveXObject("Msxml2.XMLHTTP")}}catch(e){try{new ActiveXObject("Microsoft.XMLHTTP"),n._create=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}catch(e){}}return i.addCommonMethods(n),n});//# sourceMappingURL=xhr.js.map