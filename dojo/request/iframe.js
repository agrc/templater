//>>built
define("dojo/request/iframe",["module","require","./watch","./util","./handlers","../_base/lang","../io-query","../query","../has","../dom","../dom-construct","../_base/window","../NodeList-dom"],function(e,t,a,i,r,d,o,n,l,s,m,u){function f(e,a,i){if(u.global[e])return u.global[e];if(u.global.frames[e])return u.global.frames[e];i||(l("config-useXDomain")&&!l("config-dojoBlankHtmlUrl"),i=l("config-dojoBlankHtmlUrl")||t.toUrl("dojo/resources/blank.html"));var r=m.place('<iframe id="'+e+'" name="'+e+'" src="'+i+'" onload="'+a+'" style="position: absolute; left: 1px; top: 1px; height: 1px; width: 1px; visibility: hidden">',u.body());return u.global[e]=r,r}function h(e,t,a){var i=u.global.frames[e.name];i.contentWindow&&(i=i.contentWindow);try{a?i.location.replace(t):i.location=t}catch(r){}}function c(e){if(e.contentDocument)return e.contentDocument;var t=e.name;if(t){var a=u.doc.getElementsByTagName("iframe");if(e.document&&a[t].contentWindow&&a[t].contentWindow.document)return a[t].contentWindow.document;if(u.doc.frames[t]&&u.doc.frames[t].document)return u.doc.frames[t].document}return null}function y(){return m.create("form",{name:k+"_form",style:{position:"absolute",top:"-1000px",left:"-1000px"}},u.body())}function v(){var e;try{if(w._currentDfd||!w._dfdQueue.length)return;do e=w._currentDfd=w._dfdQueue.shift();while(e&&(e.canceled||e.isCanceled&&e.isCanceled())&&w._dfdQueue.length);if(!e||e.canceled||e.isCanceled&&e.isCanceled())return void(w._currentDfd=null);var t,a=e.response,r=a.options,n=e._contentToClean=[],l=s.byId(r.form),f=i.notify,h=r.data||null;if(e._legacy||"POST"!==r.method||l?"GET"===r.method&&l&&a.url.indexOf("?")>-1&&(t=a.url.slice(a.url.indexOf("?")+1),h=d.mixin(o.queryToObject(t),h)):l=e._tmpForm=y(),l){if(!e._legacy){var c=l;do c=c.parentNode;while(c&&c!==u.doc.documentElement);c||(l.style.position="absolute",l.style.left="-1000px",l.style.top="-1000px",u.body().appendChild(l)),l.name||(l.name=k+"_form")}if(h){var v=function(e,t){m.create("input",{type:"hidden",name:e,value:t},l),n.push(e)};for(var p in h){var g=h[p];if(d.isArray(g)&&g.length>1)for(var M=0;M<g.length;M++)v(p,g[M]);else l[p]?l[p].value=g:v(p,g)}}var b=l.getAttributeNode("action"),F=l.getAttributeNode("method"),I=l.getAttributeNode("target");a.url&&(e._originalAction=b?b.value:null,b?b.value=a.url:l.setAttribute("action",a.url)),e._legacy?F&&F.value||(F?F.value=r.method:l.setAttribute("method",r.method)):(e._originalMethod=F?F.value:null,F?F.value=r.method:l.setAttribute("method",r.method)),e._originalTarget=I?I.value:null,I?I.value=w._iframeName:l.setAttribute("target",w._iframeName),l.target=w._iframeName,f&&f.emit("send",a,e.promise.cancel),w._notifyStart(a),l.submit()}else{var _="";a.options.data&&(_=a.options.data,"string"!=typeof _&&(_=o.objectToQuery(_)));var j=a.url+(a.url.indexOf("?")>-1?"&":"?")+_;f&&f.emit("send",a,e.promise.cancel),w._notifyStart(a),w.setSrc(w._frame,j,!0)}}catch(E){e.reject(E)}}function p(e){return!this.isFulfilled()}function g(e){return!!this._finished}function M(e,t){if(!t)try{var a=e.options,i=w.doc(w._frame),o=a.handleAs;if("html"!==o){if("xml"===o)if("html"===i.documentElement.tagName.toLowerCase()){n("a",i.documentElement).orphan();var l=i.documentElement.innerText||i.documentElement.textContent;l=l.replace(/>\s+</g,"><"),e.text=d.trim(l)}else e.data=i;else e.text=i.getElementsByTagName("textarea")[0].value;r(e)}else e.data=i}catch(s){t=s}t?this.reject(t):this._finished?this.resolve(e):this.reject(new Error("Invalid dojo/request/iframe request state"))}function b(e){this._callNext()}function w(e,t,r){var d=i.parseArgs(e,i.deepCreate(I,t),!0);if(e=d.url,t=d.options,"GET"!==t.method&&"POST"!==t.method)throw new Error(t.method+" not supported by dojo/request/iframe");w._frame||(w._frame=w.create(w._iframeName,F+"();"));var o=i.deferred(d,null,p,g,M,b);return o._callNext=function(){this._calledNext||(this._calledNext=!0,w._currentDfd=null,w._fireNextRequest())},o._legacy=r,w._dfdQueue.push(o),w._fireNextRequest(),a(o),r?o:o.promise}var k=e.id.replace(/[\/\.\-]/g,"_"),F=k+"_onload";u.global[F]||(u.global[F]=function(){var e=w._currentDfd;if(!e)return void w._fireNextRequest();var t=e.response,a=t.options,i=s.byId(a.form)||e._tmpForm;if(i){for(var r=e._contentToClean,d=0;d<r.length;d++)for(var o=r[d],n=0;n<i.childNodes.length;n++){var l=i.childNodes[n];if(l.name===o){m.destroy(l);break}}e._originalAction&&i.setAttribute("action",e._originalAction),e._originalMethod&&(i.setAttribute("method",e._originalMethod),i.method=e._originalMethod),e._originalTarget&&(i.setAttribute("target",e._originalTarget),i.target=e._originalTarget)}e._tmpForm&&(m.destroy(e._tmpForm),delete e._tmpForm),e._finished=!0});var I={method:"POST"};return w.create=f,w.doc=c,w.setSrc=h,w._iframeName=k+"_IoIframe",w._notifyStart=function(){},w._dfdQueue=[],w._currentDfd=null,w._fireNextRequest=v,i.addCommonMethods(w,["GET","POST"]),w});//# sourceMappingURL=iframe.js.map