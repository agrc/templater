//>>built
define("dojo/request/iframe",["module","require","./watch","./util","./handlers","../_base/lang","../io-query","../query","../has","../dom","../dom-construct","../_base/window","../NodeList-dom"],function(e,t,i,r,a,n,o,d,l,s,u,f){function c(e,i,r){if(f.global[e])return f.global[e];if(f.global.frames[e])return f.global.frames[e];r||(l("config-useXDomain")&&!l("config-dojoBlankHtmlUrl"),r=l("config-dojoBlankHtmlUrl")||t.toUrl("dojo/resources/blank.html"));var a=u.place('<iframe id="'+e+'" name="'+e+'" src="'+r+'" onload="'+i+'" style="position: absolute; left: 1px; top: 1px; height: 1px; width: 1px; visibility: hidden">',f.body());return f.global[e]=a,a}function m(e,t,i){var r=f.global.frames[e.name];r.contentWindow&&(r=r.contentWindow);try{i?r.location.replace(t):r.location=t}catch(a){}}function h(e){if(e.contentDocument)return e.contentDocument;var t=e.name;if(t){var i=f.doc.getElementsByTagName("iframe");if(e.document&&i[t].contentWindow&&i[t].contentWindow.document)return i[t].contentWindow.document;if(f.doc.frames[t]&&f.doc.frames[t].document)return f.doc.frames[t].document}return null}function y(){return u.create("form",{name:k+"_form",style:{position:"absolute",top:"-1000px",left:"-1000px"}},f.body())}function p(){var e;try{if(w._currentDfd||!w._dfdQueue.length)return;do e=w._currentDfd=w._dfdQueue.shift();while(e&&(e.canceled||e.isCanceled&&e.isCanceled())&&w._dfdQueue.length);if(!e||e.canceled||e.isCanceled&&e.isCanceled())return void(w._currentDfd=null);var t,i=e.response,a=i.options,d=e._contentToClean=[],l=s.byId(a.form),c=r.notify,m=a.data||null;if(e._legacy||"POST"!==a.method||l?"GET"===a.method&&l&&i.url.indexOf("?")>-1&&(t=i.url.slice(i.url.indexOf("?")+1),m=n.mixin(o.queryToObject(t),m)):l=e._tmpForm=y(),l){if(!e._legacy){var h=l;do h=h.parentNode;while(h&&h!==f.doc.documentElement);h||(l.style.position="absolute",l.style.left="-1000px",l.style.top="-1000px",f.body().appendChild(l)),l.name||(l.name=k+"_form")}if(m){var p=function(e,t){u.create("input",{type:"hidden",name:e,value:t},l),d.push(e)};for(var v in m){var g=m[v];if(n.isArray(g)&&g.length>1)for(var b=0;b<g.length;b++)p(v,g[b]);else l[v]?l[v].value=g:p(v,g)}}var M=l.getAttributeNode("action"),_=l.getAttributeNode("method"),F=l.getAttributeNode("target");i.url&&(e._originalAction=M?M.value:null,M?M.value=i.url:l.setAttribute("action",i.url)),e._legacy?_&&_.value||(_?_.value=a.method:l.setAttribute("method",a.method)):(e._originalMethod=_?_.value:null,_?_.value=a.method:l.setAttribute("method",a.method)),e._originalTarget=F?F.value:null,F?F.value=w._iframeName:l.setAttribute("target",w._iframeName),l.target=w._iframeName,c&&c.emit("send",i,e.promise.cancel),w._notifyStart(i),l.submit()}else{var j="";i.options.data&&(j=i.options.data,"string"!=typeof j&&(j=o.objectToQuery(j)));var I=i.url+(i.url.indexOf("?")>-1?"&":"?")+j;c&&c.emit("send",i,e.promise.cancel),w._notifyStart(i),w.setSrc(w._frame,I,!0)}}catch(E){e.reject(E)}}function v(e){return!this.isFulfilled()}function g(e){return!!this._finished}function b(e,t){if(!t)try{var i=e.options,r=w.doc(w._frame),o=i.handleAs;if("html"!==o){if("xml"===o)if("html"===r.documentElement.tagName.toLowerCase()){d("a",r.documentElement).orphan();var l=r.documentElement.innerText||r.documentElement.textContent;l=l.replace(/>\s+</g,"><"),e.text=n.trim(l)}else e.data=r;else e.text=r.getElementsByTagName("textarea")[0].value;a(e)}else e.data=r}catch(s){t=s}t?this.reject(t):this._finished?this.resolve(e):this.reject(new Error("Invalid dojo/request/iframe request state"))}function M(e){this._callNext()}function w(e,t,a){var n=r.parseArgs(e,r.deepCreate(F,t),!0);if(e=n.url,t=n.options,"GET"!==t.method&&"POST"!==t.method)throw new Error(t.method+" not supported by dojo/request/iframe");w._frame||(w._frame=w.create(w._iframeName,_+"();"));var o=r.deferred(n,null,v,g,b,M);return o._callNext=function(){this._calledNext||(this._calledNext=!0,w._currentDfd=null,w._fireNextRequest())},o._legacy=a,w._dfdQueue.push(o),w._fireNextRequest(),i(o),a?o:o.promise}var k=e.id.replace(/[\/\.\-]/g,"_"),_=k+"_onload";f.global[_]||(f.global[_]=function(){var e=w._currentDfd;if(!e)return void w._fireNextRequest();var t=e.response,i=t.options,r=s.byId(i.form)||e._tmpForm;if(r){for(var a=e._contentToClean,n=0;n<a.length;n++)for(var o=a[n],d=0;d<r.childNodes.length;d++){var l=r.childNodes[d];if(l.name===o){u.destroy(l);break}}e._originalAction&&r.setAttribute("action",e._originalAction),e._originalMethod&&(r.setAttribute("method",e._originalMethod),r.method=e._originalMethod),e._originalTarget&&(r.setAttribute("target",e._originalTarget),r.target=e._originalTarget)}e._tmpForm&&(u.destroy(e._tmpForm),delete e._tmpForm),e._finished=!0});var F={method:"POST"};return w.create=c,w.doc=h,w.setSrc=m,w._iframeName=k+"_IoIframe",w._notifyStart=function(){},w._dfdQueue=[],w._currentDfd=null,w._fireNextRequest=p,r.addCommonMethods(w,["GET","POST"]),w});//# sourceMappingURL=iframe.js.map