//>>built
define("dojo/request/iframe",["module","require","./watch","./util","./handlers","../_base/lang","../io-query","../query","../has","../dom","../dom-construct","../_base/window","../NodeList-dom"],function(e,t,i,a,r,n,o,d,s,l,u,f){function c(e,i,a){if(f.global[e])return f.global[e];if(f.global.frames[e])return f.global.frames[e];a||(s("config-useXDomain")&&!s("config-dojoBlankHtmlUrl"),a=s("config-dojoBlankHtmlUrl")||t.toUrl("dojo/resources/blank.html"));var r=u.place('<iframe id="'+e+'" name="'+e+'" src="'+a+'" onload="'+i+'" style="position: absolute; left: 1px; top: 1px; height: 1px; width: 1px; visibility: hidden">',f.body());return f.global[e]=r,r}function m(e,t,i){var a=f.global.frames[e.name];a.contentWindow&&(a=a.contentWindow);try{i?a.location.replace(t):a.location=t}catch(r){}}function h(e){if(e.contentDocument)return e.contentDocument;var t=e.name;if(t){var i=f.doc.getElementsByTagName("iframe");if(e.document&&i[t].contentWindow&&i[t].contentWindow.document)return i[t].contentWindow.document;if(f.doc.frames[t]&&f.doc.frames[t].document)return f.doc.frames[t].document}return null}function y(){return u.create("form",{name:k+"_form",style:{position:"absolute",top:"-1000px",left:"-1000px"}},f.body())}function p(){var e;try{if(w._currentDfd||!w._dfdQueue.length)return;do e=w._currentDfd=w._dfdQueue.shift();while(e&&(e.canceled||e.isCanceled&&e.isCanceled())&&w._dfdQueue.length);if(!e||e.canceled||e.isCanceled&&e.isCanceled())return void(w._currentDfd=null);var t,i=e.response,r=i.options,d=e._contentToClean=[],s=l.byId(r.form),c=a.notify,m=r.data||null;if(e._legacy||"POST"!==r.method||s?"GET"===r.method&&s&&i.url.indexOf("?")>-1&&(t=i.url.slice(i.url.indexOf("?")+1),m=n.mixin(o.queryToObject(t),m)):s=e._tmpForm=y(),s){if(!e._legacy){var h=s;do h=h.parentNode;while(h&&h!==f.doc.documentElement);h||(s.style.position="absolute",s.style.left="-1000px",s.style.top="-1000px",f.body().appendChild(s)),s.name||(s.name=k+"_form")}if(m){var p=function(e,t){u.create("input",{type:"hidden",name:e,value:t},s),d.push(e)};for(var v in m){var g=m[v];if(n.isArray(g)&&g.length>1)for(var b=0;b<g.length;b++)p(v,g[b]);else s[v]?s[v].value=g:p(v,g)}}var M=s.getAttributeNode("action"),_=s.getAttributeNode("method"),j=s.getAttributeNode("target");i.url&&(e._originalAction=M?M.value:null,M?M.value=i.url:s.setAttribute("action",i.url)),e._legacy?_&&_.value||(_?_.value=r.method:s.setAttribute("method",r.method)):(e._originalMethod=_?_.value:null,_?_.value=r.method:s.setAttribute("method",r.method)),e._originalTarget=j?j.value:null,j?j.value=w._iframeName:s.setAttribute("target",w._iframeName),s.target=w._iframeName,c&&c.emit("send",i,e.promise.cancel),w._notifyStart(i),s.submit()}else{var F="";i.options.data&&(F=i.options.data,"string"!=typeof F&&(F=o.objectToQuery(F)));var I=i.url+(i.url.indexOf("?")>-1?"&":"?")+F;c&&c.emit("send",i,e.promise.cancel),w._notifyStart(i),w.setSrc(w._frame,I,!0)}}catch(x){e.reject(x)}}function v(e){return!this.isFulfilled()}function g(e){return!!this._finished}function b(e,t){if(!t)try{var i=e.options,a=w.doc(w._frame),o=i.handleAs;if("html"!==o){if("xml"===o)if("html"===a.documentElement.tagName.toLowerCase()){d("a",a.documentElement).orphan();var s=a.documentElement.innerText||a.documentElement.textContent;s=s.replace(/>\s+</g,"><"),e.text=n.trim(s)}else e.data=a;else e.text=a.getElementsByTagName("textarea")[0].value;r(e)}else e.data=a}catch(l){t=l}t?this.reject(t):this._finished?this.resolve(e):this.reject(new Error("Invalid dojo/request/iframe request state"))}function M(e){this._callNext()}function w(e,t,r){var n=a.parseArgs(e,a.deepCreate(j,t),!0);if(e=n.url,t=n.options,"GET"!==t.method&&"POST"!==t.method)throw new Error(t.method+" not supported by dojo/request/iframe");w._frame||(w._frame=w.create(w._iframeName,_+"();"));var o=a.deferred(n,null,v,g,b,M);return o._callNext=function(){this._calledNext||(this._calledNext=!0,w._currentDfd=null,w._fireNextRequest())},o._legacy=r,w._dfdQueue.push(o),w._fireNextRequest(),i(o),r?o:o.promise}var k=e.id.replace(/[\/\.\-]/g,"_"),_=k+"_onload";f.global[_]||(f.global[_]=function(){var e=w._currentDfd;if(!e)return void w._fireNextRequest();var t=e.response,i=t.options,a=l.byId(i.form)||e._tmpForm;if(a){for(var r=e._contentToClean,n=0;n<r.length;n++)for(var o=r[n],d=0;d<a.childNodes.length;d++){var s=a.childNodes[d];if(s.name===o){u.destroy(s);break}}e._originalAction&&a.setAttribute("action",e._originalAction),e._originalMethod&&(a.setAttribute("method",e._originalMethod),a.method=e._originalMethod),e._originalTarget&&(a.setAttribute("target",e._originalTarget),a.target=e._originalTarget)}e._tmpForm&&(u.destroy(e._tmpForm),delete e._tmpForm),e._finished=!0});var j={method:"POST"};return w.create=c,w.doc=h,w.setSrc=m,w._iframeName=k+"_IoIframe",w._notifyStart=function(){},w._dfdQueue=[],w._currentDfd=null,w._fireNextRequest=p,a.addCommonMethods(w,["GET","POST"]),w});//# sourceMappingURL=iframe.js.map