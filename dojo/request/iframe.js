//>>built
define("dojo/request/iframe",["module","require","./watch","./util","./handlers","../_base/lang","../io-query","../query","../has","../dom","../dom-construct","../_base/window","../NodeList-dom"],function(e,t,a,i,r,d,o,n,l,s,m,f){function u(e,a,i){if(f.global[e])return f.global[e];if(f.global.frames[e])return f.global.frames[e];i||(l("config-useXDomain")&&l("config-dojoBlankHtmlUrl"),i=l("config-dojoBlankHtmlUrl")||t.toUrl("dojo/resources/blank.html"));var r=m.place('<iframe id="'+e+'" name="'+e+'" src="'+i+'" onload="'+a+'" style="position: absolute; left: 1px; top: 1px; height: 1px; width: 1px; visibility: hidden">',f.body());return f.global[e]=r,r}function h(e,t,a){var i=f.global.frames[e.name];i.contentWindow&&(i=i.contentWindow);try{a?i.location.replace(t):i.location=t}catch(e){}}function y(e){if(e.contentDocument)return e.contentDocument;var t=e.name;if(t){var a=f.doc.getElementsByTagName("iframe");if(e.document&&a[t].contentWindow&&a[t].contentWindow.document)return a[t].contentWindow.document;if(f.doc.frames[t]&&f.doc.frames[t].document)return f.doc.frames[t].document}return null}function c(){return m.create("form",{name:w+"_form",style:{position:"absolute",top:"-1000px",left:"-1000px"}},f.body())}function v(){var e;try{if(k._currentDfd||!k._dfdQueue.length)return;do{e=k._currentDfd=k._dfdQueue.shift()}while(e&&(e.canceled||e.isCanceled&&e.isCanceled())&&k._dfdQueue.length);if(!e||e.canceled||e.isCanceled&&e.isCanceled())return void(k._currentDfd=null);var t,a=e.response,r=a.options,n=e._contentToClean=[],l=s.byId(r.form),u=i.notify,h=r.data||null;if(e._legacy||"POST"!==r.method||l?"GET"===r.method&&l&&a.url.indexOf("?")>-1&&(t=a.url.slice(a.url.indexOf("?")+1),h=d.mixin(o.queryToObject(t),h)):l=e._tmpForm=c(),l){if(!e._legacy){var y=l;do{y=y.parentNode}while(y&&y!==f.doc.documentElement);y||(l.style.position="absolute",l.style.left="-1000px",l.style.top="-1000px",f.body().appendChild(l)),l.name||(l.name=w+"_form")}if(h){var v=function(e,t){m.create("input",{type:"hidden",name:e,value:t},l),n.push(e)};for(var M in h){var g=h[M];if(d.isArray(g)&&g.length>1)for(var p=0;p<g.length;p++)v(M,g[p]);else l[M]?l[M].value=g:v(M,g)}}var b=l.getAttributeNode("action"),F=l.getAttributeNode("method"),I=l.getAttributeNode("target");a.url&&(e._originalAction=b?b.value:null,b?b.value=a.url:l.setAttribute("action",a.url)),e._legacy?F&&F.value||(F?F.value=r.method:l.setAttribute("method",r.method)):(e._originalMethod=F?F.value:null,F?F.value=r.method:l.setAttribute("method",r.method)),e._originalTarget=I?I.value:null,I?I.value=k._iframeName:l.setAttribute("target",k._iframeName),l.target=k._iframeName,u&&u.emit("send",a,e.promise.cancel),k._notifyStart(a),l.submit()}else{var _="";a.options.data&&"string"!=typeof(_=a.options.data)&&(_=o.objectToQuery(_));var j=a.url+(a.url.indexOf("?")>-1?"&":"?")+_;u&&u.emit("send",a,e.promise.cancel),k._notifyStart(a),k.setSrc(k._frame,j,!0)}}catch(t){e.reject(t)}}function M(e){return!this.isFulfilled()}function g(e){return!!this._finished}function p(e,t){if(!t)try{var a=e.options,i=k.doc(k._frame),o=a.handleAs;if("html"!==o){if("xml"===o)if("html"===i.documentElement.tagName.toLowerCase()){n("a",i.documentElement).orphan();var l=i.documentElement.innerText||i.documentElement.textContent;l=l.replace(/>\s+</g,"><"),e.text=d.trim(l)}else e.data=i;else e.text=i.getElementsByTagName("textarea")[0].value;r(e)}else e.data=i}catch(e){t=e}t?this.reject(t):this._finished?this.resolve(e):this.reject(new Error("Invalid dojo/request/iframe request state"))}function b(e){this._callNext()}function k(e,t,r){var d=i.parseArgs(e,i.deepCreate(I,t),!0);if(e=d.url,t=d.options,"GET"!==t.method&&"POST"!==t.method)throw new Error(t.method+" not supported by dojo/request/iframe");k._frame||(k._frame=k.create(k._iframeName,F+"();"));var o=i.deferred(d,null,M,g,p,b);return o._callNext=function(){this._calledNext||(this._calledNext=!0,k._currentDfd=null,k._fireNextRequest())},o._legacy=r,k._dfdQueue.push(o),k._fireNextRequest(),a(o),r?o:o.promise}var w=e.id.replace(/[\/\.\-]/g,"_"),F=w+"_onload";f.global[F]||(f.global[F]=function(){var e=k._currentDfd;if(!e)return void k._fireNextRequest();var t=e.response,a=t.options,i=s.byId(a.form)||e._tmpForm;if(i){for(var r=e._contentToClean,d=0;d<r.length;d++)for(var o=r[d],n=0;n<i.childNodes.length;n++){var l=i.childNodes[n];if(l.name===o){m.destroy(l);break}}e._originalAction&&i.setAttribute("action",e._originalAction),e._originalMethod&&(i.setAttribute("method",e._originalMethod),i.method=e._originalMethod),e._originalTarget&&(i.setAttribute("target",e._originalTarget),i.target=e._originalTarget)}e._tmpForm&&(m.destroy(e._tmpForm),delete e._tmpForm),e._finished=!0});var I={method:"POST"};return k.create=u,k.doc=y,k.setSrc=h,k._iframeName=w+"_IoIframe",k._notifyStart=function(){},k._dfdQueue=[],k._currentDfd=null,k._fireNextRequest=v,i.addCommonMethods(k,["GET","POST"]),k});//# sourceMappingURL=iframe.js.map