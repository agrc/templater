//>>built
define("dojo/request/iframe",["module","require","./watch","./util","./handlers","../_base/lang","../io-query","../query","../has","../dom","../dom-construct","../_base/window","../NodeList-dom"],function(e,t,r,a,i,n,o,d,s,l,u,c){function f(e,r,a){if(c.global[e])return c.global[e];if(c.global.frames[e])return c.global.frames[e];a||(s("config-useXDomain")&&s("config-dojoBlankHtmlUrl"),a=s("config-dojoBlankHtmlUrl")||t.toUrl("dojo/resources/blank.html"));var i=u.place('<iframe id="'+e+'" name="'+e+'" src="'+a+'" onload="'+r+'" style="position: absolute; left: 1px; top: 1px; height: 1px; width: 1px; visibility: hidden">',c.body());return c.global[e]=i,i}function m(e,t,r){var a=c.global.frames[e.name];a.contentWindow&&(a=a.contentWindow);try{r?a.location.replace(t):a.location=t}catch(e){}}function h(e){if(e.contentDocument)return e.contentDocument;var t=e.name;if(t){var r=c.doc.getElementsByTagName("iframe");if(e.document&&r[t].contentWindow&&r[t].contentWindow.document)return r[t].contentWindow.document;if(c.doc.frames[t]&&c.doc.frames[t].document)return c.doc.frames[t].document}return null}function p(){return u.create("form",{name:k+"_form",style:{position:"absolute",top:"-1000px",left:"-1000px"}},c.body())}function y(){var e;try{if(w._currentDfd||!w._dfdQueue.length)return;do{e=w._currentDfd=w._dfdQueue.shift()}while(e&&(e.canceled||e.isCanceled&&e.isCanceled())&&w._dfdQueue.length);if(!e||e.canceled||e.isCanceled&&e.isCanceled())return void(w._currentDfd=null);var t,r=e.response,i=r.options,d=e._contentToClean=[],s=l.byId(i.form),f=a.notify,m=i.data||null;if(e._legacy||"POST"!==i.method||s?"GET"===i.method&&s&&r.url.indexOf("?")>-1&&(t=r.url.slice(r.url.indexOf("?")+1),m=n.mixin(o.queryToObject(t),m)):s=e._tmpForm=p(),s){if(!e._legacy){var h=s;do{h=h.parentNode}while(h&&h!==c.doc.documentElement);h||(s.style.position="absolute",s.style.left="-1000px",s.style.top="-1000px",c.body().appendChild(s)),s.name||(s.name=k+"_form")}if(m){var y=function(e,t){u.create("input",{type:"hidden",name:e,value:t},s),d.push(e)};for(var v in m){var g=m[v];if(n.isArray(g)&&g.length>1)for(var b=0;b<g.length;b++)y(v,g[b]);else s[v]?s[v].value=g:y(v,g)}}var M=s.getAttributeNode("action"),_=s.getAttributeNode("method"),F=s.getAttributeNode("target");r.url&&(e._originalAction=M?M.value:null,M?M.value=r.url:s.setAttribute("action",r.url)),e._legacy?_&&_.value||(_?_.value=i.method:s.setAttribute("method",i.method)):(e._originalMethod=_?_.value:null,_?_.value=i.method:s.setAttribute("method",i.method)),e._originalTarget=F?F.value:null,F?F.value=w._iframeName:s.setAttribute("target",w._iframeName),s.target=w._iframeName,f&&f.emit("send",r,e.promise.cancel),w._notifyStart(r),s.submit()}else{var j="";r.options.data&&"string"!=typeof(j=r.options.data)&&(j=o.objectToQuery(j));var I=r.url+(r.url.indexOf("?")>-1?"&":"?")+j;f&&f.emit("send",r,e.promise.cancel),w._notifyStart(r),w.setSrc(w._frame,I,!0)}}catch(t){e.reject(t)}}function v(e){return!this.isFulfilled()}function g(e){return!!this._finished}function b(e,t){if(!t)try{var r=e.options,a=w.doc(w._frame),o=r.handleAs;if("html"!==o){if("xml"===o)if("html"===a.documentElement.tagName.toLowerCase()){d("a",a.documentElement).orphan();var s=a.documentElement.innerText||a.documentElement.textContent;s=s.replace(/>\s+</g,"><"),e.text=n.trim(s)}else e.data=a;else e.text=a.getElementsByTagName("textarea")[0].value;i(e)}else e.data=a}catch(e){t=e}t?this.reject(t):this._finished?this.resolve(e):this.reject(new Error("Invalid dojo/request/iframe request state"))}function M(e){this._callNext()}function w(e,t,i){var n=a.parseArgs(e,a.deepCreate(F,t),!0);if(e=n.url,t=n.options,"GET"!==t.method&&"POST"!==t.method)throw new Error(t.method+" not supported by dojo/request/iframe");w._frame||(w._frame=w.create(w._iframeName,_+"();"));var o=a.deferred(n,null,v,g,b,M);return o._callNext=function(){this._calledNext||(this._calledNext=!0,w._currentDfd=null,w._fireNextRequest())},o._legacy=i,w._dfdQueue.push(o),w._fireNextRequest(),r(o),i?o:o.promise}var k=e.id.replace(/[\/\.\-]/g,"_"),_=k+"_onload";c.global[_]||(c.global[_]=function(){var e=w._currentDfd;if(!e)return void w._fireNextRequest();var t=e.response,r=t.options,a=l.byId(r.form)||e._tmpForm;if(a){for(var i=e._contentToClean,n=0;n<i.length;n++)for(var o=i[n],d=0;d<a.childNodes.length;d++){var s=a.childNodes[d];if(s.name===o){u.destroy(s);break}}e._originalAction&&a.setAttribute("action",e._originalAction),e._originalMethod&&(a.setAttribute("method",e._originalMethod),a.method=e._originalMethod),e._originalTarget&&(a.setAttribute("target",e._originalTarget),a.target=e._originalTarget)}e._tmpForm&&(u.destroy(e._tmpForm),delete e._tmpForm),e._finished=!0});var F={method:"POST"};return w.create=f,w.doc=h,w.setSrc=m,w._iframeName=k+"_IoIframe",w._notifyStart=function(){},w._dfdQueue=[],w._currentDfd=null,w._fireNextRequest=y,a.addCommonMethods(w,["GET","POST"]),w});//# sourceMappingURL=iframe.js.map