//>>built
define("dojo/query",["./_base/kernel","./has","./dom","./on","./_base/array","./_base/lang","./selector/_loader","./selector/_loader!default"],function(t,e,i,n,o,r,a,s){"use strict";function d(t,e){var n=function(n,o){if("string"==typeof o&&(o=i.byId(o),!o))return new e([]);var r="string"==typeof n?t(n,o):n?n.end&&n.on?n:[n]:[];return r.end&&r.on?r:new e(r)};if(n.matches=t.match||function(t,e,i){return n.filter([t],e,i).length>0},n.filter=t.filter||function(t,e,i){return n(e,i).filter(function(e){return o.indexOf(t,e)>-1})},"function"!=typeof t){var r=t.search;t=function(t,e){return r(e||document,t)}}return n}e.add("array-extensible",function(){return 1==r.delegate([],{length:1}).length&&!e("bug-for-in-skips-shadowed")});var l=Array.prototype,u=l.slice,h=l.concat,c=o.forEach,f=function(t,e,i){var n=new(i||this._NodeListCtor||y)(t);return e?n._stash(e):n},p=function(e,i,n){return i=[0].concat(u.call(i,0)),n=n||t.global,function(t){return i[0]=t,e.apply(n,i)}},m=function(t,e){return function(){return this.forEach(p(t,arguments,e)),this}},g=function(t,e){return function(){return this.map(p(t,arguments,e))}},_=function(t,e){return function(){return this.filter(p(t,arguments,e))}},b=function(e,i,n){return function(){var o=arguments,r=p(e,o,n);return i.call(n||t.global,o)?this.map(r):(this.forEach(r),this)}},v=function(t){var i=this instanceof y&&e("array-extensible");"number"==typeof t&&(t=Array(t));var n=t&&"length"in t?t:arguments;if(i||!n.sort){for(var o=i?this:[],a=o.length=n.length,s=0;a>s;s++)o[s]=n[s];if(i)return o;n=o}return r._mixin(n,j),n._NodeListCtor=function(t){return y(t)},n},y=v,j=y.prototype=e("array-extensible")?[]:{};y._wrap=j._wrap=f,y._adaptAsMap=g,y._adaptAsForEach=m,y._adaptAsFilter=_,y._adaptWithCondition=b,c(["slice","splice"],function(t){var e=l[t];j[t]=function(){return this._wrap(e.apply(this,arguments),"slice"==t?this:null)}}),c(["indexOf","lastIndexOf","every","some"],function(e){var i=o[e];j[e]=function(){return i.apply(t,[this].concat(u.call(arguments,0)))}}),r.extend(v,{constructor:y,_NodeListCtor:y,toString:function(){return this.join(",")},_stash:function(t){return this._parent=t,this},on:function(t,e){var i=this.map(function(i){return n(i,t,e)});return i.remove=function(){for(var t=0;t<i.length;t++)i[t].remove()},i},end:function(){return this._parent?this._parent:new this._NodeListCtor(0)},concat:function(t){var e=u.call(this,0),i=o.map(arguments,function(t){return u.call(t,0)});return this._wrap(h.apply(e,i),this)},map:function(t,e){return this._wrap(o.map(this,t,e),this)},forEach:function(t,e){return c(this,t,e),this},filter:function(t){var e=arguments,i=this,n=0;if("string"==typeof t){if(i=x._filterResult(this,e[0]),1==e.length)return i._stash(this);n=1}return this._wrap(o.filter(i,e[n],e[n+1]),this)},instantiate:function(t,e){var i=r.isFunction(t)?t:r.getObject(t);return e=e||{},this.forEach(function(t){new i(e,t)})},at:function(){var t=new this._NodeListCtor(0);return c(arguments,function(e){0>e&&(e=this.length+e),this[e]&&t.push(this[e])},this),t._stash(this)}});var x=d(s,v);return t.query=d(s,function(t){return v(t)}),x.load=function(t,e,i){a.load(t,e,function(t){i(d(t,v))})},t._filterQueryResult=x._filterResult=function(t,e,i){return new v(x.filter(t,e,i))},t.NodeList=x.NodeList=v,x});//# sourceMappingURL=query.js.map