//>>built
define("dojo/dnd/Container",["../_base/array","../_base/declare","../_base/kernel","../_base/lang","../_base/window","../dom","../dom-class","../dom-construct","../Evented","../has","../on","../query","../touch","./common"],function(e,t,a,i,r,d,o,n,l,s,m,f,u,h){var c=t("dojo.dnd.Container",l,{skipForm:!1,allowNested:!1,constructor:function(e,t){this.node=d.byId(e),t||(t={}),this.creator=t.creator||null,this.skipForm=t.skipForm,this.parent=t.dropParent&&d.byId(t.dropParent),this.map={},this.current=null,this.containerState="",o.add(this.node,"dojoDndContainer"),t&&t._skipStartup||this.startup(),this.events=[m(this.node,u.over,i.hitch(this,"onMouseOver")),m(this.node,u.out,i.hitch(this,"onMouseOut")),m(this.node,"dragstart",i.hitch(this,"onSelectStart")),m(this.node,"selectstart",i.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(e){return this.map[e]},setItem:function(e,t){this.map[e]=t},delItem:function(e){delete this.map[e]},forInItems:function(e,t){t=t||a.global;var i=this.map,r=h._empty;for(var d in i)d in r||e.call(t,i[d],d,this);return t},clearItems:function(){this.map={}},getAllNodes:function(){return f((this.allowNested?"":"> ")+".dojoDndItem",this.parent)},sync:function(){var e={};return this.getAllNodes().forEach(function(t){if(t.id){var a=this.getItem(t.id);if(a)return void(e[t.id]=a)}else t.id=h.getUniqueId();var i=t.getAttribute("dndType"),r=t.getAttribute("dndData");e[t.id]={data:r||t.innerHTML,type:i?i.split(/\s*,\s*/):["text"]}},this),this.map=e,this},insertNodes:function(e,t,a){this.parent.firstChild?t?a||(a=this.parent.firstChild):a&&(a=a.nextSibling):a=null;var i,r;if(a)for(i=0;i<e.length;++i)r=this._normalizedCreator(e[i]),this.setItem(r.node.id,{data:r.data,type:r.type}),a.parentNode.insertBefore(r.node,a);else for(i=0;i<e.length;++i)r=this._normalizedCreator(e[i]),this.setItem(r.node.id,{data:r.data,type:r.type}),this.parent.appendChild(r.node);return this},destroy:function(){e.forEach(this.events,function(e){e.remove()}),this.clearItems(),this.node=this.parent=this.current=null},markupFactory:function(e,t,a){return e._skipStartup=!0,new a(t,e)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var e=this.parent.getElementsByTagName("tbody");e&&e.length&&(this.parent=e[0])}this.defaultCreator=h._defaultCreator(this.parent),this.sync()},onMouseOver:function(e){for(var t=e.relatedTarget;t&&t!=this.node;)try{t=t.parentNode}catch(a){t=null}t||(this._changeState("Container","Over"),this.onOverEvent()),t=this._getChildByEvent(e),this.current!=t&&(this.current&&this._removeItemClass(this.current,"Over"),t&&this._addItemClass(t,"Over"),this.current=t)},onMouseOut:function(e){for(var t=e.relatedTarget;t;){if(t==this.node)return;try{t=t.parentNode}catch(a){t=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null),this._changeState("Container",""),this.onOutEvent()},onSelectStart:function(e){this.skipForm&&h.isFormElement(e)||(e.stopPropagation(),e.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(e,t){var a="dojoDnd"+e,i=e.toLowerCase()+"State";o.replace(this.node,a+t,a+this[i]),this[i]=t},_addItemClass:function(e,t){o.add(e,"dojoDndItem"+t)},_removeItemClass:function(e,t){o.remove(e,"dojoDndItem"+t)},_getChildByEvent:function(e){var t=e.target;if(t)for(var a=t.parentNode;a;t=a,a=t.parentNode)if((a==this.parent||this.allowNested)&&o.contains(t,"dojoDndItem"))return t;return null},_normalizedCreator:function(e,t){var a=(this.creator||this.defaultCreator).call(this,e,t);return i.isArray(a.type)||(a.type=["text"]),a.node.id||(a.node.id=h.getUniqueId()),o.add(a.node,"dojoDndItem"),a}});return h._createNode=function(e){return e?function(t){return n.create(e,{innerHTML:t})}:h._createSpan},h._createTrTd=function(e){var t=n.create("tr");return n.create("td",{innerHTML:e},t),t},h._createSpan=function(e){return n.create("span",{innerHTML:e})},h._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"},h._defaultCreator=function(e){var t=e.tagName.toLowerCase(),a="tbody"==t||"thead"==t?h._createTrTd:h._createNode(h._defaultCreatorNodes[t]);return function(e,t){var r,d,o,n=e&&i.isObject(e);return n&&e.tagName&&e.nodeType&&e.getAttribute?(r=e.getAttribute("dndData")||e.innerHTML,d=e.getAttribute("dndType"),d=d?d.split(/\s*,\s*/):["text"],o=e):(r=n&&e.data?e.data:e,d=n&&e.type?e.type:["text"],o=("avatar"==t?h._createSpan:a)(String(r))),o.id||(o.id=h.getUniqueId()),{node:o,data:r,type:d}}},c});//# sourceMappingURL=Container.js.map