//>>built
define("dojo/promise/instrumentation",["./tracer","../has","../_base/lang","../_base/array"],function(e,t,a,i){function r(e,t,a){var i="";e&&e.stack&&(i+=e.stack),t&&t.stack&&(i+="\n    ----------------------------------------\n    rejected"+t.stack.split("\n").slice(1).join("\n").replace(/^\s+/," ")),a&&a.stack&&(i+="\n    ----------------------------------------\n"+a.stack)}function d(e,t,a,i){t||r(e,a,i)}function o(e,t,a,r){i.some(n,function(a){return a.error===e?(t&&(a.handled=!0),!0):void 0})||n.push({error:e,rejection:a,handled:t,deferred:r,timestamp:(new Date).getTime()}),s||(s=setTimeout(l,m))}function l(){var e=(new Date).getTime(),t=e-m;n=i.filter(n,function(e){return e.timestamp<t?(e.handled||r(e.error,e.rejection,e.deferred),!1):!0}),s=n.length?setTimeout(l,n[0].timestamp+m-e):!1}t.add("config-useDeferredInstrumentation","report-unhandled-rejections");var n=[],s=!1,m=1e3;return function(i){var r=t("config-useDeferredInstrumentation");if(r){e.on("resolved",a.hitch(console,"log","resolved")),e.on("rejected",a.hitch(console,"log","rejected")),e.on("progress",a.hitch(console,"log","progress"));var l=[];if("string"==typeof r&&(l=r.split(","),r=l.shift()),"report-rejections"===r)i.instrumentRejected=d;else{if("report-unhandled-rejections"!==r&&r!==!0&&1!==r)throw new Error("Unsupported instrumentation usage <"+r+">");i.instrumentRejected=o,m=parseInt(l[0],10)||m}}}});//# sourceMappingURL=instrumentation.js.map