//>>built
define("dojo/promise/instrumentation",["./tracer","../has","../_base/lang","../_base/array"],function(e,t,a,i){function r(e,t,a){if(!e||!1!==e.log){var i="";e&&e.stack&&(i+=e.stack),t&&t.stack&&(i+="\n    ----------------------------------------\n    rejected"+t.stack.split("\n").slice(1).join("\n").replace(/^\s+/," ")),a&&a.stack&&(i+="\n    ----------------------------------------\n"+a.stack)}}function d(e,t,a,i){t||r(e,a,i)}function o(e,t,a,r){i.some(l,function(a){if(a.error===e)return t&&(a.handled=!0),!0})||l.push({error:e,rejection:a,handled:t,deferred:r,timestamp:(new Date).getTime()}),s||(s=setTimeout(n,m))}function n(){var e=(new Date).getTime(),t=e-m;l=i.filter(l,function(e){return!(e.timestamp<t)||(e.handled||r(e.error,e.rejection,e.deferred),!1)}),s=!!l.length&&setTimeout(n,l[0].timestamp+m-e)}t.add("config-useDeferredInstrumentation","report-unhandled-rejections");var l=[],s=!1,m=1e3;return function(i){var r=t("config-useDeferredInstrumentation");if(r){e.on("resolved",a.hitch(console,"log","resolved")),e.on("rejected",a.hitch(console,"log","rejected")),e.on("progress",a.hitch(console,"log","progress"));var n=[];if("string"==typeof r&&(n=r.split(","),r=n.shift()),"report-rejections"===r)i.instrumentRejected=d;else{if("report-unhandled-rejections"!==r&&!0!==r&&1!==r)throw new Error("Unsupported instrumentation usage <"+r+">");i.instrumentRejected=o,m=parseInt(n[0],10)||m}}}});//# sourceMappingURL=instrumentation.js.map